function ZCPConstants(){}function Regex(){this.map=null}function getCountryName(countryCode){return countryCode=countryCode?countryCode.toUpperCase():"",""!==countryCode&&countryList.hasOwnProperty(countryCode)?countryList[countryCode]:countryCode}function showDialog(id,title,bodyHTML,buttonName,buttonAction,customWidth,closeAction,removeHeaderFooter,hideCancelButton){"crmplus-dialog"==id&&(AdminPanel.authRoles.set(),title&&$j("#"+id+"-header").text(title),bodyHTML&&$j("#"+id+"-body").html(bodyHTML),buttonName&&$j("#"+id+"-button span").text(buttonName),buttonAction&&$j("#"+id+"-button").attr("onclick",buttonAction),removeHeaderFooter?$j("#"+id+" .dialogWrapper").addClass("zcrmp-alertinfoPopup"):$j("#"+id+" .dialogWrapper").removeClass("zcrmp-alertinfoPopup"),hideCancelButton?$j("#"+id+"-cancel-button").hide():$j("#"+id+"-cancel-button").show(),closeAction?($j("#"+id+"-close").attr("onclick",closeAction),$j("#"+id+"-cancel-button").attr("onclick",closeAction)):($j("#"+id+"-close").attr("onclick",'hideDialog("crmplus-dialog",true)'),$j("#"+id+"-cancel-button").attr("onclick",'hideDialog("crmplus-dialog",true)')),$j("#"+id+"-error").text(""),Common.prevHtmlContext=Common.htmlContext,Common.htmlContext="#"+id),customWidth&&$j("#"+id+" .dialogWrapper").css("width",customWidth+"px");var maxHeight=window.innerHeight-190;$j("body").addClass("popupMode"),$j("#"+id).css({opacity:"0",display:"block",top:"-200px"}),$j("#"+id).animate({opacity:"1",top:"0px"},200),$j("#"+id+" .dialogBody").css("max-height",maxHeight+"px"),$j("#"+id+" .dialogBody").css("overflow","auto")}function hideDialog(id,removeContent){"crmplus-dialog"==id&&window.from_nonUserRequestAccess_accept&&delete window.from_nonUserRequestAccess_accept,$j("#"+id).animate({opacity:"0",top:"-200px"},200,function(){$j("#"+id+" .dialogWrapper").css({width:""}),"roleContainer"!==id&&$j("#conflict_body").html("")}),removeContent&&setTimeout(function(){$j("#"+id+"-body").text("")},200),$j(".js-dialogHeader img").hide(),$j(".js-dialogHeader h4").text(""),$j(".js-dialogHeader a").remove(),Common.htmlContext=Common.prevHtmlContext,setTimeout(function(){$j("#"+id).css({display:"none"})},200)}function showStatusMsg(type,message,milliSeconds){var statusDiv=$j("#status-message");statusDiv.removeClass(),statusDiv.addClass(type),$j("#status-message-span").text(message),statusDiv.css({top:"-100px"}),void 0==milliSeconds&&(milliSeconds=message.length/1.5*100,2e3>milliSeconds&&(milliSeconds=2e3)),notifyMessage("status-message",milliSeconds)}function notifyMessage(id,milliSeconds){var timeout=2e3;void 0!=milliSeconds&&0!=milliSeconds&&(timeout=milliSeconds);var notifyElement=$j("#"+id);notifyElement.show(),notifyElement.animate({top:"0px"},200),setTimeout(function(){notifyElement.hide()},timeout)}function descCharCount(inputObj,length,parentContainer){Common.closeMsg(inputObj);var messageLength=inputObj.value.length;if(void 0===length)var length=750;var lengthdiff=length-parseInt(messageLength);parseInt(lengthdiff)<0?(Common.changeValue(parentContainer,lengthdiff),$(parentContainer).style.color="red"):(Common.changeValue(parentContainer,lengthdiff),$(parentContainer).style.color="#999")}function getCookieByName(cookieName){var cookie=document.cookie,idx=cookie.indexOf(cookieName+"=");if(-1!==idx){var eIdx=cookie.indexOf(";",idx),sIdx=idx+cookieName.length+1,val=null;val=-1!==eIdx?cookie.substring(sIdx,eIdx):cookie.substring(sIdx)}return val}function getDocObj(id){return document.getElementById(id)}function getTargetElementFromEvent(event){return event.srcElement?event.srcElement:event.target?event.target:void 0}function initPopUpHide(){$j("html").click(function(evt){var target=getTargetElementFromEvent(evt);$j("#sidepanelqlinkedit").is(target)||0!==$j("#sidepanelqlinkedit").has(target).length||Common.canHidePanel||(SidePanel.hideQuickLinkEditDialog(),CRMPlusCommonUi.handleLeftPanel()),$j("#"+Common.currentPopupID).is(target)||0!==$j("#"+Common.currentPopupID).has(target).length||hidePanel(),$j("#plusVisitorIcon").is(target)||0!==$j("#plusVisitorIcon").has(target).length||$j("#crmpluscommonui_visitorsonline").is(target)||0!==$j("#crmpluscommonui_visitorsonline").has(target).length||Common.hideVisitorOnlinePanel()})}function initLoading(){$j(document).ajaxSend(function(event,xhr,options){var params=options.loadingParams;if(params){var loadingType=params.type,loading=window.Loading[loadingType];loading.start(params)}}).ajaxComplete(function(event,xhr,options){var params=options.loadingParams;if(params){var loadingType=params.type,loading=window.Loading[loadingType];loading.stop(params)}})}function $(id){return document.getElementById(id)}function $c(selector){return $j(selector,Common.htmlContext)}function showPanel(id,element,style,addSelected,event){event&&Common.stopEvents(event,!0),void 0==element&&(element=$j("#"+id)),null!==Common.currentPopupID&&Common.currentPopupID!==id&&hidePanel(),style&&("translate-y"==style?(element.addClass("showpop"),element.removeClass("hidepop")):"translate-x"==style?(element.addClass("showpopLeft"),element.removeClass("hidepopLeft")):"translate-rx"==style&&$j(element).toggle("slide",{direction:"right"},150),Common.popupVisibilityStyle=style),void 0!==id&&(Common.currentPopupID=id),addSelected&&element.addClass("selected"),element.show()}function hidePanel(removeSelected){if(Common.canHidePanel&&Common.currentPopupID){var divObj=$j("#"+Common.currentPopupID);style=Common.popupVisibilityStyle,style?"translate-y"==style?(divObj.addClass("hidepop"),divObj.removeClass("showpop")):"translate-x"==style?(divObj.addClass("hidepopLeft"),divObj.removeClass("showpopLeft")):"translate-rx"==style&&$j(divObj).toggle("slide",{direction:"right"},100):divObj.hide(),removeSelected&&divObj.removeClass("selected"),callBackForHidePanel(Common.currentPopupID),Common.currentPopupID=null}}function callBackForHidePanel(id){switch(id){case"crmpluscommonuimoremodulelistdiv":$j("#commonUimoreModuleList"+Services.currentView+" > li").each(function(index,li){$j(li).show()}),$j("#crmpluscommonuimoremodulesearchnodata").addClass("hide"),$j("#crmpluscommonuimoremodulesearchbox").val(""),$j("#crmpluscommonuimoremodulesearch").addClass("hide");break;case"crmpluscommonuidepartmentslist":$j("#crmpluscommonuidepartmentsearchinput").val(""),CRMPlusCommonUi.departmentSearchKey="",Services.currentView===ZCPConstants.SERVICE_CRM&&Services.currentView===ZCPConstants.SERVICE_SUPPORT&&CRMPlusCommonUi.searchDepartment();break;case"profilePanel":$j("#sidepanelagentstatusdialog  [id^=sidepanelagent][id$=preferencesoptions]").hide()}}function showSpinnerLoading(id){$j("#"+id).html(Handlebars.templates.spinnerLoading())}function showLoading(){$j("#productLoading").show()}function hideLoading(){$j("#productLoading").hide()}function showServiceSwitchingLoading(serviceName){if(null!==serviceName&&"crmplus"!==serviceName){$j("#zcp-"+serviceName).addClass("switchingAppLoad");var appDiv=$j("#zcp-"+serviceName+" div")[0];void 0!=appDiv&&(appDiv.setAttribute("class","switchingApp"),appDiv.innerHTML='<img src="'+Common.staticImgUrl+"/"+Common.staticHashedFileNames[Common.busyGif]+'" width="30">')}}function hideServiceSwitchingLoading(serviceName){if(null!==serviceName&&"crmplus"!==serviceName){var appDiv=$j("#zcp-"+serviceName+" div")[0];$j("#zcp-"+serviceName).removeClass("switchingAppLoad"),appDiv.classList.remove("switchingApp"),appDiv.innerHTML=""}}function addSelected(element){$j(element).addClass("selected").siblings().removeClass("selected")}function setValue(id,value){$j("#"+id).length>0?$j("#"+id).val(value):$j("."+id).length>0&&$j("."+id).val(value)}function copyCode(element){$j(element).select(),document.execCommand("copy"),$j(".zcrmp-copiedLble").fadeIn(),setTimeout(function(){$j(".zcrmp-copiedLble").fadeOut()},2e3)}function isValidEmail(email){var emailRegex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return emailRegex.test(email)}function setAttr(id,attribute,value){$j("#"+id).length>0?$j("#"+id).attr(attribute,value):$j("."+id).length>0&&$j("."+id).attr(attribute,value)}function linkDropdownToInput(event,inputElementID,value,attrName,attrValue,allowPropogate){var inputEle=$c("#"+inputElementID);if(inputEle.length>0){if(inputEle.val(value),attrName&&inputEle.attr(attrName,attrValue),(void 0==allowPropogate||0==allowPropogate)&&Common.stopEvents(event),inputEle.attr("triggerClick")){var parentID=inputEle.attr("parentID");parentID||(parentID=inputEle.attr("id")+"-cell");var parentElement=$c("#"+parentID)[0];parentElement.setAttribute("appName",inputEle.attr("app_name")),parentElement.click(),parentElement.removeAttribute("appName")}hidePanel()}}function addAttributes(sourceElement,TargetElementID,attributes){if(void 0!==attributes&&0!=attributes.length){var targetElement=$(TargetElementID);for(var index in attributes){var attribute=attributes[index],value=sourceElement.getAttribute(attribute);targetElement.setAttribute(attribute,value)}}}function toggleBulkCheck(parentID,element){var inputs=$j("#"+parentID+" input");inputs.length>0&&(0==$j(element).prop("checked")?inputs.prop("checked",!1):inputs.prop("checked",!0))}function getText(selector){var element=$j(selector);return element.length>0?element.text():""}function getAttrValue(selector,attrName){var element=$j(selector);if(1==element.length){var value=element.attr(attrName);return void 0==value?"":value}return""}function exception(message){this.message=message}function removeClosest(element,closestSelector){$j(element).closest(closestSelector).remove()}function showFixedPop(id,event,targetID,isSkipContentReplace){var contentHeight=$c("#"+id).height()+12;contentHeight=contentHeight>150?150:contentHeight,target=void 0===targetID?$j(event.target):$c("#"+targetID);var top=target.offset().top+target.outerHeight(),left=target.offset().left,width=target.outerWidth();isSkipContentReplace||$j("#adminpanel-fixed-pop").html($c("#"+id).html());var heightDiff=window.innerHeight-($j("#wmstoolbar").height()+contentHeight+top);10>heightDiff&&(top=target.offset().top-contentHeight),$j("#adminpanel-fixed-pop").attr("parentID",targetID),$j("#adminpanel-fixed-pop").css({top:top,left:left,width:width}),$j("#adminpanel-fixed-freeze").show(),setTimeout(function(){$j("#adminpanel-fixed-pop").removeClass("hidepop"),$j("#adminpanel-fixed-pop").addClass("showpop")},.1)}function hideFixedPop(){var parentID=$j("#adminpanel-fixed-pop").attr("parentID");"crmplus-apps-adduser-parent"==parentID&&AdminPanel.util.lookUpForUser(),$j("#adminpanel-fixed-pop").removeAttr("parentID"),$j("#adminpanel-fixed-pop").removeClass("showpop"),$j("#adminpanel-fixed-pop").addClass("hidepop"),setTimeout(function(){$j("#adminpanel-fixed-freeze").hide()},300)}function shakeElement(id){$j("#"+id).length>0&&($j("#"+id).addClass("zcrmp-shake"),setTimeout(function(id){$j("#"+id).removeClass("zcrmp-shake")}.bind(null,id),850))}function Security(){this.param}function Logout(){window.location.href="/logout.sas"}function tooltip(details,evt){$j("#tooltip").remove(),targetEle=!1,tooltip=!1,targetEle=$j(evt.target);var tooltip=$j('<div id="tooltip">'+details+"</div>");tooltip.css("opacity",.6).appendTo("body");var init_tooltip=function(){var pos_left=targetEle.offset().left+targetEle.outerWidth()/2-tooltip.outerWidth()/2,pos_top=targetEle.offset().top-tooltip.outerHeight()-20;if(0>pos_left?(pos_left=targetEle.offset().left+targetEle.outerWidth()/2-20,tooltip.addClass("left")):tooltip.removeClass("left"),pos_left+tooltip.outerWidth()>$j(window).width()?(pos_left=targetEle.offset().left-tooltip.outerWidth()+targetEle.outerWidth()/2+20,tooltip.addClass("right")):tooltip.removeClass("right"),0>pos_top){var pos_top=targetEle.offset().top+targetEle.outerHeight();tooltip.addClass("top")}else tooltip.removeClass("top");tooltip.css({left:pos_left,top:pos_top}).animate({top:"+=10",opacity:.8},200)};init_tooltip(),$j(window).resize(init_tooltip);var remove_tooltip=function(){$j("#tooltip").remove()};targetEle.bind("mouseleave",remove_tooltip),targetEle.bind("click",remove_tooltip)}function BrCookie(){}function sendMail(isFromCustomer,isSupportMail,subject,body,filesArray,successCallback,completeCallback,errorCallback){if(formData=new FormData,formData.append("isFromCustomer",isFromCustomer),formData.append("isSupportMail",isSupportMail),(void 0===body||""===body.trim())&&(body=subject),body=body.replace(/\n/g,"<br>").replace(/\t/g,"<tab>").replace("<script","&lt;script").replace("</script>","&lt;/script&gt;").replace('script">','script"&gt;'),formData.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),formData.append("subject",subject),formData.append("body",body),void 0!==filesArray)for(var i=0;i<filesArray.length;i++)formData.append("filesarray",filesArray[i]);$j.ajax({type:"POST",data:formData,processData:!1,contentType:!1,dataType:"text",url:Common.getPortalUrl(!0)+"/sendmail.do",success:function(data){void 0!==successCallback?successCallback(data):showStatusMsg("success",I18N.getValue("crmplus.message.success"))},complete:function(data){void 0!==completeCallback&&completeCallback(data)},error:function(data){void 0!==errorCallback&&errorCallback(data)}})}function isImageFile(fileName){var imageExtns=[".png",".jpg",".jpeg",".gif"];if(void 0!==fileName){fileName=fileName.toLowerCase();for(index in imageExtns){var extn=imageExtns[index];if(-1!=fileName.indexOf(extn))return!0}}return!1}function createElement(element,id){var DOM=document.createElement(element);return id&&DOM.setAttribute("id",id),DOM}function escapeHtml(string){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(string).replace(/[&<>"'`=\/]/g,function(s){return entityMap[s]})}function showPreview(input,previewCont){if(input.files&&input.files[0]){var file=input.files[0],fileName=file.name;if(!isImageFile(fileName))return;var reader=new FileReader;return reader.onload=function(e){$j("#"+previewCont).show(),$j("#"+previewCont).attr("src",e.target.result)},reader.readAsDataURL(input.files[0]),reader}}function DateUtil(){}function isScrollEndReached(element){var remaining=element.scrollHeight-(element.scrollTop+element.clientHeight);return 10>remaining}function Feedback(){}function ServiceCommunicator(){}function SidePanel(){}function LiveDeskApi(){}function LDUserIdleApi(){}function Setup(){}function getLanguageName(languageCode){return languageCode=languageCode?languageCode.toLowerCase():"",""!==languageCode&&languageList.hasOwnProperty(languageCode)?languageList[languageCode]:languageCode}function registerHandleBarHelper(){Handlebars.registerHelper({I18N:function(text,prepend){return void 0!==prepend&&(text=prepend+text),I18N.getValue(text)},appendText:function(text,toAppendText){return text+toAppendText},startVisitorOnlineTimer:function(duration,timerContainerId){Common.startVisitorOnlineTimer(duration,timerContainerId)},accessNestedValues:function(mainObject,defaultValue,keysArray){for(var returnValue=mainObject,i=1;;i++){var keyName="key"+i,keyValue=keysArray.hash[keyName];if(void 0===keyValue)break;var isBreakLoop=!1;try{returnValue=returnValue[keyValue],void 0===returnValue&&(isBreakLoop=!0)}catch(e){isBreakLoop=!0}if(isBreakLoop){returnValue=defaultValue;break}}return returnValue},applicationListDisplayMessage:function(status){var displayMessageKey="service.configuration.failed";return status==ZCPConstants.NOT_STARTED?displayMessageKey="service.configuration.not.started":status==ZCPConstants.STARTED||status==ZCPConstants.INPROGRESS?displayMessageKey="service.configuration.started":status==ZCPConstants.FINISHED?displayMessageKey="service.configuration.finished":status==ZCPConstants.SOFTLINKED&&(displayMessageKey="service.configuration.softlinked"),displayMessageKey},userImage:function(zuid){var userImageUrl="https://"+Services.serviceUrl.get("userphotourl",!0)+"/file?ID="+zuid+"&fs=thumb";return userImageUrl},ifCond:function(value1,operator,value2,options){return checkCondition(value1,operator,value2)?options.fn(this):options.inverse(this)},fullName:function(firstName,lastName){return Settings.constructFullName(firstName,lastName)},primaryEmail:function(emailArray){return Settings.users.getPrimaryEmail(emailArray)},crmplusRole:function(userRole){var displayKey="crmplus.user.role.member";return userRole&&(1===userRole?displayKey="crmplus.user.role.admin":2===userRole&&(displayKey="crmplus.user.role.owner")),I18N.getValue(displayKey)},getCountryName:function(countryCode){return getCountryName(countryCode)},userAddressInfo:function(addressArray,type){var addressInfo="";if(addressArray&&addressArray.length>0)for(var i in addressArray){var addressJson=addressArray[i];if(1===addressJson.address_type){addressInfo=addressJson[type];break}}return addressInfo&&""!==addressInfo&&(addressInfo="<div class='pB5'>"+addressInfo+"</div>"),addressInfo},servicePosition:function(serviceName,memberDetails){return userServicePosition(serviceName,memberDetails)},appUserPostion:function(serviceName,appsJson){var displayText="";return appsJson.hasOwnProperty(serviceName)&&appsJson[serviceName].hasOwnProperty("members")&&(displayText=userServicePosition(serviceName,appsJson[serviceName].members[0])),displayText},userServicePosition:function(serviceName,member){return userServicePosition(serviceName,member)},constructList:function(type,element,onClickFunction){var listJson;if("country"==type){listJson=countryList;var countryListHTML=Settings.common.constructList(listJson,element,onClickFunction);return new Handlebars.SafeString(countryListHTML)}},roleComponent:function(serviceName,rolesArray,departmentId){var roleComponent="";if(!$j.isEmptyObject(rolesArray))for(var i in rolesArray){var roleObj=rolesArray[i];if(roleObj.hasOwnProperty("is_default")&&roleObj.is_default){roleComponent="<span id='"+departmentId+"_"+serviceName+"_role' "+serviceName+"_iamrole='"+roleObj.iam_sorg_role+"' "+serviceName+"_roleid='"+roleObj.role_id+"'>"+Handlebars.escapeExpression(roleObj.role_name)+"</span>";break}}return""===roleComponent&&(roleComponent="<span id='"+departmentId+"_"+serviceName+"_role' "+serviceName+"_iamrole='' "+serviceName+"_roleid='' class='greyTxt'>"+I18N.getValue("crmplus.label.select.role")+"</span>"),roleComponent},profileComponent:function(serviceName,profileArray,departmentId){var profileComponent="";if(!$j.isEmptyObject(profileArray))for(var i in profileArray){var profileObj=profileArray[i];if(profileObj.hasOwnProperty("is_default")&&profileObj.is_default){profileComponent="<span id='"+departmentId+"_"+serviceName+"_profile' "+serviceName+"_iamrole='"+profileObj.iam_sorg_role+"' "+serviceName+"_profileid='"+profileObj.profile_id+"'>"+Handlebars.escapeExpression(profileObj.profile_name)+"</span>";break}}return""===profileComponent&&(profileComponent="<span id='"+departmentId+"_"+serviceName+"_profile' "+serviceName+"_iamrole='' "+serviceName+"_profileid='' class='greyTxt'>"+I18N.getValue("crmplus.label.select.profile")+"</span>"),profileComponent},departmentRoleList:function(serviceName,departmentId,rolesArray){var rolesList="";if(!$j.isEmptyObject(rolesArray))for(var i in rolesArray){var roleObj=rolesArray[i];roleObj.skipindepartments||(rolesList+="<li onclick=\"Settings.users.setDepartmentProperty('"+serviceName+"','"+departmentId+"','"+Handlebars.escapeExpression(roleObj.role_name)+"','"+roleObj.role_id+"')\">"+Handlebars.escapeExpression(roleObj.role_name)+"</li>")}return rolesList},isAllowedToDisable:function(zuid){return zuid!=Settings.CurrentUserData.ZUID?!0:!1},hasPermission:function(service){return Settings.currentUser.hasPermission(service)},isAllowedToEdit:function(zuid,serviceName){return zuid==Settings.CurrentUserData.ZUID?!serviceName||"support"!=serviceName&&"salesiq"!=serviceName?!1:!0:"reports"==serviceName?!1:!0},canUnAssign:function(zuid,role){return zuid==Settings.CurrentUserData.ZUID?!1:"owner"!=role&&Settings.CurrentUserData.ROLE>=ZCPConstants.ADMIN_ROLE?!0:!1},convertMillisToDate:function(millis){if(void 0!==millis){var dateFmt=new Date(Number(millis));return dateFmt.toLocaleString()}return"-"}})}function checkCondition(value1,operator,value2){try{switch(operator){case"==":return value1==value2;case"!=":return value1!==value2;case">":return value1>value2;case"||":return value1||value2;case"&&":return value1||value2;case"isemptylist":return value1.length>0;case"either_one_defined":return void 0!==value1||void 0!==value2;case"isvalid_info_or_notes":return value1.length>0||""!==value2.trim();case"not_undefined_and_not_empty":return void 0!==value1&&""!==value1.trim();case"is_id_absent_in_dom":return 0===$j("#crm_reminder_div_"+value1).length;default:return!1}}catch(e){}}function userServicePosition(serviceName,memberDetails){var displayText="",serviceOrgId=null,roleName="",profileName="";if(memberDetails.hasOwnProperty("parent")&&memberDetails.parent.hasOwnProperty("zaaid")?serviceOrgId=memberDetails.parent.zaaid:memberDetails.hasOwnProperty("zaaid")&&(serviceOrgId=memberDetails.zaaid),serviceOrgId){var profileId=memberDetails.profile_id,roleId=memberDetails.role_id;profileId||roleId?(roleId&&(roleName=Settings.servicesData.getFieldName(serviceOrgId,ZCPConstants.INFOTYPE_ROLES,roleId)),profileId&&(profileName=Settings.servicesData.getFieldName(serviceOrgId,ZCPConstants.INFOTYPE_PROFILES,profileId)),""!==roleName&&(displayText=roleName),""!==roleName&&""!==profileName&&(displayText+=", "),""!==profileName&&(displayText+=profileName)):serviceName===ZCPConstants.SERVICE_SUPPORT&&(memberDetails.is_agent&&(displayText=I18N.getValue("crmplus.user.role.supportrep")),memberDetails.is_admin&&(displayText=I18N.getValue("crmplus.user.role.admin")))}if(""===displayText&&memberDetails.hasOwnProperty("zarid")){var userRole=memberDetails.zarid;userRole&&(displayText=I18N.getValue("user.profile."+userRole))}return displayText}function initCollaboration(){"undefined"==typeof Collaboration&&(Collaboration={}),Collaboration.services={PR:"projects",CR:"crm",ZS:"support"},Collaboration.handleUserList=function(){},Collaboration.handleMessage=function(){},Collaboration.handlePresence=function(){},Collaboration.join=function(chid){WebMessanger.joinCollab(chid)},Collaboration.quit=function(chid){WebMessanger.quit(chid)},Collaboration.serverup=function(){},Collaboration.serverdown=function(){},Collaboration.handleZohoMessage=function(){return!1},Collaboration.handleCustomMessage=function(msg){if("serviceInfo"==msg.title){var serviceName=msg.data,status=msg.status,url=msg.url,zaaid=msg.zaaid,manual_retry=msg.manual_retry,message={};serviceName===ZCPConstants.SERVICE_SUPPORT&&void 0!=msg.support_mailbox&&(Services.configuredServicesData[serviceName].MAILBOX=msg.support_mailbox,Services.updateSupportMailBox()),void 0!=msg.messageText?(message.CONTENT=msg.messageText,message.TYPE="info",void 0!=msg.messageType&&(message.TYPE=msg.messageType),void 0!=msg.conflict&&(message.CONFLICT=msg.conflict)):message=void 0,msg.appProperties&&(Common.appProperties||(Common.appProperties={}),Common.appProperties[serviceName]=msg.appProperties),Services.changeToDefault(serviceName,status,url,zaaid,manual_retry,message)}else if("collective_data"==msg.title)for(var service in msg)"title"!=service&&void 0!==Services.configuredServicesData[service]&&Services.configuredServicesData[service].STATUS!=status&&Collaboration.handleCustomMessage(msg[service])},Collaboration.handleCrossProductMessage=function(prd,msg){(msg.type===ZCPConstants.REMINDER||msg.TYPE===ZCPConstants.REMINDER)&&Common.showCommonNotification(ZCPConstants.REMINDER,msg,Collaboration.services[prd])},Collaboration.onConnect=function(){},Collaboration.openURL=function(){return!0},Collaboration.handleCollabAdd=function(){},Collaboration.handleCollabDelete=function(){},Collaboration.handleUserAdd=function(){},Collaboration.handleUserDeleted=function(){},Collaboration.handleIsOnline=function(){},Collaboration.handleLogout=function(){},Collaboration.goOffline=function(){},Collaboration.handleChatNotifyMessage=function(){},Collaboration.getPageTitle=function(){return void 0!==Common.currentDocumentTitle?Common.currentDocumentTitle:!1},Collaboration.handleWmsDisable=function(){},Collaboration.handleComposeMail=function(){return!1},Collaboration.handleServiceMessage=function(){},Collaboration.handleLanguageChange=function(){},WmsUIImpl.UIReady=function(){CRMPlusCommonUi.handleChatBarSize();var chatBarIcons=$j("#crmplusnotification").html();void 0!==chatBarIcons&&WebMessanger.setServiceStatus(chatBarIcons),$j("#crmplusnotification").remove(),("reports"===Services.previousLoadedFrame||"campaigns"===Services.previousLoadedFrame||"survey"===Services.previousLoadedFrame)&&Services.previousLoadedFrame===Services.currentView&&Services.setTopAndHeightForIframe()}}function AdminPanel(){}function License(){}function DataTemplates(){}function Loading(){}ZCPConstants.init=function(){this.STATUS_NOT_STARTED=0,this.STATUS_STARTED=1,this.STATUS_FINISHED=2,this.STATUS_FAILED=3,this.STATUS_INPROGRESS=4,this.STATUS_SOFTLINKED=5,this.STATUS_NOTCONFIGURED=6,this.CSRF_COOKIE="cmcsr"},ZCPConstants.init(),ZCPConstants.USER_APP_INACTIVE=0,ZCPConstants.USER_APP_ACTIVE=1,ZCPConstants.USER_APP_NOACCESS=2,ZCPConstants.APP_ADMIN_ROLE=2,ZCPConstants.APP_MODERATOR_ROLE=1,ZCPConstants.APP_USER_ROLE=0,ZCPConstants.ISMIXPANELALIASSET="ISMIXPANELALIASSET",ZCPConstants.COUNTRY="COUNTRY",ZCPConstants.FIRSTNAME="FIRSTNAME",ZCPConstants.LASTNAME="LASTNAME",ZCPConstants.MOBILE="MOBILE",ZCPConstants.PRIMARYEMAIL="PRIMARYEMAIL",ZCPConstants.SETTINGS_ORGANISATION="ORGANISATION",ZCPConstants.SETTINGS_APPLICATION="APPLICATION",ZCPConstants.SETTINGS_USERS="USERS",ZCPConstants.SETTINGS_ADMIN="ADMIN",ZCPConstants.SETTINGS_USERS_ADD="ADDUSER",ZCPConstants.SERVICE_CRM_PLUS="CRMPlus",ZCPConstants.SERVICE_CRM="crm",ZCPConstants.SERVICE_SUPPORT="support",ZCPConstants.SERVICE_CAMPAIGNS="campaigns",ZCPConstants.SERVICE_SURVEY="survey",ZCPConstants.SERVICE_PROJECTS="projects",ZCPConstants.SERVICE_SOCIAL="social",ZCPConstants.SERVICE_SALESIQ="salesiq",ZCPConstants.SERVICE_REPORTS="reports",ZCPConstants.SERVICE_MOTIVATOR="motivator",ZCPConstants.SERVICE_SALESINBOX="salesinbox",ZCPConstants.INFOTYPE_ROLES="roles",ZCPConstants.INFOTYPE_PROFILES="profiles",ZCPConstants.INFOTYPE_DEPARTMENTS="departments",ZCPConstants.INFOTYPE_DEPARTMENT_ROLES="department_roles",ZCPConstants.USER_ROLE=0,ZCPConstants.ADMIN_ROLE=1,ZCPConstants.OWNER_ROLE=2,ZCPConstants.productLoadingId="productLoading",ZCPConstants.SOURCE_HOME="Home",ZCPConstants.SOURCE_CANCEL_TRIAL="Cancel Trial ",ZCPConstants.CANCEL_ACCOUNT="Cancelled trial account",ZCPConstants.SSO_SIGNUP="Existing user sign up",ZCPConstants.NEW_SIGNUP="New user sign up",ZCPConstants.EXCESS_USERS_NEW_SUBSCRIPTION="AutoDowngrade excess users",ZCPConstants.CRMPLUS_HOME="Home Page",ZCPConstants.CRMPLUS_SUBSCRIPTION_LINK="Subscription click",ZCPConstants.CRMPLUS_TRIAL_EXPIRED="Trial Expiry Page",ZCPConstants.CRMPLUS_CANCEL_TRIAL_CLICK="Cancel Trial Button click",ZCPConstants.REACTIVATE_PAGE="Reactivate Account Page",ZCPConstants.MANUAL_RETRY="manual retry",ZCPConstants.REQUEST_ADMIN="Request admin button click",ZCPConstants.PRODUCT_CLICK="Product click",ZCPConstants.CONFLICT="Conflict",ZCPConstants.CRMPLUS_SUBSCRIPTION_EXPIRY="Subscription Expiry Page",ZCPConstants.QUICKLINK_MAX_LENGTH=100,ZCPConstants.COMPANY_LOGO_MAX_SIZE=2097152,ZCPConstants.CRMPLUS_PHONE_OFFLINE=0,ZCPConstants.CRMPLUS_PHONE_ONLINE_WEB=1,ZCPConstants.CRMPLUS_PHONE_ONLINE_PHONE=2,ZCPConstants.CRMPLUS_PHONE_BUSY=3,ZCPConstants.SUPPORT_MAIL_OFFLINE=0,ZCPConstants.SUPPORT_MAIL_ONLINE=1,ZCPConstants.SUPPORT_MAIL_BUSY=2,ZCPConstants.SUPPORT_PHONE_OFFLINE=0,ZCPConstants.SUPPORT_PHONE_ONLINE_WEB=1,ZCPConstants.SUPPORT_PHONE_ONLINE_PHONE=2,ZCPConstants.SUPPORT_PHONE_BUSY=3,ZCPConstants.SUPPORT_PHONE_INPROGRESS=4,ZCPConstants.CRM_PHONE_OFFLINE=0,ZCPConstants.CRM_PHONE_ONLINE_WEB=1,ZCPConstants.CRM_PHONE_ONLINE_PHONE=2,ZCPConstants.CRM_PHONE_BUSY=3,ZCPConstants.CRM_PHONE_INPROGRESS=4,ZCPConstants.CRM_PHONE_WRAPTIME=5,ZCPConstants.CRM_PHONE_RINGCENTRAL_BUSY=2,ZCPConstants.CHAT_AVAILABLE=1,ZCPConstants.CHAT_BUSY=3,ZCPConstants.CHAT_IDLE=4,ZCPConstants.CHAT_ENGAGED=6,ZCPConstants.COMMONUI_THEME="theme",ZCPConstants.LEFTPANEL_VISIBLE="isleftpanelvisible",ZCPConstants.LAST_ACCESSED_URL="lastaccessedurl",ZCPConstants.CURRENT_PORTAL="portalname",ZCPConstants.AVAILABLE_TABS="crmplus_at",ZCPConstants.NEWVISITOR="NEWVISITOR",ZCPConstants.INVITETRANSFERCHAT="INVITETRANSFERCHAT",ZCPConstants.INVITESUPPORTREP="INVITESUPPORTREP",ZCPConstants.RECENT_ITEMS_LIMIT=25,ZCPConstants.TODAY="Today",ZCPConstants.YESTERDAY="Yesterday",ZCPConstants.TOMORROW="Tomorrow",ZCPConstants.REMINDER="reminder",ZCPConstants.CHAT_POPUP_SHOWN="chat popup has been shown",ZCPConstants.CHAT_POPUP_HIDDEN="chat popup has been hidden",ZCPConstants.RECEIVED_CHAT_STATUS="Received chat_status call",ZCPConstants.RECEIVED_CHAT_FOCUSED="Received chat_focused call",ZCPConstants.TAB_AVAILABLE="crmplus_istabavailable",ZCPConstants.SALESINBOX_FILTER_FILE_TYPES=["dat","xml"],ZCPConstants.COMPANYPOPUPSHOWN="Onboard company popup shown",ZCPConstants.COMPANYPOPUPSUBMIT="Onboard company popup submit",Regex.init=function(){Regex.map={},Regex.map.phone=/^[0-9a-zA-Z\-\(\)\.\+\s]+$/,Regex.map.number=/^[0-9]+$/,Regex.map.float=/^(([0-9]+)?\.)?[0-9]+$/,Regex.map.double=/^[0-9]+.[0-9]+$/,Regex.map.nospecial=/^[A-Za-z0-9\s]+$/,Regex.map.email=/^[\w]([\w\-\.\+\']*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/i,Regex.map.website=new RegExp("^([A-Za-z]+://)?[A-Za-z0-9-_]+\\.[A-Za-z0-9-_%&?/.=]+$"),Regex.map.zip=/^([0-9\-])+$/,Regex.map.portal=/^[a-z0-9]{6,30}$/},Regex.init();var countryList={AF:"Afghanistan",AX:"Aland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua And Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia And Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, //No I18N Democratic Republic",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D'Ivoire",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island & Mcdonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic Of",IQ:"Iraq",IE:"Ireland",IM:"Isle Of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KR:"Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, //No I18N Federated States Of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory, //No I18N Occupied",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthelemy",SH:"Saint Helena",KN:"Saint Kitts And Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre And Miquelon",VC:"Saint Vincent And Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome And Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia And Sandwich Isl.",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard And Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad And Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks And Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Viet Nam",VG:"Virgin Islands, //No I18N British",VI:"Virgin Islands, //No I18N U.S.",WF:"Wallis And Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};
Common.currentTicket=null,Common.myId=null,Common.myZuid=null,Common.isServiceAdded=!1,Common.jsonParam=null,Common.myPortalName=null,Common.currentPortalName=null,Common.staticImgUrl="/images",Common.staticHashedFileNames={},Common.busyGif="zoho_busy.gif",Common.isReadOnlyMode=!1,Common.isPushToSpotLight=!1,Common.serviceToRedirect=null,Common.canHideSidePanel=!0,Common.subscriptionRetryCount=null,Common.subscriptionRetryPeriod=null,Common.canHidePanel=!0,Common.currentPopupID=null,Common.countUpTimerReferences={},Common.ownerEmailID=null,Common.userEmailID=null,Common.isRecentItemsFirstFetch=!0,Common.isQuickLinkFirstFetch=!0,Common.canFetchReminders=!0,Common.pressedKeys="",Common.htmlContext="body",Common.crmplusPortalCount=0,Common.prevHtmlContext="",Common.toolcontext="newcrmplustool",Common.versionForMultipleTabCommunication=null,Common.currentUserDisplayName=null,Common.tabIndex=Date.now()+"",Common.apiPrefix="/api/v1",Common.zohoOneAddUsersURL,Common.isZohoOne=!1,Common.setCurrentTicket=function(currTicket){Common.currentTicket=currTicket},Common.setMyId=function(userId){Common.myId=userId},Common.setMyZUId=function(zuid){Common.myZuid=zuid},Common.loadSetUpPage=function(isRecreate){Common.jsonParam=Common.getParameterValuesForUsedAccounts(),Common.addUserToService("true",isRecreate)},Common.getPortalUrl=function(forUrlReq){var portalName;return portalName=void 0!==forUrlReq&&forUrlReq?"/"+Common.currentPortalName:Common.currentPortalName,null===Common.currentPortalName?"":portalName},Common.addUserToService=function(isNewUser,recreateParam){var busyImg="<i class='crmpBusy'></i>"+I18N.getValue("button.submit");$j("#submitAcc").html(busyImg);var URL;if(URL="/addusertoservice.do?issignup=false",jQuery.isEmptyObject(Common.jsonParam)||(URL+="&servicesdetails="+JSON.stringify(Common.jsonParam)),$j("#portalNameinp").length>0&&(URL+="&portalname="+$j("#portalNameinp").val().toLowerCase()),$j("#valExcludeServices").length>0&&void 0!==$j("#valExcludeServices").val()&&""!==$j("#valExcludeServices").val()&&(URL+="&excludeservices="+$j("#valExcludeServices").val()),void 0!==recreateParam&&(URL+="&recreateparam=true"),isNewUser||"true"==isNewUser){var fd=new FormData;fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",data:fd,processData:!1,contentType:!1,dataType:"text",url:URL,success:function(data){$j(".landingCtnt").html(data),$j("#submitAcc").html(I18N.getValue("button.submit"))}})}},Common.getParameterValuesForUsedAccounts=function(){for(var servicesJson={},i=0;i<Services.nameArray.length;i++){var serviceName=Services.nameArray[i],serviceValueContainer=serviceName+"_portals",serviceValueContainer=$j("#"+serviceValueContainer+" li.selected");if(serviceValueContainer.length>0){var servicesDetailsJson={};servicesDetailsJson.APPACCOUNTID=$j(serviceValueContainer).attr("currsoid"),servicesDetailsJson.CANBEMIGRATED=$j(serviceValueContainer).attr("canbemigrated"),servicesJson[serviceName]=servicesDetailsJson}}return servicesJson},Common.showElement=function(module,id){void 0!==module&&("support"===module&&$j("#supportParDiv .noPortal").hide(),"survey"===module&&$j("#surveyParDiv .noPortal").hide(),"projects"===module&&$j("#projectsParDiv .noPortal").hide(),"salesiq"===module&&$j("#salesiqParDiv .noPortal").hide()),$j("#"+id).show()},Common.hideElement=function(id){$j("#"+id).hide()},Common.hideClass=function(className){$j("."+className).hide()},Common.showClass=function(className){$j("."+className).show()},Common.selectCheckbox=function(id,skipContext){if(null!=id){var element=null;element=skipContext?$j("#"+id):$c("#"+id),element.prop("checked")||element.click()}},Common.setDelayToCallFunction=function(seconds,textBoxID,functionCall){var timer,interval=seconds;$j("#"+textBoxID).keyup(function(){clearTimeout(timer),$j("#"+textBoxID).val&&(timer=setTimeout(functionCall,interval))})},Common.validatePortal=function(portalName){portalName=$j("#"+portalName).val().trim();var canValidate=!0;if(null===Common.myPortalName||null!==Common.myPortalName&&Common.myPortalName!==portalName?Common.myPortalName=portalName:null!==Common.myPortalName&&Common.myPortalName===portalName&&(canValidate=!1),canValidate){$j("[id$='ImgPortal']").css("display","none"),$j("#loadingImgPortal").css("display","inline-block");var regex=/^[a-zA-Z0-9]*$/;$j("#portalvalidation li").css("display","none"),$j("#submitAcc").prop("disabled",!1);var isShowAlert=!1;if(void 0!==portalName&&""!==portalName){if(portalName.length<6?($j("#minCharPortal").removeClass(),$j("#minCharPortal").addClass("fail"),isShowAlert=!0):($j("#minCharPortal").removeClass(),$j("#minCharPortal").addClass("pass")),regex.test(portalName)?($j("#splCharPortal").removeClass(),$j("#splCharPortal").addClass("pass")):($j("#splCharPortal").removeClass(),$j("#splCharPortal").addClass("fail"),isShowAlert=!0),isShowAlert)Common.showPortalValidMessage(isShowAlert);else{var params="portalName="+portalName.toLowerCase();$j.ajax({type:"GET",url:"/validatePortal.do?"+params,success:function(data){"true"===data&&data?($j("#validPortal").removeClass(),$j("#validPortal").addClass("pass")):($j("#validPortal").removeClass(),$j("#validPortal").addClass("fail"),isShowAlert=!0),Common.showPortalValidMessage(isShowAlert)}})}}else{var portalErrors=$j(".pnCheckList [id$='Portal']");$j(portalErrors).removeClass(),$j(portalErrors).addClass("pass"),setTimeout(function(){$j("#loadingImgPortal").css("display","none"),$j("#minCharPortal").removeClass(),$j("#minCharPortal").addClass("fail")},750),$j("#submitAcc").prop("disabled",!0),Common.showPortalValidMessage(!0)}}},Common.showPortalValidMessage=function(isShowAlert){isShowAlert?($j("#submitAcc").prop("disabled",!0),setTimeout(function(){$j("#loadingImgPortal").css("display","none"),$j("#successImgPortal").css("display","none"),$j("#xCloseImgPortal").css("display","inline-block")},750),$j("#portalNameErrors").fadeIn(750)):($j("#portalNameErrors").fadeOut(750),setTimeout(function(){$j("#loadingImgPortal").css({display:"none"}),$j("#xCloseImgPortal").css("display","none"),$j("#successImgPortal").css("display","block")},750))},Common.diffOrgErrVisibility=function(id){var optionTagArray=$j("#portalServices option:selected");Common.hideElement("difforgErrConflict");for(var isDisableSubmit=!1,i=0;i<optionTagArray.length;i++){var sinOptn=optionTagArray[i],confType=$j(sinOptn).attr("conflicttype"),parentDiv=$j("#"+id+"ParDiv");void 0!==confType?($j(parentDiv).addClass("conflictCase"),Common.showElement(void 0,"difforgErrConflict"),isDisableSubmit=!0):$j(parentDiv).removeClass("conflictCase")}isDisableSubmit&&$j("#submitAcc").prop("disabled",!0)},Common.cancelTrial=function(password){if(Common.isReadOnlyMode)showStatusMsg("error",I18N.getValue("crmplus.ro.action.denied.msg"));else{var passWrd=$j("#"+password).val();$j("#emptyPW").css("display","none"),$j("#canceltrialbutton").prop("disabled",!0);var radioId=$j(".zcrmp-reasonforCancel input:checked").attr("id"),reasonDesc="";void 0!=radioId&&(reasonDesc=radioId.substring(6));var len=reasonDesc.length+1;"Others"==reasonDesc&&""!=$j("#reasonDesc").val().trim()?reasonDesc+=" - "+$j("#reasonDesc").val().trim():""==reasonDesc&&(reasonDesc=$j("#reasonDesc").val().trim());var isAllowReq=!0;if((void 0===passWrd||""===passWrd||" "===passWrd)&&($j("#emptyPW").css("display","block"),isAllowReq=!1),reasonDesc.length>750+len&&($j("#reasonDescMsg").html(I18N.getValue("crmplus.label.error.description.length")),isAllowReq=!1),isAllowReq){Loading.button.start({id:"canceltrialbutton"});var fd=new FormData;fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),fd.append("password",passWrd),fd.append("customerreason",reasonDesc),$j.ajax({type:"POST",dataType:"json",data:fd,processData:!1,contentType:!1,url:Common.getPortalUrl(!0)+"/canceltrial.do",success:function(data){var errorMessage=I18N.getValue("service.configuration.failed");if(!$j.isEmptyObject(data)&&data.hasOwnProperty("status_code")){var status=data.status_code;if("204"==status)return void window.open("https://"+Common.productUrl+"/index.do","_self");if(data.hasOwnProperty("errors")){var errors=data.errors;errors.length>0&&errors[0].hasOwnProperty("code")&&"email_not_confirmed"===errors[0].code?errorMessage=I18N.getValue("crmplus.user.email.notconfirmed"):data.hasOwnProperty("message")&&(errorMessage=data.message)}else data.hasOwnProperty("message")&&(errorMessage=data.message)}Loading.button.stop({id:"canceltrialbutton"}),showStatusMsg("error",errorMessage)},error:function(){Loading.button.stop({id:"canceltrialbutton"}),showStatusMsg("error",I18N.getValue("service.configuration.failed"))}})}}},Common.makeDefaultPortal=function(event,portalName,idNo){if(Common.isReadOnlyMode)showStatusMsg("error",I18N.getValue("crmplus.ro.action.denied.msg"));else{var fd=new FormData;fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),fd.append("portalname",portalName),$j.ajax({type:"POST",url:"/markdefaultportal.do",data:fd,processData:!1,contentType:!1,success:function(data){data&&($j("[id^='crmplusportalurl']").show(),$j("#crmplusportalurl"+idNo).hide(),$j("[id^='crmplusportalstatus']").hide(),$j("#crmplusportalstatusicon"+idNo).show(),$j("#crmplusportalstatus"+idNo).show(),message=I18N.getValue("crmplus.message.success"),type="success"),showStatusMsg(type,message)}}),event.stopPropagation()}},Common.initializaApp=function(){$j=jQuery.noConflict(),initPopUpHide(),initLoading(),$j(window).bind("blur",Common.onWindowBlurEvent),Common.addEventListener(window,"click",Common.onClickOnCrmplus,!0),Common.addEventListener(window,"mouseover",Common.onWindowMouseHover,!0),Common.addEventListener(window,"mouseleave",Common.onWindowMouseLeave,!0),Common.addEventListener(document,"keyup",Common.onDocumentKeyup),Common.addEventListener(window,"storage",Common.handleMessageFromOtherTab),Common.addEventListener(window,"beforeunload",Common.onWindowBeforeUnLoad),Common.addClickEventListener("#crmplus-dialog-body",AdminPanel.util.removeError),Common.initPollForNoOfTabs()},Common.onDocumentKeyup=function(event){27==event.keyCode&&AdminPanel.users.hideDetail()},Common.onDocumentClick=function(event){var element=event.target,handleHash=null!=element.getAttribute("hash")?element.getAttribute("hash"):!1,hash=element.hash;handleHash&&hash&&hash.startsWith("#")&&Hash.set(hash.substring(1))},Common.setFocus=function(id){if($(id)&&($(id).focus(),void 0!==$(id).value)){var length=$(id).value.length;$(id).setSelectionRange(length,length)}},Common.stopEvents=function(e,isallowDefault){e.stopPropagation?(void 0==isallowDefault&&e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,void 0==isallowDefault&&(e.returnValue=!1))},Common.portalSelect=function(appName,liObj){var portalName=liObj.innerHTML;$j("#"+appName+"_header").html(portalName),$j("#"+appName+"_portals li").removeClass("selected"),liObj.setAttribute("class","selected"),hidePanel()},Common.portalSwap=function(serviceNames,serviceOrgId,ownerZuid,isChangeOwner){var services=$j("#"+serviceNames).val(),serviceZgid=$j("#"+serviceOrgId).val(),fd=new FormData;if(fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),fd.append("serviceorgid",serviceZgid),isChangeOwner){var newOwnerzuid=$j("#"+ownerZuid).val();fd.append("ownerzuid",newOwnerzuid),fd.append("action","changeowner")}else fd.append("servicenames",services);$j.ajax({type:"POST",data:fd,processData:!1,contentType:!1,dataType:"text",url:"/"+Common.toolcontext+"/portalswapaction.do",success:function(data){$j("#"+serviceNames).val(""),$j("#"+serviceOrgId).val(""),$j("#"+ownerZuid).val(""),"true"===data||data?showStatusMsg("success","Done!"):showStatusMsg("error","Error occured")}})},Common.redirectToHomePage=function(refererUrl,countryName,mailingState,crmplusUrl,pricingReqParam){var params="refererURL="+refererUrl;params+="&country="+countryName,params+="&mailingstate="+mailingState,params+="&useraction=signup",void 0!==pricingReqParam&&""!==pricingReqParam&&(params+="&"+pricingReqParam),$j.ajax({type:"GET",url:"/index.do?"+params,success:function(data){void 0!==pricingReqParam&&""!==pricingReqParam&&-1!=pricingReqParam.indexOf("action=upgrade_subscription")&&(Services.triggerPaymentPage=!0),Common.onSignUpComplete(data)},error:function(respObj){$j("#moduleContainer").html(respObj.responseText),crmplusUrl+="?useraction=signup",void 0!==pricingReqParam&&""!==pricingReqParam&&(crmplusUrl+="&"+pricingReqParam),window.open(crmplusUrl,"_self")}})},Common.onSignUpComplete=function(data){window.history.replaceState({},"",window.location.href.replace(window.location.pathname,"/"+data.portalName+window.location.pathname)),$j("#crmpluscommonuisubscriptionbutton").attr("href",data.paymentsUrl),Common.currentPortalName=data.portalName,$j("#crmpluscommonuitrialexpirymessage>span").text(data.trialExpiryMessage),$j("#crmpluscommonuitrialexpirymessage").show(),void 0!==data.isMigratedToAdminPanel&&data.isMigratedToAdminPanel&&$j("#crmplusbacktoolduibtn").remove(),Common.myOrgId=data.crmplusOrgId,Services.fetch(void 0,void 0,void 0,Services.nameArray),void 0!=Common.isCompanyPopUpShown&&Common.isCompanyPopUpShown&&(Common.trackFeature(ZCPConstants.COMPANYPOPUPSHOWN),Common.isCompanyPopUpShown=void 0)},Common.showReasonBox=function(){"none"===$j("#reasonDesc").css("display")&&$j("#reasonDesc").slideDown("fast"),$j("#reasonDescCharCount").show()},Common.hideReasonBox=function(){"none"!==$j("#reasonDesc").css("display")&&$j("#reasonDesc").slideUp("fast"),$j("#reasonDescCharCount").hide()},Common.showCompanyPopUp=function(isFirstTime){(isFirstTime||void 0===Services.showCompanyFetchPopUp||Services.showCompanyFetchPopUp)&&Common.getOnBoardingInfo(),Services.showCompanyFetchPopUp=!1},Common.scheduleCompanyPopUp=function(orgInfoJson){CRMPlusLocalStorage.set("companyInfoFormObj",orgInfoJson),Common.isCompanyUpdated=!1;var timerID=setInterval(function(){var con=console;con.log("added to interval timer to check this case!!!!"),Common.isCompanyUpdated=Common.retryCompanyUpdate(),Common.isCompanyUpdated&&clearInterval(timerID)},2e4);return!1},Common.retryCompanyUpdate=function(){if(null!=Common.currentPortalName){var formObj=CRMPlusLocalStorage.get("companyInfoFormObj");return AdminPanel.orgView.submitForm(void 0,!0,formObj),!0}return!1},Common.isShowCompanyPopUpClientCheck=function(){return void 0!==CRMPlusLocalStorage.get("companyInfoFormObj")?(Common.retryCompanyUpdate(),!1):!0},Common.setPositionDrpDown=function(element){element=$j(element);var offset=(element.outerWidth(),element.offset()),top=offset.top,outerHeight=element.outerHeight();top+=outerHeight;var left=offset.left,dropDownObj=element.next();dropDownObj.css({top:top-1,left:left})},Common.getOnBoardingInfo=function(){Common.isCompanyPopUpShown=!0,$j.ajax({type:"GET",url:"/companyInfoOnBoardLayout.do",success:function(responseText){$j("#companyInfopop").html(responseText)},complete:function(){$j("#onBoardProceedBtn span").html("Proceed"),$j("#onBoardProceedBtn").attr("onclick","$j('#orginfoonboardform').submit()"),Common.showElement(void 0,"companyInfopop"),Common.showElement(void 0,"onboardpopup"),setTimeout(function(){$c("#adminpanel-orgeditform-companyname").focus()},100)}})},Common.animatePlaceHolderLabel=function(inputObj){var value=$j(inputObj).val(),labelElem=$j(inputObj).parent().find(".inlineLabel");value.length>0?($j(labelElem).css({display:"block"}),$j(labelElem).stop(!0),$j(labelElem).animate({top:"-15px",opacity:"1"},{queue:!1,duration:200})):0==value.length&&($j(labelElem).hasClass("showInlineLabel")&&($j(labelElem).removeClass("showInlineLabel"),$j(labelElem).css({display:"block",top:"-15px",opacity:"1"})),$j(labelElem).animate({top:"3px",opacity:"0"},{queue:!1,duration:200,complete:function(){$j(this).hide(0)}}))},Common.changeValue=function(id,value){$(id)&&($(id).innerHTML=value)},Common.closeMsg=function(inputObj,event){if(void 0==event||13!=event.keyCode){var parentContainer=inputObj.getAttribute("id");parentContainer+="Msg",$(parentContainer)&&($(parentContainer).innerHTML="")}Common.animatePlaceHolderLabel(inputObj)},Common.descriptionfn=function(inputObj,id,length){var parentContainer=inputObj.getAttribute("id");parentContainer+="CharCount",$(parentContainer)&&descCharCount(inputObj,length,parentContainer),void 0!==id&&$(id)&&($(id).style.display="block"),0===inputObj.value.length&&($(id).style.display="none"),Common.closeMsg(inputObj)},Common.handleWindowSize=function(){CRMPlusCommonUi.handleWindowSize();var windowHeight=$j(window).height();$j("#crmpluscommonui_reminders_container").css("max-height",80*windowHeight/100),$j("#crmpluscommonui_visitors_container").css("max-height",80*windowHeight/100-50),$j("#productsidepanelscroll").css({height:windowHeight-($j("#crmplussidepanelfooter").outerHeight(!0)+3)});var gsFrameHeight=windowHeight;$j("#getting-started-frame :visible").length>0&&(gsFrameHeight-=$j("#getting-started-frame .zcrmp-ifgsTopPan").outerHeight(),$j("#getting-started-frame-cont").outerHeight(gsFrameHeight)),$j("#crmpluscommonuiqlinkpanelscrollingdiv").css({"max-height":windowHeight-$j("#quickLinkHeader").outerHeight(!0)}),$j("#crmpluscommonuirecentitemsscrollingdiv").css({"max-height":windowHeight-$j("#recentitemsheader").outerHeight(!0)}),$j("#crmpluscommonuisearchfilterlistscrolldiv").css({height:windowHeight-$j("#crmpluscommonuitopbar").outerHeight(!0)}),$j("#crmpluscommonuipopviewscroll").css({"max-height":windowHeight-100}),AdminPanel.util.handleWindowSize(),Services.setTopAndHeightForIframe(),CRMPlusCommonUi.handleChatBarSize(!0),Common.setNotificationContainerHeight(),Common.setProfilePanelHeight();var overviewFooterIds="#crmplusoverviewfooterview, #crmplusoverviewfooterview"+Services.currentView;$j(window).width()<=1366?($j(overviewFooterIds).addClass("zcrmp-fixedFtr"),$j(overviewFooterIds).css("0px"===$j("#crmpluscommonuileftpanel").css("left")?{width:$j(window).width()-70,left:70}:{width:$j(window).width(),left:0})):($j(overviewFooterIds).removeClass("zcrmp-fixedFtr"),$j(overviewFooterIds).removeAttr("style"))},Common.spotLight={identify:function(distinctId){Common.isPushToSpotLight&&$zoho.spotlight.identify(distinctId)},initialize:function(userDetails,orgDetails,eventType){if(Common.isPushToSpotLight){userDetails.ZUID&&this.identify(userDetails.ZUID),userDetails&&this.setProfile(userDetails,orgDetails),null!=eventType&&"null"!==eventType&&this.track(eventType)}},setProfile:function(userDetails,orgDetails){Common.isPushToSpotLight&&($zoho.spotlight.customer.set({id:userDetails.ZUID}),$zoho.spotlight.customer.set({email:userDetails.PRIMARYEMAIL}),userDetails.FIRSTNAME&&$zoho.spotlight.customer.set({first_name:userDetails.FIRSTNAME}),userDetails.LASTNAME&&$zoho.spotlight.customer.set({last_name:userDetails.LASTNAME}),userDetails.MOBILE&&$zoho.spotlight.customer.set({phone:userDetails.MOBILE}),orgDetails&&$zoho.spotlight.customer.set({company:orgDetails}))},track:function(action,properties){try{void 0!==action&&""!==action&&(void 0!==properties&&""!==properties?$zoho.spotlight.track(action,properties):$zoho.spotlight.track(action))}catch(e){}}},Common.setScroll=function(id,configJson){void 0===configJson&&(configJson={}),void 0===configJson.height&&(configJson.height=""),$j("#"+id).slimScroll(configJson)},Common.scrollToTop=function(id,top){void 0===top&&(top=0),$j("#"+id).slimScroll({scrollTo:top})},Common.animateScrollToTop=function(id,top,timeInMillis){void 0===top&&(top=0),void 0===timeInMillis&&(timeInMillis=1e3),$j("#"+id).animate({scrollTop:top},timeInMillis)},Common.showLiveChat=function(){$zoho.salesiq.floatwindow.visible("show")},Common.onWindowBlurEvent=function(){CRMPlusCommonUi.handleBlur()},Common.addClickEventListener=function(queryString,handler,params,thisObject){var index,elements=document.querySelectorAll(queryString);for(index=0;index<elements.length;index++){var element=elements[index];void 0!==handler&&(element.customclickhandler=handler),void 0===params&&(params=[]),element.customclickparam=params,void 0!==thisObject&&(element.customclickthis=thisObject),Common.addEventListener(element,"click",Common.clickHandler)}},Common.addEventListener=function(element,eventName,eventListener,useCapture){window.addEventListener?element.addEventListener(eventName,eventListener,useCapture):element.attachEvent("on"+eventName,eventListener)},Common.superClickHandler=function(event){if(void 0!=event){var target=event.target,element=this;if(null!=element.getAttribute("data-click")&&null!=target.getAttribute("data-clickparam")){var parentClick=element.getAttribute("data-click");null!=target.getAttribute("data-click")&&(element.customclickhandler=void 0,element.setAttribute("data-click",target.getAttribute("data-click"))),element.setAttribute("data-clickparam",target.getAttribute("data-clickparam")),Common.clickHandler(event,this),element.removeAttribute("data-clickparam"),null!=target.getAttribute("data-click")&&(element.setAttribute("data-click",parentClick),element.customclickhandler=void 0)}else null!=target.getAttribute("data-click")&&(element.setAttribute("data-click",target.getAttribute("data-click")),null!=target.getAttribute("data-clickparam")&&element.setAttribute("data-clickparam",target.getAttribute("data-clickparam")),element.customclickhandler=void 0,Common.clickHandler(event,this),element.removeAttribute("data-click"),element.removeAttribute("data-clickparam"))}},Common.clickHandler=function(event,element){if(void 0!==event){var resetParams=!1;if(void 0==element?element=this:resetParams=!0,void 0!==element&&1===element.nodeType&&(void 0!==element.getAttribute("data-click")||void 0!==element.customclickhandler)){if(void 0===element.customclickhandler){var methodReference=Common.getParentAndMethodReferenceByName(element.getAttribute("data-click"));if(void 0===methodReference)return element.setAttribute("data-click",void 0),void element.setAttribute("data-clickparam",void 0);element.customclickthis=methodReference.parent,element.customclickhandler=methodReference.reference,resetParams=!0}if(resetParams&&null!==element.getAttribute("data-clickparam")&&(element.customclickparam=Common.jsonParse(element.getAttribute("data-clickparam")),void 0!==element.customclickparam))for(var i=0;i<element.customclickparam.length;i++)"#undefined#"===element.customclickparam[i]&&(element.customclickparam[i]=void 0);void 0!==element.getAttribute("data-click")&&"Services.getRedirectionUrl"===element.getAttribute("data-click")&&(CRMPlusUnifiedSearch.isFilterClick=!1);var thisIndex=element.customclickparam.indexOf("#this#");thisIndex>-1&&(element.customclickparam[thisIndex]=element);var eventIndex=element.customclickparam.indexOf("#event#");eventIndex>-1&&(element.customclickparam[eventIndex]=event),Common.isCtrlClick(event)?"true"==element.getAttribute("data-allow_method_on_ctrl_click")&&element.customclickhandler.apply(element.customclickthis,element.customclickparam):(element.customclickhandler.apply(element.customclickthis,element.customclickparam),"A"===element.nodeName&&Common.stopEvents(event)),eventIndex>-1&&(element.customclickparam[eventIndex]="#event#")}}},Common.isCtrlClick=function(event){var isCtrlClick=event&&(event.metaKey&&-1!=window.navigator.platform.indexOf("Mac")||event.ctrlKey&&-1==window.navigator.platform.indexOf("Mac"));return isCtrlClick!==!0?!1:!0},Common.getParentAndMethodReferenceByName=function(methodName){if(null===methodName||void 0===methodName)return void 0;for(var parent,methodNamespaces=methodName.split("."),methodReference=window,i=0;i<methodNamespaces.length;i++)if(parent=methodReference,methodReference=methodReference[methodNamespaces[i]],void 0===methodReference)return void 0;return{parent:parent,reference:methodReference}},Common.showCommonNotification=function(type,data,fromService,source){try{if("chat"===type){var chid=data.CHID||data.chid;if(0===$j("#"+chid).length){var chatData=Common.formatChatNotificationData(data,fromService);Common.logChatActions(fromService,chid,ZCPConstants.CHAT_POPUP_SHOWN,source,chatData.MODE),void 0!==chatData&&(Common.renderCommonNotification(chatData),void 0!==data.WAITINGTIME&&data.ISPROACTIVE!==!0&&Common.startTimer(data.WAITINGTIME,"waitingTimer"+chatData.ID,chatData.ID,fromService,type))}}else if("phone"===type)if("incoming"===data.subtype&&Services.currentView!==fromService){var callData=Common.formatCallNotificationData(data,fromService);Common.renderCommonNotification(callData)}else"answered"===data.subtype?$j("#commonuicallnotify_"+data.servicename+"_"+data.callrefid+"_status").text("Answered"):"ended"===data.subtype&&Common.removeNotificationComponent("commonuicallnotify_"+data.servicename+"_"+data.callrefid,type);else if("reminder"===type){var reminderData;reminderData=fromService===ZCPConstants.SERVICE_CRM&&data.SERVICENAME===ZCPConstants.SERVICE_SALESINBOX?data:Common.formatReminderNotificationData(data,fromService),0===$j("#"+reminderData.ID).length&&Common.renderCommonNotification(reminderData)}else if("message"===type){if("showphoneloginpopup"===data.subtype&&Services.currentView!==fromService){var phoneLoginData={};phoneLoginData.ID="commonuiphonelogin_"+fromService+"_popup",phoneLoginData.ICON="annonceIcon",phoneLoginData.HEADERNAME=I18N.getValue("commonui.popup.phonelogin.header"),phoneLoginData.HEADERMSG=I18N.getValue("commonui.popup.phonelogin.message"),phoneLoginData.SERVICENAME=fromService;var acceptBtnparams={};acceptBtnparams.LABEL=I18N.getValue("button.login"),acceptBtnparams.ACTION="Common.removeNotificationComponent('"+phoneLoginData.ID+"','"+type+"'); Services.loadFrame('"+fromService+"');",phoneLoginData.ACCEPTBUTTON=acceptBtnparams;var rejectBtnparams={};rejectBtnparams.LABEL=I18N.getValue("button.close"),rejectBtnparams.ACTION="Common.removeNotificationComponent('"+phoneLoginData.ID+"','"+type+"');",phoneLoginData.REJECTBUTTON=rejectBtnparams,phoneLoginData.CLOSEBUTTON={ACTION:"Common.removeNotificationComponent('"+phoneLoginData.ID+"','"+type+"');"},0===$j("#"+phoneLoginData.ID).length&&Common.renderCommonNotification(phoneLoginData)}}else if("excessusers"===type&&void 0!==data&&0!==data.excessusers&&data.excessusers>0){var excessUsersData={};excessUsersData.ID="commonuiexcessusers",excessUsersData.ICON="notifyIcon",excessUsersData.HEADERNAME=I18N.getValue("commonui.popup.subscription.header"),excessUsersData.HEADERMSG=I18N.getValue("commonui.popup.subscription.message",[data.paidusers,data.totalusers,data.excessusers]),excessUsersData.SERVICENAME=fromService;var acceptBtnparams={};acceptBtnparams.LABEL=I18N.getValue("button.upgrade"),acceptBtnparams.ACTION="window.open('"+Services.serviceUrl.get("paymentsurl",!0)+"', '_blank');Common.removeNotificationComponent('"+excessUsersData.ID+"','"+type+"');",excessUsersData.ACCEPTBUTTON=acceptBtnparams;var rejectBtnparams={};rejectBtnparams.LABEL=I18N.getValue("button.deactivate"),rejectBtnparams.ACTION="AdminPanel.util.handleHash('#settings/users');Common.removeNotificationComponent('"+excessUsersData.ID+"','"+type+"');",excessUsersData.REJECTBUTTON=rejectBtnparams,excessUsersData.CLOSEBUTTON={ACTION:"Common.removeNotificationComponent('"+excessUsersData.ID+"','"+type+"');"},Common.renderCommonNotification(excessUsersData)}}catch(e){}},Common.renderCommonNotification=function(notificationData){var notificationTemplate=Handlebars.compile($j("#common_notification_template").html());$j("#crmpluscommonuigeneralnotificationcontainer").prepend(notificationTemplate(notificationData)),Common.setNotificationContainerHeight()},Common.formatChatNotificationData=function(data,fromService){try{if(void 0!==data.CHID){var header="",chatData={INFO:[]};if(chatData.INFODESC="Visitor Info",chatData.HEADERNAME=data.SENDERNAME,data.MODE===ZCPConstants.INVITETRANSFERCHAT?header=I18N.getValue("crmplus.commonchat.titlemsg.one"):data.MODE===ZCPConstants.INVITESUPPORTREP?header=I18N.getValue("crmplus.commonchat.titlemsg.two"):(header=I18N.getValue("crmplus.commonchat.titlemsg.three"),chatData.HEADERNAME=data.NAME),chatData.ICON="chatIcon",chatData.MODE=data.MODE,chatData.ID=data.CHID,chatData.HEADERMSG=header,chatData.QUESTION=data.QUESTION,chatData.SERVICENAME=fromService,void 0!==data.VISITORNAME&&""!==data.VISITORNAME&&chatData.INFO.push({NAME:"Visitor",VALUE:data.VISITORNAME}),void 0!==data.DEPARTMENT&&""!==data.DEPARTMENT&&chatData.INFO.push({NAME:"Department",VALUE:data.DEPARTMENT}),void 0!==data.LATTENDER&&""!==data.LATTENDER&&chatData.INFO.push({NAME:"Owner",VALUE:data.LATTENDER}),void 0!==data.CCODE&&""!==data.CCODE&&chatData.INFO.push({NAME:"Country",VALUE:getCountryName(data.CCODE)}),void 0!==data.CPAGE&&""!==data.CPAGE){var urlInfo={NAME:"Source URL",LINK:!0,VALUE:data.CPAGE};CRMPlusValidator.isWebSite(data.CPAGE)&&(urlInfo.ISVALIDLINK=!0),chatData.INFO.push(urlInfo)}void 0!==data.NOTES&&""!==data.NOTES&&(chatData.NOTES=data.NOTES);var acceptBtnparams={},rejectBtnparams={};return data.MODE===ZCPConstants.NEWVISITOR?(acceptBtnparams.LABEL=I18N.getValue("button.accept"),1==data.ISPROACTIVE&&(acceptBtnparams.LABEL=I18N.getValue("button.reply")),acceptBtnparams.ACTION="Common.handleChatNotificationAction('"+fromService+"',true, 'PickUP', undefined, '"+data.CHID+"', '"+data.VISITORID+"', undefined, "+data.ISPROACTIVE+");",rejectBtnparams.LABEL=I18N.getValue("button.ignore"),rejectBtnparams.ACTION="Common.handleChatNotificationAction('"+fromService+"',false, 'IgnoreChat', undefined, '"+data.CHID+"', '"+data.VISITORID+"',  undefined, "+data.ISPROACTIVE+");"):data.MODE===ZCPConstants.INVITETRANSFERCHAT?(acceptBtnparams.LABEL=I18N.getValue("button.accept"),acceptBtnparams.ACTION="Common.handleChatNotificationAction('"+fromService+"',true, 'TransferChat', 'Accept','"+data.CHID+"','"+data.VISITORID+"','"+data.SENDER+"');",rejectBtnparams.LABEL=I18N.getValue("button.reject"),rejectBtnparams.ACTION="Common.handleChatNotificationAction('"+fromService+"',false, 'TransferChat', 'Reject','"+data.CHID+"','"+data.VISITORID+"','"+data.SENDER+"');"):data.MODE===ZCPConstants.INVITESUPPORTREP&&(acceptBtnparams.LABEL=I18N.getValue("button.join"),acceptBtnparams.ACTION="Common.handleChatNotificationAction('"+fromService+"',true, 'InviteChat', 'Join','"+data.CHID+"','"+data.VISITORID+"','"+data.SENDER+"')",rejectBtnparams.LABEL=I18N.getValue("button.ignore"),rejectBtnparams.ACTION="Common.handleChatNotificationAction('"+fromService+"',false, 'ENDSOUND', undefined, '"+data.CHID+"', '"+data.VISITORID+"');"),chatData.ACCEPTBUTTON=acceptBtnparams,chatData.REJECTBUTTON=rejectBtnparams,chatData.CLOSEBUTTON={ACTION:rejectBtnparams.ACTION},chatData}}catch(e){}},Common.formatCallNotificationData=function(data,serviceName){try{var callData={};callData.ID="commonuicallnotify_"+data.servicename+"_"+data.callrefid,callData.ICON="callIcon",callData.HEADERNAME=data.info.values.phone,callData.HEADERMSGID=callData.ID+"_status",callData.HEADERMSG=I18N.getValue("commonui.popup.call.message"),callData.SERVICENAME=serviceName;var acceptBtnparams={};acceptBtnparams.LABEL=I18N.getValue("crmplus.sidepanel.switchtoservice",[I18N.getValue("service.title."+serviceName)]),acceptBtnparams.ACTION="Services.loadFrame('"+serviceName+"');",callData.ACCEPTBUTTON=acceptBtnparams;var rejectBtnparams={};return rejectBtnparams.LABEL=I18N.getValue("button.cancel"),rejectBtnparams.ACTION="Common.removeNotificationComponent('"+callData.ID+"');",callData.REJECTBUTTON=rejectBtnparams,callData.CLOSEBUTTON={ACTION:"Common.removeNotificationComponent('"+callData.ID+"');"},callData}catch(e){}},Common.formatReminderNotificationData=function(data,serviceName){try{if("reminder"===data.type){var reminderData={};reminderData.ID="commonuireminder_"+serviceName+"_"+data.activityid,reminderData.ICON="reminderIcon",reminderData.HEADERNAME=data.displayname;var duedate,duemsg;void 0!==data.remindat&&(duedate=DateUtil.formatDate(new Date(data.remindat),!0)),void 0!==data.duedate&&(duedate=data.duedate),duemsg=void 0===duedate||""===duedate.trim()?"-":I18N.getValue("commonui.popup.reminder.message",[data.module,duedate]),reminderData.HEADERMSG=duemsg,reminderData.SERVICENAME=serviceName,reminderData.CLICKACTION=data.clickaction;
var acceptBtnparams={};acceptBtnparams.LABEL=I18N.getValue("button.snooze"),acceptBtnparams.ACTION="Common.removeNotificationComponent('"+reminderData.ID+"');",reminderData.ACCEPTBUTTON=acceptBtnparams;var rejectBtnparams={};return rejectBtnparams.LABEL=I18N.getValue("button.dismiss"),rejectBtnparams.ACTION="Common.deleteReminders(["+data.activityid+"]);Common.removeNotificationComponent('"+reminderData.ID+"');",reminderData.REJECTBUTTON=rejectBtnparams,reminderData.CLOSEBUTTON={ACTION:"Common.removeNotificationComponent('"+reminderData.ID+"');"},reminderData}}catch(e){}},Common.startTimer=function(duration,timerElemId,notificationId,fromService,notificationType){var minutes,seconds,timer=duration,display=$j("#"+timerElemId),chatCountDown=setInterval(function(){minutes=parseInt(timer/60,10),seconds=parseInt(timer%60,10),minutes=10>minutes?"0"+minutes:minutes,seconds=10>seconds?"0"+seconds:seconds,void 0!==display&&($j(display).text(minutes+":"+seconds),display.html($j(display).text()),"none"===display.css("display")&&display.show()),--timer<0&&(Common.removeNotificationComponent(notificationId,notificationType,"Timer Fired"),clearInterval(chatCountDown))},1e3)},Common.startVisitorOnlineTimer=function(initTime,timerContainerId){var duration=+new Date/1e3-+new Date(+initTime)/1e3;Common.startCountUpTimer(duration,timerContainerId)},Common.startCountUpTimer=function(initDuration,timerContainerId){var hours,minutes,seconds,duration=initDuration,countUpTimer=setInterval(function(){hours=Math.floor(duration/3600),minutes=Math.floor(duration%3600/60),seconds=Math.floor(duration%60),hours=10>hours?"0"+hours:hours,minutes=10>minutes?"0"+minutes:minutes,seconds=10>seconds?"0"+seconds:seconds,$j("#"+timerContainerId).text(hours+":"+minutes+":"+seconds),duration++},1e3);Common.countUpTimerReferences[timerContainerId]=countUpTimer},Common.removeNotificationComponent=function(id,type,source){"chat"===type&&Common.logChatActions(void 0,id,ZCPConstants.CHAT_POPUP_HIDDEN,source),$j("#"+id).remove(),Common.setNotificationContainerHeight()},Common.showConfirmDialog=function(header,content){var clickAction=Common.hideElement("confirm_popup");return $j("#confirm_title").html(header),$j("#confirm_content").html(content),$j("#button1").attr("onclick",clickAction),$j("#confirm_popup").show(),confirm(content)},Common.pushRecentItems=function(service,params){var fd=new FormData;fd.append("service",service),void 0!==params.DisplayName&&""!==params.DisplayName&&(fd.append("displayname",params.DisplayName),void 0!==params.Module&&""!==params.Module&&(fd.append("service_module",params.Module),void 0!==params.ClickAction&&""!==params.ClickAction&&(fd.append("clicktourl",params.ClickAction),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updaterecentitems.do",data:fd,processData:!1,contentType:!1,dataType:"text",success:function(recentItemId){recentItemId="recentitem_"+service+"_"+recentItemId;var recentItemCount=$j("#crmpluscommonui_recentitems_container > div").not("#crmpluscommonui_recentitems_container_nodatamsg").length,data="<a rel='noopener' href='#"+encodeURI(params.ClickAction)+"' id='"+escapeHtml(recentItemId)+"' class='zcrmp-rilist clearFix'\"><div class='zcrmp-riDoto'>"+escapeHtml(params.DisplayName)+"</div><div class='zcrmp-riSerLabel clearFix'><span class='zcrmp-moduleName'>"+escapeHtml(params.Module)+"</span><span class='fRight'><i class='plus-logo-"+service+" mR5'  title='"+I18N.getValue("service.title."+service)+"'></i></span></div></a>";$j("#"+recentItemId).length>0&&$j("#"+recentItemId).remove(),0===recentItemCount?$j("#crmpluscommonui_recentitems_container_nodatamsg").remove():recentItemCount>=ZCPConstants.RECENT_ITEMS_LIMIT&&$j("#crmpluscommonui_recentitems_container > div:last").remove(),$j("#crmpluscommonui_recentitems_container").prepend(data),Common.addClickEventListener("#"+recentItemId,Common.accessRecentItem,[service,encodeURI(params.ClickAction),"#event#"],Common)},error:function(){}}))))},Common.showRecentItems=function(){if(Common.isRecentItemsFirstFetch){var recentItemContainer=$j("#crmpluscommonui_recentitems_container"),params={};params.requesttype="recentitems",params.zuid=Common.myZuid;var url="fetchchatbardata.do";recentItemContainer.html('<img src="'+Common.staticImgUrl+"/"+Common.staticHashedFileNames[Common.busyGif]+'" style="margin:60px auto;"/>'),$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/"+url,data:params,success:function(data){Common.isRecentItemsFirstFetch=!1,recentItemContainer.html(data),Common.addClickEventListener("#crmpluscommonui_recentitems_container a"),$j("#crmpluscommonuirecentitemsscrollingdiv").css({"max-height":$j(window).height()-$j("#recentitemsheader").outerHeight(!0)})},error:function(){}})}},Common.onReminderPanelScroll=function(){var containerId="crmpluscommonui_reminders_container";Common.canFetchReminders&&!Common.isRemindersLoadingOn&&$j("#"+containerId).scrollTop()+$j("#"+containerId).innerHeight()>=$j("#"+containerId)[0].scrollHeight&&Common.fetchAndRenderReminderPanel()},Common.fetchAndRenderReminderPanel=function(isFromWMS){var containerId="crmpluscommonui_reminders_container",loadingId="crmpluscommonui_reminders_loading",pageNo=$j("#"+containerId).attr("pageno");if(!(isFromWMS&&+pageNo>1)){Common.isRemindersLoadingOn=!0,$j("#"+containerId).append('<img id="crmpluscommonui_reminders_loading" style="margin:30px auto;" src="'+Common.staticImgUrl+"/"+Common.staticHashedFileNames[Common.busyGif]+'"/>'),$j("#crmpluscommonui_reminders_container_nodatamsg").hide();var params={};params.requesttype="reminders",params.zuid=Common.myZuid,params.page=pageNo,params.per_page=25;var url="fetchchatbardata.do";$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/"+url,data:params,success:function(result){if(reminderData=result.reminderData,$j("#"+loadingId).remove(),void 0!==reminderData&&reminderData.length>0){$j("#crmpluscommonui_reminders_container_nodatamsg").hide();for(var i=0;i<reminderData.length;i++){var reminderObj=reminderData[i];for(var key in reminderObj){var dateKey=escapeHtml(key.replace(" ","_"));$j("#reminders_datefield_"+dateKey).length||$j("#"+containerId).append('<div class="zcrmp-rDateFields" id="reminders_datefield_'+dateKey+'" datekey="'+dateKey+'">'+key+"</div>");var reminderTemplate=Handlebars.compile($j("#crm_list_reminder_template").html()),modelData={};modelData.reminderData=reminderObj[key],modelData.dateKey=dateKey,$j("#"+containerId).append(reminderTemplate(modelData))}}Common.isRemindersLoadingOn=!1,$j("#"+containerId).attr("pageno",parseInt(pageNo,10)+1),"1"==pageNo&&($j("#"+containerId).attr("onscroll","Common.onReminderPanelScroll();"),Common.setScroll(containerId));var reminderCount=$j("#crmpluscommonui_reminders_container input").length;result.reminderDataCount<25&&delete Common.canFetchReminders,$j("#reminders_select_count_vs_total_count").text("("+$j("#crmpluscommonui_reminders_container input:checked").length+"/"+reminderCount+")"),25==result.reminderDataCount?reminderCount>99?reminderCount="99+":reminderCount+="+":reminderCount>99&&(reminderCount="99+"),$j("#plusRemindersCount, #plusreminderscountonpaneltop").text(reminderCount),$j("#plusreminderscountonpaneltop").show(),$j("#plusReminderIcon").hasClass("selected")||"1"!=pageNo||$j("#plusRemindersCount").show()}else if("1"==pageNo)$j("#crmpluscommonui_reminders_container_nodatamsg").show(),$j("#plusreminderscountonpaneltop").hide();else{delete Common.canFetchReminders;var reminderCount=$j("#crmpluscommonui_reminders_container input").length;99>reminderCount&&$j("#plusRemindersCount, #plusreminderscountonpaneltop").text(reminderCount)}},error:function(){$j("#"+loadingId).remove(),Common.isRemindersLoadingOn=!1}})}},Common.hideReminderPanel=function(){if($j("#plusReminderIcon").hasClass("selected")){$j("#crmpluscommonui_reminders_container").slimScroll({scrollTo:"0px"}),$j("#crmpluscommonui_reminders").slideUp(300,"linear"),$j("#crmpluscommonui_reminders_alloptionview").slideUp(300,"linear"),$j("#crmpluscommonui_reminders_alloption").prop("checked",!1),$j("#plusReminderIcon").removeClass("selected");var inputArr=$j("#crmpluscommonui_reminders_container input");$j(inputArr).removeProp("checked"),Common.isRemindersLoadingOn=!1,$j("#plusRemindersCount").addClass("greyColor"),$j("#crmpluscommonui_reminders_container input").length>0&&($j("#plusRemindersCount").show(),$j("#plusreminderscountonpaneltop").hide())}},Common.selectReminderCheckBox=function(event){event&&Common.stopEvents(event,!0);var checkBoxes=$j("#crmpluscommonui_reminders_container input"),checkedBoxes=$j("#crmpluscommonui_reminders_container input:checked"),allCheckBoxView=$j("#crmpluscommonui_reminders_alloptionview"),allCheckBox=$j("#crmpluscommonui_reminders_alloption");checkedBoxes.length>0?allCheckBoxView.slideDown(100,"linear"):allCheckBoxView.slideUp(100,"linear"),checkBoxes.length===checkedBoxes.length?allCheckBox.prop("checked",!0):allCheckBox.prop("checked",!1),$j("#reminders_select_count_vs_total_count").text("("+checkedBoxes.length+"/"+checkBoxes.length+")")},Common.selectAllRemindersCheckBox=function(eventObj){if(void 0!==eventObj){var checkedValue=$j(eventObj).prop("checked"),inputArr=$j("#crmpluscommonui_reminders_container input");void 0!==checkedValue&&checkedValue?$j(inputArr).prop("checked",!0):($j("#crmpluscommonui_reminders_alloptionview").slideUp(100,"linear"),$j(inputArr).removeProp("checked")),$j("#reminders_select_count_vs_total_count").text("("+inputArr.length+"/"+inputArr.length+")")}},Common.deleteSelectedReminders=function(){for(var reminderIds=[],checkedInputArr=$j("#crmpluscommonui_reminders_container input:checked"),i=($j("#crmpluscommonui_reminders_container input").length,0);i<checkedInputArr.length;i++)reminderIds.push(checkedInputArr[i].value);if(reminderIds.length>0)for(var maxDeleteSize=5,i=0;i<reminderIds.length;i+=maxDeleteSize){var tempReminderIds=reminderIds.slice(i,i+maxDeleteSize);Common.deleteReminders(tempReminderIds)}},Common.deleteReminders=function(reminderIds){if(reminderIds.length>0){var fd=new FormData;fd.append("reminderId",reminderIds),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updatereminders.do",loadingParams:{type:"global"},data:fd,processData:!1,contentType:!1,success:function(){$j("#crmpluscommonui_reminders_alloption").removeProp("checked"),$j("#crmpluscommonui_reminders_alloptionview").hide(),$j("#crmpluscommonui_reminders_container > div").not("#crmpluscommonui_reminders_container_nodatamsg").remove(),$j("#reminders_select_count_vs_total_count").text(""),$j("#plusRemindersCount, #plusreminderscountonpaneltop").hide(),$j("#crmpluscommonui_reminders_container").attr("pageno","1"),Common.canFetchReminders=!0,Common.fetchAndRenderReminderPanel()},error:function(){showStatusMsg("error",I18N.getValue("service.creation.error.header"),3e3)}})}},Common.showVisitorOnlinePanel=function(){$j("#plusVisitorsCount").hide(),$j("#plusVisitorIcon").addClass("selected"),Common.setScroll("crmpluscommonui_visitors_container"),$j("#crmpluscommonui_visitorsonline").slideDown(200,"linear")},Common.hideVisitorOnlinePanel=function(){$j("#plusVisitorIcon").hasClass("selected")&&($j("#crmpluscommonui_visitorsonline").slideUp(300,"linear"),$j("#plusVisitorIcon").removeClass("selected"),$j("#plusVisitorsCount").addClass("greyColor"),$j("#plusVisitorsCount").text()>0&&$j("#plusVisitorsCount").show())},Common.registerWMS=function(langCode,countryCode,serviceCode,zuid,fullName){WebMessanger.setNoDomainChange(),WebMessanger.setLocale(langCode,countryCode),WebMessanger.enableTokenPairAuth(),WebMessanger.registerZuid(serviceCode,zuid,fullName),WebMessanger.disableWMSStatus()},Common.fetchPortals=function(noCloseButton){hidePanel(),Services.showLoading();var params={};noCloseButton&&(params.targettab="_self"),null!==Common.currentPortalName&&(params.currentportalname=Common.currentPortalName),$j.ajax({type:"GET",url:"/getportals.do",dataType:"html",data:params,success:function(data){null!=data&&""!=data&&($j("#freezingPopContainer").html(data),noCloseButton&&$j("#freezingPopContainerCloseButton").hide(),showDialog("freezingPopContainer"))},complete:function(){Services.hideLoading()}})},Common.populateVisitorData=function(cobjJson){try{if(void 0!==cobjJson){var visitorTemplate=Handlebars.compile($j("#visitor_notification").html());cobjJson.length>0&&$j("#crmpluscommonui_visitors_container_nodatamsg").hide();for(var index in cobjJson){var visitor=cobjJson[index];if(0===$j("#visitoronline"+visitor.uvid).length){if(void 0!=visitor.lastvisittime){var date=new Date(+visitor.lastvisittime),lastVisitTime=DateUtil.convertDateToString(date);-1!=lastVisitTime.indexOf(ZCPConstants.TODAY)||-1!=lastVisitTime.indexOf(ZCPConstants.YESTERDAY)||-1!=lastVisitTime.indexOf(ZCPConstants.TOMORROW)?visitor.lastvisittitle=DateUtil.getDateStringFromDate(date)+" "+DateUtil.getTimeStringFromDate(date):lastVisitTime=lastVisitTime+" "+DateUtil.getTimeStringFromDate(date),visitor.lastvisittime=lastVisitTime}else visitor.lastvisittime="-";$j("#crmpluscommonui_visitors_container").append(visitorTemplate(visitor))}}var visitorCount=$j("#crmpluscommonui_visitors_container > div").not("#crmpluscommonui_visitors_container_nodatamsg").length;visitorCount>0?(visitorCount>99&&(visitorCount="99+"),$j("#plusVisitorsCount, #plusvisitorscountonpaneltop").html(visitorCount),$j("#plusVisitorsCount").removeClass("greyColor"),$j("#plusvisitorscountonpaneltop").show(),$j("#plusVisitorIcon").hasClass("selected")||$j("#plusVisitorsCount").show()):$j("#plusVisitorsCount, #plusvisitorscountonpaneltop").hide()}}catch(e){}},Common.accessRecentItem=function(serviceName,recentItemHash,event){Services.getRedirectionUrl(serviceName,!0,!1,recentItemHash),Common.stopEvents(event,!0),hidePanel(),CRMPlusCommonUi.handleLeftPanel()},Common.setUserOptions=function(key,value){if(void 0!=key&&void 0!=value){var params={};if(void 0===Common.userOptions&&(Common.userOptions={}),"isnewui"===key)params.isnewui=value,params.options=JSON.stringify(Common.userOptions);else{var stats={};Common.userOptions[key]=value,params.options=JSON.stringify(Common.userOptions),Object.keys(stats).length>0&&(params.stats=JSON.stringify(stats))}params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updateuseroptions.do",data:params,dataType:"json",success:function(data){if(data===!0&&"isnewui"===key)if(value===!1){var currentServiceUrl=location.hash,toAppendUrl="",redirectUrl=window.location.origin+window.location.pathname;void 0!=currentServiceUrl&&(-1!==currentServiceUrl.indexOf("/getcpdata")&&(currentServiceUrl=currentServiceUrl.substring(0,currentServiceUrl.indexOf("/getcpdata"))),toAppendUrl=currentServiceUrl,redirectUrl+="?toappendurl="+encodeURIComponent(toAppendUrl)),Common.resetNewUICookies(),window.location.href=redirectUrl}else Common.isNewUI=!0,Services.loadFirstService(),Services.handleSalesiqChat(),SidePanel.getAgentStatus(),$j("#crmplusoldusers-newuibanner").hide(),$j("#crmplusbacktoolduibtn").show(),$j("#crmpluscommonuiadminpanel").show(),"setup"==TopBar.type&&TopBar.onClose(),CRMPlusCommonUi.initLeftPanel(),location.reload()},error:function(){showStatusMsg("error",I18N.getValue("service.creation.error.header"),3e3)}})}},Common.defaultUserOptions={},Common.defaultUserOptions.isleftpanelvisible=!0,Common.defaultUserOptions.theme="bluefan",Common.getUserOptions=function(key){return void 0!==Common.userOptions&&Common.userOptions.hasOwnProperty(key)?Common.userOptions[key]:Common.defaultUserOptions[key]},Common.onClickOnCrmplus=function(){CRMPlusCommonUi.hideNotificationDialog(Services.currentView),"popup"!==CRMPlusCommonUi.search.UIType&&CRMPlusCommonUi.search.hideAutoSuggestView(Services.currentView),null!==$("salesinboxLoadFrame")&&Services.currentView===ZCPConstants.SERVICE_SALESINBOX&&ServiceCommunicator.triggerAction("salesinbox","hideDialog","search"),$j("#sidepanelagentstatusdialog  [id^=sidepanelagent][id$=statuslist]").hide(),$j("#crmpluscanceltrailoption").hide()},Common.setNotificationContainerHeight=function(){var contentsHeight=0;$j("#crmpluscommonuigeneralnotificationcontainer > div").each(function(index,content){contentsHeight+=$j(content).outerHeight(!0)}),contentsHeight<$j(window).outerHeight(!0)?$j("#crmpluscommonuigeneralnotificationcontainer").css("height",contentsHeight):$j("#crmpluscommonuigeneralnotificationcontainer").css("height",$j(window).outerHeight(!0)-$j("#wmstoolbar").outerHeight(!0))},Common.handleChatNotificationAction=function(fromService,isSwitchService,mode,status,chid,visitorid,sender,isProactive){try{var ldmsgobj={};void 0!==mode&&(ldmsgobj.MODE=mode),void 0!==status&&(ldmsgobj.STATUS=status),void 0!==chid&&(ldmsgobj.CHID=chid),void 0!==visitorid&&(ldmsgobj.VISITORID=visitorid),void 0!==sender&&(ldmsgobj.SENDER=sender),void 0!==isProactive&&(ldmsgobj.ISPROACTIVE=isProactive),fromService===ZCPConstants.SERVICE_SALESIQ?LiveDeskApi.sendPostMessage(ldmsgobj):fromService===ZCPConstants.SERVICE_SUPPORT&&ServiceCommunicator.triggerAction(fromService,"handleChatNotificationAction",ldmsgobj),isSwitchService&&(fromService!==ZCPConstants.SERVICE_SALESIQ||Services.isLoadedInIframe[fromService]||(LiveDeskApi.focus={chid:chid}),Services.getRedirectionUrl(fromService,!0,!1,void 0,"initiating-chat")),void 0!=chid&&(Common.removeNotificationComponent(chid,"chat","userAction : "+mode),("IgnoreChat"==mode||"ENDSOUND"==mode)&&Common.broadCastMessageThroughStorage("crmplus_"+fromService+"_remove_chat_notification",JSON.stringify({chid:chid,serviceName:fromService})))}catch(e){}},Common.setAgentChatStatus=function(serviceName,mode,status){var ldmsgobj={};ldmsgobj.MODE=mode,ldmsgobj.STATUS=status,serviceName===ZCPConstants.SERVICE_SALESIQ?LiveDeskApi.sendPostMessage(ldmsgobj):serviceName===ZCPConstants.SERVICE_SUPPORT&&ServiceCommunicator.triggerAction(Services.currentView,"setAgentChatStatus",ldmsgobj)},Common.handleKeyBoardShortCutKeyCode=function(event){var target=event.target&&event.srcElement||event.originalTarget;"INPUT"!==target.nodeName&&"TEXTAREA"!==target.nodeName&&"true"!==target.contentEditable&&("keydown"==event.type&&Services.currentView!==ZCPConstants.SERVICE_SUPPORT?191===event.keyCode&&event.shiftKey===!1?Common.pressedKeys="/":85===event.keyCode?Common.pressedKeys="u":(event.shiftKey===!0&&187===event.keyCode||61===event.keyCode)&&(Common.pressedKeys="shift+"):"keyup"==event.type&&(""!==Common.pressedKeys&&Common.handleKeyBoardShortCut(Common.pressedKeys),Common.pressedKeys=""))},Common.handleKeyBoardShortCut=function(pressedKeys){if(""!==pressedKeys){hidePanel(),CRMPlusCommonUi.hideNotificationDialog(Services.currentView),0!==$j("#wmstoolbar").length&&"ctrl+space"===pressedKeys&&"undefined"!=typeof WmsHybridSearch&&void 0!==WmsHybridSearch.toggleUI&&WmsHybridSearch.toggleUI();try{"/"===pressedKeys&&Services.isServiceFrameVisible(Services.currentView)&&"popup"!=CRMPlusCommonUi.search.UIType&&"search"!==TopBar.type&&"setup"!==TopBar.type&&(Services.currentView==ZCPConstants.SERVICE_SALESINBOX?$j("#crmpluscommonuisalesinboxtext").focus():CRMPlusCommonUi.currentModuleList[Services.currentView].quickaccess.search&&CRMPlusCommonUi.search.showSearchPopUp())}catch(e){}"/"===pressedKeys&&"search"==TopBar.type&&(document.getElementById("crmpluscommonuisearchtext").select(),$j("#crmpluscommonuisearchtext").focus()),"u"===pressedKeys&&($j("#profilePanel").is(":visible")||Common.showProfilePanel()),"shift+"===pressedKeys&&"search"!==TopBar.type&&"setup"!==TopBar.type&&showPanel("crmpluscommonuiaddoptionpanel",void 0,"translate-y",!1),window.focus()}},Common.clickOnFreezeLayer=function(){"popup"==CRMPlusCommonUi.search.UIType&&CRMPlusCommonUi.search.hideSearchPopUp()},Common.toggleChatNotifictionSound=function(serviceName){var elem=$j("#sidepanelagentchat"+serviceName+"sound"),soundStatus=elem.hasClass("plus-mute")?!0:!1;Common.handleChatNotifictionSound(serviceName,soundStatus,"muteicon")},Common.handleChatNotifictionSound=function(serviceName,soundStatus,actionSrc){try{if("localstorage"===actionSrc&&Common.handleChatNotificationAction(serviceName,!1,"SETSOUNDSTATUS",soundStatus),"muteicon"===actionSrc){var status=soundStatus?"ENABLESOUND":"MUTESOUND";Common.handleChatNotificationAction(serviceName,!1,status)}"localstorage"!==actionSrc&&Common.broadCastMessageThroughStorage("crmplus_"+serviceName+"_sync_chat_notification_sound",JSON.stringify({soundStatus:soundStatus,serviceName:serviceName}));var elemIds="#sidepanelagentchat"+serviceName+"sound";serviceName==ZCPConstants.SERVICE_SALESIQ&&(elemIds+=", #crmpluscommonuisalesiqsoundicon > i"),soundStatus?$j(elemIds).removeClass("plus-mute").addClass("plus-unmute"):$j(elemIds).removeClass("plus-unmute").addClass("plus-mute")}catch(e){}},Common.setNotifictionSound=function(serviceName,soundData){"chat"===soundData.type&&Common.handleChatNotifictionSound(serviceName,soundData.ismute)},Common.onWindowMouseHover=function(){Common.isCrmplusFocused=!0},Common.onWindowMouseLeave=function(){Common.isCrmplusFocused=!1},Common.canTreatLeftPanelVisible=function(){if("setup"==TopBar.type)return!1;var leftPanelStatus=Common.getUserOptions(ZCPConstants.LEFTPANEL_VISIBLE);if(leftPanelStatus===!0)return!0;if(null===leftPanelStatus){if(Common.isSignUp)return!0;if(!Common.canHideLeftPanelOnNull)return!0}return!1},Common.showProfilePanel=function(event){Common.setProfilePanelHeight(),showPanel("profilePanel",void 0,"translate-rx",!0,event)},Common.setProfilePanelHeight=function(){var windowHeight=$j(window).height();$j("#profilePanel").css({height:windowHeight}),$j("#crmpluscommonuiprofilescrollview").css({height:windowHeight})},Common.hideWmsAnnouncement=function(){try{var wmsAnnStyle=document.createElement("style");wmsAnnStyle.innerHTML="#annmsgstrip {display:none !important}",document.head.appendChild(wmsAnnStyle)}catch(e){}},Common.toggleCallusDialog=function(){"none"===$j("#callus-dialogcontainer").css("display")?($j("#callus-dialogcontainer").show(),$j("#callus-dialog").slideDown("fast")):$j("#callus-dialog").slideUp("fast",function(){$j("#callus-dialogcontainer").hide()})},Common.showMoreModuleList=function(event){showPanel("crmpluscommonuimoremodulelistdiv",void 0,"translate-y",void 0,event),Services.currentView==ZCPConstants.SERVICE_CRM&&$j("#commonUimoreModuleList"+Services.currentView+" > li").length>8&&($j("#crmpluscommonuimoremodulesearch").removeClass("hide"),$j("#crmpluscommonuimoremodulesearchbox").focus())},Common.changeBrowserTitle=function(titleText){Common.currentDocumentTitle=titleText,document.title=titleText},Common.canShowSwitchIconOnHiddenTopBar=function(serviceName){if(Common.isSignUp&&Services.isOverviewCompleted[serviceName]!==!0||-1!=Services.nonSignupOverviewServices.indexOf(serviceName))return!0;if(serviceName===ZCPConstants.SERVICE_SALESINBOX){var salesInboxData=Services.configuredServicesData[serviceName];if(void 0!==salesInboxData&&salesInboxData.HAS_ACCESS===!0&&salesInboxData.ISCONFIGURED===!1)return!0}return!1},Common.endTrialPopUp=function(){hidePanel();var param={};param.type="canceltrial",$j.ajax({type:"get",url:""+Common.getPortalUrl(!0)+"/fetchhtml.do",data:param,loadingParams:{type:"global"},dataType:"html",success:function(data){null!=data&&""!=data&&(0==$j("#cancel-account").length&&$j("body").append(data),Common.spotLight.track(ZCPConstants.CRMPLUS_CANCEL_TRIAL_CLICK,{source:"Home Page"}),Common.hideElement("profile-panel"),$j("#cancelaccount_body").show(),Common.showReasonBox(),showDialog("cancel-account"),$j("#passwordFld").focus())},error:function(){showStatusMsg("error",I18N.getValue("service.configuration.failed"))}})},Common.logChatActions=function(serviceName,chid,action,source,mode){try{var logData={};void 0!==serviceName&&(logData.servicename=serviceName),void 0!=chid&&(logData.chid=chid),void 0!==action&&(logData.action=action),void 0!==source&&(logData.source=source),void 0!==mode&&(logData.mode=mode),Common.log(JSON.stringify(logData))}catch(e){}},Common.log=function(message,level){try{if(void 0===message)return;var formData=new FormData;formData.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),formData.append("message",message),void 0!==level&&formData.append("level",level),$j.ajax({type:"POST",url:"/logclientinfo.do",data:formData,processData:!1,contentType:!1,success:function(){}})}catch(e){}},Common.handleMessageFromOtherTab=function(event){try{var key=event.key,message=event.newValue;if(!message)return;var messageJson=Common.jsonParse(message);if(messageJson.isPortalSpecific&&(messageJson.portalName!=Common.currentPortalName||messageJson.tabIndex===Common.tabIndex))return;var messageVersion=messageJson.tabVersion,newValue=messageJson.message;if(Common.versionForMultipleTabCommunication==messageVersion)if("crmplus_livedesk_sendpostmessage"===key)Common.canCommunicateThroughStorage()&&(newValue=Common.jsonParse(newValue),LiveDeskApi.sendPostMessage(newValue));else if("crmplus_livedesk_receivepostmessage"===key)Services.isLoadedInIframe.salesiq||(newValue=Common.jsonParse(newValue),LiveDeskApi.handlePostMessage(newValue));else if(key.startsWith("crmplus_poll_from_")){if(Common.isFirstTab){var pollFromTab=key.split("crmplus_poll_from_")[1];CRMPlusLocalStorage.setItem(ZCPConstants.TAB_AVAILABLE+"_"+pollFromTab,1)}}else"firsttabclose"===key?Common.tabIndex==newValue&&Common.switchAsParent():"crmplus_livedesk_handle_salesiq_pending"===key?(newValue=Common.jsonParse(newValue),void 0!==LiveDeskApi.focus&&LiveDeskApi.focus.chid==newValue.CHID&&(LiveDeskApi.canFocus=!0,LiveDeskApi.pendingChatData=newValue,Services.isLoadedInIframe.salesiq&&LiveDeskApi.handlePendingActions())):"crmplus_salesiq_remove_chat_notification"===key?(newValue=Common.jsonParse(newValue),Common.removeNotificationComponent(newValue.chid,"chat","Accepted or declined from other tab"),Common.handleChatNotificationAction(newValue.serviceName,!1,"ENDSOUND")):"crmplus_support_remove_chat_notification"===key?(newValue=Common.jsonParse(newValue),Common.removeNotificationComponent(newValue.chid,"chat","Accepted or declined from other tab"),Common.handleChatNotificationAction(newValue.serviceName,!1,"ENDSOUND")):"crmplus_salesiq_sync_chat_notification_sound"===key?(newValue=Common.jsonParse(newValue),Common.handleChatNotifictionSound(newValue.serviceName,newValue.soundStatus,"localstorage")):"crmplus_support_sync_chat_notification_sound"===key&&(newValue=Common.jsonParse(newValue),Common.handleChatNotifictionSound(newValue.serviceName,newValue.soundStatus,"localstorage"))}catch(e){}},Common.broadCastMessageThroughStorage=function(messageKey,message,isPortalSpecific){void 0===isPortalSpecific&&(isPortalSpecific=!0);var messageJson={};isPortalSpecific&&(messageJson.isPortalSpecific=!0,messageJson.portalName=Common.currentPortalName),messageJson.tabIndex=Common.tabIndex,messageJson.message=message,messageJson.tabVersion=Common.versionForMultipleTabCommunication,messageJson=JSON.stringify(messageJson);try{CRMPlusLocalStorage.setItem(messageKey,messageJson),CRMPlusLocalStorage.removeItem(messageKey)}catch(e){}},Common.initPollForNoOfTabs=function(){CRMPlusLocalStorage.setItem(ZCPConstants.TAB_AVAILABLE+"_"+Common.tabIndex,0),Common.broadCastMessageThroughStorage("crmplus_poll_from_"+Common.tabIndex,0),setTimeout(Common.endPoll,1e3)},Common.endPoll=function(){try{Common.isPollFinished=!0;var istabavailable=CRMPlusLocalStorage.getItem(ZCPConstants.TAB_AVAILABLE+"_"+Common.tabIndex);if(CRMPlusLocalStorage.removeItem(ZCPConstants.TAB_AVAILABLE+"_"+Common.tabIndex),"0"==istabavailable){Common.isFirstTab=!0;for(var i=0;i<window.localStorage.length;i++){var key=window.localStorage.key(i);key.startsWith(Common.getPrefixForTabID())&&(CRMPlusLocalStorage.removeItem(key),i--)}}Services.isFetchComplete&&Services.handleSalesiqForChatCommunication(),Services.isLoadedInIframe.saleisq?CRMPlusLocalStorage.setItem(Common.getTabID(),1):CRMPlusLocalStorage.setItem(Common.getTabID(),0)}catch(e){Common.isFirstTab=!0,Common.isPollFinished=!0}},Common.onWindowBeforeUnLoad=function(){if(CRMPlusLocalStorage.removeItem(Common.getTabID()),CRMPlusLocalStorage.removeItem(ZCPConstants.TAB_AVAILABLE+"_"+Common.tabIndex),Common.isFirstTab){for(var nextParent=null,i=0;i<window.localStorage.length;i++){var key=window.localStorage.key(i);if(key.startsWith(Common.getPrefixForTabID())){var value=CRMPlusLocalStorage.getItem(key);if(1==value){nextParent=key;break}nextParent=key}}Common.isFirstTab=!1,null!=nextParent&&Common.broadCastMessageThroughStorage("firsttabclose",nextParent.replace(Common.getPrefixForTabID(),""))}},Common.switchAsParent=function(){Common.isFirstTab=!0,Services.hasServiceAccess("salesiq")&&Services.loadFrame("salesiq",void 0,void 0,!1)},Common.canCommunicateThroughStorage=function(){return Common.isFirstTab},Common.getTabID=function(){return Common.getPrefixForTabID()+Common.tabIndex},Common.getPrefixForTabID=function(){return ZCPConstants.AVAILABLE_TABS+"_"+Common.myOrgId+"_"},Common.redirectToCreateAccount=function(){$j(".zcrmp-pageErrBtn").addClass("disabled"),Loading.global.start(),window.open(window.location.origin+"/index.do?createaccount=true","_self")},Common.acceptInvite=function(soid){$j(".zcrmp-pageErrBtn").addClass("disabled"),$j("#crmplus-errpage-button").text(I18N.getValue("button.joining"));var param={};param.soid=soid,$j.ajax({type:"GET",url:"/crmplusinvite/acceptinvite.cp",data:param,dataType:"text",success:function(data){var URL=window.location.origin+data;window.location.href=URL},error:function(){showStatusMsg("error",I18N.getValue("service.creation.error.header")),$j(".zcrmp-pageErrBtn").removeClass("disabled"),$j("#crmplus-errpage-button").text(I18N.getValue("button.join"))}})},Common.sendErrorAlert=function(subject,bodyObj){if(-1===window.location.origin.indexOf(".zohocorpin.com")&&-1===window.location.origin.indexOf("localzoho.com")){var body="Dear Team, ";body+="\n\nOrg Name : "+Common.currentPortalName,body+="\n\nUser Email : "+Common.userEmailID;for(var key in bodyObj)body+="\n\n"+key+" : "+bodyObj[key];sendMail(!1,!1,"[CRMPLUS ALERT] "+subject,body,void 0,function(){})}},Common.canHideTopBar=function(serviceName){if("crmplus"===TopBar.type){if(Common.isSignUp&&1!=Services.isOverviewCompleted[serviceName]||-1!==Services.nonSignupOverviewServices.indexOf(Services.currentView))return!0;if(CRMPlusCommonUi.isTopBarHidden[serviceName]===!0||serviceName===ZCPConstants.SERVICE_SALESINBOX&&Services.isSalesInboxRemapping)return!0;var serviceData=Services.configuredServicesData[serviceName];if(void 0!==serviceData){if("salesinbox"===serviceName&&serviceData.HAS_ACCESS&&!serviceData.ISCONFIGURED)return!0;if(serviceData.STATUS===ZCPConstants.STATUS_NOTCONFIGURED)return!0}}},Common.showExtendTrialDialog=function(){$j("#extendtrial").show(),showDialog("extendtrial"),$j("#extendtrialreason").focus()},Common.showContactMeDialog=function(){$j("#contactmeformparent").show(),showDialog("contactmeformparent"),$j("#contact-number").focus()},Common.extendTrial=function(crmplusId){if(Common.isReadOnlyMode)showStatusMsg("error",I18N.getValue("crmplus.ro.action.denied.msg"));else{Loading.button.start({id:"extendtrialbutton"});var trialinfo=[];if(trialinfo[0]={},trialinfo[0].customerreason=$j("#extendtrialreason").val().trim().substring(0,2e3),!CRMPlusValidator.isValidInputField($j("#contact-number")))return $j("#contact-number").focus(),void Loading.button.stop({id:"extendtrialbutton"});trialinfo[0].mobile=$j("#contact-number").val();var params={};params.extendtrial=trialinfo[0],$j.ajax({type:"PUT",dataType:"json",data:JSON.stringify(params),url:"/api/v1/orgs/"+crmplusId+"/extendtrial",beforeSend:function(request){request.setRequestHeader("X-ZCSRF-TOKEN",Security.csrfParam.get()+"="+encodeURIComponent(Security.csrfToken.get()))},success:function(data){null!=data.message&&""!=data.message?200==data.status_code?0!=$j("#contact-number").length?($j("#successalert").addClass("successAlert2"),$j("#extendtrialbuttonspan").text(I18N.getValue("link.access.crmplus")),Loading.button.stop({id:"extendtrialbutton"}),$j("#extendtrialbutton").attr("onclick","window.open('https://"+Common.productUrl+encodeURI(Common.getPortalUrl(!0))+"/index.do','_self')")):($j("#successalert").addClass("successAlert"),setTimeout(function(){window.location.href="https://"+Common.productUrl+Common.getPortalUrl(!0)+"/index.do"
},5e3)):(showStatusMsg("error",data.message,3e3),Loading.button.stop({id:"extendtrialbutton"})):(showStatusMsg("error",I18N.getValue("subscription.message.extendtrial.failure.general"),3e3),Loading.button.stop({id:"extendtrialbutton"}))},error:function(){showStatusMsg("error",I18N.getValue("subscription.message.extendtrial.failure.general")),Loading.button.stop({id:"extendtrialbutton"})}})}},Common.resetNewUICookies=function(){for(var serviceContextPaths=["crm","support","portal","campaigns","social","survey","salesiq","reports","motivator"],i=0;i<serviceContextPaths.length;i++)try{var context=serviceContextPaths[i];document.cookie="newcrmplusredirection=0; path=/"+context+"/; domain="+window.location.host.replace(window.location.host.split(".")[0],"")+"; secure;"}catch(e){}},Common.autoNewVersionButtonClick=function(){$j("#crmplus_autonewui_welcome").hide()},Common.trackFeature=function(featureName){var featureInfo=[];featureInfo[0]={},featureInfo[0].featureName=featureName;var params={};params.mics=featureInfo[0],$j.ajax({type:"POST",dataType:"json",data:JSON.stringify(params),url:"/api/v1/orgs/"+Common.myOrgId+"/mics",beforeSend:function(request){request.setRequestHeader("X-ZCSRF-TOKEN",Security.csrfParam.get()+"="+encodeURIComponent(Security.csrfToken.get()))}})},Common.isInternalChange=function(){try{if(-1!=Common.userEmailID.indexOf("@zohocorp.com"))return!0}catch(e){}return!1},Common.showZiaOptionPanel=function(){$j("#crmplusziaoptionpanel").show(),$j("#crmplustotalziacount").hide()},Common.hideZiaOptionPanel=function(){$j("#crmplusziaoptionpanel").hide(),+$j("#crmplustotalziacount").text()>0&&$j("#crmplustotalziacount").show()},Services.configuredServicesData={},Services.fieldsData={},Services.appsData={},Services.intialFrameLoad=!1,Services.previousLoadedFrame=null,Services.isFetchUsedAccountData=!1,Services.userData=null,Services.accountsData=null,Services.isFetchComplete=!1,Services.initialServiceToCreate="crm",Services.triggerPaymentPage=!1,Services.productSpecificOptions={},Services.isLoadedInIframe={},Services.hasAdminPanelAccess=!1,Services.currentUrl={},Services.allCurrentUrl={},Services.loadingType=null,Services.currentTopBarType="crmplus",Services.currentErrorPage=null,Services.configuredCount=0,Services.isNonCrmplusPortal=!1,Services.isSalesInboxConfigured=null,Services.isSalesInboxEmailAdded=!1,Services.isSalesInboxRemapping=!1,Services.admins={},Services.nonSignupOverviewServices=[],Services.notConfiguredServices=[],Services.showCompanyFetchPopUp=void 0,Services.hidden=[ZCPConstants.SERVICE_MOTIVATOR,ZCPConstants.SERVICE_SALESINBOX],Services.fetch=function(serviceZaaid,serviceName,isAccountInfo,serviceList,returnData){var paramData={},data_type="json";void 0!=serviceZaaid&&(paramData={zaaid:serviceZaaid,service:serviceName}),void 0!=isAccountInfo&&(paramData={isaccountData:isAccountInfo}),void 0!=serviceList&&(paramData={servicelist:serviceList.toString()}),$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/fetchappsstatus.do",data:paramData,dataType:data_type,cache:!1,success:function(data){if(null!=data&&""!=data)if(void 0!=serviceZaaid){if(returnData)return Setup.show.serviceError(serviceName,JSON.stringify(data)),data;Services.conflict.show(serviceName,data)}else if(void 0==isAccountInfo||isAccountInfo){if(void 0!=isAccountInfo&&isAccountInfo)Services.accountsData=data.SERVICESLIST,Common.isAdmin=data.IS_ADMIN;else if(void 0!=serviceList)if(Common.IsAdmin=void 0===data.IS_ADMIN?!1:data.IS_ADMIN,returnData&&Common.isAdmin){var canCreate=data.CREATEACCOUNT;canCreate&&showStatusMsg("info",I18N.getValue("crmplus.message.recreate"),5e3)}else Services.appData.populateDbData(data)}else Services.userData=data.SERVICESLIST,Common.isAdmin=data.IS_ADMIN}})},Services.appData={populateDbData:function(serviceData){var data=serviceData.SERVICESLIST,canCreate=serviceData.CREATEACCOUNT,appCount=0,notConfiguredServices="";for(var appName in data){var appData=data[appName],serviceUrl=Services.serviceUrl.getDirectAccess(appName,appData.APPID,appData.PORTAL,appData.ISCONFIGURED);Services.configuredServicesData[appName]=data[appName],Services.configuredServicesData[appName].IS_ADMIN=Common.isAdmin,Services.configuredServicesData[appName].URL=serviceUrl,Services.configuredServicesData[appName].isUserActive=null,void 0!=appData.IS_ACTIVE_IN_SERVICE&&(Services.configuredServicesData[appName].isUserActive=appData.IS_ACTIVE_IN_SERVICE),data[appName].ISCONFIGURED&&appCount++,data[appName].STATUS==ZCPConstants.STATUS_NOTCONFIGURED&&(Services.isFetchUsedAccountData=!0,notConfiguredServices+=""+appName+",",Services.nonSignupOverviewServices.push(appName))}!Common.isSignUp&&Services.showCompanyFetchPopUp&&Common.showCompanyPopUp(Services.isFetchUsedAccountData),Services.configuredCount=appCount,void 0!=canCreate&&canCreate&&(AdminPanel.authRoles.init(),Services.isSalesInboxRemapping=!0,this.createAccount()),Services.isFetchUsedAccountData&&Common.isAdmin&&""!==notConfiguredServices&&(Common.isSignUp?Services.notConfiguredServices=notConfiguredServices.split(","):Services.fetchServiceOverviewPage(notConfiguredServices)),Services.conflict.mapAccount(),Services.onFetchAppStatusComplete()},updateDbData:function(serviceName,serviceData){Services.configuredServicesData[serviceName]&&(serviceData.IS_ADMIN&&(Services.configuredServicesData[serviceName].IS_ADMIN=serviceData.IS_ADMIN),serviceData.isUserActive&&(Services.configuredServicesData[serviceName].isUserActive=serviceData.isUserActive),serviceData.IS_ACTIVE_IN_SERVICE&&(Services.configuredServicesData[serviceName].IS_ACTIVE_IN_SERVICE=serviceData.IS_ACTIVE_IN_SERVICE),serviceData.STATUS&&(Services.configuredServicesData[serviceName].STATUS=serviceData.STATUS),serviceData.HAS_ACCESS&&(Services.configuredServicesData[serviceName].HAS_ACCESS=serviceData.HAS_ACCESS),serviceData.isUserActive&&(Services.configuredServicesData[serviceName].isUserActive=serviceData.isUserActive),serviceData.CONFLICT_TYPE&&(Services.configuredServicesData[serviceName].CONFLICT_TYPE=serviceData.CONFLICT_TYPE))},createAccount:function(){Common.isSignUp||Services.showLoading(ZCPConstants.SERVICE_CRM,"iframe-spinner"),void 0!==Services.showCompanyFetchPopUp&&Services.showCompanyFetchPopUp||"none"!=$j("#onboardpopup").css("display")||showStatusMsg("info",I18N.getValue("crmplus.message.welcome"),5e3);var fd=new FormData;fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/createserviceaccount.do",data:fd,processData:!1,contentType:!1,complete:function(){}}),setTimeout(function(){if(Services.triggerPaymentPage){Common.spotLight.track(ZCPConstants.CRMPLUS_SUBSCRIPTION_LINK);var paymentsUrl=$j("#crmpluscommonuisubscriptionbutton").attr("href");window.open(paymentsUrl,"_self")}},1500)}},Services.fetchUsedAccountsData=function(servicesName,isRetry,isSpinnerLoading){if(!Common.isZohoOne)if(Common.isReadOnlyMode)isRetry&&showStatusMsg("error",I18N.getValue("crmplus.ro.action.denied.msg"));else{var params={};null!==servicesName&&void 0!==servicesName&&""!==servicesName&&" "!==servicesName&&(params={servicenames:servicesName}),void 0!=isRetry&&(Common.spotLight.track(servicesName.split(",")[0]+" "+ZCPConstants.MANUAL_RETRY),params.isretry=isRetry,isSpinnerLoading?Services.showLoading(Services.currentView,"iframe-spinner"):isSpinnerLoading===!1&&Services.showLoading()),$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/fetchusedaccountsdata.do",data:params,success:function(data){if("object"==typeof data){if(data.type){var serviceData={};serviceData.CONFLICT_TYPE=data.type,Services.notConfiguredServices.push(servicesName),Services.appData.updateDbData(servicesName,serviceData)}Services.conflict.show(servicesName,data)}else null!=data&&""!=data&&(Services.hideLoading(),$j("#freezingPopContainer").html(data),showDialog("freezingPopContainer"))},complete:function(){Services.hideLoading()}})}},Services.serviceUrl={get:function(serviceName,isServiceOwnUrl){return-1!==window.location.host.indexOf(".zohocorpin.com")&&(isServiceOwnUrl=!0),isServiceOwnUrl?Services.allServiceUrl[serviceName]:Common.productUrl},getDirectAccess:function(serviceName,serviceOrgId,portalName,isConfigured){if(void 0!=isConfigured&&!isConfigured)return serviceName;var serviceUrl="";return serviceName===ZCPConstants.SERVICE_SURVEY?serviceUrl="survey/home.do?from_service=crmplus&soid="+serviceOrgId:serviceName===ZCPConstants.SERVICE_PROJECTS?serviceUrl="portal/"+portalName:serviceName===ZCPConstants.SERVICE_SALESIQ?serviceUrl="salesiq/"+portalName+"/index":serviceName===ZCPConstants.SERVICE_SUPPORT?serviceUrl="support/"+portalName+"/ShowHomePage.do":serviceName===ZCPConstants.SERVICE_SOCIAL?serviceUrl="social/"+portalName+"/Home.do":serviceName===ZCPConstants.SERVICE_CRM?serviceUrl="crm/ShowHomePage.do":serviceName===ZCPConstants.SERVICE_CAMPAIGNS?serviceUrl="campaigns/home.do":serviceName===ZCPConstants.SERVICE_REPORTS?serviceUrl="reports/ZDBHome.cc?from_service=crmplus&soid="+serviceOrgId:serviceName===ZCPConstants.SERVICE_MOTIVATOR?serviceUrl="motivator/#home":serviceName===ZCPConstants.SERVICE_SALESINBOX&&(serviceUrl="salesinbox/View.do"),serviceUrl},processFrameURL:function(serviceName,URL,isServiceUrl,isFrameOriginNeeded){return processFrameURL(serviceName,URL,isServiceUrl,isFrameOriginNeeded)}},Services.changeToDefault=function(serviceName,status,url,zaaid,manual_retry,message){if(void 0!=message&&(status==ZCPConstants.STATUS_FAILED||status==ZCPConstants.STATUS_NOTCONFIGURED&&message&&void 0!=message.CONFLICT?Services.currentView==serviceName&&showStatusMsg(message.TYPE,I18N.getValue(message.CONTENT)):showStatusMsg(message.TYPE,I18N.getValue(message.CONTENT))),Services.configuredServicesData[serviceName].STATUS=status,status==ZCPConstants.STATUS_FINISHED||status==ZCPConstants.STATUS_SOFTLINKED)void 0!=Services.configuredServicesData[serviceName]?Services.configuredServicesData[serviceName].ISCONFIGURED=!0:Services.configuredServicesData[serviceName]={ISCONFIGURED:!0},null!=url&&void 0!=url&&(Services.configuredServicesData[serviceName].URL=url),null!=zaaid&&void 0!=zaaid&&(Services.configuredServicesData[serviceName].APPID=zaaid,serviceName===ZCPConstants.SERVICE_CRM&&null===Services.isSalesInboxConfigured&&SidePanel.getAgentStatus()),status==ZCPConstants.STATUS_FINISHED?Services.configuredServicesData[serviceName].HAS_ACCESS=!0:(Services.configuredServicesData[serviceName].ISCONFIGURED=!1,Services.configuredServicesData[serviceName].HAS_ACCESS=!1);else if(status==ZCPConstants.STATUS_FAILED)void 0!=Services.configuredServicesData[serviceName]&&(Services.configuredServicesData[serviceName].RETRY_COUNT+=1),Services.currentView==serviceName&&(Common.isSignUp?Services.isOverviewCompleted[serviceName]:-1==Services.nonSignupOverviewServices.indexOf(serviceName))&&(Services.hideLoading(),Services.hideLoading(Services.currentView,"iframe-spinner"),CRMPlusCommonUi.showErrorPage("unabletocreateservice",{servicename:serviceName}));else if(status==ZCPConstants.STATUS_NOTCONFIGURED&&message&&void 0!=message.CONFLICT){var conflictData=Services.conflict.getConflictData(serviceName,message.CONFLICT);Services.conflict.show(serviceName,conflictData)}(status==ZCPConstants.STATUS_NOTCONFIGURED||status==ZCPConstants.STATUS_FINISHED||status==ZCPConstants.STATUS_FAILED||status==ZCPConstants.STATUS_SOFTLINKED)&&(Services.currentView===serviceName&&Services.hideLoading(),Services.onCreationComplete(serviceName)),status==ZCPConstants.STATUS_STARTED&&(Services.startLoadingTimer(serviceName),serviceName===ZCPConstants.SERVICE_SALESINBOX&&Services.startLoadingTimer(ZCPConstants.SERVICE_SALESINBOX))},Services.onFetchAppStatusComplete=function(){if(Services.isFetchComplete=!0,null!==Common.serviceToRedirect){var service=Common.serviceToRedirect;Common.serviceToRedirect=null,Services.isCrmplusIntegratedService(service)&&Services.getRedirectionUrl(service)}if(void 0!==Services.configuredServicesData.crm){var salesInboxData={};salesInboxData.HAS_ACCESS=!1,salesInboxData.ISCONFIGURED=!1,salesInboxData.STATUS=Services.configuredServicesData[ZCPConstants.SERVICE_CRM].STATUS,salesInboxData.IS_ADMIN=Common.isAdmin,salesInboxData.URL=Services.serviceUrl.getDirectAccess(ZCPConstants.SERVICE_SALESINBOX,void 0,void 0,!0),salesInboxData.isUserActive=Services.configuredServicesData[ZCPConstants.SERVICE_CRM].isUserActive,Services.configuredServicesData[ZCPConstants.SERVICE_SALESINBOX]=salesInboxData}Services.constructAccessibleCrmplusApps(),Services.hasAdminPanelAccess&&$j("#settingssidepanelswitch").show(),Common.isNewUI===!0&&(Services.loadFirstService(),Services.handleSalesiqChat(),SidePanel.getAgentStatus()),this.hasServiceAccess(ZCPConstants.SERVICE_CRM)&&($j("#plusReminderIcon").show(),Common.fetchAndRenderReminderPanel(!0)),AdminPanel.init()},Services.loadFirstService=function(){if(null===Services.currentView){var firstServiceName=Services.getFirstService(),url=void 0,lastAccessedUrl=CRMPlusLocalStorage.get("lastaccessedurl");if(null!=preLoadedService)firstServiceName=preLoadedService;else if(void 0!==lastAccessedUrl){var serviceName=lastAccessedUrl.split("/")[0];"portal"===serviceName&&(serviceName="projects"),Services.hasServiceAccess(serviceName)&&lastAccessedUrl!==serviceName&&Services.isCrmplusIntegratedService(serviceName)&&(url=lastAccessedUrl,firstServiceName=serviceName)}Services.getRedirectionUrl(firstServiceName,!1,!1,url)}else Services.getRedirectionUrl(Services.currentView)},Services.handleSalesiqChat=function(){this.hasServiceAccess("salesiq")&&("salesiq"!==Services.currentView&&Services.handleSalesiqForChatCommunication(),$j("#plusVisitorIcon").show())},Services.getRedirectionUrl=function(serviceName,isServiceClick,isOldUser,url,type){""==Services.configuredServicesData&&Services.fetch(),isServiceClick&&$j("#"+serviceName+"commonuileftpanelswitch").hasClass("_notiDot_"+serviceName)&&CRMPlusCommonUi.handleServiceHighlighting(serviceName,!1);var retryCount=0,configuredData=Services.configuredServicesData,serviceData=configuredData[serviceName];if((serviceName!==Services.currentView||!Common.isSignUp&&-1==Services.nonSignupOverviewServices.indexOf(serviceName))&&Services.hideOverViewPage(),Common.isSignUp&&!Services.isOverviewCompleted[serviceName]){if("crmplus"===TopBar.type){if(serviceName!==Services.currentView){Services.hideLoading(),Services.hideServiceIframe(Services.currentView),Services.showOverViewPage(serviceName,isServiceClick);var index=Services.notConfiguredServices.indexOf(serviceName);-1!==index&&(Services.notConfiguredServices.splice(index,1),Services.fetchUsedAccountsData(serviceName,!0))}return}Services.isOverviewCompleted[serviceName]=!0}if(void 0!=serviceData){if(serviceData.ISCONFIGURED&&serviceData.HAS_ACCESS&&-1==Services.nonSignupOverviewServices.indexOf(serviceName)&&(serviceName!==ZCPConstants.SERVICE_SALESINBOX||!Services.isSalesInboxRemapping))return void 0==Services.canBeTracked[serviceName]&&(Common.trackFeature("Access Zoho "+I18N.getValue("service.title."+serviceName)),Services.canBeTracked[serviceName]=!0),void(null!==url&&void 0!==url?Services.loadFrame(serviceName,url,isServiceClick,!0,type):Services.loadFrame(serviceName,void 0,isServiceClick,!0,type));isServiceClick&&Hash.append(serviceName),null!==$(serviceName+"LoadFrame")&&-1==Services.nonSignupOverviewServices.indexOf(serviceName)&&($(serviceName+"LoadFrame").remove(),ServiceCommunicator.loadFrame.clearTimeOut(serviceName)),Services.hideServiceIframe(Services.currentView),TopBar.resetToDefault();var isInternalPortal=!1;if(serviceData.CONFLICT_TYPE&&serviceData.STATUS==ZCPConstants.STATUS_NOTCONFIGURED&&(isInternalPortal=!0,Services.hideOverViewPage(serviceName)),Services.onBeforeFrameLoad(serviceName,isInternalPortal),serviceName!==Services.currentView||-1===Services.nonSignupOverviewServices.indexOf(serviceName)||isInternalPortal||Services.showServiceOverviewPage(serviceName),serviceName===ZCPConstants.SERVICE_SALESINBOX)Services.handleSalesInboxErrorCase();else if(serviceData.STATUS==ZCPConstants.STATUS_SOFTLINKED&&serviceData.IS_ADMIN&&-1==Services.nonSignupOverviewServices.indexOf(serviceName))Services.fetch(serviceData.APPID,serviceName);else if(!serviceData.ISCONFIGURED&&serviceData.RETRY_COUNT>=retryCount&&serviceData.IS_ADMIN)serviceData.STATUS==ZCPConstants.STATUS_INPROGRESS?showStatusMsg("error",I18N.getValue("crmplus.message.common.tryafter")):(serviceData.STATUS==ZCPConstants.STATUS_FAILED||serviceData.STATUS==ZCPConstants.STATUS_NOTCONFIGURED)&&(-1==Services.nonSignupOverviewServices.indexOf(serviceName)?Services.fetchUsedAccountsData(serviceName,!0,!0):Services.fetchUsedAccountsData(serviceName,!0));else if(!serviceData.HAS_ACCESS&&-1==Services.nonSignupOverviewServices.indexOf(serviceName)){var message,header=I18N.getValue("crmplus.label.insufficientpermission");if(null==serviceData.isUserActive||serviceData.isUserActive)return void 0!=serviceData.IS_ADMIN&&serviceData.IS_ADMIN?void Services.showAdminOnboardScreen():void nonUserRequestAccess.showOverViewPage(serviceName);message=I18N.getValue("crmplus.label.contactserviceadmin",[I18N.getValue("service.title."+serviceName)]);var errorData={};errorData.image="/error-image2.png",errorData.header=header,errorData.message=message,CRMPlusCommonUi.showErrorPage("noaccessforservice",errorData)}}};var nonUserRequestAccess={showOverViewPage:function(appName){try{CRMPlusCommonUi.hideTopBar(appName),$j("#crmplusoverviewforservices"+appName).length>0?Services.showServiceOverviewPage(appName):Services.fetchServiceOverviewPage(appName,null,"ReqToJoin")}catch(e){}},getNonUserRequestAccessPopUp:function(appName){try{var successCall=function(response){$j("body").prepend(response)};nonUserRequestAccess.fetch(appName,"requestpage",void 0,successCall)}catch(e){}},fetch:function(appName,action,offsetZuid,successCall,errorCall){try{var params={},appsoid=Services.configuredServicesData[appName].APPID;params.appsoid=appsoid,params.action=action,params.filter_role=ZCPConstants.APP_ADMIN_ROLE,params.filter_isactive=!0,offsetZuid&&(params.filter_offsetuser=offsetZuid),params.fields="full_name,primary_email,imageurl,zuid",params.page=1,params.per_page=6,$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/nonuserrequestaccess.do",data:params,dataType:"html",success:successCall,error:errorCall})}catch(e){errorCall()}}};Services.showAdminOnboardScreen=function(){var appName=$j('#commonuileftpanelswitchlist li[class="selected"]').attr("data");CRMPlusCommonUi.hideTopBar(appName);var buttonAction='AdminPanel.onBoardAdmin.add("'+appName+'")';$j("#crmplusoverviewforservices"+appName).length>0?Services.showServiceOverviewPage(appName,buttonAction):Services.fetchServiceOverviewPage(appName,buttonAction)},Services.reloadFrame=function(service){if(void 0===service)$j("[id$='LoadFrame']").attr("src",$j("[id$='LoadFrame']").attr("src"));else{var id=service+"LoadFrame";void 0!==id&&$j("#"+id).attr("src",$j("#"+id).attr("src"))}},Services.loadService=function(appName){Hash.set(appName),Hash.handleURI()},Services.createService=function(serviceName,adminZuid,isMapPortal,digest,successCallBack,failureCallBack,element){if(!Common.isReadOnlyMode){var params={},method="POST";void 0===isMapPortal?void 0!==serviceName&&($j("#requesttojoin_"+serviceName+"_"+adminZuid).html('<i class="spinnerLoading"></i>'),$j("#requesttojoin_"+serviceName+"_"+adminZuid).addClass("loading"),params.servicenames=serviceName,void 0!=adminZuid&&(params.adminzuid=adminZuid),method="GET"):void 0!==isMapPortal&&isMapPortal&&($j("#createServ").html('<i class="spinnerLoading"></i>'),$j("#createServ").addClass("loading"),$j("#createServ").attr("onclick",""),params.servicesdetails=JSON.stringify(Common.getParameterValuesForUsedAccounts()),params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get())),void 0!==digest&&(params.digest=digest),$j.ajax({type:method,url:""+Common.getPortalUrl(!0)+"/serviceCreation.do",data:params,complete:function(data,status){void 0!==isMapPortal&&isMapPortal&&($j("#createServ").html(I18N.getValue("button.done")),$j("#createServ").removeClass("loading"),$j("#createServ").attr("onclick","Services.createService(undefined,undefined,true);"),hideDialog("freezingPopContainer"),Services.isLoadedInIframe[Services.currentView]||Services.getRedirectionUrl(Services.currentView,!0,!1,void 0,"iframe-spinner"),void 0!==Services.showCompanyFetchPopUp&&Services.showCompanyFetchPopUp||showStatusMsg("success",I18N.getValue("service.success.mapportal"))),void 0!=isMapPortal&&isMapPortal||("success"==status&&(void 0!==successCallBack&&successCallBack(element,JSON.parse(data.responseText)),adminZuid&&(Common.spotLight.track(ZCPConstants.REQUEST_ADMIN),$j("#requesttojoin_"+serviceName+"_"+adminZuid).addClass("greenBtn").removeClass("blueBtn"),$j("#requesttojoin_"+serviceName+"_"+adminZuid).html(I18N.getValue("admin.requested")),$j("#requesttojoin_"+serviceName+"_"+adminZuid).removeClass("loading"),void 0!==Services.showCompanyFetchPopUp&&Services.showCompanyFetchPopUp||showStatusMsg("success",I18N.getValue("crmplus.message.mail.sent")))),"error"==status&&400==data.error().status&&(void 0!==failureCallBack&&failureCallBack(element),void 0!==Services.showCompanyFetchPopUp&&Services.showCompanyFetchPopUp||showStatusMsg("error",I18N.getValue("crmplus.message.common.tryafter"))))}})}},Services.conflict={show:function(serviceName,conflictData){null!=conflictData&&void 0!=conflictData&&serviceName==Services.currentView&&(CRMPlusCommonUi.showErrorPage("conflictcase",conflictData),Services.hideLoading())},mapAccount:function(){var serviceData=Services.configuredServicesData,serviceArray=[];for(index in Services.nameArray){var service=Services.nameArray[index];void 0!=serviceData[service]&&serviceData[service].STATUS==ZCPConstants.STATUS_SOFTLINKED&&serviceData[service].IS_ADMIN&&null==BrCookie.read("crmp_"+service+"_create")&&(serviceArray.push(service),BrCookie.create("crmp_"+service+"_create",!0,20))}serviceArray.length>0&&Services.fetch(void 0,void 0,void 0,Services.nameArray.slice(),!0)},sendApprovalMail:function(adminEmail,serviceName){var params={};void 0!==adminEmail&&void 0!==serviceName&&(params.admin_email=adminEmail,params.service=serviceName,$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/sendapprovalmail.do",data:params,success:function(){Common.spotLight.track(ZCPConstants.REQUEST_ADMIN),showStatusMsg("success",I18N.getValue("crmplus.message.mail.sent"))},error:function(){showStatusMsg("error",I18N.getValue("crmplus.message.common.tryafter"))}}))},getConflictData:function(appName,type){var conflictData={};return"dependent_service_not_mapped"==type&&(conflictData.image="/error-image4.png",conflictData.header=I18N.getValue("crmplus.label.conflict.dependentservicenotmapped",[I18N.getValue("service.title."+appName)]),conflictData.message=I18N.getValue("crmplus.message.conflict.dependentservicenotmapped",[I18N.getValue("service.title."+appName),I18N.getValue("service.title.crm")]),conflictData.script="Common.spotLight.track('dependent_service_not_mapped conflict click',{'service':'"+appName+"'})",conflictData.customdiv='<div class="zcrmp-button blueBtn" onclick=\'Services.loadService("crm")\'>'+I18N.getValue("crmplus.overview.button.configure",[I18N.getValue("service.title.crm")])+"</div>"),conflictData}},Services.removeFrameCookie=function(serviceName){var con=console;con.log("sremoveframe-->"+(new Date).toGMTString());var date=new Date;date.setTime(date.getTime()-1e3);var expires=date.toGMTString(),path="/"+serviceName+"/";"projects"===serviceName&&(path="/portal/"),document.cookie="crmplusframe=true;path="+path+";expires="+expires},Services.loadFrame=function(serviceName,URL,isServiceClick,canView,type){if(void 0===type&&(type="iframe-spinner"),void 0===canView&&(canView=!0),!CRMPlusUnifiedSearch.isResultClick&&"search"==TopBar.type&&isServiceClick&&1!=CRMPlusUnifiedSearch.isFilterClick&&(TopBar.type="crmplus"),void 0===serviceName||null===serviceName||"crmplus"===serviceName||"dashboard"===serviceName)serviceName="crmplus",$j("#serviceFrameContainer .serviceFrames").hide(),Services.onBeforeFrameLoad("crmplus"),Services.previousLoadedFrame="crmplus","crmplus"!==TopBar.type&&TopBar.resetToDefault(),$j("#crmplusContainer").fadeIn(),"crmplus"!==Services.currentView&&isServiceClick&&Hash.append(""),window.history.replaceState({},"",window.location.href.replace(window.location.hash,"")),Services.hideLoading(),Services.currentView="crmplus";else if($(serviceName+"LoadFrame")){if(!canView&&void 0===URL||!Services.isFetchComplete)return;if("crmplus"===TopBar.type&&void 0===URL){var index=TopBar.loadedServices.indexOf(serviceName);if(-1!==index){if(URL=Services.currentUrl[serviceName],void 0===URL){var serviceData=Services.configuredServicesData[serviceName];URL=serviceData.URL}if(TopBar.loadedServices.splice(index,1),Services.isLoadedInIframe[serviceName]){Services.hideServiceIframe(Services.currentView),Services.onBeforeFrameLoad(serviceName,!0,void 0,void 0,type);var selectedModule=$j("#commonUiModuleList"+serviceName+" li.selected").attr("key");if("setup"==TopBar.previousType)return void ServiceCommunicator.handleSetup(serviceName,!1,Services.serviceUrl.processFrameURL(serviceName,URL),selectedModule);if("search"==TopBar.previousType&&!CRMPlusUnifiedSearch.isResultClick)return ServiceCommunicator.triggerAction(serviceName,"closesearchview",selectedModule),void((serviceName==ZCPConstants.SERVICE_SUPPORT||serviceName==ZCPConstants.SERVICE_SURVEY)&&Services.loadUrlInIframe(serviceName,URL,isServiceClick,canView))}}}if(void 0!==URL&&ServiceCommunicator.loadFrame.clearTimeOut(serviceName),void 0!==URL)return Services.loadUrlInIframe(serviceName,URL,isServiceClick,canView),void(canView&&(Services.hideServiceIframe(Services.currentView),Services.handleServiceUrlChange(serviceName),Services.hideServiceIframe(serviceName,!0),Services.onBeforeFrameLoad(serviceName,!0,void 0,void 0,type)));if(!Services.isLoadedInIframe[serviceName]){canView&&(Services.hideServiceIframe(Services.currentView),Services.onBeforeFrameLoad(serviceName,!0,void 0,void 0,type));var currentUrl=$j("#"+serviceName+"LoadFrame").attr("src");return isServiceClick?Hash.changeHistory(serviceName,currentUrl,Common.productUrl,!0):Hash.changeHistory(serviceName,currentUrl,Common.productUrl,!0),void ServiceCommunicator.loadFrame.setTimeOut(serviceName,canView)}var currentUrlInHash=window.location.hash.substring(1),currentServiceNameInHash=currentUrlInHash.split("/")[0];if("portal"===currentServiceNameInHash&&(currentServiceNameInHash===currentUrlInHash&&(currentUrlInHash="projects"),currentServiceNameInHash="projects"),Services.currentView!==serviceName||currentServiceNameInHash===currentUrlInHash)return Services.hideServiceIframe(Services.currentView),Services.onBeforeFrameLoad(serviceName,!1,!1),void(isServiceClick?ServiceCommunicator.action.getCurrentServiceURL(serviceName,"changeHistory"):ServiceCommunicator.action.getCurrentServiceURL(serviceName,"replaceHistory"));ServiceCommunicator.loadFrame.clearTimeOut(serviceName),$j("#"+serviceName+"LoadFrame").hide(),Services.hideServiceIframe(Services.currentView),Services.onBeforeFrameLoad(serviceName,!1,!1,!0),Services.setTopAndHeightForIframe(serviceName,!1),$j("#"+serviceName+"LoadFrame").fadeIn(),CRMPlusUnifiedSearch.isResultClick||CRMPlusUnifiedSearch.isFilterClick||Services.hideLoading(),Services.onIframeVisible(serviceName),Services.previousLoadedFrame=serviceName}else{if(canView)Services.hideServiceIframe(Services.currentView),Services.onBeforeFrameLoad(serviceName,!0,void 0,void 0,type),-1!==Services.queuedServicesToLoadInBackGround.indexOf(serviceName)&&Services.queuedServicesToLoadInBackGround.splice(Services.queuedServicesToLoadInBackGround.indexOf(serviceName),1);else if(0!==Services.currentLoadingServices.length)return void(-1===Services.queuedServicesToLoadInBackGround.indexOf(serviceName)&&Services.queuedServicesToLoadInBackGround.push(serviceName));if(!Services.isFetchComplete&&URL===serviceName)return;if(URL===serviceName&&(URL=void 0),void 0===URL){var serviceData=Services.configuredServicesData[serviceName];URL=serviceData.URL}URL=Services.serviceUrl.processFrameURL(serviceName,URL),isServiceClick?Hash.changeHistory(serviceName,URL,Common.productUrl,!0):canView&&Hash.changeHistory(serviceName,URL,Common.productUrl,!1),canView&&Services.handleServiceUrlChange(serviceName);{ServiceCommunicator.loadFrame.setTimeOut(serviceName,canView,type)}createServiceIframe(serviceName,URL)}},Services.onIframeVisible=function(serviceName){("crm"===serviceName||"support"===serviceName)&&void 0!==CRMPlusCommonUi.clickedChatBarIcon&&CRMPlusCommonUi.handleClickOnNotificationIcon(void 0,CRMPlusCommonUi.clickedChatBarIcon),null!==Services.previousLoadedFrame&&ServiceCommunicator.triggerAction(Services.previousLoadedFrame,"handleParentEvents","unbindevents"),(serviceName===ZCPConstants.SERVICE_SUPPORT||serviceName===ZCPConstants.SERVICE_PROJECTS||ZCPConstants.SERVICE_SALESIQ)&&ServiceCommunicator.triggerAction(serviceName,"handleParentEvents","bindevents")},Services.hideServiceIframe=function(serviceName,isHeightHide){1==isHeightHide?($j("#"+serviceName+"LoadFrame").stop().css({height:0}),$j("#"+serviceName+"LoadFrame").show()):$j("#"+serviceName+"LoadFrame").hide()},Services.isServiceFrameVisible=function(serviceName){var serviceElement=$j("#"+serviceName+"LoadFrame");return serviceElement.is(":visible")&&0!=serviceElement.height()?!0:!1},Services.loadUrlInIframe=function(serviceName,URL,isServiceClick,canView){URL=Services.serviceUrl.processFrameURL(serviceName,URL),isServiceClick?Hash.changeHistory(serviceName,URL,Common.productUrl,!0):canView&&Hash.changeHistory(serviceName,URL,Common.productUrl,!1),Services.isLoadedInIframe[serviceName]?ServiceCommunicator.action.replaceServiceURL(serviceName,URL):$j("#"+serviceName+"LoadFrame").attr("src",encodeURI(decodeURIComponent(URL))),ServiceCommunicator.loadFrame.setTimeOut(serviceName,canView)},Services.setLastAccessedURL=function(){if(Services.isNonCrmplusPortal)return void(Services.isNonCrmplusPortal=!1);var currenthash=window.location.hash;currenthash=currenthash.substring(1),"setup"!=TopBar.type&&"search"!=TopBar.type&&CRMPlusLocalStorage.set(ZCPConstants.LAST_ACCESSED_URL,currenthash);var portalName=CRMPlusLocalStorage.get(ZCPConstants.CURRENT_PORTAL);portalName!==Common.currentPortalName&&CRMPlusLocalStorage.set(ZCPConstants.CURRENT_PORTAL,Common.currentPortalName)},Services.handleServiceUrlChange=function(serviceName,isFromService){Services.currentView==serviceName&&CRMPlusCommonUi.search.hideSearchPopUp(),Services.setTopBar(serviceName,isFromService),Services.setLastAccessedURL()},Services.isCrmplusIntegratedService=function(serviceName){for(index in Services.nameArray)if(Services.nameArray[index]===serviceName)return!0;return serviceName===ZCPConstants.SERVICE_SALESINBOX?!0:!1},Services.onBeforeFrameLoad=function(serviceName,isLoadingNeeded,isTemplateTopBar,isLoaded,loadingType){isLoadingNeeded===!0&&(void 0===loadingType&&(loadingType="iframe-spinner"),Services.showLoading(serviceName,loadingType));var previousService=Services.currentView;Services.currentView=serviceName,$j("#commonerrorpage").hide(),Services.currentErrorPage=null;Services.configuredServicesData[ZCPConstants.SERVICE_SALESINBOX];if(Common.canHideTopBar(serviceName)?CRMPlusCommonUi.hideTopBar(serviceName):CRMPlusCommonUi.showTopBar(serviceName),CRMPlusCommonUi.hideNotificationDialog(previousService),previousService!==serviceName){$j("#"+previousService+"commonuileftpanelswitch").removeClass("selected"),$j("#"+serviceName+"commonuileftpanelswitch").addClass("selected"),$j("#commontopbar"+previousService).removeClass("selected"),$j("#commontopbar"+serviceName).addClass("selected"),$j("#crmpluscommonuisearchservicediv"+previousService).removeClass("selected"),$j("#crmpluscommonuisearchservicediv"+serviceName).addClass("selected"),$j("#commonUiModuleList"+previousService).hide(),$j("#commonUimoreModuleList"+previousService).hide(),$j("#"+previousService+"specificoptionsdiv").hide(),$j("#crmpluscommonuiaddoptionlist"+previousService).hide(),$j("#crmpluscommonuidepartments").hide(),$j("#crmpluscommonuiadddepartmentmsg").hide(),$j("#crmpluscommonuidepartmentloading").hide(),$j("#crmpluscommonuidepartmentsearch").hide(),$j("[id^=commonuicallnotify_"+serviceName+"]").remove();
var currentModuleList=CRMPlusCommonUi.currentModuleList[serviceName];void 0!==currentModuleList&&void 0!==currentModuleList.option&&void 0!==currentModuleList.option.list?CRMPlusCommonUi.showServiceSpecificOption(serviceName):$j("#crmpluscommonuispecificoption").slideUp(200,"linear",function(){Common.setProfilePanelHeight()}),Common.setNotificationContainerHeight();var iconUrl=Common.staticImgUrl+"/"+Common.staticHashedFileNames["fav"+serviceName+".ico"];CRMPlusCommonUi.browserTitle.set(serviceName),"adminpanel"==serviceName&&(iconUrl=Common.staticImgUrl+"/"+Common.staticHashedFileNames["favicon.ico"]),$j("#crmpluscommonuifavicon").attr("href",iconUrl)}$j("#searchcommonuileftpanelswitch").hasClass("selected")&&"search"!=TopBar.type&&($j("#searchcommonuileftpanelswitch").removeClass("selected"),$j("#"+serviceName+"commonuileftpanelswitch").addClass("selected")),"search"===TopBar.type?($j("#searchcommonuileftpanelswitch").show(),$j("#"+Services.currentView+"commonuileftpanelswitch").removeClass("selected"),$j("#searchcommonuileftpanelswitch").addClass("selected"),previousService!==serviceName&&CRMPlusCommonUi.search.hideServiceFilters(previousService,!0),isLoaded&&CRMPlusCommonUi.search.show(serviceName)):void 0==CRMPlusUnifiedSearch.lastService&&$j("#searchcommonuileftpanelswitch").attr("style","display:none !important"),"setup"===TopBar.type?"adminpanel"===serviceName?Services.previousLoadedFrame&&Services.hideServiceIframe(Services.previousLoadedFrame):AdminPanel.layout.hide():"adminpanel"===previousService&&AdminPanel.layout.hide(),isTemplateTopBar===!1||"crmplus"!==TopBar.type?CRMPlusCommonUi.initTopBar(TopBar.type,serviceName):CRMPlusCommonUi.initTopBar("default"),$j("#"+previousService+"sidepanelswitch").show(),$j("#"+serviceName+"sidepanelswitch").hide(),CRMPlusCommonUi.handleWindowSize()},Services.constructProductSpecificOptions=function(serviceName){var specificoptions=CRMPlusCommonUi.currentModuleList[serviceName];if(void 0!==specificoptions&&void 0!==specificoptions.option&&void 0!==specificoptions.option.list){specificoptions=specificoptions.option.list,$j("#"+serviceName+"specificoptionsdiv").length>0&&$j("#"+serviceName+"specificoptionsdiv").remove();var specificoptionbody=document.createElement("div");$j(specificoptionbody).addClass("zcrmpSetTitles clearFix"),$j(specificoptionbody).attr("id",serviceName+"specificoptionsdiv"),$j("#crmpluscommonuispecificoptiondiv").append(specificoptionbody);for(var index in specificoptions){var specificoption=specificoptions[index],specificoptionDiv=document.createElement("div");$j(specificoptionDiv).addClass("zcrmp-serSpcOpt");var specificoptionAnchor=document.createElement("a"),aId=serviceName+"_specificoptions_"+specificoption.key.replace(/[\s.]/g,""),divId=aId+"_div";$j(specificoptionAnchor).attr("id",aId),$j(specificoptionDiv).attr("id",divId),$j(specificoptionAnchor).text(specificoption.label),$j(specificoptionAnchor).attr("onmouseover","Services.productSpecificOptionsTooltip('"+divId+"', \""+specificoption.label+'", event);'),$j(specificoptionDiv).append(specificoptionAnchor),$j(specificoptionbody).append(specificoptionDiv),Common.addClickEventListener("#"+aId,ServiceCommunicator.triggerAction,[serviceName,"selectoption",specificoption.key],ServiceCommunicator)}Services.currentView==serviceName?CRMPlusCommonUi.showServiceSpecificOption(serviceName):$j(specificoptionbody).hide()}else $j("#"+serviceName+"specificoptionsdiv").remove()},Services.productSpecificOptionsTooltip=function(elemId,message,event){$j("#"+elemId).width()==$j("#"+elemId+">a").width()&&tooltip(message,event)},Services.constructAccessibleCrmplusApps=function(){function showServiceInLeftPanel(serviceName){try{var $serviceSwitch=$j("#"+serviceName+"commonuileftpanelswitch");$serviceSwitch.removeClass("dummyli"),$serviceSwitch.attr("order",ListableServiceCount);var order=ListableServiceCount;if(0==order)$j("#commonuileftpanelswitchlist").prepend($serviceSwitch);else{var $beforeSwitch=$switchLists.children("[order="+(order-1)+"]");$serviceSwitch.insertAfter($beforeSwitch)}ListableServiceCount++}catch(e){}}function removeServiceFromLeftPanel(serviceName){try{$j("#"+serviceName+"commonuileftpanelswitch").remove()}catch(e){}}function constructNotAccessibleServices(){function anyOfThisAccessible(services){try{for(var j in services)if(accessibleServices.includes(services[j]))return!0;return!1}catch(e){}}try{var isAnSGServiceInAccessibleList,isAnMGServiceInAccessibleList,naService,salesGroup=[ZCPConstants.SERVICE_CRM,ZCPConstants.SERVICE_SALESIQ],marketingGroup=[ZCPConstants.SERVICE_CAMPAIGNS,ZCPConstants.SERVICE_SOCIAL];for(var i in notAccessibleServices)switch(naService=notAccessibleServices[i]){case ZCPConstants.SERVICE_CRM:case ZCPConstants.SERVICE_SALESIQ:case ZCPConstants.SERVICE_SALESINBOX:void 0===isAnSGServiceInAccessibleList&&(isAnSGServiceInAccessibleList=anyOfThisAccessible(salesGroup)),isAnSGServiceInAccessibleList?showServiceInLeftPanel(naService):removeServiceFromLeftPanel(naService);break;case ZCPConstants.SERVICE_CAMPAIGNS:case ZCPConstants.SERVICE_SOCIAL:void 0===isAnMGServiceInAccessibleList&&(isAnMGServiceInAccessibleList=anyOfThisAccessible(marketingGroup)),isAnMGServiceInAccessibleList?showServiceInLeftPanel(naService):removeServiceFromLeftPanel(naService);break;case ZCPConstants.SERVICE_PROJECTS:accessibleServices.includes(ZCPConstants.SERVICE_SUPPORT)||anyOfThisAccessible(salesGroup)?showServiceInLeftPanel(naService):removeServiceFromLeftPanel(naService);break;case ZCPConstants.SERVICE_SURVEY:var canListSurvey=accessibleServices.includes(ZCPConstants.SERVICE_SUPPORT)||anyOfThisAccessible(marketingGroup)||anyOfThisAccessible(salesGroup);canListSurvey?showServiceInLeftPanel(naService):removeServiceFromLeftPanel(naService);break;case ZCPConstants.SERVICE_REPORTS:var canListReports=accessibleServices.includes(ZCPConstants.SERVICE_SUPPORT)||accessibleServices.includes(ZCPConstants.SERVICE_PROJECTS)||anyOfThisAccessible(marketingGroup)||anyOfThisAccessible(salesGroup);canListReports?showServiceInLeftPanel(naService):removeServiceFromLeftPanel(naService);break;case ZCPConstants.SERVICE_SUPPORT:case ZCPConstants.SERVICE_MOTIVATOR:removeServiceFromLeftPanel(naService)}}catch(e){}}try{var ListableServiceCount=0,accessibleServices=[],notAccessibleServices=[],crmplusApps=Services.nameArray.slice();crmplusApps.splice(7,0,ZCPConstants.SERVICE_SALESINBOX);var service,serviceData,$switchLists=$j("#commonuileftpanelswitchlist,#crmpluscommonuimoreservicelinks>ul"),isZohoOne=void 0!=Common.zohoOneAddUsersURL;for(var index in crmplusApps)service=crmplusApps[index],serviceData=Services.configuredServicesData[service],service===ZCPConstants.SERVICE_SALESINBOX&&0==$j("#salesinboxcommonuileftpanelswitch").length?removeServiceFromLeftPanel(service):Common.isAdmin||Services.hasServiceAccess(service)?(showServiceInLeftPanel(service),accessibleServices.push(service)):isZohoOne||serviceData.STATUS!=ZCPConstants.STATUS_FINISHED||serviceData.USER_STATUS!=ZCPConstants.USER_APP_NOACCESS?removeServiceFromLeftPanel(service):notAccessibleServices.push(service),Services.hasServiceAccess(service)?($j("#crmpluscommonuisearchservicediv"+service).show(),$j("#crmplusUnifiedSearchFilterByServicesli"+crmplusApps[index]).show()):($j("#crmpluscommonuisearchservicediv"+service).hide(),$j("#crmplusUnifiedSearchFilterByServicesli"+crmplusApps[index]).hide());notAccessibleServices.length>0&&constructNotAccessibleServices(),1===ListableServiceCount?($j("#crmplusUnifiedSearchServiceFilterParent").addClass("zcrmp-sinSer"),$j("#crmpluscommonuiservicelistscrolldiv").remove(),$j("#crmpluscommonuimoreservices").remove(),$j("#crmpluscommonuileftpanelbottom").addClass("zcrmp-uiuxLeftpan"),Common.defaultUserOptions.isleftpanelvisible=null):0===ListableServiceCount&&(Common.isAdmin||CRMPlusCommonUi.showErrorPage("noaccessforservices")),showServiceInLeftPanel("search")}catch(e){}},Services.hasServiceAccess=function(serviceName){if("adminpanel"===serviceName)return!0;serviceName===ZCPConstants.SERVICE_SALESINBOX&&(serviceName=ZCPConstants.SERVICE_CRM);var serviceData=Services.configuredServicesData[serviceName];return void 0!==serviceData&&serviceData.STATUS!=ZCPConstants.STATUS_SOFTLINKED&&serviceData.ISCONFIGURED&&serviceData.HAS_ACCESS?!0:!1},Services.showLoading=function(serviceName,type){"welcome-loading"!==Services.loadingType&&(void 0!=type||"iframe-spinner"!=Services.loadingType)&&(void 0===type&&(type="common-loading"),null!==Services.loadingType&&Services.loadingType!==type&&Services.hideLoading(void 0,Services.loadingType),Services.loadingType=type,"getting-started"===TopBar.type?TopBar[TopBar.type].showLoading():"common-loading"===type?showLoading():"getting-started"==type?TopBar.gettingStarted.showLoading():"switch-from-home"===type?showServiceSwitchingLoading(serviceName):"switch-from-sidepanel"===type?(SidePanel.canHideInHoverOut=!1,$j("#"+serviceName+"sidepanelswitch").addClass("popswitchingload")):"welcome-loading"===type?$j("#loading_cont").show():"iframe-spinner"===type?($j("#fullpageloadingtext").text(I18N.getValue("service.loading")),"search"===TopBar.type&&$j("#fullpageloadingtext").text(I18N.getValue("crmplus.search.loading")),$j("#iframeLoading").fadeIn()):"initiating-chat"===type&&($j("#fullpageloadingtext").text(I18N.getValue("crmplus.common.loading.initiatechat")),$j("#iframeLoading").fadeIn()))},Services.hideLoading=function(serviceName,type){return null!==Services.loadingType?(void 0===type&&(type=Services.loadingType),void 0===serviceName&&(serviceName=Services.currentView),"welcome-loading"===type||"getting-started"!=TopBar.type?("common-loading"===type?hideLoading():"switch-from-home"===type?hideServiceSwitchingLoading(serviceName):"switch-from-sidepanel"===type?($j('#serviceswitchdiv [id$="sidepanelswitch"]:visible').removeClass("popswitchingload"),SidePanel.canHideInHoverOut=!0):"welcome-loading"===type?$j("#loading_cont").hide():"getting-started"===type?TopBar.gettingStarted.hideLoading():("iframe-spinner"===type||"initiating-chat"===type)&&$j("#iframeLoading").fadeOut("fast"),void(Services.loadingType=null)):void TopBar[TopBar.type].hideLoading()):void 0},Services.addQuickLink=function(event){event&&event.stopPropagation();var link=window.location.hash;link=link.substring(1);var linkName=$j("#sidepanelqlinkeditbox").val();if(Services.validateQuickLink(linkName)){$j("#sidepanelqlinkupdate").addClass("peventNone"),$j("#sidepanelqlinkupdate").addClass("loading");var fd=new FormData;fd.append("link",link),fd.append("linkname",linkName),fd.append("type","insert"),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updatequicklink.do",data:fd,processData:!1,contentType:!1,dataType:"json",complete:function(){$j("#sidepanelqlinkupdate").removeClass("peventNone"),$j("#sidepanelqlinkupdate").removeClass("loading")},success:function(data){if(!data.status)return void showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinkcannotadd"));Services.quickLinksArray.push(data),CRMPlusCommonUi.constructQuickLink(data.QUICKLINKNAME,data.LINK,data.QUICKLINKID),SidePanel.hideQuickLinkEditDialog("add"),showStatusMsg("success",I18N.getValue("crmplus.sidepanel.quicklinkadded"));var noQlinkMessageDiv=$j("#noquicklinkmessagediv");noQlinkMessageDiv.is(":visible")&&noQlinkMessageDiv.hide()},error:function(){showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinkcannotadd"))}})}},Services.updateQuickLink=function(event){event&&event.stopPropagation();var id=$j("#sidepanelqlinkeditbox").attr("qlid"),newname=$j("#sidepanelqlinkeditbox").val(),oldName=$j("#"+id).text();if(""===$j.trim(newname))return void showStatusMsg("error",I18N.getValue("crmplus.sidepanel.enterquicklink"));if(oldName===newname)return void SidePanel.hideQuickLinkEditDialog("edit");$j("#sidepanelqlinkupdate").addClass("peventNone"),$j("#sidepanelqlinkdelete").addClass("peventNone"),$j("#sidepanelqlinkupdate").addClass("loading");var fd=new FormData;fd.append("quicklinkid",id),fd.append("linkname",newname),fd.append("type","update"),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updatequicklink.do",data:fd,processData:!1,contentType:!1,dataType:"json",complete:function(){$j("#sidepanelqlinkupdate").removeClass("peventNone"),$j("#sidepanelqlinkdelete").removeClass("peventNone"),$j("#sidepanelqlinkupdate").removeClass("loading")},success:function(data){return data.status?($j("#quicklink_"+id+" > span").text(newname),SidePanel.hideQuickLinkEditDialog("edit"),void showStatusMsg("success",I18N.getValue("crmplus.sidepanel.quicklinkupdated"))):void showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinkcannotupdate"))},error:function(){showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinkcannotupdate"))}})},Services.deleteQuickLink=function(event){event&&event.stopPropagation(),id=$j("#sidepanelqlinkeditbox").attr("qlid");var fd=new FormData;fd.append("quicklinkid",id),$j("#sidepanelqlinkupdate").addClass("peventNone"),$j("#sidepanelqlinkdelete").addClass("peventNone"),$j("#sidepanelqlinkdelete").addClass("spinnerLoading zcrmp-qLinDeload"),$j("#sidepanelqlinkdelete").removeClass("plus-trash"),fd.append("type","delete"),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updatequicklink.do",data:fd,processData:!1,contentType:!1,dataType:"json",complete:function(){$j("#sidepanelqlinkupdate").removeClass("peventNone"),$j("#sidepanelqlinkdelete").removeClass("peventNone"),$j("#sidepanelqlinkdelete").removeClass("spinnerLoading zcrmp-qLinDeload"),$j("#sidepanelqlinkdelete").addClass("plus-trash")},success:function(data){if(!data.status)return void showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinkcannotdelete"));$j("#quicklink_"+id).remove();var index=0;for(index in Services.quickLinksArray){var qlink=Services.quickLinksArray[index];if(qlink.QUICKLINKID==id)break}var deletedInService=Services.quickLinksArray[index].LINK;deletedInService=deletedInService.split("/")[0],"portal"===deletedInService?deletedInService="projects":""===deletedInService&&(deletedInService="crmplus"),Services.quickLinksArray.splice(index,1),0===Services.quickLinksArray.length&&$j("#noquicklinkmessagediv").show(),0===$j("#qlinklist"+deletedInService+">a").length&&$j("#commonuiqlinklist"+deletedInService).hide(),SidePanel.hideQuickLinkEditDialog("edit"),showStatusMsg("success",I18N.getValue("crmplus.sidepanel.quicklinkdeleted"))},error:function(){showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinkcannotdelete"))}})},Services.validateQuickLink=function(linkname){return 0===linkname.length?(showStatusMsg("error",I18N.getValue("crmplus.sidepanel.enterquicklink")),!1):linkname.length>ZCPConstants.QUICKLINK_MAX_LENGTH?(showStatusMsg("error",I18N.getValue("crmplus.sidepanel.quicklinklengthexceed",[ZCPConstants.QUICKLINK_MAX_LENGTH])),!1):!0},Services.keyupEventForQuickLink=function(event){var textInput=$j("#sidepanelqlinkeditbox").val();void 0!==textInput&&""!==$j.trim(textInput)&&void 0!==event&&void 0!==event.keyCode&&"13"==event.keyCode&&$j("#sidepanelqlinkupdate").click()},Services.showQuickLinks=function(event){showPanel("crmpluscommonuiqlinkpanel",void 0,"translate-x",!0,event),Common.isQuickLinkFirstFetch&&(delete Common.isQuickLinkFirstFetch,Services.getQuickLinks())},Services.getQuickLinks=function(){$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/getquicklinksforuser.do",processData:!1,contentType:!1,dataType:"json",success:function(data){if(Services.quickLinksArray=data.quicklinksarray,$j("#crmpluscommonuiqlinkloadingicon").hide(),$j.isEmptyObject(Services.quickLinksArray))$j("#noquicklinkmessagediv").show();else for(index in Services.quickLinksArray){var qlink=Services.quickLinksArray[index];CRMPlusCommonUi.constructQuickLink(qlink.QUICKLINKNAME,qlink.LINK,qlink.QUICKLINKID)}$j("#crmpluscommonuiqlinkpanelscrollingdiv").css({"max-height":$j(window).height()-$j("#quickLinkHeader").outerHeight(!0)})}})},Services.canInsertQuickLink=function(canShowErrorMessage){var link=window.location.hash;link=link.substring(1);for(index in Services.quickLinksArray){var qlink=Services.quickLinksArray[index],qlName=qlink.QUICKLINKNAME;if(link===qlink.LINK)return void 0!==canShowErrorMessage&&canShowErrorMessage&&showStatusMsg("info",I18N.getValue("crmplus.sidepanel.quicklinkalreadyavailable")+" "+qlName),!1}return!0},Services.getPortalName=function(serviceName){if(void 0==serviceName||void 0!=Services.configuredServicesData[serviceName]){var portalName=Services.configuredServicesData[serviceName].PORTAL;if(void 0!=portalName)return portalName}return Common.currentPortalName},Services.loadGettingStartedFrame=function(serviceName,URL){var configuredData=Services.configuredServicesData,serviceData=configuredData[serviceName],html="",errorMessage=";";if(void 0!=serviceData&&null!=serviceData){if(serviceData.ISCONFIGURED){if(serviceData.STATUS==ZCPConstants.STATUS_SOFTLINKED&&serviceData.IS_ADMIN)return void Services.fetch(serviceData.APPID,serviceName,void 0,void 0,!0);if(serviceData.HAS_ACCESS){if(serviceData.ISCONFIGURED&&serviceData.HAS_ACCESS)return void TopBar.loadTopBar("gettingStarted",serviceName,URL)}else{var errorMessage="";errorMessage=null==serviceData.isUserActive||serviceData.isUserActive?void 0!=serviceData.IS_ADMIN&&serviceData.IS_ADMIN?$j("#assign_app").text():I18N.getValue("crmplus.label.contactadmin"):I18N.getValue("crmplus.label.contactserviceadmin",[I18N.getValue("service.title."+serviceName)])}}else errorMessage=I18N.getValue("service.title."+serviceName)+" is not yet mapped into Zoho CRM Plus.";Setup.show.serviceError(serviceName,html,errorMessage)}},Services.getServiceSoid=function(serviceNames,allowedServices){var servicesSoidJson={};for(service in Services.configuredServicesData){var serviceData=Services.configuredServicesData[service];(!allowedServices||Services.hasServiceAccess(service))&&-1!==serviceNames.indexOf(service)&&(servicesSoidJson[service]=serviceData.APPID)}return servicesSoidJson},Services.getServiceUrl=function(serviceName,url){var portalName=this.getPortalName(serviceName);url=url.replace("#PORTALNAME#",portalName);var soid=this.getServiceSoid(serviceName);return soid=soid[serviceName],url=url.replace("#SOID#",soid)},Services.getAssignNewAppsURL=function(){return Common.isAdmin?Services.serviceUrl.get("onezoho",!0)+"/crmplus/"+Common.currentPortalName+"/home#/users/"+Common.myZuid+"/newapps":void 0},Services.setTopAndHeightForIframe=function(serviceName,isAnimation){void 0===isAnimation&&(isAnimation=!0);var top=$j("#crmpluscommonuitopbar").outerHeight(!0),left=0,width=$j(window).width(),heightOfChatBar=$j("#wmstoolbar").outerHeight(!0);1==Common.canTreatLeftPanelVisible()&&(top=$j("#crmpluscommonuitopbar").outerHeight(!0),left=$j("#crmpluscommonuileftpanel").outerWidth(!0),width-=$j("#crmpluscommonuileftpanel").outerWidth(!0));var topBarHeight=$j("#crmpluscommonuitopbar").outerHeight(!0);$j("#crmpluscommonuitopbar").is(":visible")||"crmplus"!==TopBar.type||(topBarHeight=0,top=0);var height=$j(window).height()-topBarHeight-heightOfChatBar;if(CRMPlusCommonUi.changeSize(".crmplusFrameView",isAnimation,height,width,top,left),void 0===serviceName){if(!Services.isServiceFrameVisible(Services.currentView))return;serviceName=Services.currentView}"campaigns"!==serviceName&&"survey"!==serviceName&&"reports"!==serviceName&&(height+=$j("#wmstoolbar").outerHeight(!0)),CRMPlusCommonUi.changeSize("#"+serviceName+"LoadFrame",!1,height,width,top,left)},Services.setTopBar=function(serviceName,isFromService){if("crmplus"!==TopBar.type){var toUrl;if(toUrl=window.location.hash.substring(1),void 0!==TopBar[TopBar.type]&&!TopBar[TopBar.type].isValidURL(serviceName,toUrl)&&!CRMPlusUnifiedSearch.isFilterClick){var index=TopBar.loadedServices.indexOf(serviceName);-1!==index&&TopBar.loadedServices.splice(index,1),TopBar.resetToDefault()}}if("crmplus"===TopBar.type){var toUrl=window.location.hash.substring(1);TopBar.setup.isValidURL(serviceName,toUrl)?TopBar.showTopBar("setup",serviceName):TopBar.search.isValidURL(serviceName,toUrl)&&null!=JSON.parse(sessionStorage.getItem("searchJson"+serviceName))?TopBar.showTopBar("search",serviceName):Services.currentUrl[serviceName]=window.location.hash.substring(1)}"crmplus"!==TopBar.type&&-1===TopBar.loadedServices.indexOf(serviceName)&&TopBar.loadedServices.push(serviceName),Services.currentTopBarType!==TopBar.type&&(Services.currentTopBarType=TopBar.type,isFromService===!0&&Services.loadFrame(Services.currentView))},Services.onMappingServiceWithCRMPlus=function(serviceName){Services.hasServiceAccess(serviceName)&&(Services.previousLoadedFrame!==serviceName&&$j("#"+serviceName+"sidepanelswitch").fadeIn(),$j("#"+serviceName+"commonuileftpanelswitch").css({display:""}),$j("#crmpluscommonuisearchservicediv"+serviceName).show(),$j("#crmplusUnifiedSearchFilterByServicesli"+serviceName).show(),"setup"===TopBar.type&&TopBar.showServiceSetupLabel(serviceName))},Services.getFirstService=function(){var index;for(index in Services.nameArray)if(Common.isAdmin||Services.hasServiceAccess(Services.nameArray[index]))return Services.nameArray[index]},Services.onBeforeSignUp=function(){Services.isOverviewCompleted={},Services.isServieCreationCompleted={},Services.approxCompletionTime={crm:20,salesinbox:35,support:20,campaigns:20,survey:27,projects:23,social:15,motivator:10,reports:11,salesiq:17},Services.timeCompletedToCreate={},Services.percentageCompletedToCreate={},Services.loadingTimer={},Services.hideLoading(),Services.getRedirectionUrl(Services.nameArray[0],!0)},Services.onCreationComplete=function(serviceName){Services.configuredServicesData[serviceName];Common.isSignUp?Services.endLoadingTimer(serviceName):-1!==Services.nonSignupOverviewServices.indexOf(Services.currentView)&&Services.showServiceOverviewPage(serviceName),Services.onMappingServiceWithCRMPlus(serviceName),Services.hasServiceAccess(serviceName)&&(null!=Services.currentView||Common.isSignUp&&-1!=Services.nonSignupOverviewServices.indexOf(Services.currentView)?Services.loadFrame(serviceName,void 0,!1,!1):Services.getRedirectionUrl(serviceName,!1,!1))},Services.completeOverView=function(){Services.hideOverViewPage(),Common.isSignUp&&(Services.isOverviewCompleted[Services.currentView]=!0),-1!==Services.nonSignupOverviewServices.indexOf(Services.currentView)&&Services.nonSignupOverviewServices.splice(Services.nonSignupOverviewServices.indexOf(Services.currentView),1),Services.currentView===ZCPConstants.SERVICE_SALESINBOX?Services.completeSalesInboxOverView():Services.getRedirectionUrl(Services.currentView),(Services.currentView===ZCPConstants.SERVICE_CRM||Services.currentView===ZCPConstants.SERVICE_SUPPORT)&&SidePanel.getAgentStatus()},Services.showOverViewPage=function(serviceName,isServiceClick){isServiceClick&&Hash.append(serviceName);var previousService=Services.currentView;Services.onBeforeFrameLoad(serviceName),Services.constructOverViewPage(serviceName,previousService),$j("#crmplusoverviewforservices").fadeIn({always:function(){$j("#crmplusoverviewforservices").css({opacity:1})}})},Services.constructOverViewPage=function(serviceName,previousService){var loadingDiv=$j("#crmplusoverviewloadingdiv");$j("#crmplusoverviewheader").text(I18N.getValue("crmplus.overview.header."+serviceName)),$j("#crmplusoverviewsubheader").text(I18N.getValue("crmplus.overview.subheader."+serviceName)),$j("#crmplusoverviewsubheader1").text(I18N.getValue("crmplus.overview.section1.header."+serviceName)),$j("#crmplusoverviewsubheader2").text(I18N.getValue("crmplus.overview.section2.header."+serviceName)),$j("#crmplusoverviewsubheader3").text(I18N.getValue("crmplus.overview.section3.header."+serviceName)),$j("#crmplusoverviewsubcontent1").text(I18N.getValue("crmplus.overview.section1.content."+serviceName)),$j("#crmplusoverviewsubcontent2").text(I18N.getValue("crmplus.overview.section2.content."+serviceName)),$j("#crmplusoverviewsubcontent3").text(I18N.getValue("crmplus.overview.section3.content."+serviceName)),$j("#crmplusoverviewloadingservicelabel").text(I18N.getValue("crmplus.overview.message.loading",[I18N.getValue("service.title."+serviceName)])),serviceName!==ZCPConstants.SERVICE_SALESINBOX||0!=Services.isSalesInboxConfigured||Services.isSalesInboxEmailAdded?($j("#crmplusoverviewloadingicon").attr("onclick","Services.completeOverView();"),$j("#crmplusoverviewloadingicon").text(I18N.getValue("crmplus.overview.button.access",[I18N.getValue("service.title."+serviceName)]))):$j("#crmplusoverviewloadingicon").text(I18N.getValue("crmplus.overview.button.configure",[I18N.getValue("service.title."+serviceName)]));var classNamePrev="zcrmp-"+previousService+"Ovr",className="zcrmp-"+serviceName+"Ovr";if($j("#crmplusoverviewiconscontainer").addClass(className),$j("#crmplusoverviewiconscontainer").removeClass(classNamePrev),Services.isServieCreationCompleted[serviceName]){loadingDiv.hasClass("zcrmp-loaddone")||loadingDiv.addClass("zcrmp-loaddone");var percentageCreated=Services.getPercentageCreated(serviceName);$j("#crmplusoverviewloadingicon").stop().css({width:percentageCreated+"%"}),$j("#crmplusoverviewloadingpercent").text(Math.floor(percentageCreated)+"%")}else{loadingDiv.hasClass("zcrmp-loaddone")&&loadingDiv.removeClass("zcrmp-loaddone");var percentageCreated=Services.getPercentageCreated(serviceName);$j("#crmplusoverviewloadingicon").stop().css({width:percentageCreated+"%"}),$j("#crmplusoverviewloadingpercent").text(Math.floor(percentageCreated)+"%")}Services.isServieCreationCompleted[serviceName]&&serviceName===ZCPConstants.SERVICE_SUPPORT?Services.showSupportMailBox(serviceName):Services.hideSupportMailBox()},Services.hideOverViewPage=function(){$j("[id^=crmplusoverviewforservices]").hide()},Services.startLoadingTimer=function(serviceName){Common.isSignUp&&void 0===Services.loadingTimer[serviceName]&&(Services.loadingTimer[serviceName]=window.setInterval(function(){Services.serviceCreationLoadingHandler(serviceName)},1e3))},Services.endLoadingTimer=function(serviceName){if(window.clearInterval(Services.loadingTimer[serviceName]),Services.loadingTimer[serviceName]=null,Services.isServieCreationCompleted[serviceName]=!0,Services.currentView===serviceName){var percentageCreated=Services.getPercentageCreated(serviceName);$j("#crmplusoverviewloadingicon").stop().animate({width:percentageCreated+"%"},800,function(){$j("#crmplusoverviewloadingdiv").addClass("zcrmp-loaddone"),Services.configuredServicesData[serviceName].STATUS==ZCPConstants.STATUS_FINISHED&&serviceName===ZCPConstants.SERVICE_SUPPORT?Services.showSupportMailBox(serviceName):Services.hideSupportMailBox()}),$j("#crmplusoverviewloadingpercent").text(Math.floor(percentageCreated)+"%")}},Services.serviceCreationLoadingHandler=function(serviceName){if(void 0===Services.timeCompletedToCreate[serviceName]&&(Services.timeCompletedToCreate[serviceName]=0),Services.timeCompletedToCreate[serviceName]===Services.approxCompletionTime[serviceName]?Services.percentageCompletedToCreate[serviceName]=Services.percentageCompletedToCreate[serviceName]<99?Services.percentageCompletedToCreate[serviceName]+1:99:(Services.timeCompletedToCreate[serviceName]=Services.timeCompletedToCreate[serviceName]+1,Services.percentageCompletedToCreate[serviceName]=90*Services.timeCompletedToCreate[serviceName]/Services.approxCompletionTime[serviceName],Services.timeCompletedToCreate[serviceName]===Services.approxCompletionTime[serviceName]&&(window.clearInterval(Services.loadingTimer[serviceName]),Services.loadingTimer[serviceName]=window.setInterval(function(){Services.serviceCreationLoadingHandler(serviceName)},5e3))),serviceName===Services.currentView){var percentageCreated=Services.getPercentageCreated(serviceName);$j("#crmplusoverviewloadingicon").stop().animate({width:percentageCreated+"%"},800),$j("#crmplusoverviewloadingpercent").text(Math.floor(percentageCreated)+"%")}},Services.getPercentageCreated=function(serviceName){return null!==Services.loadingTimer[serviceName]?void 0===Services.percentageCompletedToCreate[serviceName]?0:Services.percentageCompletedToCreate[serviceName]:100},Services.onIframeUIReady=function(serviceName){if(Services.isLoadedInIframe[serviceName]!==!0||hasUserAgentExcluded()||Services.removeFrameCookie(serviceName),-1!==Services.currentLoadingServices.indexOf(serviceName)&&Services.currentLoadingServices.splice(Services.currentLoadingServices.indexOf(serviceName),1),0==Services.currentLoadingServices.length&&0!==Services.queuedServicesToLoadInBackGround.length){var servicetoload=Services.queuedServicesToLoadInBackGround[0];Services.queuedServicesToLoadInBackGround.splice(0,1),Services.loadFrame(servicetoload,void 0,!1,!1)}null===Common.getUserOptions(ZCPConstants.LEFTPANEL_VISIBLE)&&Services.currentView==serviceName&&(Common.canHideLeftPanelOnNull=!0,0===$j("#commonuileftpanelswitchicon:hover, #crmpluscommonuileftpanel:hover").length&&(CRMPlusCommonUi.hideLeftPanel(),Common.handleWindowSize()))},Services.validateCurrentPortalInHash=function(){try{var hash=location.hash,curServiceName=hash.substring(1,hash.indexOf("/"));if("portal"===curServiceName&&(curServiceName="projects"),null!==curServiceName&&void 0!==Services.configuredServicesData[curServiceName].PORTAL){var curServicePortal=Services.configuredServicesData[curServiceName].PORTAL,context=curServiceName;"projects"===curServiceName&&(context="portal");var hashWithoutContext=hash.substring(hash.indexOf("/")+1),portalInHash=hashWithoutContext.substring(0);-1!==hashWithoutContext.indexOf("/")&&(portalInHash=hashWithoutContext.substring(0,hashWithoutContext.indexOf("/")));var serviceURL=hashWithoutContext.substring(0);if(-1!==hashWithoutContext.indexOf("/getcpdata/")&&(serviceURL=hashWithoutContext.substring(0,hashWithoutContext.indexOf("/getcpdata/"))),portalInHash!==curServicePortal){var redirectURL=location.protocol+Services.allServiceUrl[curServiceName]+"/"+context+"/"+serviceURL;location.href=redirectURL;var previousUrl=Services.currentUrl[curServiceName];history.replaceState(null,"",location.href.split("#")[0]+"#"+previousUrl),Services.isNonCrmplusPortal=!0}}}catch(e){Services.isNonCrmplusPortal=!0}},Services.canShowIframeOnURLChange=function(serviceName){if(Services.currentView===serviceName&&Services.currentErrorPage!==serviceName&&!Services.isServiceFrameVisible(Services.currentView)){if(serviceName!==ZCPConstants.SERVICE_SALESIQ)return!0;if(void 0==LiveDeskApi.focus||1==LiveDeskApi.isFocusedChatUIReady)return!0}return!1},Services.handleSalesiqForChatCommunication=function(){Services.hasServiceAccess("salesiq")&&Common.isPollFinished&&(Common.isFirstTab?Services.loadFrame("salesiq",void 0,void 0,!1):LiveDeskApi.init())},Services.handleSalesInbox=function(salesInboxStatus){var salesInboxData=Services.configuredServicesData[ZCPConstants.SERVICE_SALESINBOX];void 0!==salesInboxData&&(void 0!==salesInboxStatus.has_access&&(salesInboxData.HAS_ACCESS=salesInboxStatus.has_access),void 0!==salesInboxStatus.isemailadded&&(salesInboxData.isemailadded=salesInboxStatus.isemailadded,Services.isSalesInboxEmailAdded=salesInboxStatus.isemailadded),void 0!==salesInboxStatus.isconfigured&&(salesInboxData.ISCONFIGURED=salesInboxStatus.isconfigured,Services.isSalesInboxConfigured=salesInboxStatus.isconfigured),Common.isSignUp&&Services.isOverviewCompleted.salesinbox!==!0?(Services.currentView!==ZCPConstants.SERVICE_SALESINBOX||0!=Services.isSalesInboxConfigured||Services.isSalesInboxEmailAdded||$j("#crmplusoverviewloadingicon").text(I18N.getValue("crmplus.overview.button.configure",[I18N.getValue("service.title."+Services.currentView)])),Services.endLoadingTimer(ZCPConstants.SERVICE_SALESINBOX)):(salesInboxStatus.isfromconfigrationview&&salesInboxStatus.isconfigured||Services.currentView===ZCPConstants.SERVICE_SALESINBOX)&&(Common.isAdminOnboard?(delete Common.isAdminOnboard,Services.completeOverView()):Services.getRedirectionUrl(ZCPConstants.SERVICE_SALESINBOX)))
},Services.completeSalesInboxOverView=function(){Services.isSalesInboxRemapping=!1;var serviceData=Services.configuredServicesData[ZCPConstants.SERVICE_SALESINBOX];serviceData.HAS_ACCESS&&Services.isSalesInboxConfigured===!1&&Services.isSalesInboxEmailAdded?Services.showSalesInboxFiltersDailog():serviceData.HAS_ACCESS&&Services.isSalesInboxConfigured===!1&&!Services.isSalesInboxEmailAdded?(void 0!==Services.isOverviewCompleted&&Services.isOverviewCompleted.crm!==!0&&(Services.isOverviewCompleted.crm=!0),-1!==Services.nonSignupOverviewServices.indexOf(ZCPConstants.SERVICE_CRM)&&Services.nonSignupOverviewServices.splice(Services.nonSignupOverviewServices.indexOf(ZCPConstants.SERVICE_CRM),1),Services.getRedirectionUrl(ZCPConstants.SERVICE_CRM,!0,!1,TopBar.setup.getDefaultURL(ZCPConstants.SERVICE_SALESINBOX))):Services.getRedirectionUrl(Services.currentView,!0)},Services.handleSalesInboxErrorCase=function(){if(Services.isLoadedInIframe[ZCPConstants.SERVICE_SALESINBOX]=!1,Services.hideServiceIframe(ZCPConstants.SERVICE_SALESINBOX,!0),$j("#salesinboxLoadFrame").remove(),null!==Services.isSalesInboxConfigured){var serviceData=Services.configuredServicesData[ZCPConstants.SERVICE_SALESINBOX];serviceData.HAS_ACCESS||Services.isSalesInboxRemapping?Services.showServiceOverviewPage(ZCPConstants.SERVICE_SALESINBOX):Services.showSalesInboxAdminsForRequestAccess()}else if(Services.showLoading(ZCPConstants.SERVICE_SALESINBOX,"iframe-spinner"),Services.isSalesInboxRemapping)Services.showServiceOverviewPage(ZCPConstants.SERVICE_SALESINBOX);else if(Services.currentView==ZCPConstants.SERVICE_SALESINBOX&&Services.configuredServicesData.crm&&Services.configuredServicesData.crm.STATUS===ZCPConstants.STATUS_FAILED)Services.hideLoading(Services.currentView,"iframe-spinner"),CRMPlusCommonUi.showErrorPage("unabletocreateservice",{servicename:ZCPConstants.SERVICE_SALESINBOX});else if(Services.currentView==ZCPConstants.SERVICE_SALESINBOX&&Services.configuredServicesData.crm&&Services.configuredServicesData.crm.IS_ADMIN)if(Services.configuredServicesData.crm.STATUS===ZCPConstants.STATUS_FINISHED)Services.configuredServicesData.crm.HAS_ACCESS||Services.showAdminOnboardScreen();else{Services.hideLoading(Services.currentView,"iframe-spinner");var conflictData=Services.conflict.getConflictData(ZCPConstants.SERVICE_SALESINBOX,"dependent_service_not_mapped");Services.conflict.show(Services.currentView,conflictData)}},Services.showServiceOverviewPage=function(serviceName,buttonAction){var configuredData=Services.configuredServicesData,serviceData=configuredData[serviceName];if(!serviceData||!serviceData.CONFLICT_TYPE||serviceData.STATUS!=ZCPConstants.STATUS_NOTCONFIGURED){if(Common.isSignUp)Services.showOverViewPage(serviceName,!0);else if($j("#crmplusoverviewforservices"+serviceName).length>0){if($j("#crmplusoverviewiconscontainer"+serviceName).addClass("zcrmp-"+serviceName+"Ovr"),serviceName===Services.currentView){var serviceData=Services.configuredServicesData[serviceName];(Common.isZohoOne||serviceData.STATUS==ZCPConstants.STATUS_FINISHED||serviceData.STATUS==ZCPConstants.STATUS_FAILED||serviceData.STATUS==ZCPConstants.STATUS_SOFTLINKED||serviceName===ZCPConstants.SERVICE_SALESINBOX)&&($j("#crmplusoverviewloadingicon"+serviceName).stop().css({width:"100%"}),$j("#crmplusoverviewloadingpercent"+serviceName).text(Math.floor(100)+"%"),$j("#crmplusoverviewloadingdiv"+serviceName).addClass("zcrmp-loaddone")),serviceData.STATUS==ZCPConstants.STATUS_FINISHED&&serviceName===ZCPConstants.SERVICE_SUPPORT?Services.showSupportMailBox(serviceName):Services.hideSupportMailBox(),Services.hideLoading(serviceName,"iframe-spinner"),$j("#crmplusoverviewforservices"+serviceName).fadeIn({always:function(){$j("#crmplusoverviewforservices"+serviceName).css({opacity:1})}}),0==CRMPlusCommonUi.isLeftPanelVisible&&CRMPlusCommonUi.hideLeftPanel()}}else serviceName===Services.currentView&&serviceName===ZCPConstants.SERVICE_SALESINBOX&&(Services.showLoading(serviceName,"iframe-spinner"),Services.fetchServiceOverviewPage(serviceName));buttonAction&&$j("#crmplusoverviewloadingicon"+serviceName).attr("onclick",buttonAction)}},Services.fetchServiceOverviewPage=function(services,buttonAction,overviewType){var params={};params.services=services,void 0!=overviewType&&(params.overviewtype=overviewType),params.isnonsingupfetch=!0,$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/getcrmplusserviceoverview.do",data:params,dataType:"html",success:function(response){$j("body").prepend(response),-1!==services.indexOf(Services.currentView)&&Services.showServiceOverviewPage(Services.currentView,buttonAction)}})},Services.showSalesInboxFiltersDailog=function(){$j("#salesinboxfilterimportdialog").show()},Services.hideSalesInboxFiltersDailog=function(){$j("#salesinboxfilterimportsfile")[0].value="",$j("#salesinboxfilterimportdialog").hide(),$j("#salesinboxfilterimportsfilename").text(""),$j("#salesinboxfilterimportserrormsg").hide(),$j("#crmplusoverviewforservicessalesinbox").fadeIn({always:function(){$j("#crmplusoverviewforservicessalesinbox").css({opacity:1})}})},Services.isValidFile=function(fileName,allowedExtensions){var ind=fileName.lastIndexOf(".");if(-1!==ind){var extn=fileName.slice(ind+1);if(-1===allowedExtensions.lastIndexOf(extn))return!1}return!0},Services.onfilterFileSelect=function(input){if(input.files&&input.files[0]){var fileName=input.files[0].name,fileSize=input.files[0].size;Services.isValidFile(fileName,ZCPConstants.SALESINBOX_FILTER_FILE_TYPES)?fileSize>1048576?(input.value="",$j("#salesinboxfilterimportserrormsg").text(I18N.getValue("crmplus.salesinbox.importfilter.sizelarge")),$j("#salesinboxfilterimportserrormsg").show()):($j("#salesinboxfilterimportsfilename").text(fileName),$j("#salesinboxfilterimportserrormsg").hide()):(input.value="",$j("#salesinboxfilterimportserrormsg").text(I18N.getValue("crmplus.salesinbox.importfilter.allowedfile")),$j("#salesinboxfilterimportserrormsg").show())}},Services.handleSalesInboxFiltersDailogAction=function(actionType){if("skip"===actionType)$j("#salesinboxfilterskipbtn").addClass("peventNone"),Services.createSalesInbox();else if("import"===actionType)if(void 0===$j("#salesinboxfilterimportsfile").get(0).files[0])$j("#salesinboxfilterimportserrormsg").text(I18N.getValue("crmplus.salesinbox.importfilter.choosefile")),$j("#salesinboxfilterimportserrormsg").show();else{var file=$j("#salesinboxfilterimportsfile").get(0).files[0],fileName=file.name;if(Services.isValidFile(fileName,ZCPConstants.SALESINBOX_FILTER_FILE_TYPES)){var data=new FormData;data.append("efImportFilter",file),data.append("crmcsrfparam",encodeURIComponent(Security.csrfToken.get())),$j("#salesinboxfilterimportbtn").addClass("peventNone"),Services.showLoading(),$j.ajax({url:"/crm/EmailWF.do?action=importEmailFilter",type:"POST",data:data,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(data){("SUCCESS"===data.result||"duplicate"===data.result)&&Services.createSalesInbox()},complete:function(){$j("#salesinboxfilterimportbtn").removeClass("peventNone")},error:function(){$j("#salesinboxfilterimportdialog").hide(),Services.hideLoading()}})}else $j("#salesinboxfilterimportserrormsg").text(I18N.getValue("crmplus.salesinbox.importfilter.allowedfile")),$j("#salesinboxfilterimportserrormsg").show()}},Services.createSalesInbox=function(){var servicesSoidJson=Services.getServiceSoid([ZCPConstants.SERVICE_CRM],!0),fd=new FormData;fd.append("crmzsoid",servicesSoidJson.crm),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),Services.showLoading(),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/createsalesinbox.do",data:fd,processData:!1,contentType:!1,dataType:"json",success:function(response){200===response.status_code&&(Services.configuredServicesData[ZCPConstants.SERVICE_SALESINBOX].ISCONFIGURED=!0,Services.isSalesInboxConfigured=!0,Services.currentView===ZCPConstants.SERVICE_SALESINBOX&&Services.getRedirectionUrl(ZCPConstants.SERVICE_SALESINBOX))},complete:function(){$j("#salesinboxfilterimportdialog").hide(),$j("#salesinboxfilterskipbtn").removeClass("peventNone"),$j("#crmplusoverviewforservices").hide()},error:function(){Services.hideLoading()}})},Services.showSalesInboxAdminsForRequestAccess=function(){var errorData={};errorData.image="/error-image2.png",errorData.header=I18N.getValue("crmplus.salesinbox.noaccess.header"),errorData.message=I18N.getValue("crmplus.salesinbox.noaccess.message"),CRMPlusCommonUi.showErrorPage("noaccessforservice",errorData)},Services.handleSalesInboxRequestToAdmin=function(adminEmail){Feedback.successMessage="";var subject="",body="";Feedback.showFeedbackDialog("salesinboxaccessrequest",subject,body,adminEmail)},Services.showAppliedFiltersOnSearch=function(serviceName,searchText,appliedFilters){serviceName===ZCPConstants.SERVICE_SALESINBOX&&($j("#salesinboxsearchedtext").text('"'+searchText+'"'),$j("#salesinboxappliedfilters").text('"'+appliedFilters+'"'),$j("#salesinboxappliedfiltersview").show())},Services.clearAppliedFilters=function(){Services.currentView===ZCPConstants.SERVICE_SALESINBOX&&(ServiceCommunicator.triggerAction(Services.currentView,"clearSearchFilter"),$j("#crmpluscommonuisalesinboxtext").val(""),$j("#salesinboxappliedfiltersview").hide())},Services.updateSupportMailBox=function(){if(void 0!==Services.configuredServicesData[ZCPConstants.SERVICE_SUPPORT].MAILBOX){var mailBoxName=Services.configuredServicesData[ZCPConstants.SERVICE_SUPPORT].MAILBOX;$("crmplusoverviewsupportmailboxname")&&$j("#crmplusoverviewsupportmailboxname").text(mailBoxName),$("crmplusoverviewsupportmailboxnamesupport")&&$j("#crmplusoverviewsupportmailboxnamesupport").text(mailBoxName)}},Services.hideSupportMailBox=function(){$("crmplusoverviewsupportmailboxname")&&$j("#crmplusoverviewsupportmailbox").addClass("hide"),$("crmplusoverviewsupportmailboxnamesupport")&&$j("#crmplusoverviewsupportmailboxsupport").addClass("hide")},Services.showSupportMailBox=function(curServiceName){curServiceName===ZCPConstants.SERVICE_SUPPORT&&void 0!==Services.configuredServicesData[ZCPConstants.SERVICE_SUPPORT].MAILBOX&&($("crmplusoverviewsupportmailboxname")&&$j("#crmplusoverviewsupportmailbox").removeClass("hide"),$("crmplusoverviewsupportmailboxnamesupport")&&$j("#crmplusoverviewsupportmailboxsupport").removeClass("hide"))},Services.getZohoOneAddUserURL=function(appName){return Common.zohoOneAddUsersURL?Common.zohoOneAddUsersURL.replace(ZCPConstants.SERVICE_CRM_PLUS,appName):void 0},Security.init=function(paramName){null!=paramName&&(Security.param=paramName)},Security.csrfParam={get:function(){return Security.param}},Security.csrfToken={get:function(){return getCookieByName(ZCPConstants.CSRF_COOKIE)}},String.prototype.endsWith||(String.prototype.endsWith=function(search,this_len){return(void 0===this_len||this_len>this.length)&&(this_len=this.length),this.substring(this_len-search.length,this_len)===search}),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host),BrCookie.create=function(name,value,minutes,isSecure,path){var expires="";if(minutes){var date=new Date;date.setTime(date.getTime()+60*minutes*1e3);var expires="; expires="+date.toGMTString()}void 0==path&&(path="/");var cookie=name+"="+value+expires+"; path="+path+";";(void 0===isSecure||isSecure===!0)&&(cookie+="secure;"),document.cookie=cookie},BrCookie.read=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},BrCookie.erase=function(name){BrCookie.create(name,"",-1)};var Hash={_MODULE_MAP:{},_MODULE_ID_MAP:{},SEPARATOR:"/",current:window.location.hash,init:function(){"onhashchange"in window?window.onhashchange=Hash.listener:window.setInterval(function(){Hash.listener()},1e3),this._MODULE_MAP.Dashboard="dashboard",this._MODULE_ID_MAP.dashboard="Dashboard"},append:function(val,args){args&&(val+=Hash.SEPARATOR+args),this.set(val)},set:function(val){null!=val&&void 0!=val&&(Hash.history.add(val),""!==$j.trim(val)&&(val="#"+val),window.history.pushState({},"",window.location.href.replace(window.location.hash,"")+val),Hash.current=window.location.hash)},listener:function(){window.location.hash;Hash.handleURI()},handleURI:function(){var hash=window.location.hash.trim(),hashValue=hash.substring(1),hashArr=hashValue.split(Hash.SEPARATOR),module=hashArr[0];if("portal"===module&&(module="projects"),"settings"==module)return $j("#crmplusoldusers-newuibanner").hide(),void AdminPanel.util.handleHash(hashValue);if(Common.isNewUI!==!0){if(Services.isCrmplusIntegratedService(module)){var url="";return hashArr.length>1&&(url=hashValue),void(window.location.href=Services.serviceUrl.processFrameURL(module,url,!0,!1))}return void $j("#crmplusoldusers-newuibanner").show()}return""!==hash&&Services.isCrmplusIntegratedService(module)||(window.history.replaceState({},"",window.location.href.replace(window.location.hash,"")),module="dashboard"),Services.isFetchComplete?void(module===hashValue?Services.getRedirectionUrl(module,!1,!1):Services.getRedirectionUrl(module,!1,!1,hashValue)):void("dashboard"!==module&&Services.loadFrame(module,hashValue,!1))},changeHistory:function(fromService,historyUrl,eventOrigin,isSetHashValue){-1!=eventOrigin.indexOf(".zohocorpin.com")&&(eventOrigin=-1!=eventOrigin.indexOf(window.location.protocol)?window.location.protocol+Services.allServiceUrl[fromService]:Services.allServiceUrl[fromService]);var toAppendUrl=historyUrl.replace(eventOrigin,"").replace("#","/getcpdata/").substring(1);if("crm"===fromService||"motivator"===fromService){var frameorigin=window.location.protocol+"//"+window.location.host;toAppendUrl=toAppendUrl.replace("&frameorigin="+frameorigin,"").replace("?frameorigin="+frameorigin,"")}return 0===toAppendUrl.search(/crm(\/[\w]+)?\/salesinbox\/View\.do/)&&(toAppendUrl=toAppendUrl.replace(/crm(\/[\w]+)?\/salesinbox\/View\.do/,"salesinbox/View.do")),0===toAppendUrl.indexOf("portal/")&&(toAppendUrl=toAppendUrl.replace("portal/","projects/")),isSetHashValue?window.location.hash.trim()!=="#"+toAppendUrl&&Hash.append(toAppendUrl):window.history.replaceState({},"",window.location.href.replace(window.location.hash,"")+"#"+toAppendUrl),toAppendUrl}};Hash.history={uris:[],maxURIs:100,add:function(val){val!=this.current()&&(this.uris.push(val),this.uris.length>this.maxURIs&&this.uris.slice())},current:function(){return this.uris[this.uris.length-1]},back:function(){this.uris.length>1&&(this.uris.pop(),Hash.set(this.current()),Hash.handleURI())},getLastLoadedURL:function(){var lastLoadedUrl="";return this.uris.length>1&&(lastLoadedUrl=this.uris[this.uris.length-2]),lastLoadedUrl}},Hash.init();var CRMPlusLocalStorage={storage:window.localStorage,context:"crmplus",init:function(){var crmplusData=this.storage[this.context];void 0!==crmplusData&&(crmplusData=JSON.parse(crmplusData)),void 0===crmplusData||void 0!==crmplusData.zuid&&crmplusData.zuid===Common.myZuid||this.reset();var portalName=CRMPlusLocalStorage.get(ZCPConstants.CURRENT_PORTAL);portalName!==Common.currentPortalName&&(CRMPlusLocalStorage.remove(ZCPConstants.CURRENT_PORTAL),CRMPlusLocalStorage.remove(ZCPConstants.LAST_ACCESSED_URL),CRMPlusLocalStorage.set(ZCPConstants.CURRENT_PORTAL,Common.currentPortalName))},set:function(key,value){try{var crmplusData=this.getStorageJson();void 0===crmplusData.zuid&&(crmplusData.zuid=Common.myZuid);var pathArray=key.split(".");key=pathArray[pathArray.length-1],pathArray.splice(pathArray.length-1,1);var toBeInsertedJson=this.getParsedJson(crmplusData,pathArray,!0);toBeInsertedJson[key]=value,crmplusData=JSON.stringify(crmplusData),this.storage[this.context]=crmplusData}catch(e){}},get:function(key){try{var crmplusData=this.getStorageJson();if(void 0!==crmplusData){var pathArray=key.split(".");key=pathArray[pathArray.length-1],pathArray.splice(pathArray.length-1,1);var targetJson=this.getParsedJson(crmplusData,pathArray,!1);if(null!==targetJson&&void 0!==targetJson[key])return targetJson[key]}}catch(e){}return void 0},remove:function(key){try{var crmplusData=this.getStorageJson();if(void 0!==crmplusData){var pathArray=key.split(".");key=pathArray[pathArray.length-1],pathArray.splice(pathArray.length-1,1);var targetJson=this.getParsedJson(crmplusData,pathArray,!1);null!==targetJson&&(delete targetJson[key],crmplusData=JSON.stringify(crmplusData),this.storage[this.context]=crmplusData)}}catch(e){}},reset:function(){try{this.storage.removeItem(this.context)}catch(e){}},getParsedJson:function(json,pathArray,canCreate){if(void 0===json)return null;for(var i=0;i<pathArray.length;i++){if(void 0===json[pathArray[i]]){if(!canCreate)return null;json[pathArray[i]]={}}json=json[pathArray[i]]}return json},getStorageJson:function(){var crmplusData=this.storage[this.context];try{crmplusData=JSON.parse(crmplusData)}catch(e){return this.reset(),{}}return crmplusData},setItem:function(key,value){try{window.localStorage.setItem(key,value)}catch(e){}},getItem:function(key){try{return window.localStorage.getItem(key)}catch(e){}return void 0},removeItem:function(key){try{window.localStorage.removeItem(key)}catch(e){}}};DateUtil.month=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),DateUtil.formatDate=function(date,isTimeRequired){var month=DateUtil.month,minutes=date.getMinutes(),hours=date.getHours(),dd=date.getDate(),mm=date.getMonth(),yyyy=date.getFullYear();return 10>dd&&(dd="0"+dd),10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),date=isTimeRequired?dd+"-"+month[mm]+"-"+yyyy+" "+hours+":"+minutes:dd+"-"+month[mm]+"-"+yyyy},DateUtil.convertDateToString=function(date){if(void 0!==date){var curDate=new Date;if(date.getFullYear()===curDate.getFullYear()&&date.getMonth()===curDate.getMonth()){if(date.getDate()===curDate.getDate())return ZCPConstants.TODAY;if(date.getDate()===curDate.getDate()-1)return ZCPConstants.YESTERDAY;if(date.getDate()===curDate.getDate()+1)return ZCPConstants.TOMORROW}return DateUtil.getDateStringFromDate(date)}return"-"},DateUtil.getDateStringFromDate=function(date){var dd=date.getDate();return 10>dd&&(dd="0"+dd),DateUtil.month[date.getMonth()]+" "+dd+", "+date.getFullYear()},DateUtil.getTimeStringFromDate=function(date){var hours=date.getHours(),minutes=date.getMinutes(),meridiem="AM";return 12==hours?minutes>0&&(meridiem="PM"):hours>12&&(hours-=12,meridiem="PM"),10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),hours+":"+minutes+" "+meridiem},Feedback.isEmpty=!0;var filesArray=[],filesIndex=[],files,filesize=0,count=0;Feedback.successMessage=null,Feedback.addEventListener=function(){document.getElementById("filesid").addEventListener("change",Feedback.handleAttachments,!1)},Feedback.handleAttachments=function(evt){files=evt.target.files;for(var i=0;i<files.length;i++)filesize+files[i].size<1536e3?(filesize+=files[i].size,filesArray.push(files[i]),count+=1,Feedback.isEmpty=!1,Feedback.createView(files[i].name,files[i].size,count),filesIndex.push(count)):showStatusMsg("error",showStatusMsg("error",I18N.getValue("feedback.message.sizelarge")));$j("#filesid").val(null),Feedback.handleSubmitButton()},Feedback.createView=function(name,size,id){var sizeinkb=size/1024,attachment="<div class='attachment' id='attachmentforfile"+id+"'></div>";$j("#attachments").append(attachment);var icon="<div class='attImg'><i class='plus-attachment'></i></div>",attDetail="<div class='attDtl' id='attDtlforfile"+id+"' ></div>",attName="<div class='attName' id='attNameforfile"+id+"'></div>";if(1024>sizeinkb)var sizespan="<span class='attSize' id='attSizeforfile"+id+"' >"+sizeinkb.toFixed(1)+" kb</span>";else{sizeinkb/=1024;var sizespan="<span class='attSize' id='attSizeforfile"+id+"' >"+sizeinkb.toFixed(1)+" mb</span>"}var close=" <div class='attDel'><a href='javascript:;' onclick='Feedback.deleteAttach("+id+","+size+");' ><i class='plus-close'></i></a></div>";$j("#attachmentforfile"+id).html(icon+attDetail+close),$j("#attDtlforfile"+id).html(attName+sizespan),$j("#attNameforfile"+id).text(name),$j("#attNameforfile"+id).attr("title",name),$j("#attachmentsouter").css("display","block")},Feedback.deleteAttach=function(id,size){var index=filesIndex.indexOf(id);filesArray.splice(index,1),filesIndex.splice(index,1),filesize-=size,$j("#attachmentforfile"+id).css("display","none"),0==filesArray.length&&(Feedback.isEmpty=!0,$j("#attachmentsouter").css("display","none"),Feedback.handleSubmitButton())},Feedback.submitFeedback=function(){Feedback.showLoading();var toAddress=Feedback.getValidatedFields("to"),ccAddress=Feedback.getValidatedFields("cc");if(null===toAddress||null===ccAddress)return void $j("#SubmitFeedbackSpan").text(I18N.getValue("button.submit"));var subject=$j.trim($j("#feedback-subject").val()),body=$j.trim($j("#feedback-body").val());Feedback.isEmptyFeedback()?Feedback.hideLoading():((void 0==subject||""==subject)&&(subject=I18N.getValue("feedback.default.subject")),(void 0===body||""===body.trim())&&(body=subject),sendMail(!0,!0,subject,body,filesArray,function(data){"extendtrial"==Feedback.type&&(Feedback.successMessage=I18N.getValue("feedback.message.extendtrial.success")),"success"==data?(null==Feedback.successMessage&&(Feedback.successMessage=I18N.getValue("feedback.message.success")),showStatusMsg("success",Feedback.successMessage),Feedback.closeFeedbackDialog()):(showStatusMsg("error",I18N.getValue("feedback.message."+data)),Feedback.hideLoading())},void 0,function(){Feedback.hideLoading(),showStatusMsg("error",I18N.getValue("feedback.message.failure"))}))},Feedback.showFeedbackDialog=function(type,subject,body){Feedback.hideLoading(),$j("#feedback-header").html(I18N.getValue("top.supportmail")),$j("#feedback-subject").show(),$j("#feedback-body").prop("placeholder",I18N.getValue("feedback.message")),$j(".attachFile").show(),$j("#SubmitFeedbackSpan").text(I18N.getValue("button.submit")),void 0!=type&&(Feedback.type=type,"trackerCodeEmail"==type&&($j("#feedback-to").show(),$j("#feedback-cc-link").show(),$j("#feedback-header").html("Send Tracker Code")),void 0===subject&&(subject=I18N.getValue("feedback."+type+".subject")),void 0===body&&(body=I18N.getValue("feedback."+type+".body")),void 0!=body&&body!="feedback."+type+".body"&&(body=body.replace(/<br>/g,"\n").replace(/<tab>/g,"	"),$j("#feedback-subject").val(subject),$j("#feedback-body").val(body))),Feedback.toggleFeedbackDialog(),$j("#feedback-subject").focus(),Feedback.handleSubmitButton()},Feedback.handleSubmitButton=function(){Feedback.isContentExist()?Feedback.enableSubmitButton():Feedback.disableSubmitButton()},Feedback.isContentExist=function(){return $j("#feedback-subject").val().trim().length>0||$j("#feedback-body").val().trim().length>0?!0:"none"===$j("#attachmentsouter").css("display")?!1:!0},Feedback.onMouseOverSubmitButton=function(evt){Feedback.isContentExist()||tooltip(I18N.getValue("button.submit.feedback"),evt)},Feedback.onClickSubmitButton=function(){Feedback.isContentExist()&&Feedback.submitFeedback()},Feedback.disableSubmitButton=function(){$j("#SubmitFeedback").css("opacity","0.4")},Feedback.enableSubmitButton=function(){$j("#SubmitFeedback").css("opacity","1")},Feedback.showLoading=function(){$j("#SubmitFeedbackSpan").hide(),$j("#SubmitFeedback").addClass("loading"),$j("#SubmitFeedback").addClass("zcrmp-pointerNone")},Feedback.hideLoading=function(){$j("#SubmitFeedbackSpan").show(),$j("#SubmitFeedback").removeClass("zcrmp-pointerNone"),$j("#SubmitFeedback").removeClass("loading")},Feedback.closeFeedbackDialog=function(){delete Feedback.type,filesArray=[],filesize=0,Feedback.isEmpty=!0,filesIndex=[],count=0,$j("#filesid").val(null),Feedback.successMessage=null,$j("#attachments").empty(),$j("#attachmentsouter").css("display","none"),$j("#feedback-subject").val(""),$j("#feedback-body").val(""),$j("#feedback-to").val(""),$j("#feedback-cc").val(""),$j("#feedback-cc").hide(),$j("#feedback-to").hide(),$j("#feedback-cc-link").hide(),$j("#feedback-to-error").hide(),$j("#feedback-cc-error").hide(),$j("#feedback-dialog").slideUp("fast",function(){$j("#feedback-dialogcontainer").hide()})},Feedback.toggleFeedbackDialog=function(){"none"===$j("#feedback-dialogcontainer").css("display")?($j("#feedback-dialogcontainer").show(),$j("#feedback-dialog").slideDown("fast")):(Feedback.closeFeedbackDialog(),$j("#feedback-dialog").slideUp("fast",function(){$j("#feedback-dialogcontainer").hide()}))},Feedback.isEmptyFeedback=function(){var subject=$j.trim($j("#feedback-subject").val()),body=$j.trim($j("#feedback-body").val());return!Feedback.isEmpty||void 0!==subject&&""!==subject||void 0!==body&&""!==body?!1:!0},Feedback.getValidatedFields=function(fieldName){var field=$j("#feedback-"+fieldName+":visible");if(void 0!==field&&field.length>0&&""!==field.val().trim()){value=field.val().trim();var emailArray=value.split(",");for(index in emailArray)if(!isValidEmail(emailArray[index]))return $j("#feedback-"+fieldName+"-error").removeClass("zcrmp-shake"),$j("#feedback-"+fieldName+"-error").show(),$j("#feedback-"+fieldName+"-error").addClass("zcrmp-shake"),$j("#SubmitFeedbackSpan").text(I18N.getValue("button.submit")),null;return value}return void 0},Feedback.validateEmail=function(fieldName){null!=Feedback.getValidatedFields(fieldName)&&$j("#feedback-"+fieldName+"-error").hide()},Feedback.handleConflictFeedbackDialog=function(type,service){var subject=I18N.getValue("feedback."+type+".subject"),body=I18N.getValue("feedback."+type+".body",[I18N.getValue("service.title."+Services.currentView),service]);Feedback.showFeedbackDialog(type,subject,body)},ServiceCommunicator.tempKeysForAlersLogging=["InitializeTriggered","sentInitCheck","InitReplyReceived","UIReadyReceived","UIReadyCalled","LibraryLoaded","frameElement"],ServiceCommunicator.intialize=function(){window.addEventListener?window.addEventListener("message",ServiceCommunicator.action.receiveMessage,!1):window.attachEvent("onmessage",ServiceCommunicator.action.receiveMessage)},ServiceCommunicator.loadFrame={servicesLoadTimer:{},servicesRetryTimer:{},setTimeOut:function(serviceName,canView){(void 0===ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName]||null===ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName])&&(ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName]=setTimeout(function(){ServiceCommunicator.loadFrame.onTimeOut(serviceName)},18e4)),canView&&void 0!==ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]&&null!==ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]&&(clearTimeout(ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]),ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]=null),(canView&&void 0===ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]||null===ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName])&&(ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]=setTimeout(function(){-1===Services.nonSignupOverviewServices.indexOf(Services.currentView)&&ServiceCommunicator.loadFrame.onError(serviceName)},15e4))},clearTimeOut:function(serviceName){clearTimeout(ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]),ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]=null,clearTimeout(ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName]),ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName]=null},onError:function(serviceName){clearTimeout(ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]),Services.onIframeUIReady(serviceName),ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]=null;var frameUrl="default",frameAccess=!0,frameSrc="default";try{frameSrc=document.getElementById(serviceName+"LoadFrame").src,frameUrl=document.getElementById(serviceName+"LoadFrame").contentWindow.location.href}catch(e){frameAccess=!1}if(null===ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName]&&$j("#"+serviceName+"LoadFrame").remove(),Services.currentView===serviceName&&Services.isFetchComplete){Services.currentErrorPage=serviceName,Services.hideLoading(),CRMPlusCommonUi.showErrorPage("unabletoload");var isWindowFrameElement=null;try{isWindowFrameElement=null!=window.frameElement}catch(e){}var bodyObj={Service:I18N.getValue("service.title."+Services.currentView),IFrameUrl:frameUrl,URL:window.location.hash,InitCheck:ServiceCommunicator.readTempLog(serviceName+"_InitializeTriggered")+","+ServiceCommunicator.readTempLog(serviceName+"_sentInitCheck")+","+tempLoggingForInitCheck[serviceName]+","+ServiceCommunicator.readTempLog(serviceName+"_InitReplyReceived"),isLoaded:Services.isLoadedInIframe[serviceName],URLChange:tempLoggingForURLChange[serviceName],UIReady:ServiceCommunicator.readTempLog(serviceName+"_UIReadyReceived")+","+tempLoggingForUIReady[serviceName]+","+ServiceCommunicator.readTempLog(serviceName+"_UIReadyCalled"),LibraryLoaded:ServiceCommunicator.readTempLog(serviceName+"_LibraryLoaded"),frameElement:ServiceCommunicator.readTempLog(serviceName+"_frameElement"),userAgent:navigator.userAgent,parentFrameElement:isWindowFrameElement,isOnline:tempLoggingForOnline[serviceName],FrameAccess:frameAccess,FrameSrc:frameSrc};Common.sendErrorAlert("Problem while loading service in CRMPlus",bodyObj)}},onTimeOut:function(serviceName){Services.removeFrameCookie(serviceName),null===ServiceCommunicator.loadFrame.servicesLoadTimer[serviceName]&&($j("#"+serviceName+"LoadFrame").remove(),ServiceCommunicator.resetTempLogs(serviceName)),ServiceCommunicator.loadFrame.servicesRetryTimer[serviceName]=null}},ServiceCommunicator.action={initRetryCount:0,sendMessage:function(serviceName,toPostMessage,event,sourceWindow){if(toPostMessage.isfromcrmplus=!0,serviceName){var serviceOrigin=location.protocol+Services.serviceUrl.get(serviceName),serviceWindow=sourceWindow;void 0==serviceWindow&&(serviceWindow=$(serviceName+"LoadFrame").contentWindow),serviceWindow.postMessage(JSON.stringify(toPostMessage),serviceOrigin)}else event&&event.source.postMessage(JSON.stringify(toPostMessage),event.origin)},receiveMessage:function(event){var eventOrigin=event.origin,curdomain=window.location.host;if(-1!==curdomain.indexOf(".zohocorpin.com")||eventOrigin===location.protocol+Common.productUrl){var eventData;if(eventData="object"!=typeof event.data?Common.jsonParse(event.data):event.data,void 0!==eventData&&eventData.isfromcrmpluslibrary){var eventType=eventData.type;if("InitCheck"===eventType){var toPostMessage={};tempLoggingForInitCheck[eventData.fromService]=!0,toPostMessage.type="InitReply",ServiceCommunicator.action.sendMessage(void 0,toPostMessage,event),ServiceCommunicator.crmplusUIReady(eventData.fromService,event.source)}else if("GetCurrentURL"===eventType){var callBackFnName=eventData.callbackfunctionname,fromService=eventData.fromService;if(fromService!==Services.currentView)return;"autoCorrectFrameURL"===callBackFnName?ServiceCommunicator.autoCorrectFrameURL(fromService,eventOrigin,eventData.value):"changeHistory"===callBackFnName?(Hash.changeHistory(fromService,eventData.value,eventOrigin,!0),Services.loadFrame(fromService)):"replaceHistory"===callBackFnName&&(Hash.changeHistory(fromService,eventData.value,eventOrigin,!1),Services.loadFrame(fromService))}else if("SetActive"===eventType)LDUserIdleApi.active();else if("SetLoadingStatus"===eventType){var fromService=eventData.fromService;fromService===Services.currentView&&1==Services.isServiceFrameVisible(Services.currentView)&&(eventData.status?Services.showLoading():Services.hideLoading())}else if("SetCommonUIElements"===eventType)CRMPlusCommonUi.handleCommonUiModules(eventData.fromService,eventData.uitype,eventData.modulejson);else if("SelectEntity"===eventType)CRMPlusCommonUi.setSelected(eventData.fromService,eventData.selected,eventData.uitype);else if("WindowUnLoad"===eventType){if(ServiceCommunicator.resetTempLogs(eventData.fromService),Services.isLoadedInIframe[eventData.fromService]&&!Common.isSignUp){CRMPlusCommonUi.isTopBarHidden[eventData.fromService]=!1,Services.isLoadedInIframe[eventData.fromService]=!1,Services.hideServiceIframe(eventData.fromService,!0);
var canView=!1;eventData.fromService===Services.currentView&&(canView=!0,Services.showLoading(eventData.fromService,"iframe-spinner")),ServiceCommunicator.loadFrame.setTimeOut(eventData.fromService,canView)}}else if("UpdateField"===eventType)CRMPlusCommonUi.updateField(eventData.fromService,eventData.uitype,eventData.key,eventData.newValue);else if("SetSearchFilters"===eventType)CRMPlusCommonUi.handleCommonUiModules(eventData.fromService,"search",eventData.filters);else if("SetDefaultFilters"===eventType)CRMPlusCommonUi.search.handleDefaultCheckedFilters(eventData.fromService,eventData.filters);else if("SetNotificationCount"===eventType)CRMPlusCommonUi.handleNotificationsCount(eventData.fromService,eventData.notificationtype,eventData.count,eventData.isAlertIcon);else if("pushrecentitems"===eventType)Common.pushRecentItems(eventData.fromService,eventData.params);else if("PushNotification"===eventType)Common.showCommonNotification(eventData.notifyData.type,eventData.notifyData,eventData.fromService);else if("AddNewUIElement"===eventType)CRMPlusCommonUi.appendNewUIElement(eventData.uitype,eventData.json,eventData.fromService);else if("RemoveUIElement"===eventType)CRMPlusCommonUi.removeUIElement(eventData.uitype,eventData.key,eventData.fromService);else if("ShowChatNotification"===eventType){var notifyData=eventData.notifyData;if("INVITESUPPORTREP"==notifyData.MODE||"INVITESUPPORTREP"==notifyData.ACTION){var dataParams=notifyData.CPARAMS;dataParams.MODE="INVITESUPPORTREP",Common.showCommonNotification("chat",dataParams,eventData.fromService,"postmessage")}else if("NEWVISITOR"==notifyData.MODE)Common.showCommonNotification("chat",notifyData,eventData.fromService,"postmessage");else if("INVITETRANSFERCHAT"==notifyData.MODE||"INVITETRANSFERCHAT"==notifyData.ACTION)Common.showCommonNotification("chat",notifyData.CPARAMS,eventData.fromService,"postmessage");else if("HANDLEPICKUP"==notifyData.MODE||"CBHANDLER"==notifyData.MODE){var chid=notifyData.CHID||notifyData.chid;if(notifyData.CPARAMS){var dataParams=notifyData.CPARAMS;chid=dataParams.CHID||dataParams.chid}Common.removeNotificationComponent(chid,"chat",notifyData.MODE),"HANDLEPICKUP"==notifyData.MODE&&Common.broadCastMessageThroughStorage("crmplus_support_remove_chat_notification",JSON.stringify({chid:chid,serviceName:ZCPConstants.SERVICE_SUPPORT}))}else"SOUNDSTATUS"==notifyData.MODE&&Common.handleChatNotifictionSound(eventData.fromService,notifyData.MODE)}else if("HandleTopBarVisibility"===eventType){var status=eventData.status;status?(CRMPlusCommonUi.isTopBarHidden[eventData.fromService]=!1,CRMPlusCommonUi.showTopBar(eventData.fromService)):(CRMPlusCommonUi.isTopBarHidden[eventData.fromService]=!0,CRMPlusCommonUi.hideTopBar(eventData.fromService))}else if("SetLiveChatAgentStatus"===eventType)SidePanel.constructChatAgentStatus(eventData.fromService,eventData.status);else if("HandleKeyBoardShortCut"===eventType)Common.handleKeyBoardShortCut(eventData.pressedKeys);else if("CreateWMSChat"===eventType)WebMessanger.chat(eventData.zuid);else if("OnClickOnFreezeLayer"===eventType)CRMPlusCommonUi.search.hideSearchPopUp();else if("SetNotificationSound"===eventType)Common.setNotifictionSound(eventData.fromService,eventData.soundData);else if("SetPhoneAgentStatus"===eventType)try{eventData.statusData.has_access&&(SidePanel.updateAgentPhoneStatus(eventData.fromService,eventData.statusData.currentstatus),SidePanel.counstructAgentStatusOptions("phone",eventData.fromService,eventData.statusData.statuslist),SidePanel.counstructAgentOtherOptions("phone",eventData.fromService,eventData.statusData.otheroption),SidePanel.agentStatusInServices[eventData.fromService].phone.statuslist=eventData.statusData.statuslist)}catch(e){}else if("UpdatePhoneAgentStatus"===eventType)try{eventData.statusData.has_access&&(SidePanel.agentStatusInServices[eventData.fromService].phone.has_access?SidePanel.updateAgentPhoneStatus(eventData.fromService,eventData.statusData.currentstatus):SidePanel.getAgentStatus())}catch(e){}else if("ShowAddUser"===eventType)Common.zohoOneAddUsersURL?window.open(Services.getZohoOneAddUserURL(eventData.fromService),"_blank"):AdminPanel.apps.showAddUser(eventData.fromService,eventData.departmentID);else if("RemoveAgentStatus"===eventType)SidePanel.removeAgentStatus(eventData.fromService,eventData.channel);else if("HideCrmPlusDialog"===eventType)hidePanel(),CRMPlusCommonUi.search.hideSearchPopUp();else if("ChangeBrowserTitle"===eventType)CRMPlusCommonUi.browserTitle.setForService(eventData.fromService,eventData.title);else if("changeView"===eventType)eventData.viewType="normal"===eventData.viewType?"crmplus":eventData.viewType,CRMPlusCommonUi.initTopBar(eventData.viewType,eventData.fromService);else if("updateSalesInboxConfigurationData"===eventType)Services.handleSalesInbox(eventData.configurationData);else if("showAppliedFiltersOnSearch"===eventType){var filtersData=eventData.filtersData;Services.showAppliedFiltersOnSearch(eventData.fromService,filtersData.searchtext,filtersData.filters)}else if("HandleHighlighting"===eventType)CRMPlusCommonUi.highlightEntity(eventData.fromService,eventData.uitype,eventData.key,eventData.canHighlight);else if(void 0!==eventType){var historyUrl=eventData.value,fromService=eventData.fromService;if(historyUrl&&"URLChange"===eventType){var isFirstTime=!1;Services.allCurrentUrl[fromService]=historyUrl,tempLoggingForURLChange[fromService]=!0,Services.isLoadedInIframe[fromService]||(ServiceCommunicator.resetTempLogs(fromService),isFirstTime=!0,Services.isLoadedInIframe[fromService]=!0,Services.onIframeUIReady(fromService),"salesiq"===fromService&&(void 0!==Common.tabIndex&&CRMPlusLocalStorage.setItem(Common.getTabID(),1),LiveDeskApi.init()),"crm"===fromService&&$j("#plusReminderIcon").show()),Services.currentView===fromService&&Services.currentErrorPage!==fromService&&(Hash.changeHistory(fromService,historyUrl,eventOrigin,!1),Services.handleServiceUrlChange(fromService,!0)),fromService!=ZCPConstants.SERVICE_SURVEY&&!TopBar.search.isValidURL(fromService,historyUrl)||CRMPlusUnifiedSearch.lastService!=fromService||(CRMPlusUnifiedSearch.isFilterClick=!1,"iframe-spinner"==Services.loadingType&&Services.hideLoading(fromService,"iframe-spinner")),fromService===ZCPConstants.SERVICE_SALESIQ&&isFirstTime&&(void 0==LiveDeskApi.focus||LiveDeskApi.canFocus)&&LiveDeskApi.handlePendingActions(),Services.canShowIframeOnURLChange(fromService)&&Services.getRedirectionUrl(fromService,!1,!1)}}}}},getCurrentServiceURL:function(serviceName,callBackFnName){var toPostMessage={};toPostMessage.type="GetCurrentURL",toPostMessage.callbackfunctionname=callBackFnName,this.sendMessage(serviceName,toPostMessage)},replaceServiceURL:function(serviceName,toReplaceURL){var toPostMessage={};toPostMessage.type="ReplaceCurrentURL",toPostMessage.toreplaceurl=toReplaceURL,this.sendMessage(serviceName,toPostMessage),Services.isLoadedInIframe[serviceName]=!1}},ServiceCommunicator.autoCorrectFrameURL=function(serviceName,serviceURL,currentFrameUrl){var hash=window.location.hash.trim();hash=hash.substring(1),hash=hash.replace("/getcpdata/","#");var loadedServiceUrl=serviceURL+"/"+hash,frameorigin=window.location.protocol+"//"+window.location.host;currentFrameUrl=currentFrameUrl.replace("&frameorigin="+frameorigin,"").replace("?frameorigin="+frameorigin,""),currentFrameUrl!==loadedServiceUrl&&currentFrameUrl.replace(serviceURL,"").length>2&&(ServiceCommunicator.action.replaceServiceURL(serviceName,loadedServiceUrl),Services.intialFrameLoad=!0)},ServiceCommunicator.triggerAction=function(serviceName,type,key,event){void 0!==event&&event.stopPropagation();var skipHidePanelType=["hideDialog","handleChatNotificationAction","updatePhoneAgentStatus","SetLiveChatAgentStatus","getdepartmentlist","getCurrentDefaultFilters","triggersearch","getSearchFilters"];-1===skipHidePanelType.indexOf(type)&&hidePanel();var toPostMessage={};toPostMessage.type="TriggerAction",toPostMessage.uitype=type,toPostMessage.key=key,ServiceCommunicator.action.sendMessage(serviceName,toPostMessage)},ServiceCommunicator.handleFreezerLayerVisibility=function(serviceName,status){var toPostMessage={};toPostMessage.type="FreezeLayerVisibility",toPostMessage.status=status,ServiceCommunicator.action.sendMessage(serviceName,toPostMessage)},ServiceCommunicator.handleSetup=function(serviceName,status,url,selectedModule){var toPostMessage={};toPostMessage.type="HandleSetup",toPostMessage.status=status,toPostMessage.url=url,toPostMessage.selectedModule=selectedModule,ServiceCommunicator.action.sendMessage(serviceName,toPostMessage)},ServiceCommunicator.crmplusUIReady=function(serviceName,windowObject){ServiceCommunicator.loadFrame.clearTimeOut(serviceName);var toPostMessage={};toPostMessage.type="CRMPlusUIReady",ServiceCommunicator.action.sendMessage(serviceName,toPostMessage,void 0,windowObject),tempLoggingForUIReady[serviceName]=!0},ServiceCommunicator.handlePendingUIReadyCalls=function(){if(null!=pendingServicesToSendUIReady){for(var i=0;i<pendingServicesToSendUIReady.length;i++){var serviceJson=pendingServicesToSendUIReady[i];ServiceCommunicator.crmplusUIReady(serviceJson.serviceName,serviceJson.windowObject)}pendingServicesToSendUIReady=null}},ServiceCommunicator.readTempLog=function(key){try{return sessionStorage.getItem("crmplus_"+key)}catch(e){}},ServiceCommunicator.resetTempLogs=function(serviceName){try{tempLoggingForURLChange[serviceName]=!1,tempLoggingForUIReady[serviceName]=!1,tempLoggingForInitCheck[serviceName]=!1;for(var i=0;i<ServiceCommunicator.tempKeysForAlersLogging.length;i++)sessionStorage.removeItem("crmplus_"+serviceName+"_"+ServiceCommunicator.tempKeysForAlersLogging[i]);tempLoggingForOnline[serviceName]=navigator.onLine}catch(e){}},SidePanel.provider={},SidePanel.availableStatuses={},SidePanel.canHideInHoverOut=!0,SidePanel.isChatFirstTime={support:!0,salesiq:!0},SidePanel.agentStatusInServices={},SidePanel.showQuickLinkEditDialog=function(event,obj,qid,qlink,type){event&&Common.stopEvents(event);var position;if("add"===type){if(!Services.canInsertQuickLink(!0))return;$j("#sidepanelqlinkupdate").removeClass("peventNone"),$j("#sidepanelqlinkupdate > span").text(I18N.getValue("button.save")),$j("#sidepanelqlinkdelete").hide(),$j("#sidepanelqlinkeditbox").val(""),$j("#sidepanelqlinkupdate").unbind("click"),$j("#sidepanelqlinkupdate").click(Services.addQuickLink),$j("#sidepanelqlinkcancel").unbind("click"),$j("#sidepanelqlinkcancel").click(function(event){event.stopPropagation(),SidePanel.hideQuickLinkEditDialog("add")}),$j("#addquicklinkicon").removeAttr("onmouseover"),qlink=window.location.href,position=$j(obj).offset(),position.top=position.top+6,position.left=position.left+12}else if("edit"===type){$j("#sidepanelqlinkupdate").removeClass("peventNone"),$j("#sidepanelqlinkdelete").removeClass("peventNone"),$j("#sidepanelqlinkdelete").show(),$j("#sidepanelqlinkupdate > span").text(I18N.getValue("crmplus.label.update")),$j("#sidepanelqlinkupdate").unbind("click"),$j("#sidepanelqlinkupdate").click(Services.updateQuickLink);var preqid=$j("#sidepanelqlinkeditbox").attr("qlid");$j("#quicklink_"+preqid+" i").removeClass("pencilshow"),$j("#quicklink_"+qid+" i").addClass("pencilshow");var qlinkName=$j("#quicklink_"+qid).text();qlink=window.location.protocol+Common.productUrl+"/"+Common.currentPortalName+"/index.do#"+qlink,$j("#sidepanelqlinkeditbox").val(qlinkName),$j("#sidepanelqlinkeditbox").attr("qlid",qid),$j("#sidepanelqlinkcancel").unbind("click"),$j("#sidepanelqlinkcancel").click(function(event){event.stopPropagation(),SidePanel.hideQuickLinkEditDialog("edit")}),position=$j(obj).offset(),position.left=position.left+12}Common.canHidePanel=!1,SidePanel.canHideInHoverOut=!1,SidePanel.QuickLinkDialogType=type,$j("#sidepanelqlinkinedit").text(qlink);var qLinkEditBoxHeight=$j("#sidepanelqlinkedit").outerHeight();position.top+10+qLinkEditBoxHeight<=$j(window).outerHeight()?$j("#sidepanelqlinkedit").css("top",position.top+10):$j("#sidepanelqlinkedit").css("top",position.top-qLinkEditBoxHeight+10),$j("#sidepanelqlinkedit").css("left",position.left),$j("#sidepanelqlinkedit").fadeIn(400,function(){$j("#sidepanelqlinkeditbox").focus()})},SidePanel.hideQuickLinkEditDialog=function(type){if(void 0===type&&(type=SidePanel.QuickLinkDialogType),SidePanel.canHideInHoverOut=!0,"edit"===type){var qid=$j("#sidepanelqlinkeditbox").attr("qlid");$j("#quicklink_"+qid+" i").removeClass("pencilshow")}else"add"===type&&$j("#addquicklinkicon").attr("onmouseover","tooltip('"+I18N.getValue("crmplus.sidepanel.quicklinkhoveraddmessage")+"', event);");$j("#sidepanelqlinkedit").fadeOut(200,function(){$j("#sidepanelqlinkeditbox").val(""),$j("#sidepanelqlinkinedit").text("")}),SidePanel.QuickLinkDialogType=null,Common.canHidePanel=!0},SidePanel.crmplusQLinkPanelOnScroll=function(){SidePanel.hideQuickLinkEditDialog()},SidePanel.onMouseLeaveEventForSidePanel=function(){SidePanel.canHideInHoverOut&&(Common.canHideSidePanel=!0,setTimeout(function(){Common.canHideSidePanel&&SidePanel.hideQuickLinkEditDialog()},500))},SidePanel.reformatAgentMailData=function(mailData){var newMailData={statuslist:[{statustype:"Online",label:I18N.getValue("crmplus.sidepanel.agentstatus.common.online"),statuskey:"1"},{statustype:"Offline",label:I18N.getValue("crmplus.sidepanel.agentstatus.common.offline"),statuskey:"2"}]};if(mailData)try{if(newMailData.has_access=mailData.has_access,mailData.has_access){var list=newMailData.statuslist;0==mailData.agentstatus&&(mailData.agentstatus=2);for(var index in list){var statusObj=list[index];statusObj.statuskey==""+mailData.agentstatus&&(newMailData.currentstatus=statusObj)}}}catch(e){}return newMailData},SidePanel.reformatAgentPhoneData=function(serviceName,phoneData){if(phoneData)try{phoneData.statuslist&&(SidePanel.agentphonestatuslist={},SidePanel.agentphonestatuslist[serviceName]=JSON.parse(JSON.stringify(phoneData.statuslist)),phoneData.currentstatus?(phoneData.currentmodekey=phoneData.currentstatus.modekey,phoneData.statuslist=SidePanel.getPhoneAgentStatusList(serviceName,phoneData.currentstatus.modekey)):(delete phoneData.statuslist,delete phoneData.currentstatus))}catch(e){}return phoneData},SidePanel.getPhoneAgentStatusList=function(serviceName,modeKey){var list=SidePanel.agentphonestatuslist[serviceName];for(var i in list){var modeObj=list[i];if(modeObj.modekey==modeKey)return modeObj.options}},SidePanel.getPhoneAgentStatusObj=function(serviceName,modeKey,statusKey){var list=SidePanel.agentphonestatuslist[serviceName];for(var i in list){var modeObj=list[i];if(modeObj.modekey==modeKey)for(var j in modeObj.options){var statusObj=modeObj.options[j];if(statusObj.statuskey==statusKey)return statusObj}}},SidePanel.getAgentStatus=function(){var servicesSoidJson={};servicesSoidJson=Services.getServiceSoid(["crm","support"],!0);var servicesZsoidActions={};for(var service in servicesSoidJson){var actions=["getagentstatus"];"crm"===service&&null==Services.isSalesInboxConfigured&&actions.push("getsalesinboxstatus"),servicesZsoidActions[service]={zsoid:servicesSoidJson[service],actions:actions}}var params={};params.serviceszsoidactions=JSON.stringify(servicesZsoidActions),$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/getappproperties.do",data:params,dataType:"json",success:function(data){void 0!==data.getsalesinboxstatus&&void 0!==data.getsalesinboxstatus.crm&&Services.handleSalesInbox(data.getsalesinboxstatus.crm),data.hasOwnProperty("getagentstatus")&&SidePanel.handleAgentStatus(data)},error:function(){$j("#sidepanelagentstatusdialog").hide()}})},SidePanel.handleAgentStatus=function(data){if(data.hasOwnProperty("getagentstatus")){SidePanel.agentStatusInServices=data.getagentstatus;for(var serviceName in SidePanel.agentStatusInServices){void 0!=SidePanel.agentStatusInServices[serviceName].mail&&(SidePanel.agentStatusInServices[serviceName].mail=SidePanel.reformatAgentMailData(SidePanel.agentStatusInServices[serviceName].mail)),void 0!=SidePanel.agentStatusInServices[serviceName].phone&&SidePanel.agentStatusInServices[serviceName].phone.has_mode&&(SidePanel.agentStatusInServices[serviceName].phone=SidePanel.reformatAgentPhoneData(serviceName,SidePanel.agentStatusInServices[serviceName].phone));var serviceJson=SidePanel.agentStatusInServices[serviceName];for(var channel in serviceJson)try{var channelJson=serviceJson[channel];if(1==channelJson.has_access&&"mail"!==channel&&($(serviceName+"LoadFrame")||Services.loadFrame(serviceName,void 0,!1,!1)),"chat"!=channel)if("phone"===channel)channelJson.hasOwnProperty("provider")&&(SidePanel.provider[serviceName]=channelJson.provider),1==channelJson.has_access&&SidePanel.updateAgentPhoneStatus(serviceName,channelJson.currentstatus),SidePanel.counstructAgentStatusOptions(channel,serviceName,channelJson.statuslist),SidePanel.counstructAgentOtherOptions(channel,serviceName,channelJson.otheroption),SidePanel.updateAgentPhoneModeStatus(serviceName,channelJson.currentmodekey),delete channelJson.currentmodekey;else if(1==channelJson.has_access){var statusData=channelJson.currentstatus;statusData&&(SidePanel.showStatusUI(channel,serviceName),SidePanel.changeStatusesUI(channel,serviceName,statusData.statuskey,statusData.label,statusData.statustype)),SidePanel.counstructAgentStatusOptions(channel,serviceName,channelJson.statuslist)}}catch(e){}}}},SidePanel.counstructAgentStatusOptions=function(channel,serviceName,statusList){try{if(statusList&&statusList.length>0){$j("#sidepanelagent"+channel+serviceName+"statuslist").html(""),$j("#sidepanelagent"+channel+serviceName+"currentstatus").removeClass("zcrmp-phonereadonly");for(var index in statusList){var statusData=statusList[index],li=document.createElement("li");$j(li).text(statusData.label),"phone"==channel&&SidePanel.agentStatusInServices[serviceName][channel].isclientsideimpl?$j(li).attr("onclick","ServiceCommunicator.triggerAction('"+serviceName+"','updatePhoneAgentStatus', '"+statusData.statuskey+"', event);"):$j(li).attr("onclick","SidePanel.changeStatus('"+channel+"','"+serviceName+"','"+statusData.statuskey+"');"),$j("#sidepanelagent"+channel+serviceName+"statuslist").append(li)}}else $j("#sidepanelagent"+channel+serviceName+"currentstatus").hasClass("phonelogin")||$j("#sidepanelagent"+channel+serviceName+"currentstatus").addClass("zcrmp-phonereadonly")}catch(e){}},SidePanel.counstructAgentOtherOptions=function(channel,serviceName,otherOptions){try{if(otherOptions){if(otherOptions.preferences){var preferences=otherOptions.preferences;if($j("#sidepanelagent"+channel+serviceName+"preferencesicon").attr("onclick","SidePanel.showPhonePreferences('"+serviceName+"', '"+preferences.method+"', '"+preferences.key+"', event);"),$j("#sidepanelagent"+channel+serviceName+"preferencesicon").attr("onmouseover","tooltip('"+preferences.label+"', event);"),SidePanel.agentStatusInServices[serviceName].phone.has_mode){$j("#sidepanelagent"+channel+serviceName+"preferencesoptions").html(""),$j("#sidepanelagentphone"+serviceName+"preferencesicon").removeAttr("currentmodekey");for(var i in SidePanel.agentphonestatuslist[serviceName]){var modeObj=SidePanel.agentphonestatuslist[serviceName][i],li=document.createElement("li");$j(li).html('<i class="plus-tickIcon"></i>'+modeObj.label),$j(li).attr("id",channel+serviceName+"preferencesoption"+modeObj.modekey),$j(li).attr("onclick","SidePanel.updateAgentPhoneMode('"+serviceName+"', '"+modeObj.modekey+"');"),$j("#sidepanelagent"+channel+serviceName+"preferencesoptions").append(li)}}$j("#sidepanelagent"+channel+serviceName+"preferencesicon").show()}if(otherOptions.logout){var logout=otherOptions.logout,li=document.createElement("li");$j(li).text(logout.label),$j(li).attr("onclick","SidePanel.logoutPhoneAgent('"+serviceName+"','"+logout.method+"', '"+logout.key+"', event);"),$j("#sidepanelagent"+channel+serviceName+"statuslist").append(li)}}}catch(e){}},SidePanel.updateAgentPhoneStatus=function(serviceName,statusData){try{if(statusData)if(SidePanel.showStatusUI("phone",serviceName),"phonelogin"===statusData.statuskey)SidePanel.setAgentPhoneLogin(serviceName,statusData),$j("#sidepanelagentphone"+serviceName+"currentstatus").removeClass("zcrmp-phonereadonly");else{$j("#sidepanelagentphone"+serviceName+"currentstatus").removeClass("phonelogin"),$j("#sidepanelagentphone"+serviceName+"currentstatus").attr("onclick","SidePanel.showAgentStatusList(event, 'phone', '"+serviceName+"');");var modeKey=""+statusData.modekey;modeKey=modeKey.replace(".","");var statusKey=""+statusData.statuskey;SidePanel.updateAgentPhoneModeStatus(serviceName,modeKey),void 0===statusData.label&&SidePanel.agentStatusInServices[serviceName].phone.has_mode&&(statusData=SidePanel.getPhoneAgentStatusObj(serviceName,modeKey,statusKey)),SidePanel.changeStatusesUI("phone",serviceName,statusKey,statusData.label,statusData.statustype)}}catch(e){}},SidePanel.updateAgentPhoneModeStatus=function(serviceName,modeKey,canUpdateAgentStatus){if(modeKey&&$j("#sidepanelagentphone"+serviceName+"preferencesicon").attr("currentmodekey")!==modeKey&&"undefined"!==modeKey){$j("#sidepanelagentphone"+serviceName+"preferencesicon").attr("currentmodekey",modeKey),$j("#sidepanelagentphone"+serviceName+"preferencesoptions > li").removeClass("active"),$j("#phone"+serviceName+"preferencesoption"+modeKey).addClass("active");var statusList=SidePanel.getPhoneAgentStatusList(serviceName,modeKey);if(statusList&&(SidePanel.agentStatusInServices[serviceName].phone.statuslist=statusList,SidePanel.counstructAgentStatusOptions("phone",serviceName,statusList)),canUpdateAgentStatus){var statusObj=SidePanel.getStatusObjectByStatusType("phone",serviceName,"Online");SidePanel.updateAgentPhoneStatus(serviceName,statusObj)}}},SidePanel.logoutPhoneAgent=function(serviceName,logoutMethod,logoutKey,event){ServiceCommunicator.triggerAction(serviceName,logoutMethod,logoutKey,event)},SidePanel.loginPhoneAgent=function(serviceName,loginMethod,loginKey,event){ServiceCommunicator.triggerAction(serviceName,loginMethod,loginKey,event),Services.currentView!==serviceName&&Services.getRedirectionUrl(serviceName,!0)},SidePanel.showPhonePreferences=function(serviceName,preferencesMethod,preferencesKey,event){if(SidePanel.agentStatusInServices[serviceName].phone.has_mode){$j("#sidepanelagentphone"+serviceName+"preferencesoptions").show();var offset=$j("#sidepanelagentphone"+serviceName+"preferencesicon").offset(),position=$j("#sidepanelagentphone"+serviceName+"preferencesicon").position(),preferencesBoxHeight=$j("#sidepanelagentphone"+serviceName+"preferencesoptions").outerHeight();offset.top+18+preferencesBoxHeight<=$j(window).outerHeight()?$j("#sidepanelagentphone"+serviceName+"preferencesoptions").css("top",position.top+18):$j("#sidepanelagentphone"+serviceName+"tpreferencesoptions").css("top",position.top-preferencesBoxHeight)}else ServiceCommunicator.triggerAction(serviceName,preferencesMethod,preferencesKey,event),Services.currentView!==serviceName&&Services.getRedirectionUrl(serviceName,!0)},SidePanel.setAgentPhoneLogin=function(serviceName,statusData){statusData&&($j("#sidepanelagentphone"+serviceName+"currentstatus").addClass(statusData.statustype),$j("#sidepanelagentphone"+serviceName+"currentstatus>span").text(statusData.label),$j("#sidepanelagentphone"+serviceName+"currentstatus").attr("onclick","SidePanel.loginPhoneAgent('"+serviceName+"','"+statusData.method+"', '"+statusData.statuskey+"', event);"))},SidePanel.removeAgentStatus=function(serviceName,channel){$j("#sidepanelagent"+channel+serviceName+"status").hide(),$j("#sidepanelagent"+channel+"status").hide(),$j("#sidepanelagentstatusdialog").hide(),SidePanel.getAgentStatus()},SidePanel.showStatusUI=function(channel,serviceName){void 0==SidePanel.availableStatuses[serviceName]&&(SidePanel.availableStatuses[serviceName]={}),SidePanel.availableStatuses[serviceName][channel]=!0,$j("#sidepanelagentstatusdialog").show(),$j("#sidepanelagent"+channel+"status").show(),$j("#sidepanelagent"+channel+serviceName+"status").show()},SidePanel.changeStatusesUI=function(channel,serviceName,currentStatus,statusString,statusType){$j("#sidepanelagentstatusloading"+channel+serviceName).hide(),$j("#sidepanelagent"+channel+serviceName+"currentstatus").removeAttr("isloading"),$j("#sidepanelagent"+channel+serviceName+"currentstatus>span").text(statusString),$j("#sidepanelagent"+channel+serviceName+"currentstatus").removeClass("Online Offline Busy Idle"),$j("#sidepanelagent"+channel+serviceName+"currentstatus").addClass(statusType);var canSkipCurrentStatus=!1;if("phone"===channel){$j("#sidepanelagent"+channel+serviceName+"currentstatus").removeClass("phonelogin");var channelJson=SidePanel.agentStatusInServices[serviceName][channel];canSkipCurrentStatus=void 0===channelJson.statuslist||0==channelJson.statuslist.length}if(void 0===currentStatus||canSkipCurrentStatus||$j("#sidepanelagent"+channel+serviceName+"currentstatus").attr("currstatus",currentStatus),0===$j("#sidepanelagentstatusdialog [id^=sidepanelagent][id$=currentstatus][isloading]").length){var globalStatus=SidePanel.getGlobalStatus();$j("#sidepanelagentstatuscheckbox")[0].checked="Online"==globalStatus||"Idle"==globalStatus?!0:!1}1==Object.keys(SidePanel.availableStatuses).length&&1==Object.keys(SidePanel.availableStatuses[Object.keys(SidePanel.availableStatuses)[0]]).length?$j("#sidepanelagentstatustogglediv").hide():$j("#sidepanelagentstatustogglediv").show()},SidePanel.getGlobalStatus=function(){return $j("#sidepanelagentstatusdialog [id^=sidepanelagent][id$=currentstatus].Online:not([isloading])").length>0?"Online":$j("#sidepanelagentstatusdialog [id^=sidepanelagent][id$=currentstatus].Idle:not([isloading]").length>0?"Idle":$j("#sidepanelagentstatusdialog [id^=sidepanelagent][id$=currentstatus].Busy:not([isloading]").length>0?"Busy":$j("#sidepanelagentstatusdialog [id^=sidepanelagent][id$=currentstatus].Offline:not([isloading]").length>0?"Offline":void 0},SidePanel.handleAgentStatusCheckBox=function(element,event){event&&Common.stopEvents(event,!0),element.checked?SidePanel.changeStatus("all",void 0,1):SidePanel.changeStatus("all",void 0,0)},SidePanel.showAgentStatusList=function(event,channel,serviceName){event&&event.stopPropagation(),$j("#sidepanelagentstatusdialog [id^=sidepanelagent][id$=statuslist]").hide(),$j("#sidepanelagentstatusdialog  [id^=sidepanelagent][id$=preferencesoptions]").hide(),$j("#sidepanelagent"+channel+serviceName+"statuslist").show();var offset=$j("#sidepanelagent"+channel+serviceName+"currentstatus").offset(),position=$j("#sidepanelagent"+channel+serviceName+"currentstatus").position(),statusListBoxHeight=$j("#sidepanelagent"+channel+serviceName+"statuslist").outerHeight();offset.top+18+statusListBoxHeight<=$j(window).outerHeight()?$j("#sidepanelagent"+channel+serviceName+"statuslist").css("top",position.top+18):$j("#sidepanelagent"+channel+serviceName+"statuslist").css("top",position.top-statusListBoxHeight)},SidePanel.changeStatus=function(channel,serviceName,status){var statusJson={},serviceArray=[];if("all"===channel)for(var serviceKey in SidePanel.availableStatuses){serviceArray.push(serviceKey);var availableServiceJson=SidePanel.availableStatuses[serviceKey],serviceJson={};for(var channelKey in availableServiceJson){var currentStatus=$j("#sidepanelagent"+channelKey+serviceKey+"currentstatus").attr("currstatus"),statusToBeUpdated=""+SidePanel.getServiceStatusWithCommonStatus(channelKey,serviceKey,status);if("phone"==channelKey&&"undefined"!==statusToBeUpdated&&SidePanel.agentStatusInServices[serviceKey][channelKey].isclientsideimpl)ServiceCommunicator.triggerAction(serviceKey,"updatePhoneAgentStatus",statusToBeUpdated),$j("#sidepanelagent"+channelKey+serviceKey+"currentstatus").attr("isloading",!0);else if(void 0!==currentStatus&&"undefined"!==statusToBeUpdated&&currentStatus!=statusToBeUpdated){if("chat"==channelKey)SidePanel.setChatAgentStatus(serviceKey,statusToBeUpdated);else{var channelJson={};"phone"===channelKey&&(void 0!=SidePanel.provider[serviceKey]&&(channelJson.providername=SidePanel.provider[serviceKey]),$j("#sidepanelagentphone"+serviceKey+"preferencesicon").attr("currentmodekey")&&(channelJson.modekey=$j("#sidepanelagentphone"+serviceKey+"preferencesicon").attr("currentmodekey"))),channelJson.agentstatus=statusToBeUpdated,serviceJson[channelKey]=channelJson}$j("#sidepanelagentstatusloading"+channelKey+serviceKey).show(),$j("#sidepanelagent"+channelKey+serviceKey+"currentstatus").attr("isloading",!0)}}$j.isEmptyObject(serviceJson)||(statusJson[serviceKey]=serviceJson)}else{var currentStatus=$j("#sidepanelagent"+channel+serviceName+"currentstatus").attr("currstatus");if(void 0!==currentStatus&&void 0!==status&&currentStatus!=status){if("chat"==channel)SidePanel.setChatAgentStatus(serviceName,status);else{var serviceJson={};serviceJson[channel]={agentstatus:status},"phone"==channel&&(void 0!=SidePanel.provider[serviceName]&&(serviceJson[channel].providername=SidePanel.provider[serviceName]),$j("#sidepanelagentphone"+serviceName+"preferencesicon").attr("currentmodekey")&&(serviceJson[channel].modekey=$j("#sidepanelagentphone"+serviceName+"preferencesicon").attr("currentmodekey"))),statusJson[serviceName]=serviceJson,serviceArray.push(serviceName)}$j("#sidepanelagentstatusloading"+channel+serviceName).show(),$j("#sidepanelagent"+channel+serviceName+"currentstatus").attr("isloading",!0)}}$j.isEmptyObject(statusJson)||SidePanel.setAgentStatus(statusJson,Services.getServiceSoid(serviceArray))},SidePanel.getServiceStatusWithCommonStatus=function(channel,serviceName,status){if(0==status){if("chat"==channel)return ZCPConstants.CHAT_BUSY;var statusObj=SidePanel.getStatusObjectByStatusType(channel,serviceName,"Offline");return void 0==statusObj&&(statusObj=SidePanel.getStatusObjectByStatusType(channel,serviceName,"Busy")),statusObj?statusObj.statuskey:void 0}if(1==status){if("chat"==channel)return ZCPConstants.CHAT_AVAILABLE;var statusObj=SidePanel.getStatusObjectByStatusType(channel,serviceName,"Online");return statusObj?statusObj.statuskey:void 0}},SidePanel.updateAgentPhoneMode=function(serviceName,modeKey){var fd=new FormData,statusJson={};statusJson[serviceName]={phone:{modekey:modeKey,providername:SidePanel.provider[serviceName]}},fd.append("statusjson",JSON.stringify(statusJson)),fd.append("soidjson",JSON.stringify(Services.getServiceSoid([serviceName],!0))),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j("#sidepanelagentstatusloadingphone"+serviceName).show(),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updateagentstatus.do",data:fd,processData:!1,contentType:!1,dataType:"json",success:function(data){try{1==data[serviceName].phone?SidePanel.updateAgentPhoneModeStatus(serviceName,modeKey,!0):"200"===modeKey&&showStatusMsg("error",I18N.getValue("crmplus.sidepanel.agentstatus.overphonenotconfigured"),3e3)}catch(e){}},complete:function(){$j("#sidepanelagentstatusloadingphone"+serviceName).hide()},error:function(){showStatusMsg("error",I18N.getValue("service.creation.error.header"),3e3)}})},SidePanel.setAgentStatus=function(statusJson,soidJson){var fd=new FormData;fd.append("statusjson",JSON.stringify(statusJson)),fd.append("soidjson",JSON.stringify(soidJson)),fd.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get())),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/updateagentstatus.do",data:fd,processData:!1,contentType:!1,dataType:"json",success:function(data){for(var serviceKey in statusJson)try{var serviceJson=statusJson[serviceKey];for(var chanK in serviceJson){var currentStatus=$j("#sidepanelagent"+chanK+serviceKey+"currentstatus").attr("currstatus"),statusToBeUpdated=serviceJson[chanK].agentstatus;data[serviceKey][chanK]!==!0&&(statusToBeUpdated=currentStatus);var statusObj=SidePanel.getStatusObjectByStatusId(chanK,serviceKey,statusToBeUpdated);SidePanel.changeStatusesUI(chanK,serviceKey,statusToBeUpdated,statusObj.label,statusObj.statustype)}}catch(e){}},error:function(){for(var serviceKey in statusJson){var serviceJson=statusJson[serviceKey];for(var chanK in serviceJson)$j("#sidepanelagentstatusloading"+chanK+serviceKey).hide(),$j("#sidepanelagent"+chanK+serviceKey+"currentstatus").removeAttr("isloading")
}}})},SidePanel.setChatAgentStatus=function(serviceName,status){status==ZCPConstants.CHAT_AVAILABLE?"support"==serviceName?ServiceCommunicator.triggerAction(ZCPConstants.SERVICE_SUPPORT,"SetLiveChatAgentStatus",!0):"salesiq"==serviceName&&LiveDeskApi.setAgentAvailable():status==ZCPConstants.CHAT_BUSY&&("support"==serviceName?ServiceCommunicator.triggerAction(ZCPConstants.SERVICE_SUPPORT,"SetLiveChatAgentStatus",!1):"salesiq"==serviceName&&LiveDeskApi.setAgentBusy())},SidePanel.getStatusObjectByStatusId=function(channel,serviceName,statusId){try{if(void 0!==SidePanel.agentStatusInServices[serviceName]){var agentStatus=SidePanel.agentStatusInServices[serviceName][channel];if(void 0!==agentStatus.statuslist)for(var statusList=agentStatus.statuslist,i=0;i<statusList.length;i++){var statusObj=statusList[i];if(statusObj.statuskey===statusId)return statusObj}}}catch(e){}},SidePanel.getStatusObjectByStatusType=function(channel,serviceName,statusType){try{if(void 0!==SidePanel.agentStatusInServices[serviceName]){var agentStatus=SidePanel.agentStatusInServices[serviceName][channel];if(void 0!==agentStatus.statuslist)for(var statusList=agentStatus.statuslist,i=0;i<statusList.length;i++){var statusObj=statusList[i];if(statusObj.statustype===statusType)return statusObj}}}catch(e){}},SidePanel.constructChatAgentStatus=function(serviceName,statusCode){"support"==serviceName&&statusCode==ZCPConstants.CHAT_IDLE&&(statusCode=ZCPConstants.CHAT_AVAILABLE),void 0!==SidePanel.isChatFirstTime&&SidePanel.isChatFirstTime[serviceName]===!0&&(delete SidePanel.isChatFirstTime[serviceName],$j.isEmptyObject(SidePanel.isChatFirstTime)&&delete SidePanel.isChatFirstTime,SidePanel.showStatusUI("chat",serviceName));var statusString=SidePanel.getStatusString("chat",serviceName,statusCode),statusType=SidePanel.getStatusClass("chat",serviceName,statusCode);SidePanel.changeStatusesUI("chat",serviceName,statusCode,statusString,statusType)},SidePanel.getStatusString=function(channel,serviceName,status){if("chat"===channel){if(status==ZCPConstants.CHAT_AVAILABLE)return I18N.getValue("crmplus.sidepanel.agentstatus.common.available");if(status==ZCPConstants.CHAT_BUSY)return I18N.getValue("crmplus.sidepanel.agentstatus.common.busy");if(status==ZCPConstants.CHAT_IDLE)return I18N.getValue("crmplus.sidepanel.agentstatus.common.idle")}},SidePanel.getStatusClass=function(channel,serviceName,status){if("chat"===channel){if(status==ZCPConstants.CHAT_AVAILABLE)return"Online";if(status==ZCPConstants.CHAT_BUSY)return"Busy";if(status==ZCPConstants.CHAT_IDLE)return"Idle"}},SidePanel.initialiseStyles=function(styles,fromService){var topBar=styles.topbar;void 0!==topBar&&(TopBar.servicesTop[fromService]=topBar.top+topBar.height)};var TopBar={};TopBar.loadedServices=[],TopBar.previousService="crmplus",TopBar.type="crmplus",TopBar.search={isValidURL:function(serviceName,url){if(void 0==url)return!1;switch(void 0==serviceName&&(serviceName=Services.currentView),url=url.replace("#","/getcpdata/"),serviceName){case"salesiq":return-1!==url.indexOf("/getcpdata/search");case"support":return-1!==url.indexOf("/search/")||-1!==url.indexOf("advsearch");case"crm":return-1!==url.indexOf("/search");case"campaigns":return-1!==url.indexOf("/getcpdata/gs/crmplus");case"social":return-1!==url.indexOf("/getcpdata/connectionssearch");case"projects":return-1!==url.indexOf("/getcpdata/searchresult");case"survey":return-1!==url.indexOf("isSurveySearch=true")}},handleClose:function(){TopBar.type="crmplus",$j("#crmpluscommonuisearchtext").val(""),$j("body").removeClass("zcrmp-searchPanel");for(var key in CRMPlusCommonUi.search.isAdvancedSearchView)CRMPlusCommonUi.search.isAdvancedSearchView[key]===!0&&CRMPlusCommonUi.search.hideAutoSuggestView(key);if(CRMPlusCommonUi.search.canSearch={},CRMPlusCommonUi.search.isAdvancedSearchView={},CRMPlusCommonUi.search.UIType=null,CRMPlusCommonUi.isSearchViewInServices={},$j("#searchcommonuileftpanelswitch").hide(),Services.loadFrame(Services.currentView),Services.currentView==ZCPConstants.SERVICE_SUPPORT){var url=Services.currentUrl[Services.currentView];void 0==url&&(url=Services.configuredServicesData[Services.currentView].URL),Services.loadUrlInIframe(Services.currentView,url,!0,!0)}}},TopBar.setup={init:function(){$j("#commontopbar").css("top",-1*$j("#commontopbar").outerHeight(!0)),$j("#commontopbar").show()},getDefaultURL:function(serviceName){switch(serviceName){case"support":return Services.getServiceUrl("support","support/#PORTALNAME#/ShowHomePage.do#setup");case"salesiq":return Services.getServiceUrl("salesiq","salesiq/#PORTALNAME#/index/getcpdata/setting/user");case"crm":return Services.getServiceUrl("crm","crm/ShowTab.do?module=Setup");case"campaigns":return Services.getServiceUrl("campaigns","campaigns/home.do#settings");case"social":return Services.getServiceUrl("social","social/#PORTALNAME#/Home.do#adminsettings");case"reports":return Services.getServiceUrl("reports","reports/ZDBPricing.cc?SHOWPAGE=CurrentPlanDetails&STRUCT=true&ZDBACTION=USERPLANDETAILS&from_service=crmplus&soid=#SOID#");case"projects":return Services.getServiceUrl("projects","portal/#PORTALNAME##setup");case"motivator":return Services.getServiceUrl("motivator","motivator/settings");case"survey":return Services.getServiceUrl("survey","survey/home.do?from_service=crmplus&soid=#SOID##setup");case"salesinbox":return Services.getServiceUrl("salesinbox","crm/ShowSetup.do?tab=comm&subTab=emailSettings&action=imap&isFromSI=true")}},isValidURL:function(serviceName,url){if(void 0===url)return!1;switch(url=url.replace("#","/getcpdata/"),serviceName){case"salesiq":return-1!==url.indexOf("/setting/");case"support":return-1!==url.indexOf("/SetupPageLayout.do")||-1!==url.indexOf("/getcpdata/setup");case"crm":return-1!==url.indexOf("module=Setup")||-1!==url.indexOf("/ShowSetup.do")||-1!==url.indexOf("/settings/");case"campaigns":return-1!==url.indexOf("/getcpdata/settings")||-1!==url.indexOf("#settings");case"social":return-1!==url.indexOf("settings");case"reports":return-1!==url.indexOf("/ZDBPricing.cc");case"projects":return-1!==url.indexOf("/getcpdata/profiles")||-1!==url.indexOf("/getcpdata/role")||-1!==url.indexOf("/getcpdata/gamification")||-1!==url.indexOf("/getcpdata/tasklayouts")||-1!==url.indexOf("/getcpdata/portalclients")||-1!==url.indexOf("/getcpdata/portalusers")||-1!==url.indexOf("/getcpdata/bugsettings")||-1!==url.indexOf("/getcpdata/custtabs")||-1!==url.indexOf("/getcpdata/projinfo")||-1!==url.indexOf("/getcpdata/managegroups")||-1!==url.indexOf("/getcpdata/fieldsettings")||-1!==url.indexOf("/getcpdata/emailsettings")||-1!==url.indexOf("/getcpdata/userprofile")||-1!==url.indexOf("/getcpdata/setup");case"motivator":return-1!==url.indexOf("settings");case"survey":return-1!==url.indexOf("/getcpdata/setup")||-1!==url.indexOf("/setup/")}},getDefaultService:function(){return null!==Services.currentView&&"crmplus"!==Services.currentView&&"adminpanel"!==Services.currentView?Services.currentView:Services.getFirstService()},construct:function(){var label=Services.nameArray.slice();label.push("adminpanel"),TopBar.construct(label,!1)},show:function(){$j("#commontopbar").animate({top:"0px"})},handleClose:function(){TopBar.type="crmplus";var previousService=TopBar.previousService;(void 0==previousService||"adminpanel"==previousService)&&(previousService=this.getDefaultService()),"adminpanel"==Services.currentView&&AdminPanel.layout.hide(),Services.getRedirectionUrl(previousService,!0)},hide:function(){$j("#commontopbar").animate({top:-1*$j("#commontopbar").outerHeight(!0)+"px"})},getTop:function(){return 0},showLoading:function(){showLoading()},hideLoading:function(){hideLoading()},onBeforeLoad:function(){},getHeight:function(){return $j("#commontopbar").length>0?$j("#commontopbar").outerHeight(!0):0}},TopBar.showTopBar=function(type,service){"setup"==type&&(CRMPlusCommonUi.hideLeftPanel(),CRMPlusCommonUi.handleChatBarSize(!0)),"adminpanel"===service?TopBar.previousService=Services.currentView:void 0!==service&&(TopBar.previousService=service),TopBar.type=type,CRMPlusCommonUi.initTopBar(type,service)},TopBar.loadTopBar=function(type,serviceName,URL){type!==this.type?(void 0===serviceName&&(serviceName=this[type].getDefaultService()),this.showTopBar(type,serviceName),void 0===URL&&(URL=this[type].getDefaultURL(serviceName)),TopBar[type].onBeforeLoad(),"setup"==TopBar.type&&Services.isLoadedInIframe[serviceName]===!0?("setup"===TopBar.type&&-1===TopBar.loadedServices.indexOf(serviceName)&&TopBar.loadedServices.push(serviceName),ServiceCommunicator.handleSetup(serviceName,!0,Services.serviceUrl.processFrameURL(serviceName,URL))):"setup"==TopBar.type&&"adminpanel"==serviceName?(Services.onBeforeFrameLoad(serviceName),void 0===URL&&AdminPanel.layout.show()):Services.getRedirectionUrl(serviceName,!0,!1,URL)):Services.getRedirectionUrl(serviceName,!0,!1,URL,"getting-started"),Common.handleWindowSize()},TopBar.handleClickOnServices=function(serviceName){Services.currentView!==serviceName&&(void 0!==TopBar[TopBar.type]&&Services.isLoadedInIframe[serviceName]!==!0?Services.getRedirectionUrl(serviceName,!0,!1,this[TopBar.type].getDefaultURL(serviceName),"iframe-spinner"):TopBar[TopBar.type].isValidURL(serviceName,Services.allCurrentUrl[serviceName])?Services.getRedirectionUrl(serviceName,!0):(Services.hideServiceIframe(Services.currentView),Services.onBeforeFrameLoad(serviceName,!0),"setup"===TopBar.type&&-1===TopBar.loadedServices.indexOf(serviceName)&&TopBar.loadedServices.push(serviceName),ServiceCommunicator.handleSetup(serviceName,!0,Services.serviceUrl.processFrameURL(serviceName,this[TopBar.type].getDefaultURL(serviceName)))))},TopBar.onClose=function(){null===TopBar.previousService&&(TopBar.previousService=Services.currentView),TopBar[this.type].handleClose(),TopBar.resetToDefault()},TopBar.resetToDefault=function(){TopBar.type="crmplus",Common.canTreatLeftPanelVisible()&&CRMPlusCommonUi.showLeftPanel(),Common.handleWindowSize()},TopBar.construct=function(labelObject,isCustomLabel){if($j("#commontopbar li").hide(),isCustomLabel)for(var index in labelObject)Services.hasServiceAccess(index)&&($j("#commontopbar"+index).show(),$j("#commontopbar"+index).text(labelObject[index]));else for(var index in labelObject)Services.hasServiceAccess(labelObject[index])&&TopBar.showServiceSetupLabel(labelObject[index])},TopBar.showServiceSetupLabel=function(serviceName){if($j("#commontopbar"+serviceName).show(),"adminpanel"!==serviceName){var href="#"+TopBar.setup.getDefaultURL(serviceName);$j("#commontopbar"+serviceName+" > a").attr("href",href)}},TopBar.gettingStarted={getTop:function(){var top=0;return $j(".zcrmp-servicesAvail:visible").length>0?top=$j(".zcrmp-servicesAvail:visible").position().top:$j("#getting-started-frame  .zcrmp-ifgsTopPan").length>0&&(top=$j("#getting-started-frame  .zcrmp-ifgsTopPan").height()),top},hide:function(){},isValidURL:function(){return!0},construct:function(){},init:function(){},show:function(){$j("#getting-started-frame").show(),$j("#getting-started-frame-cont").hide()},getDefaultService:function(){return Setup.currentService},getDefaultURL:function(serviceName){return Services.serviceUrl.get(serviceName)},showLoading:function(){$j("#getting-started-frame-cont").show(),Common.showElement(void 0,"gsframeloading"),$j("#getting-started-frame-cont .js-setup-error").hide()},hideLoading:function(){$j("#getting-started-frame-cont").hide(),Common.hideElement("gsframeloading")},onBeforeLoad:function(){$j("#getting-started-frame").show(),Common.handleWindowSize()},handleClose:function(){if(TopBar.isHiding=!0,"crmplus"===TopBar.previousService)Services.getRedirectionUrl("crmplus",!0);else{var URL=Services.currentUrl[TopBar.previousService];if(void 0===URL){var serviceData=Services.configuredServicesData[TopBar.previousService];URL=serviceData.URL}Services.getRedirectionUrl(TopBar.previousService,!0,!1,URL)}},getHeight:function(){return $j(".zcrmp-servicesAvail:visible").length>0?$j(".zcrmp-servicesAvail:visible").outerHeight(!0):0}},LiveDeskApi.init=function(){LiveDeskApi.isInitialized||(this.scode=1,this.smsg="Available",this.setdomain=window.location.host,this.serverurl=document.location.protocol+"//"+window.location.host,this.WMS_IDLE=4,this.WMS_ONLINE=1,this.WMS_BUSY=3,LiveDeskApi.loadPostMessage(),LiveDeskApi.getCurrentVisitorsOnlineList(),LiveDeskApi.getAvailability(),LiveDeskApi.getCurrentSoundStatus(),LDUserIdleApi.init(),this.isInitialized=!0)},LiveDeskApi.setServerURL=function(url){this.serverurl=url},LiveDeskApi.setStatus=function(scode,smsg){this.scode=scode,this.smsg=smsg},LiveDeskApi.sendPostMessage=function(message){if(!Services.isLoadedInIframe.salesiq&&void 0!==message)return message.ISFROMCURRENTTAB=!1,void Common.broadCastMessageThroughStorage("crmplus_livedesk_sendpostmessage",JSON.stringify(message));try{var frame=document.getElementById("salesiqLoadFrame");frame.contentWindow.postMessage?frame.contentWindow.postMessage(JSON.stringify(message),"*"):alert(LSResource.getRealValue("infomsg.postmessage.failuremsg"))}catch(exp){}return!1},LiveDeskApi.loadPostMessage=function(){window.addEventListener?addEventListener("message",LiveDeskApi.handlePostMessage,!1):attachEvent("onmessage",LiveDeskApi.handlePostMessage)},LiveDeskApi.handlePostMessage=function(ev){try{if(ev.origin==LiveDeskApi.serverurl){if(Common.canCommunicateThroughStorage()){var dataJson={origin:ev.origin,data:ev.data};Common.broadCastMessageThroughStorage("crmplus_livedesk_receivepostmessage",JSON.stringify(dataJson))}var postmessage=ev.data,cobj=LiveDeskApi.parseJSON(postmessage);if("INVITESUPPORTREP"==cobj.MODE||"INVITESUPPORTREP"==cobj.ACTION){var dataParams=cobj.CPARAMS;dataParams.MODE="INVITESUPPORTREP",Common.showCommonNotification("chat",dataParams,ZCPConstants.SERVICE_SALESIQ,"postmessage")}else if("NEWVISITOR"==cobj.MODE)Common.showCommonNotification("chat",cobj,ZCPConstants.SERVICE_SALESIQ,"postmessage");else if("INVITETRANSFERCHAT"==cobj.MODE||"INVITETRANSFERCHAT"==cobj.ACTION)Common.showCommonNotification("chat",cobj.CPARAMS,ZCPConstants.SERVICE_SALESIQ,"postmessage");else if("HANDLEPICKUP"==cobj.MODE||"HANDLETRANSFERPENDING"==cobj.MODE||"REMOVEPROACTIVEPOPUP"==cobj.MODE){var chid=cobj.CHID||cobj.chid;Common.removeNotificationComponent(chid,"chat",cobj.MODE),"HANDLEPICKUP"==cobj.MODE&&Common.broadCastMessageThroughStorage("crmplus_salesiq_remove_chat_notification",JSON.stringify({chid:chid,serviceName:ZCPConstants.SERVICE_SALESIQ}))}else if("SOUNDSTATUS"==cobj.MODE)Common.handleChatNotifictionSound(ZCPConstants.SERVICE_SALESIQ,cobj.SOUND);else if("USERPRESENCE"==cobj.MODE)LiveDeskApi.setStatus(cobj.SCODE,cobj.SMSG),LiveDeskApi.handleAvailabilityChange(cobj.SCODE,cobj.SMSG);else if("HANDLEPRESENCE"==cobj.MODE)LiveDeskApi.handlePresence(cobj.SCODE,cobj.SMSG,cobj.ZUID);else if("INACTIVEPERIOD"==cobj.MODE)LDUserIdleApi.setTime(60*parseInt(cobj.TIME||30)*1e3);else if("VisitorLeft"==cobj.MODE){for(var jsonObjectArr=cobj.JSON,i=0;i<jsonObjectArr.length;i++){var jsonObject=jsonObjectArr[i];void 0!==jsonObject.uvid&&LiveDeskApi.handleVisitorLeft(jsonObject)}var visitorCount=$j("#crmpluscommonui_visitors_container > div").not("#crmpluscommonui_visitors_container_nodatamsg").length;visitorCount>0?(visitorCount>99&&(visitorCount="99+"),$j("#plusVisitorsCount, #plusvisitorscountonpaneltop").html(visitorCount),$j("#plusvisitorscountonpaneltop").show(),$j("#plusVisitorIcon").hasClass("selected")||$j("#plusVisitorsCount").show()):($j("#plusVisitorsCount, #plusvisitorscountonpaneltop").html(visitorCount),$j("#plusVisitorsCount, #plusvisitorscountonpaneltop").hide())}else if("NewVisitor"==cobj.MODE){var jsonObjectArr=cobj.JSON;Common.populateVisitorData(jsonObjectArr)}else if("PageUpdate"==cobj.MODE||"InfoUpdate"==cobj.MODE)for(var jsonObjectArr=cobj.JSON,i=0;i<jsonObjectArr.length;i++){var jsonObject=jsonObjectArr[i];void 0!==jsonObject.uvid&&LiveDeskApi.handleVisitorUpdate(jsonObject)}else if("VisitorsOnline"==cobj.MODE){var cobjJsonArr=cobj.JSON;cobjJsonArr.length>0&&Common.populateVisitorData(cobjJsonArr)}else if("CHATSTATUS"==cobj.MODE){if(Common.canCommunicateThroughStorage()){try{Common.log(ZCPConstants.RECEIVED_CHAT_STATUS+"--"+cobj.CHID)}catch(e){}Common.broadCastMessageThroughStorage("crmplus_livedesk_handle_salesiq_pending",JSON.stringify(cobj))}}else if("CHATFOCUSED"===cobj.MODE&&void 0!==LiveDeskApi.focus&&LiveDeskApi.focus.chid===cobj.CHID){try{Common.log(ZCPConstants.RECEIVED_CHAT_FOCUSED+"--"+cobj.CHID)}catch(e){}LiveDeskApi.isFocusedChatUIReady=!0,Services.isLoadedInIframe.salesiq&&Services.currentView===ZCPConstants.SERVICE_SALESIQ&&Services.getRedirectionUrl(ZCPConstants.SERVICE_SALESIQ,!1,!1),delete LiveDeskApi.focus,delete LiveDeskApi.pendingChatData,delete LiveDeskApi.canFocus}}}catch(exp){}},LDUserIdleApi.updateIdle=function(){try{if(LDUserIdleApi.prevscode==LiveDeskApi.WMS_IDLE||LDUserIdleApi.updating||LiveDeskApi.scode==LiveDeskApi.WMS_IDLE||LiveDeskApi.scode==LiveDeskApi.WMS_BUSY)return;var smsg=LiveDeskApi.smsg;smsg="Available"==smsg||"Busy"==smsg||"Idle"==smsg?"Idle":smsg,LDUserIdleApi.prevscode=LiveDeskApi.scode,LDUserIdleApi.setUpdating(!0)}catch(exp){}LiveDeskApi.setStatus(LiveDeskApi.WMS_IDLE,smsg),LiveDeskApi.setAgentIdle()},LDUserIdleApi.init=function(){LDUserIdleApi.idletime=12e4;var ldmsgobj={};ldmsgobj.MODE="GETINACTIVEPERIOD",LiveDeskApi.sendPostMessage(ldmsgobj),LDUserIdleApi.idletimer=-1,void 0==LDUserIdleApi.prevscode&&(LDUserIdleApi.prevscode=1),void 0==LDUserIdleApi.updating&&(LDUserIdleApi.updating=!1),window.addEventListener?(document.addEventListener("keydown",LDUserIdleApi.active,!0),document.addEventListener("keypress",LDUserIdleApi.active,!0),document.addEventListener("mouseout",LDUserIdleApi.active,!0),document.addEventListener("mouseenter",LDUserIdleApi.active,!0),window.addEventListener("scroll",LDUserIdleApi.active,!0),document.addEventListener("click",LDUserIdleApi.active,!0)):(document.attachEvent("onkeydown",LDUserIdleApi.active),document.attachEvent("onclick",LDUserIdleApi.active),document.attachEvent("onkeypress",LDUserIdleApi.active),window.attachEvent("onscroll",LDUserIdleApi.active),document.attachEvent("onmouseout",LDUserIdleApi.active),document.attachEvent("onmouseenter",LDUserIdleApi.active))},LDUserIdleApi.setTime=function(time){LDUserIdleApi.idletime=time},LDUserIdleApi.getTime=function(){return LDUserIdleApi.idletime},LDUserIdleApi.setStatus=function(scode){scode==LiveDeskApi.WMS_IDLE?LDUserIdleApi.init():(LDUserIdleApi.init(),LDUserIdleApi.active())},LDUserIdleApi.setUpdating=function(value){value?(LDUserIdleApi.updating=!0,setTimeout(function(){LDUserIdleApi.updating=!1},1e4)):LDUserIdleApi.updating=!1},LDUserIdleApi.active=function(){try{if(clearTimeout(LDUserIdleApi.idletimer),LDUserIdleApi.getTime()>0&&(LDUserIdleApi.idletimer=setTimeout(LDUserIdleApi.updateIdle,LDUserIdleApi.getTime())),LiveDeskApi.scode==LiveDeskApi.WMS_IDLE&&0==LDUserIdleApi.updating){var smsg=LiveDeskApi.smsg;"Idle"==smsg&&LDUserIdleApi.prevscode==LiveDeskApi.WMS_ONLINE?smsg="Available":"Idle"==smsg&&LDUserIdleApi.prevscode==LiveDeskApi.WMS_BUSY&&(smsg="Busy"),LDUserIdleApi.setUpdating(!0);var ldmsgobj={};ldmsgobj.MODE="SETACTIVE",LiveDeskApi.sendPostMessage(ldmsgobj),LiveDeskApi.setStatus(LDUserIdleApi.prevscode,smsg)}}catch(exp){}},LiveDeskApi.setAgentAvailable=function(){var ldmsgobj={};ldmsgobj.MODE="SetStatus",ldmsgobj.STATUS="Available",LiveDeskApi.sendPostMessage(ldmsgobj)},LiveDeskApi.setAgentBusy=function(){var ldmsgobj={};ldmsgobj.MODE="SetStatus",ldmsgobj.STATUS="Busy",LiveDeskApi.sendPostMessage(ldmsgobj)},LiveDeskApi.setAgentIdle=function(){var ldmsgobj={};ldmsgobj.MODE="SetStatus",ldmsgobj.STATUS="Idle",LiveDeskApi.sendPostMessage(ldmsgobj)},LiveDeskApi.initiateChat=function(vs_uvid){Services.getRedirectionUrl("salesiq",!0),Services.isLoadedInIframe.salesiq?setTimeout(function(){var ldmsgobj={};ldmsgobj.MODE="SHOWUTSDETAILS",ldmsgobj.uvid=vs_uvid,LiveDeskApi.sendPostMessage(ldmsgobj)},500):LiveDeskApi.chatFromVisitorsOnline=vs_uvid},LiveDeskApi.handleAvailabilityChange=function(scode){SidePanel.constructChatAgentStatus("salesiq",scode)},LiveDeskApi.parseJSON=function(obj){return jQuery.isPlainObject(obj)||"string"!=typeof obj||(obj=JSON.parse(obj)),obj},LiveDeskApi.parseJSONForPostMessage=function(value){return Object.toJSON?Object.toJSON(value):JSON.stringify(value)},LiveDeskApi.handleVisitorLeft=function(cobjJson){var visitorId=cobjJson.uvid,visitorContainer=$j("#visitoronline"+visitorId);void 0!==visitorContainer&&(visitorContainer.remove(),clearInterval(Common.countUpTimerReferences[visitorId]),delete Common.countUpTimerReferences[visitorId],1===$j("#crmpluscommonui_visitors_container > div").length&&$j("#crmpluscommonui_visitors_container_nodatamsg").show())},LiveDeskApi.handleVisitorUpdate=function(cobjJson){var visitorId=cobjJson.uvid,visitorContainer=$j("#visitoronline"+visitorId);if(void 0!==visitorContainer){if(void 0!==cobjJson.pagevisited){var message,count=cobjJson.pagevisited;message=count>1?"pages Visited":"page visited",message=count+" "+message,$j("#pagevisitscount"+visitorId).html(message)}void 0!==cobjJson.pageTitle&&$j("#pagetitle"+visitorId).html(cobjJson.pageTitle),void 0!==cobjJson.visitorname&&$j("#visitorname"+visitorId).html(cobjJson.visitorname)}},LiveDeskApi.handlePendingActions=function(){if(void 0!==LiveDeskApi.focus&&LiveDeskApi.canFocus){var messageToFocus=LiveDeskApi.pendingChatData;void 0==messageToFocus&&(messageToFocus={}),messageToFocus.MODE="FOCUSCHAT",LiveDeskApi.sendPostMessage(messageToFocus);try{var co=window.console;co.log("Focussing chat-->"+messageToFocus.CHID)}catch(e){}delete LiveDeskApi.pendingChatData,delete LiveDeskApi.canFocus}void 0!==LiveDeskApi.chatFromVisitorsOnline&&(LiveDeskApi.initiateChat(LiveDeskApi.chatFromVisitorsOnline),delete LiveDeskApi.chatFromVisitorsOnline)},LiveDeskApi.getCurrentVisitorsOnlineList=function(){var ldmsgobj={};ldmsgobj.MODE="GETVISITORONLINE",LiveDeskApi.sendPostMessage(ldmsgobj)},LiveDeskApi.getAvailability=function(){var ldmsgobj={};ldmsgobj.MODE="GETUSERSTATUS",LiveDeskApi.sendPostMessage(ldmsgobj)},LiveDeskApi.getCurrentSoundStatus=function(){var ldmsgobj={};ldmsgobj.MODE="GETSOUNDSTATUS",LiveDeskApi.sendPostMessage(ldmsgobj)},Setup.moduleCount=8,Setup.currentService="",Setup.actionsProperties={crm:{dataimport:{URL:"/crm/ShowSetup.do?tab=data&subTab=migrate",ID:"setupshow"},lead_generation_form:{URL:"/crm/ShowSetup.do?tab=webInteg&subTab=webLeads",ID:"setupshow"}},support:{dataimport:{URL:"/support/#PORTALNAME#/ImportWizard.do?step=1",ID:"middle_container"},web_to_tickets_form:{URL:"/support/#PORTALNAME#/WebToEntityForm.do?module=Cases&formType=web_to_request_form",ID:"middle_container"},support_email:{URL:"/support/#PORTALNAME#/MailAlias.do",ID:"middle_container"}},campaigns:{mailing_list:{URL:"/campaigns/home.do#contacts/list",ID:"campaignInnerContents"},signup_form:{URL:"/campaigns/home.do#contacts/list",ID:"campaignInnerContents"}},survey:{survey_form:{URL:"/",ID:"zs_home_page"}},onezoho:{invite_users:{URL:"/crmplus/#PORTALNAME#/home#/users/new",ID:""}}},Setup.module={fetch:function(moduleName,isManual,returnData,successCalback){var params={},loadingContainer="";void 0!=moduleName&&(params={modulename:moduleName}),isManual&&(params={ismanual:isManual},loadingContainer=ZCPConstants.productLoadingId,$j("#getting-started-link").addClass("peventNone")),$j.ajax({type:"GET",data:params,url:"/"+Common.currentPortalName+"/gettingstarted.do",dataType:"text",loadingParams:{type:"global"},success:function(data){return returnData?data:(Setup.module.initialize(data,moduleName),void(void 0!=successCalback&&successCalback()))},complete:function(){hideLoading(),$j(".zcrmp-gs-steps").removeClass("peventNone"),isManual&&$j("#getting-started-link").removeClass("peventNone")}})},show:function(moduleName,element){var directModules=["invite_users","support_email","mailing_list"],internalModules=["invite_users","company_info","website"];if("getting-started"==moduleName||"apps"==moduleName){var linkTab=$j("#li-getting-started-1 a");return"apps"===moduleName&&(linkTab=$j("#li-getting-started-2 a")),void($j("#getting-started-ul li").length>0?($j("#getting-started").removeClass("zoomOutt"),$j("#getting-started").show(),linkTab.click()):Setup.module.fetch(void 0,!0,void 0,function(){linkTab.click()}))}if(element=$j("[id^="+element.getAttribute("id")+"]"),addSelected(element),$j('[class^="js-setup"]').hide(),$j("#getting-started-frame-cont").hide(),$j(".js-setup-"+moduleName).length>0){if(Setup.currentService="crmplus",Common.hideElement("gsloading"),$j(".js-setup-"+moduleName).show(),-1!=internalModules.indexOf(moduleName)&&Services.loadFrame("crmplus",void 0,void 0,void 0,"getting-started"),"company_info"==moduleName||"website"==moduleName){var height=$j(window).height()-$j("#getting-started-frame .zcrmp-ifgsTopPan").outerHeight();$j("#getting-started-frame-cont").outerHeight(height),$j("#getting-started-frame-cont").show()}if($j("#getting-started-frame-module:visible").length>0)if($j("#getting-started-frame-module .js-setup-"+moduleName+" li").length>0){var selectedAction=$j("#getting-started-frame-module .js-setup-"+moduleName+" li.selected");actionElement=selectedAction.length>0?selectedAction[0]:$j("#getting-started-frame-module .js-setup-"+moduleName+" li:first"),actionElement.click()}else-1!=directModules.indexOf(moduleName)&&(serviceName=$j("#getting-started-frame-ul #"+moduleName+"_module").attr("service"),Setup.actions.loadFrame(serviceName,moduleName))}else Common.showElement(void 0,"gsloading")},setProgress:function(percentage){void 0===percentage&&(modulesCompleted=$j(".zcrmp-gs-steps li.fini").length,percentage=modulesCompleted/Setup.moduleCount*100),percentage=Math.round(percentage),$j(".zcrmp-progrsCmp #gs-progress").text(percentage+"%"),$j(".zcmrp-CompltnVal").text(percentage+"%"),$j(".zcrmp-progrsCmp .displayTableCellGr").width(percentage+"%")},initialize:function(data,moduleName){if(void 0===moduleName){if(null!=data&&""!=data){$j("#getting-started").show();var dropDownHTML="",frameHTML="",setupArray=JSON.parse(data);for(index in setupArray){var finishedClass="",moduleData=setupArray[index];if(void 0===moduleData.percentCompleted){var module=moduleData.module,isconfigured=moduleData.configured,I18NKey="setup.module."+module.replace(/\_/g,""),moduleTitle=I18N.getValue(I18NKey),serviceName=moduleData.service,moduleICON="<i class='plus-"+module+"' ></i>";"support_email"==module&&(moduleICON="<i style='font-style:normal'>@</i>"),isconfigured&&(finishedClass="fini"),dropDownHTML=dropDownHTML.concat("<li class='clearFix "+finishedClass+"' id='"+module+"_module' onclick=\"Setup.module.show('"+module+"',this);\">"+moduleICON+"<span class='plus-tick'></span><div>"+moduleTitle+"</div><span class='plus-arrow'></span></li>"),frameHTML=frameHTML.concat("<li class='"+finishedClass+"' service='"+serviceName+"' id='"+module+"_module' onclick=\"Setup.module.show('"+module+"',this);\">"+moduleICON+"</li>"),Setup.module.fetch(module)}else Setup.module.setProgress(moduleData.percentCompleted)}$j("#getting-started-ul").html(dropDownHTML),$j("#getting-started-frame-ul").html(frameHTML),$j(".zcrmp-gs-steps li:first").click(),$j("#getting-started").tabs()}}else{if($j(".js-zcrmp-gsstepInfo").append(data),"company_info"==moduleName&&($j("#getting-started-frame-cont").append(data),$j("#getting-started-frame-cont .js-setup-"+moduleName).addClass("zcrmp-gsstepInfo"),$j("#getting-started-frame-module .js-setup-"+moduleName).remove()),"website"==moduleName){var trackerCodeHTML=$j("#getting-started-frame-module .zcrmp-website"),trackerContainer=$j('<div class="js-setup-website" style="display: none;">');trackerContainer.html(trackerCodeHTML),$j("#getting-started-frame-cont").append(trackerContainer),$j("#getting-started-frame-module .zcrmp-website").remove()}$j("#"+moduleName+"_module.selected").length>0&&(Common.hideElement("gsloading"),$j(".js-setup-"+moduleName).show()),"company_info"==moduleName&&(Setup.show.defaultCompanyValues(),Setup.show.valueForCode())}}},Setup.show={companyFields:function(id){this.companyLabel(id);var element=$j(".zcrmp-inptsFld:visible .js-"+id+"_dropdown");showPanel(void 0,element)},companyLabel:function(fieldName){$j(".js-"+fieldName+"_label").css({top:"-5px",visibility:"visible"})},defaultCompanyValues:function(){var companyFields={country:countryList,timezone:timezoneList,language:languageList};for(field in companyFields){var htmlList="",fieldList=companyFields[field];for(fieldValue in fieldList){var fieldName=fieldList[fieldValue];"timezone"==field&&(fieldName=fieldValue),htmlList+="<li code='"+fieldValue+"' onclick=\"setValue('js-company_"+field+"','"+fieldName+"'); setAttr('js-company_"+field+"','code','"+fieldValue+"');Common.hideClass('js-company_"+field+"_dropdown')\">"+fieldName+"</li>"}$j("#company_"+field+"_dropdown ul").html(htmlList)}},searchList:function(element){$j(element).bind("input",function(){$j(element).val()})},imagePreview:function(input){if(input.files&&input.files[0]){var file=input.files[0],fileSize=file.size,fileName=file.name;if(!isImageFile(fileName))return void showStatusMsg("error",I18N.getValue("setup.company.logo.file"));if(fileSize>ZCPConstants.COMPANY_LOGO_MAX_SIZE)return void showStatusMsg("error",I18N.getValue("setup.company.logo.size"));var reader=new FileReader;reader.onload=function(e){$j(".js-company-logo").show(),$j(".js-company-logo").attr("src",e.target.result)},reader.readAsDataURL(input.files[0])}},serviceError:function(serviceName,html,message){if(Setup.currentService===serviceName){$j("#getting-started-frame").show(),$j("#getting-started-frame-cont").show(),Common.hideElement("gsframeloading");var height=$j(window).height()-$j("#getting-started-frame .zcrmp-ifgsTopPan").outerHeight();if($j("#getting-started-frame-cont").outerHeight(height),html&&null!=html&&""!=html)$j("#getting-started-frame-cont .js-setup-error").html(html);else{var html='<img class="pB20" src="/images/noaccess.png" style="width:70px; margin-top: 30px;"><p class="f20 fontLighter mB30">'+message+"</p>";$j("#getting-started-frame-cont .js-setup-error").html(html)}$j("#getting-started-frame-cont .js-setup-error").show()}},gettingStartedFrame:function(moduleName){$j("#getting-started-frame-cont").show(),$j("#getting-started-frame .zcrmp-ifgs-Switch li:first").click(),moduleName&&(moduleHTML=Setup.module.fetch(moduleName),$j("#getting-started-frame-module"))},valueForCode:function(){var fieldNames=["country","language"];for(index in fieldNames){var fieldName=fieldNames[index],code=$j(".js-company_"+fieldName).attr("code");void 0!=code&&""!=code&&("country"==fieldName?fieldValue=getCountryName(code):"language"==fieldName&&(fieldValue=getLanguageName(code)),setAttr("js-company_"+fieldName,"value",fieldValue))}}},Setup.hide={view:function(){$j.ajax({type:"GET",url:"/"+Common.currentPortalName+"/hidegettingstarted.do"})},container:function(){$j("#getting-started").addClass("zoomOutt")},frame:function(){var frameElement=$j("#"+Setup.currentService+"LoadFrame");frameElement.css({top:"0px"}),$j("#getting-started-frame").hide(),$j(".zcrmp-ifgsPosOvrflow").removeClass("zcrmp-ifgsPosOvrflow"),Common.handleWindowSize(),TopBar.gettingStarted.handleClose()}},Setup.update={company:function(event,fieldName){var orgJson={},locationsJson={},changedFields=[],isvaluesChanged=!1,companyFields=["name","description","language","timezone","country"];fieldName&&(companyFields=fieldName);var fd=new FormData;for(index in companyFields){fieldName=companyFields[index];var element=$j(".js-company_"+fieldName+":visible"),fieldValue=element.val().trim();""!=fieldValue&&fieldValue!==element.attr("value")&&(changedFields.push(fieldName),"name"==fieldName||"description"==fieldName?("name"==fieldName&&(fieldName="display_name"),orgJson[fieldName]=fieldValue):("language"==fieldName&&(fieldValue=element.attr("code").toLowerCase()),locationsJson[fieldName]=fieldValue))}var companyLogo=$j(".js-company-logo-file")[0];if(companyLogo.files&&companyLogo.files[0]&&(fd.append("companylogo",companyLogo.files[0]),isvaluesChanged=!0),!$j.isEmptyObject(orgJson)){var orgInfo={};
orgInfo.orgs=orgJson,fd.append("orginfo",JSON.stringify(orgInfo)),isvaluesChanged=!0}if(!$j.isEmptyObject(locationsJson)){var locationsInfo={};locationsInfo.locations=locationsJson,fd.append("orglocations",JSON.stringify(locationsInfo)),isvaluesChanged=!0}isvaluesChanged&&($j(".js-company-update").text("updating..."),$j.ajax({type:"POST",data:fd,processData:!1,dataType:"json",contentType:!1,url:"/"+Common.currentPortalName+"/updateorganization.do",success:function(responseData){var failedModules=[];for(module in responseData){var moduleData=responseData[module];"200"!=moduleData.status_code&&"201"!=moduleData.status_code&&failedModules.push(module)}failedModules.length>0?showStatusMsg("error",I18N.getValue("setup.company.error")):showStatusMsg("success",I18N.getValue("setup.company.success"));for(index in changedFields){var field=changedFields[index],changedElement=$j(".js-company_"+field+":visible");$j(".js-company_"+field).attr("value",changedElement.val())}},complete:function(){$j(".js-company-update").text("update")}}))},serviceProperties:function(serviceName){var params={};serviceName&&(params.service=serviceName),$j.ajax({type:"GET",url:"/"+Common.currentPortalName+"/populategettingstarted.do",data:params})}},Setup.sendTrackerCode=function(){var subject=I18N.getValue("setup.website.emailsubj"),trackerCode=$j(".zcrmp-websitecode:visible").val(),body=I18N.getValue("setup.website.emailbody1")+"<br>"+I18N.getValue("setup.website.emailbody2")+"<br><br>"+I18N.getValue("setup.website.emailbody3")+"<br><br>"+trackerCode+"<br><br>"+I18N.getValue("setup.website.emailbody4")+"<br>"+I18N.getValue("setup.website.emailbody5");Feedback.showFeedbackDialog("trackerCodeEmail",subject,body)},Setup.actions={getUrl:function(serviceName,action){if("survey"==serviceName)return Services.configuredServicesData.survey.URL;var actionURL,portalName=Services.getPortalName(serviceName);return Setup.actionsProperties[serviceName]&&(actionObj=Setup.actionsProperties[serviceName][action],void 0!=actionObj&&(actionURL=actionObj.URL,actionURL=actionURL.replace("#PORTALNAME#",portalName))),defaultURL=Services.serviceUrl.get(serviceName),defaultURL&&actionURL?completeURL=defaultURL+actionURL:void 0},loadFrame:function(serviceName,action){if(Setup.currentService=serviceName,$j("#getting-started").hide(),Common.handleWindowSize(),$j("#getting-started-frame-cont .js-setup-error").hide(),element=$j('[class^="js-action-'+serviceName+"-"+action+'"]'),addSelected(element),actionURL=this.getUrl(serviceName,action),"onezoho"===serviceName&&void 0!==actionURL){var message="click <a onclick='Setup.module.show(\"invite_users\",this);'>here </a>to manage users",html='<img class="pB20" src="/images/adminpanelicon.png" style="width:70px; margin-top: 30px;"><p class="f20 fontLighter mB30">'+message+"</p>";Setup.show.serviceError(serviceName,html),window.open(actionURL,"_blank")}else Services.loadGettingStartedFrame(serviceName,actionURL),Services.currentAction=action},setFrameStyle:function(serviceName){var frameElement=$j("#"+serviceName+"LoadFrame"),gettingStartedFrame=$j("#getting-started-frame:visible");if(frameElement.length>0&&gettingStartedFrame.length>0&&Setup.currentService===serviceName){$j("#getting-started-frame-cont").hide(),frameElement.addClass("zcrmp-ifgsPosOvrflow");var topHeight=$j("#getting-started-frame .zcrmp-ifgsTopPan").outerHeight(),height=$j(window).height()-topHeight;frameElement.css({top:topHeight}),frameElement.outerHeight(height);var action=$j(".zcrmp-servicesAvail li.selected").attr("action"),actionID="";Setup.actionsProperties[serviceName]&&(actionObj=Setup.actionsProperties[serviceName][action],(void 0!==actionObj||null!=actionObj)&&(actionID=actionObj.ID));var toPostMessage={};toPostMessage.type="scrollToDiv",toPostMessage.ID=actionID,ServiceCommunicator.action.sendMessage(serviceName,toPostMessage)}}},Urls={},Urls.actionsProperties={crm:{dataimport:{URL:"/crm/ShowSetup.do?tab=data&subTab=migrate",ID:"setupshow"},lead_generation_form:{URL:"/crm/ShowSetup.do?tab=webInteg&subTab=webLeads",ID:"setupshow"},admintool:{URL:"/crm/ZCRMAdminTools.do?action=userInfoAction&step=FetchDetails&userNameOrZuId={0}"}},support:{dataimport:{URL:"/support/#PORTALNAME#/ImportWizard.do?step=1",ID:"middle_container"},web_to_tickets_form:{URL:"/support/#PORTALNAME#/WebToEntityForm.do?module=Cases&formType=web_to_request_form",ID:"middle_container"},support_email:{URL:"/support/#PORTALNAME#/MailAlias.do",ID:"middle_container"},admintool:{URL:"/support/{0}/ProductAdmin.do?crmplusCustomerEmail={1}"}},campaigns:{mailing_list:{URL:"/campaigns/home.do#contacts/list",ID:"campaignInnerContents"},signup_form:{URL:"/campaigns/home.do#contacts/list",ID:"campaignInnerContents"},admintool:{URL:"/zcadmin/admin.do?searchString={0}&searchType=all&orgViewSts=All&page=showOrgList&CRMPlus=true"}},survey:{survey_form:{URL:"/",ID:"zs_home_page"},admintool:{URL:"/survey/admin/userinfo.jsp?loginname={0}"}},onezoho:{invite_users:{URL:"/crmplus/#PORTALNAME#/home#/users/new",ID:""}},projects:{admintool:{URL:"/ziamutil/getUserDataByEmail.jsp?email={0}"}},social:{admintool:{URL:"/social/getIamUserDetails.do?zuidOrEmail={0}"}},reports:{admintool:{URL:"/reports/pricing/PaymentAdminConsole.jsp?USERID={0}&USEROPT=3"}},salesiq:{admintool:{URL:""}},motivator:{admintool:{URL:"/motivator/admin/user?user={0}"}}},Urls.getUrl=function(serviceName,action,params){var actionURL;if(Urls.actionsProperties[serviceName][action]&&(actionURL=Urls.actionsProperties[serviceName][action].URL),"survey"==serviceName&&"admintool"!=action)return Services.configuredServicesData.survey.URL;if("admintool"==action&&null==params||void 0==params)return actionURL;for(var i=0;i<params.length;i++)actionURL=actionURL.split("{"+i+"}").join(encodeURIComponent(params[i]));var portalName=Services.getPortalName(serviceName);actionURL=actionURL.replace("#PORTALNAME#",portalName);var defaultURL=Services.serviceUrl.get(serviceName);return"admintool"!=action||"projects"!=serviceName&&"campaigns"!=serviceName||(defaultURL=Services.serviceUrl.get(serviceName,!0)),defaultURL&&actionURL?completeURL=defaultURL+actionURL:void 0};var CRMPlusCommonUi={searchData:{},isSearchViewInServices:{},currentModuleList:{},notifications:{},isSearchAvailable:{},isSetupAvailable:{},notificationsCount:{},isAlertIcon:{},currentNotificationView:null,isLeftPanelVisible:!0,currentThemeClass:"zcrmp-darkgreyTheme",defaultTheme:"darkgrey",currentDepartmentInfo:{departmentlabel:{projects:"projects",reports:"databases",crm:"tabgroups",social:"brands",survey:"departments",support:"departments"}},isNotificationVisible:!1,isTopBarHidden:{current:!1},isZiaVisible:{},init:function(){var theme=Common.getUserOptions(ZCPConstants.COMMONUI_THEME);void 0!==theme&&($j("#crmpluscommonuitheme"+theme).addClass("selected"),this.defaultTheme=theme,this.currentThemeClass="zcrmp-"+theme+"Theme",$j("body").addClass(this.currentThemeClass),$j("#crmpluscommonuitopbar").show()),Common.isNewUI&&CRMPlusCommonUi.initLeftPanel()},initLeftPanel:function(){$j("#crmpluscommonuileftpanel").show();var leftPanelInitState=Common.getUserOptions(ZCPConstants.LEFTPANEL_VISIBLE);null===leftPanelInitState&&Common.isSignUp&&(leftPanelInitState=!0),CRMPlusCommonUi.handleLeftPanelVisibility(leftPanelInitState,!1)},constructQuickLink:function(linkname,link,qlid){var serviceName=link.split("/")[0];"portal"===serviceName&&(serviceName="projects"),""===serviceName&&(serviceName="crmplus");var parentElement=$j("#commonuiqlinklist"+serviceName);if(0===$j("#qlinklist"+serviceName).length){var qlinkheader=document.createElement("div");$j(qlinkheader).addClass("zcrmpproflabel clearFix");var qlinkheaderspan=document.createElement("div");$j(qlinkheaderspan).addClass("fLeft zcrmp-moduleName"),$j(qlinkheaderspan).text(I18N.getValue("service.title."+serviceName)),$j(qlinkheader).append(qlinkheaderspan);var qlinklist=document.createElement("div");$j(qlinklist).addClass("zcrmpSpcficLinks clearFix"),$j(qlinklist).attr("id","qlinklist"+serviceName),parentElement.append(qlinkheader),parentElement.append(qlinklist)}parentElement.is(":visible")||parentElement.show();var qlinkDiv=document.createElement("a");$j(qlinkDiv).attr("rel","noopener"),$j(qlinkDiv).attr("href","#"+link),$j(qlinkDiv).addClass("zcrmpQlinkDiv"),$j(qlinkDiv).append($j("<span/>"));var qid="quicklink_"+qlid;qlinkDiv.setAttribute("id",qid),qlinkDiv.setAttribute("style","display:none;"),qlinkDiv.setAttribute("servicename",serviceName);var editIcon=document.createElement("i");$j(editIcon).addClass("plus-pencil");var editId=qid+"_edit";$j(editIcon).attr("id",editId),$j(qlinkDiv).append(editIcon),$j("#qlinklist"+serviceName).append(qlinkDiv),$j("#"+qid+" > span").text(linkname),$j(qlinkDiv).fadeIn(),Common.addClickEventListener("#"+qid,Common.accessRecentItem,[serviceName,link,"#event#"],Common),Common.addClickEventListener("#"+editId,SidePanel.showQuickLinkEditDialog,["#event#","#this#",qlid,link,"edit"],SidePanel)},handleCommonUiModules:function(serviceName,type,labels){if("all"===type){if(this.currentModuleList[serviceName]=labels,void 0!==labels){if(this.notifications[serviceName]=labels.notifications,"crm"===serviceName||"support"===serviceName&&void 0!==labels.notifications&&void 0!==labels.notifications.InChatBar){var inChatBar=labels.notifications.InChatBar;inChatBar.zia===!0&&this.constructZia(serviceName),inChatBar.stickynotes===!0&&$j("#crmpluscommonuinotificationstickynotes").show(),inChatBar.ziachatbot===!0&&$j("#crmpluscommonuinotificationziachatbot").show(),inChatBar.telephonyWidget===!0&&$j("#crmpluscommonuinotificationtelephonyWidget").show()}if(!labels.quickaccess){var quickaccess={};quickaccess.search=void 0!==labels.isSearchAvailable?labels.isSearchAvailable:!0,quickaccess.setup=void 0!==labels.isSetupAvailable?labels.isSetupAvailable:!0,serviceName===ZCPConstants.SERVICE_SALESIQ&&(quickaccess.salesiqsound=!0),this.currentModuleList[serviceName].quickaccess=quickaccess}}}else"submodule"!==type&&(void 0===this.currentModuleList[serviceName]&&(this.currentModuleList[serviceName]={}),this.currentModuleList[serviceName][type]=labels);if("all"===type)this.construct(serviceName);else if("module"===type)this.constructModules(serviceName);else if("submodule"===type){var parentElement=$j("#crmpluscommonui_"+serviceName+"_"+labels.parentkey);parentElement.find("div").first().remove(),this.constructSubModules(serviceName,labels.subitems,parentElement,labels.parentkey)}else"department"===type?labels.isnewdepartment?(labels.cansetselected&&this.setCurrentDepartment(serviceName,labels.list[0]),this.resetDepartmentList(serviceName)):labels.cansetselected?(this.setCurrentDepartment(serviceName,labels.list[0]),this.resetDepartmentList(serviceName)):this.renderDepartmentList(serviceName,labels.list):"option"===type?Services.constructProductSpecificOptions(serviceName):"search"===type?(void 0===labels?labels=null:$j("#crmpluscommonuisearchservicediv"+serviceName+" i").show(),CRMPlusCommonUi.searchData[serviceName]=labels,CRMPlusCommonUi.search.show(serviceName,!0)):"addrecordoption"===type?CRMPlusCommonUi.constructAddRecordOptionUI(serviceName,labels):"quickaccess"===type&&serviceName===Services.currentView&&this.handleQuickAccessIcons(serviceName);this.handleWindowSize()},construct:function(serviceName){var currentModuleList=CRMPlusCommonUi.currentModuleList[serviceName];void 0!==currentModuleList&&(void 0!==currentModuleList.department&&this.constructDepartment(serviceName),void 0!==currentModuleList.module&&this.constructModules(serviceName),void 0!==currentModuleList.option&&Services.constructProductSpecificOptions(serviceName),void 0!==currentModuleList.addrecordoption&&CRMPlusCommonUi.constructAddRecordOptionUI(serviceName,currentModuleList.addrecordoption),serviceName===Services.currentView&&(CRMPlusCommonUi.handleNotificationsIcons(serviceName),CRMPlusCommonUi.handleQuickAccessIcons(serviceName)))},constructZia:function(serviceName){CRMPlusCommonUi.isZiaVisible[serviceName]||(CRMPlusCommonUi.isZiaVisible[serviceName]=!0,void 0===$j("#crmpluscommonuinotificationzia").attr("ziaservicecount")?($j("#crmpluscommonuinotificationzia").attr("ziaservicecount","1"),$j("#crmpluscommonuinotificationzia").attr("onclick","CRMPlusCommonUi.handleClickedChatBarIcon(event, 'zia', '"+serviceName+"')"),$j("#crmpluscommonuinotificationzia").attr("onmouseenter","tooltip('"+I18N.getValue("crmplus.label.zia")+"', event)")):($j("#crmpluscommonuinotificationzia").removeAttr("onclick"),$j("#crmpluscommonuinotificationzia").attr("onmouseenter","Common.showZiaOptionPanel();"),$j("#crmpluscommonuinotificationzia").attr("onmouseleave","Common.hideZiaOptionPanel();")),$j("#crmpluscommonuinotificationzia").show())},handleQuickAccessIcons:function(serviceName){$j("#crmpluscommonuisearchicon").hide(),$j("#crmpluscommonuisetupicon").hide(),$j("#crmpluscommonuiautosyncicon").hide(),$j("#crmpluscommonuiquicktouricon").hide(),$j("#crmpluscommonuicomposeicon").hide(),$j("#crmpluscommonuisalesiqsoundicon").hide(),$j("#crmpluscommonuirefreshicon").hide();var currentModuleList=CRMPlusCommonUi.currentModuleList[serviceName];if(void 0!==currentModuleList&&void 0!==currentModuleList.quickaccess){var quickAccessJson=currentModuleList.quickaccess;for(var key in quickAccessJson)if(quickAccessJson[key]){var id="crmpluscommonui"+key.replace(/[\s.]/g,"")+"icon";if("setup"===key){var url=TopBar.setup.getDefaultURL(serviceName);void 0!=url&&""!==url.trim()?(url=url.replace("#","/getcpdata/"),$j("#"+id).attr("href","#"+url)):$j("#"+id).removeAttr("href")}$j("#"+id).show()}}},handleClickOnQuickAccessIcon:function(event,type){switch(type){case"quicktour":ServiceCommunicator.triggerAction(Services.currentView,"showDialog",type);break;case"compose":ServiceCommunicator.triggerAction(Services.currentView,"showDialog",type);break;case"salesiqsound":Common.toggleChatNotifictionSound(Services.currentView);break;case"refresh":ServiceCommunicator.triggerAction(Services.currentView,"triggerAction",type)}},constructModules:function(serviceName){var commonUiModuleListId="commonUiModuleList"+serviceName,commonUimoreModuleListId="commonUimoreModuleList"+serviceName;if(0==$j("#"+commonUiModuleListId).length){var ul=document.createElement("ul");$j(ul).addClass("fLeft zcrmp-serModTabs"),$j(ul).attr("id",commonUiModuleListId),$j(ul).hide(),$j("#commonuimodulelistdiv").prepend(ul)}if(0==$j("#"+commonUimoreModuleListId).length){var ul=document.createElement("ul");$j(ul).addClass("zcrmp-serSubtabs"),$j(ul).attr("id",commonUimoreModuleListId),$j(ul).hide(),$j("#crmpluscommonuimoremodulelist").prepend(ul)}var commonUiModuleList=$j("#"+commonUiModuleListId),commonUimoreModuleList=$j("#"+commonUimoreModuleListId);commonUiModuleList.html(""),commonUimoreModuleList.html("");var availableWidth=$j("#crmpluscommonuitopbar").outerWidth(!0)-($j("#crmpluscommonuileftpanelswitch").outerWidth(!0)+$j("#crmpluscommonuidepartments").outerWidth(!0)+$j("#crmpluscommonuitopbaroptions").outerWidth(!0)+200);if(this.currentModuleList[serviceName]){var moduleJson=this.currentModuleList[serviceName].module;if(void 0!==moduleJson){var index,modules=moduleJson.list,selectedModule=void 0,counter=0;for(index in modules){var label=modules[index].label,key=modules[index].key;if(serviceName!==ZCPConstants.SERVICE_CRM||"SalesInbox"!==key){var anchor=document.createElement("a");if(void 0!=modules[index].href){var moduleHref=modules[index].href.replace("#","/getcpdata/");anchor.setAttribute("href","#"+moduleHref)}$j(anchor).text($j.trim(label));var li=document.createElement("li");$j(li).addClass("clearFix"),$j(li).append(anchor),$j(li).attr("key",key);var id="crmpluscommonui_"+serviceName+"_"+key.replace(/[\s.]/g,"");$j(li).attr("id",id),$j(li).attr("order",counter++),commonUiModuleList.outerWidth(!0)+$j(li).outerWidth(!0)>availableWidth&&!modules[index].isselected?commonUimoreModuleList.append(li):commonUiModuleList.append(li),Common.addClickEventListener("#"+id+" > a",ServiceCommunicator.triggerAction,[serviceName,"selectmodule",key,"#event#"],ServiceCommunicator),void 0!==modules[index].subitems&&this.constructSubModules(serviceName,modules[index].subitems,li,key),modules[index].isselected&&(selectedModule=li)}}void 0!==selectedModule&&$j(selectedModule).addClass("selected"),Services.currentView==serviceName&&this.showTopbarModules(serviceName,moduleJson)}}},constructSubModules:function(serviceName,subitems,parentElement,parentModule){if(void 0!==subitems){var list=subitems.list,divElement=document.createElement("div");$j(divElement).addClass("zcrmp-serSubModList clearFix hidepop topLeftVal");var id="submodules_"+serviceName+"_"+parentModule;if($j(divElement).attr("id",id),$j(parentElement).append(divElement),void 0!==list&&list.length>0){var ulElement=document.createElement("ul");$j(ulElement).addClass("zcrmp-serSubtabs"),$j(ulElement).css("max-height","300px"),$j(ulElement).css("overflow","auto"),$j(divElement).append(ulElement);for(var index in list){var subModule=list[index],key=subModule.key,idForLi="crmpluscommonui_"+serviceName+"_"+key.replace(/[\s.]/g,""),li=document.createElement("li");$j(li).attr("id",idForLi),$j(li).attr("parent",parentModule),$j(li).attr("key",key);var anchor=document.createElement("a");if(void 0!=subModule.href){var subModuleHref=subModule.href.replace("#","/getcpdata/");anchor.setAttribute("href","#"+subModuleHref)}$j(anchor).text($j.trim(subModule.label)),$j(li).append(anchor),1==subModule.isselected&&($j(li).addClass("selected"),$j(parentElement).addClass("selected")),$j(ulElement).append(li),Common.addClickEventListener("#"+idForLi+">a",ServiceCommunicator.triggerAction,[serviceName,"selectmodule",key,"#event#"],ServiceCommunicator)}}else{var emptymessage=void 0;void 0!==subitems.emptyMessage&&(emptymessage=subitems.emptyMessage);var emptyMessageDiv=CRMPlusCommonUi.createEmptyListContent(id+"emptymessage",emptymessage);$j(divElement).append(emptyMessageDiv)}$j(parentElement).attr("onmouseover","showPanel('submodules_"+serviceName+"_"+parentModule+"',undefined,'translate-y',true,event)"),$j(parentElement).attr("onmouseleave","hidePanel(true)")}},constructDepartment:function(serviceName){if(this.currentModuleList[serviceName]){var departmentJson=this.currentModuleList[serviceName].department;if(void 0!=departmentJson&&!$j.isEmptyObject(departmentJson)){var deptListContainerId="crmpluscommonuidepartmentslistcontainer"+serviceName;if(0==$j("#"+deptListContainerId).length){var ul=document.createElement("ul");$j(ul).addClass("zcrmp-serDeprtmntList lispace"),serviceName===ZCPConstants.SERVICE_REPORTS&&$j(ul).addClass("zcrmp-rprtsList"),$j(ul).css({"max-height":"300px","overflow-y":"auto",hieght:"auto",display:"none"}),$j(ul).attr("id",deptListContainerId),Services.currentView!=serviceName&&$j(ul).hide(),$j("#crmpluscommonuiadddepartmentmsg").after(ul),Common.setScroll("crmpluscommonuidepartmentslistcontainer"+serviceName),this.currentDepartmentInfo[serviceName]={}}var departments=[];departmentJson.hasOwnProperty("currentdepartment")&&(this.currentDepartmentInfo[serviceName].currentdepartment=departmentJson.currentdepartment,departments.push(departmentJson.currentdepartment)),departmentJson.hasOwnProperty("adddepartment")&&(this.currentDepartmentInfo[serviceName].adddepartment=departmentJson.adddepartment),departmentJson.hasOwnProperty("managedepartment")&&(this.currentDepartmentInfo[serviceName].managedepartment=departmentJson.managedepartment),Services.currentView==serviceName&&this.renderSelectedAndAddDepartment(serviceName),this.resetDepartmentList(serviceName)}}},renderDepartmentList:function(serviceName,departments){var deptListContainer,isSearchOn=this.currentDepartmentInfo[serviceName].isDepartmentSearchOn;if($j("#crmpluscommonuidepartmentloading").remove(),this.currentDepartmentInfo[serviceName].isDepartmentFetchProgress||isSearchOn){isSearchOn?(deptListContainer=$j("#crmpluscommonuidepartmentslistcontainersearch"),10===this.currentDepartmentInfo[Services.currentView].departmentSearchOffset&&deptListContainer.html("")):deptListContainer=$j("#crmpluscommonuidepartmentslistcontainer"+serviceName);var idPart="crmpluscommonui_"+serviceName+"_department_id",curSelctedId=$j("#crmpluscommonuiselecteddepartment").attr("selecteddepartmentid");if(void 0!==departments)for(var index in departments){var department=departments[index],label=department.label,key=department.key,id=idPart+key.replace(/[\s.]/g,"");if(isSearchOn&&(id="search"+idPart+key.replace(/[\s.]/g,"")),!$j("#"+id).length){var li=document.createElement("li");$j(li).text($j.trim(label)),serviceName===ZCPConstants.SERVICE_REPORTS&&void 0!==department.group_name&&$j(li).append('<i class="plus-shared" onmouseover="tooltip("Shared", event);"></i>'),$j(li).attr("id",id),serviceName==ZCPConstants.SERVICE_PROJECTS&&"topProjMenu_myhome"!==key&&(department.recent_accessed?$j(li).attr("recent",!0):$j(li).attr("recent",!1)),void 0!=department.group_name&&$j(li).attr("title",department.group_name),$j(li).attr("onclick","CRMPlusCommonUi.selectDepartment('"+key+"', event);"),deptListContainer.append(li)}}if($j("[id$='"+curSelctedId+"']").hide(),isSearchOn){var searchListItem=$j("#crmpluscommonuidepartmentslistcontainersearch > li");0==searchListItem.length&&$j("#crmpluscommonuidepartmentslistcontainersearch").html("<li>"+I18N.getValue("crmplus.label.not.available")+"</li>"),$j("#crmplusdepartmentsearchloading").hide(),$j("#crmplusdepartmentsearchicon").show(),$j("#crmpluscommonuidepartmentslistcontainersearch").show(),$j("[id^=crmpluscommonuidepartmentslistcontainer]").not("#crmpluscommonuidepartmentslistcontainersearch").hide(),departments.length>=this.currentDepartmentInfo[serviceName].departmentSearchRange&&$j("#crmpluscommonuidepartmentslistcontainersearch").attr("onscroll","CRMPlusCommonUi.fetchDepartmentList(event, true);"),this.currentDepartmentInfo[Services.currentView].isDepartmentSearchOn=!1}else departments.length>=this.currentDepartmentInfo[serviceName].departmentRange&&serviceName!==ZCPConstants.SERVICE_CRM&&serviceName!==ZCPConstants.SERVICE_SUPPORT&&$j("#crmpluscommonuidepartmentslistcontainer"+serviceName).attr("onscroll","CRMPlusCommonUi.fetchDepartmentList(event, true);"),this.currentDepartmentInfo[serviceName].isDepartmentFetchProgress=!1,this.currentDepartmentInfo[serviceName].isDepartmentFirstFetch=!1,Services.currentView==serviceName&&this.showDepartmentView(Services.currentView)}},setCurrentDepartment:function(serviceName,currentDepartment){if(void 0!==currentDepartment){var selectedDept=$j("#crmpluscommonuiselecteddepartment"),idPart="crmpluscommonui_"+serviceName+"_department_id";selectedDept.text(currentDepartment.label),$j("[id$='"+selectedDept.attr("selecteddepartmentid")+"']").show(),selectedDept.attr("selecteddepartmentid",idPart+currentDepartment.key.replace(/[\s.]/g,"")),$j("[id$='"+selectedDept.attr("selecteddepartmentid")+"']").hide(),void 0!==this.currentDepartmentInfo[serviceName]&&(this.currentDepartmentInfo[serviceName].currentdepartment.key=currentDepartment.key,this.currentDepartmentInfo[serviceName].currentdepartment.label=currentDepartment.label)}},resetDepartmentList:function(serviceName){this.currentDepartmentInfo[serviceName].departmentOffset=0,this.currentDepartmentInfo[serviceName].departmentRange=10,this.currentDepartmentInfo[serviceName].isDepartmentFirstFetch=!0,Services.currentView===serviceName&&($j("#crmpluscommonuiadddepartmentmsg").hide(),$j("#crmpluscommonuidepartmentsearch").hide()),$j("#crmpluscommonuidepartmentslistcontainer"+serviceName).attr("onscroll",""),$j("#crmpluscommonuidepartmentslistcontainer"+serviceName).html("")},fetchDepartmentList:function(event,isScroll){var key={},elem=getTargetElementFromEvent(event),searchKey=$j("#crmpluscommonuidepartmentsearchinput").val();return searchKey=searchKey.trim(),CRMPlusCommonUi.departmentSearchKey=searchKey,Services.currentView==ZCPConstants.SERVICE_CRM||Services.currentView==ZCPConstants.SERVICE_SUPPORT||!isScroll&&""==searchKey?(CRMPlusCommonUi.searchDepartment(),this.showDepartmentView(Services.currentView),void $j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).slimScroll({scrollTo:"0px"})):void(""!=searchKey?($j("#crmpluscommonuidepartmentslistcontainersearch").attr("onscroll",""),isScroll?$j("#crmpluscommonuidepartmentslistcontainersearch").append('<li class="zcrmp-shortload" id="crmpluscommonuidepartmentloading"><img src="'+Common.staticImgUrl+"/"+Common.staticHashedFileNames[Common.busyGif]+'"/></li>'):(this.currentDepartmentInfo[Services.currentView].departmentSearchOffset=0,this.currentDepartmentInfo[Services.currentView].departmentSearchRange=10,$j("#crmplusdepartmentsearchicon").hide(),$j("#crmplusdepartmentsearchloading").show()),key.searchkey=searchKey,key.offset=this.currentDepartmentInfo[Services.currentView].departmentSearchOffset,key.range=this.currentDepartmentInfo[Services.currentView].departmentSearchRange,this.currentDepartmentInfo[Services.currentView].departmentSearchOffset=this.currentDepartmentInfo[Services.currentView].departmentSearchOffset+this.currentDepartmentInfo[Services.currentView].departmentSearchRange,this.currentDepartmentInfo[Services.currentView].isDepartmentSearchOn=!0,ServiceCommunicator.triggerAction(Services.currentView,"getdepartmentlist",key,event)):$j(elem).scrollTop()+$j(elem).innerHeight()>=$j(elem)[0].scrollHeight&&1!=this.currentDepartmentInfo[Services.currentView].isDepartmentFetchProgress&&(key.offset=this.currentDepartmentInfo[Services.currentView].departmentOffset,key.range=this.currentDepartmentInfo[Services.currentView].departmentRange,this.currentDepartmentInfo[Services.currentView].departmentOffset=this.currentDepartmentInfo[Services.currentView].departmentOffset+this.currentDepartmentInfo[Services.currentView].departmentRange,$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).append('<li class="zcrmp-shortload" id="crmpluscommonuidepartmentloading"><img src="'+Common.staticImgUrl+"/"+Common.staticHashedFileNames[Common.busyGif]+'"/></li>'),this.currentDepartmentInfo[Services.currentView].isDepartmentFetchProgress=!0,$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).attr("onscroll",""),ServiceCommunicator.triggerAction(Services.currentView,"getdepartmentlist",key,event)))},renderSelectedAndAddDepartment:function(serviceName){var departmentJson=($j("#crmpluscommonuiselecteddepartment"),"crmpluscommonui_"+Services.currentView+"_department_id",this.currentDepartmentInfo[Services.currentView]);if(void 0!=departmentJson){departmentJson.hasOwnProperty("currentdepartment")&&this.setCurrentDepartment(serviceName,departmentJson.currentdepartment);var addDeptElemId="crmpluscommonuiadddepartment",addDeptCrmElemId="crmpluscommonuiadddepartmentcrm";if($j("#"+addDeptElemId).hide(),$j("#"+addDeptCrmElemId).hide(),Services.currentView==ZCPConstants.SERVICE_CRM){var addDeptCrmElem=$j("#"+addDeptCrmElemId);addDeptCrmElem.html("");var canShow=!1;if(departmentJson.hasOwnProperty("adddepartment")){var span=document.createElement("span");$j(span).text("+ "+departmentJson.adddepartment),$j(span).attr("onclick","ServiceCommunicator.triggerAction(Services.currentView, 'newdepartment', undefined, event);"),addDeptCrmElem.append(span),canShow=!0}if(departmentJson.hasOwnProperty("managedepartment")){var span=document.createElement("span");$j(span).text(departmentJson.managedepartment),$j(span).attr("onclick","ServiceCommunicator.triggerAction(Services.currentView, 'newdepartment', true, event);"),addDeptCrmElem.append(span),canShow=!0}canShow&&addDeptCrmElem.show()}else if(departmentJson.hasOwnProperty("adddepartment")){var addDeptElem=$j("#"+addDeptElemId);addDeptElem.text("+ "+departmentJson.adddepartment),addDeptElem.attr("onclick","ServiceCommunicator.triggerAction(Services.currentView, 'newdepartment', undefined, event);"),addDeptElem.show()}$j("#crmpluscommonuidepartments").show()}},showDepartmentView:function(){var deptSearchElem=$j("#crmpluscommonuidepartmentsearch"),deptList=$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView+" > li").not("#crmpluscommonui"+Services.currentView+"recentdepartmentmsg,#crmpluscommonui"+Services.currentView+"otherdepartmentmsg");deptList.length>8?deptSearchElem.show():deptSearchElem.hide(),$j("[id^=crmpluscommonuidepartmentslistcontainer]").not("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).hide(),$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).show();var recentList=$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView+" > li[recent='true']"),noRecentList=$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView+" > li[recent='false']");if(deptList.length>6&&recentList.length>0&&noRecentList.length>0&&(recentList.length>1||1==recentList.length&&$j(recentList[0]).is(":visible")?($j("#crmpluscommonui"+Services.currentView+"recentdepartmentmsg").length?$j("#crmpluscommonui"+Services.currentView+"recentdepartmentmsg").show():$j(recentList[0]).before("<li class='zcrmp-rcPortLine' id='crmpluscommonui"+Services.currentView+"recentdepartmentmsg'>"+I18N.getValue("commonui.department.recent")+"</li>"),noRecentList.length>1||1==noRecentList.length&&$j(noRecentList[0]).is(":visible")?$j("#crmpluscommonui"+Services.currentView+"otherdepartmentmsg").length?$j("#crmpluscommonui"+Services.currentView+"otherdepartmentmsg").show():$j(noRecentList[0]).before("<li class='zcrmp-rcPortLine' id='crmpluscommonui"+Services.currentView+"otherdepartmentmsg'>"+I18N.getValue("crmplus.label.canceltrial.reason.others")+"</li>"):$j("#crmpluscommonui"+Services.currentView+"otherdepartmentmsg").hide()):$j("#crmpluscommonui"+Services.currentView+"recentdepartmentmsg").hide()),showPanel("crmpluscommonuidepartmentslist",void 0,"translate-y",!0),0===$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView+" > li:visible").length){var departmentLabel=this.currentDepartmentInfo.departmentlabel[Services.currentView];$j("#crmpluscommonuiadddepartmentmsg").text(I18N.getValue("commonui.department.nodepartment",[I18N.getValue("crmplus.label."+departmentLabel)])),$j("#crmpluscommonuiadddepartmentmsg").show()}else $j("#crmpluscommonuiadddepartmentmsg").hide()},showDepartmentList:function(event){Common.stopEvents(event),this.currentDepartmentInfo[Services.currentView].isDepartmentFirstFetch?($j("[id^=crmpluscommonuidepartmentslistcontainer]").hide(),$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).show(),showPanel("crmpluscommonuidepartmentslist",void 0,"translate-y",!0),0===$j("#crmpluscommonuidepartmentloading").length&&($j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).append('<li class="zcrmp-shortload" id="crmpluscommonuidepartmentloading"><img src="'+Common.staticImgUrl+"/"+Common.staticHashedFileNames[Common.busyGif]+'"/></li>'),this.currentDepartmentInfo[Services.currentView].isDepartmentFetchProgress=!0,ServiceCommunicator.triggerAction(Services.currentView,"getdepartmentlist",{offset:this.currentDepartmentInfo[Services.currentView].departmentOffset,range:this.currentDepartmentInfo[Services.currentView].departmentRange,recentdepartment:!0},event),this.currentDepartmentInfo[Services.currentView].departmentOffset=this.currentDepartmentInfo[Services.currentView].departmentOffset+this.currentDepartmentInfo[Services.currentView].departmentRange)):(this.showDepartmentView(Services.currentView),$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView).slimScroll({scrollTo:"0px"}))},searchDepartment:function(){var lis=$j("#crmpluscommonuidepartmentslistcontainer"+Services.currentView+" > li"),lisCount=lis.length,filter=CRMPlusCommonUi.departmentSearchKey.toUpperCase().trim();$j("#crmpluscommonui"+Services.currentView+"recentdepartmentmsg").hide();for(var i=0;lisCount>i;i++)if(!$j(lis[i]).attr("id").endsWith($j("#crmpluscommonuiselecteddepartment").attr("selecteddepartmentid"))){var departmentName=lis[i].innerHTML.toUpperCase().trim();departmentName.indexOf(filter)>-1?$j(lis[i]).show():$j(lis[i]).hide()}this.currentDepartmentInfo[Services.currentView].isDepartmentSearchOn=!1
},selectDepartment:function(key,event){var selectedDept=$j("#crmpluscommonuiselecteddepartment").attr("selecteddepartmentid"),toBeSelectDept=selectedDept.split("_id")[0]+"_id"+key.replace(/[\s.]/g,""),params={};if(params.id=key,Services.currentView==ZCPConstants.SERVICE_REPORTS)$j("#"+toBeSelectDept).is("[title]")&&(params.group_name=$j("#"+toBeSelectDept).attr("title")),ServiceCommunicator.triggerAction(Services.currentView,"selectdepartment",params,event);else{var department={};department.key=key,department.label=$j($j("[id$='"+toBeSelectDept+"']")[0]).text(),this.currentDepartmentInfo[Services.currentView].doNotSelect||this.setCurrentDepartment(Services.currentView,department),Services.currentView==ZCPConstants.SERVICE_PROJECTS&&this.resetDepartmentList(Services.currentView),ServiceCommunicator.triggerAction(Services.currentView,"selectdepartment",params,event)}hidePanel(!0)},searchMoreModuleList:function(searchString){var isMtched=!1;$j("#crmpluscommonuimoremodulesearchnodata").addClass("hide"),$j("#commonUimoreModuleList"+Services.currentView+" > li").each(function(index,li){-1===$j(li).find("a:first").text().toLocaleUpperCase().indexOf(searchString.toLocaleUpperCase())?$j(li).hide():(isMtched=!0,$j(li).show())}),isMtched||$j("#crmpluscommonuimoremodulesearchnodata").removeClass("hide")},handleWindowSize:function(){var commonUiModuleListId="commonUiModuleList"+Services.currentView,commonUimoreModuleListId="commonUimoreModuleList"+Services.currentView,commonUiModuleList=$j("#"+commonUiModuleListId),commonUimoreModuleList=$j("#"+commonUimoreModuleListId),panelHeight=$j("#crmpluscommonuileftpanel").height()-$j("#commonuileftpanelswitchicon").height(),bottomHeight=$j("#crmpluscommonuileftpanelbottom").height(),allServicesIcon=$j('#crmpluscommonuileftpanel [id$="commonuileftpanelswitch"]:visible'),singleServiceSize=$j(allServicesIcon[0]).outerHeight(!0),serviceIconAvailableSize=panelHeight-bottomHeight,numberOfServices=Math.floor(serviceIconAvailableSize/singleServiceSize);30>serviceIconAvailableSize-numberOfServices*singleServiceSize&&numberOfServices--;var availableServices=$j('#commonuileftpanelswitchlist [id$="commonuileftpanelswitch"]:visible'),availableServiceCount=availableServices.length;$j("#crmpluscommonuimoreservices").show();var allVisibleServices=$j('#crmpluscommonuileftpanel [id$="commonuileftpanelswitch"]:visible');if($j("#crmpluscommonuimoreservices").hide(),numberOfServices<allVisibleServices.length&&(availableServiceCount+=1),availableServiceCount>numberOfServices)for(var serviceCountToHide=availableServiceCount-numberOfServices,allAvailableServices=$j('#commonuileftpanelswitchlist [id$="commonuileftpanelswitch"]'),allAvailableServiceCount=allAvailableServices.length,index=allAvailableServiceCount-1;serviceCountToHide&&index>=0;){var element=allAvailableServices[index--],orderForElement=($j('#crmpluscommonuimoreservicelinks [id$="commonuileftpanelswitch"]'),$j(element).attr("order"));orderForElement=+orderForElement,$j(element).is(":visible")&&serviceCountToHide--,$j("#crmpluscommonuimoreservicelinks>ul").prepend(element)}else for(var serviceCountToVisible=numberOfServices-availableServiceCount,moreServices=$j('#crmpluscommonuimoreservicelinks [id$="commonuileftpanelswitch"]'),index=0;serviceCountToVisible&&index<moreServices.length;){var element=$j(moreServices[index++]),orderForElement=element.attr("order");if(orderForElement=+orderForElement,0===orderForElement)$j("#commonuileftpanelswitchlist").prepend(element);else{var preElement=$j('#commonuileftpanelswitchlist [order="'+(orderForElement-1).toString()+'"]');$j(preElement).after(element)}element.is(":visible")&&serviceCountToVisible--}if((Common.isSignUp||Services.isFetchComplete)&&numberOfServices<allVisibleServices.length?$j("#crmpluscommonuimoreservices").show():$j("#crmpluscommonuimoreservices").hide(),CRMPlusCommonUi.handleServiceHighlighting(),$j('#crmpluscommonuimoreservicelinks [id$="commonuileftpanelswitch"].selected').length){var elementtovisible=$j('#crmpluscommonuimoreservicelinks [id$="commonuileftpanelswitch"].selected')[0],elementtohide=$j('#commonuileftpanelswitchlist [id$="commonuileftpanelswitch"]:visible');elementtohide=elementtohide[elementtohide.length-1];var orderForElement=$j(elementtohide).attr("order");if(orderForElement=+orderForElement,orderForElement===allVisibleServices.length-1)$j("#crmpluscommonuimoreservicelinks>ul").append(elementtohide);else{var prevElement=$j('#crmpluscommonuimoreservicelinks [order="'+(orderForElement+1).toString()+'"]');$j(prevElement).before(elementtohide)}$j("#commonuileftpanelswitchlist").append(elementtovisible)}var deptWidth=0;$j("#crmpluscommonuidepartments").is(":visible")&&(deptWidth+=$j("#crmpluscommonuidepartments").outerWidth(!0));var availableWidth=$j("#crmpluscommonuitopbar").outerWidth(!0)-($j("#commonuileftpanelswitchicon").outerWidth(!0)+deptWidth+$j("#crmpluscommonuitopbaroptions").outerWidth(!0)+200);this.isLeftPanelVisible||(availableWidth=availableWidth-$j("#crmpluscommonuitopbarserviceName").outerWidth(!0)+3);var isMoreModuleAvailable=$j("#commonUimoreModuleListicon").is(":visible");if(availableWidth>commonUiModuleList.outerWidth(!0)){if(isMoreModuleAvailable)for(var elementsInMoreList=$j("#"+commonUimoreModuleListId+">li"),index=0;availableWidth>commonUiModuleList.outerWidth(!0)&&index<elementsInMoreList.length;){var element=elementsInMoreList[index++];$j(element).hide(),commonUiModuleList.append(element);var widthInTopBar=$j(element).outerWidth(!0);if(commonUimoreModuleList.prepend(element),$j(element).show(),availableWidth-commonUiModuleList.outerWidth(!0)>=widthInTopBar){var orderForElement=$j(element).attr("order");if(orderForElement=+orderForElement,0==orderForElement)commonUiModuleList.prepend(element);else{var preElement=$j("#"+commonUiModuleListId+' [order="'+(orderForElement-1).toString()+'"]');preElement.length&&(preElement=$j(preElement[0]),preElement.after(element))}}else availableWidth=commonUiModuleList.outerWidth(!0)}}else for(var allElements=$j("#"+commonUiModuleListId+">li"),index=allElements.length-1;availableWidth<=commonUiModuleList.outerWidth(!0)&&index>=0;){var element=allElements[index--];if(!$j(element).hasClass("selected")){var orderForElement=$j(element).attr("order");orderForElement=+orderForElement;var firstMoreElement=$j("#"+commonUimoreModuleListId+">li");if(firstMoreElement.length){var orderForFirsElement=$j(firstMoreElement[0]).attr("order");if(orderForFirsElement=+orderForFirsElement,orderForFirsElement>orderForElement)commonUimoreModuleList.prepend(element);else if(orderForElement==$j("#"+commonUimoreModuleListId+">li").length+$j("#"+commonUiModuleListId+">li").length-1)commonUimoreModuleList.append(element);else{var nearElement=$j("#"+commonUimoreModuleListId+' [order="'+(orderForElement-1).toString()+'"]');nearElement.length?$j(nearElement[0]).after(element):(nearElement=$j("#"+commonUimoreModuleListId+' [order="'+(orderForElement+1).toString()+'"]'),nearElement.length&&$j(nearElement[0]).before(element))}}else commonUimoreModuleList.append(element)}}$j("#"+commonUimoreModuleListId+">li").length>0?$j("#commonUimoreModuleListicon").show():$j("#commonUimoreModuleListicon").hide()},handleLeftPanel:function(){!Common.canTreatLeftPanelVisible()&&Common.canHidePanel&&(CRMPlusCommonUi.hideLeftPanel(),Common.handleWindowSize())},hideLeftPanel:function(isAnimation){void 0===isAnimation&&(isAnimation=!0),this.isLeftPanelVisible=!1,$j("#commonuileftpanelswitchicon>i").removeClass("plus-pinit"),$j("#commonuileftpanelswitchicon>i").addClass("plus-switchback"),$j("#commonuileftpanelswitchicon").addClass("IcnroatateY"),isAnimation?$j("#crmpluscommonuileftpanel").stop().animate({left:-1*$j("#crmpluscommonuileftpanel").outerWidth(!0)},{duration:200,queue:!1,always:function(){(Common.isLeftPanelToggleClicked||void 0===Common.isLeftPanelToggleClicked)&&(Common.handleWindowSize(),Common.isLeftPanelToggleClicked=!1)}}):$j("#crmpluscommonuileftpanel").css("left",-1*$j("#crmpluscommonuileftpanel").outerWidth(!0)),CRMPlusCommonUi.isTopBarHidden.current?Common.canShowSwitchIconOnHiddenTopBar(Services.currentView)?($j("#commonuileftpanelswitchicon").addClass("zcrmp-signuptimeIcn"),$j("#commonuileftpanelswitchicon").show()):$j("#commonuileftpanelswitchicon").hide():$j("#commonuileftpanelswitchicon").removeClass("zcrmp-signuptimeIcn"),hidePanel()},showLeftPanel:function(isAnimation){void 0===isAnimation&&(isAnimation=!0),this.isLeftPanelVisible=!0,$j("#commonuileftpanelswitchicon").show(),$j("#commonuileftpanelswitchicon").removeClass("IcnroatateY zcrmp-signuptimeIcn"),$j("#commonuileftpanelswitchicon>i").removeClass("plus-pinit"),$j("#commonuileftpanelswitchicon>i").removeClass("plus-switchback"),$j("#commonuileftpanelswitchicon>i").addClass(Common.canTreatLeftPanelVisible()===!1?"plus-pinit":"plus-switchback"),isAnimation?$j("#crmpluscommonuileftpanel").stop().animate({left:0},{duration:200,queue:!1,always:function(){(Common.isLeftPanelToggleClicked||void 0===Common.isLeftPanelToggleClicked)&&(Common.handleWindowSize(),Common.isLeftPanelToggleClicked=!1)}}):$j("#crmpluscommonuileftpanel").css("left",0)},toggleLeftPanel:function(){var currentStatus=!1;Common.canTreatLeftPanelVisible()&&(currentStatus=!0),Common.isLeftPanelToggleClicked=!0,Common.setUserOptions(ZCPConstants.LEFTPANEL_VISIBLE,!currentStatus),this.handleLeftPanelVisibility(!currentStatus),"search"==TopBar.type&&CRMPlusUnifiedSearch.handleProfileIcon()},handleLeftPanelVisibility:function(status,isAnimation){if(void 0===isAnimation&&(isAnimation=!0),null===status){CRMPlusCommonUi.showLeftPanel(isAnimation),$j("#commonuimodulelistdiv").stop().animate({left:-3},{duration:200,queue:!1});var leftpanelSwitchIcon=$j("#commonuileftpanelswitchicon"),leftPanel=$j("#crmpluscommonuileftpanel");leftpanelSwitchIcon.bind("mouseover",CRMPlusCommonUi.showLeftPanel),leftpanelSwitchIcon.bind("mouseleave",CRMPlusCommonUi.onLeftPanelMouseLeave),leftPanel.bind("mouseover",CRMPlusCommonUi.showLeftPanel),leftPanel.bind("mouseleave",CRMPlusCommonUi.onLeftPanelMouseLeave)}else if(status===!0){CRMPlusCommonUi.showLeftPanel(isAnimation),$j("#commonuimodulelistdiv").stop().animate({left:15},{duration:200,queue:!1});var leftpanelSwitchIcon=$j("#commonuileftpanelswitchicon"),leftPanel=$j("#crmpluscommonuileftpanel");leftpanelSwitchIcon.unbind("mouseover"),leftpanelSwitchIcon.unbind("mouseleave"),leftPanel.unbind("mouseover"),leftPanel.unbind("mouseleave")}else{CRMPlusCommonUi.hideLeftPanel(isAnimation),$j("#commonuimodulelistdiv").stop().animate({left:-3},{duration:200,queue:!1});var leftpanelSwitchIcon=$j("#commonuileftpanelswitchicon"),leftPanel=$j("#crmpluscommonuileftpanel");leftpanelSwitchIcon.unbind("mouseover"),leftpanelSwitchIcon.unbind("mouseleave"),leftPanel.unbind("mouseover"),leftPanel.unbind("mouseleave"),leftpanelSwitchIcon.bind("mouseover",CRMPlusCommonUi.showLeftPanel),leftpanelSwitchIcon.bind("mouseleave",CRMPlusCommonUi.onLeftPanelMouseLeave),leftPanel.bind("mouseover",CRMPlusCommonUi.showLeftPanel),leftPanel.bind("mouseleave",CRMPlusCommonUi.onLeftPanelMouseLeave)}},changeTheme:function(theme){if(void 0!==theme&&theme!==this.defaultTheme){"default"===theme&&(theme=this.defaultTheme);var className;switch(theme){case"bluefan":className="zcrmp-bluefanTheme";break;case"orange":className="zcrmp-orangeTheme";break;case"green":className="zcrmp-greenTheme";break;case"teal":className="zcrmp-tealTheme";break;case"white":className="zcrmp-whiteTheme";break;case"darkblue":className="zcrmp-darkblueTheme";break;case"darkgrey":className="zcrmp-darkgreyTheme";break;case"pink":className="zcrmp-pinkTheme";break;case"blue":className="zcrmp-blueTheme";break;default:className=""}$j("body").removeClass(this.currentThemeClass),$j("body").addClass(className),this.currentThemeClass=className;var curtheme=Common.getUserOptions(ZCPConstants.COMMONUI_THEME);void 0===curtheme&&(curtheme=this.defaultTheme),$j("#crmpluscommonuitheme"+curtheme).removeClass("selected"),$j("#crmpluscommonuitheme"+theme).addClass("selected"),this.defaultTheme=theme,Common.setUserOptions(ZCPConstants.COMMONUI_THEME,theme),Common.handleWindowSize()}},handleBlur:function(){Common.isCrmplusFocused&&Services.focusedService===Services.previousLoadedFrame&&(CRMPlusCommonUi.search.hideSearchFilters(),SidePanel.hideQuickLinkEditDialog(),CRMPlusCommonUi.handleLeftPanel(),hidePanel(!0))},setSelected:function(serviceName,moduleKey,type){if(void 0!==moduleKey){var commonUiModuleListId="commonUiModuleList"+serviceName,commonUimoreModuleListId="commonUimoreModuleList"+serviceName;if("module"===type||"submodule"===type){{var selectedElement=$j("#"+commonUiModuleListId+" li.selected");this.currentModuleList[serviceName]}$j(selectedElement).removeClass("selected");var newElement=$j("#crmpluscommonui_"+serviceName+"_"+moduleKey.replace(/[\s.]/g,""));newElement.addClass("selected"),newElement.attr("parent")&&$j("#crmpluscommonui_"+serviceName+"_"+newElement.attr("parent")).addClass("selected"),$j("#"+commonUimoreModuleListId+">li.selected").length&&($j("#"+commonUiModuleListId).append(newElement),serviceName===Services.currentView&&this.handleWindowSize())}serviceName==Services.currentView&&CRMPlusCommonUi.browserTitle.set(serviceName)}},initTopBar:function(type,serviceName){if("default"===type||"adminpanel"!==serviceName&&1==Common.isSignUp&&!Services.isOverviewCompleted[serviceName])return $j("#crmpluscommonuitopbarservicemainview").show(),$j("#crmpluscommonuimoduleanddepartmentdiv").hide(),$j("#crmpluscommonuisearchview").hide(),$j("#crmpluscommonuitopbaroptions").hide(),$j("#crmpluscommonuisetupicon").hide(),$j("#commonuimodulelistdiv").hide(),$j("#crmpluscommonuisetupbar").hide(),$j("#crmpluscommonuisetupbarold").hide(),$j("#crmpluscommonuiclose").hide(),$j("#crmpluscommonuitopbar").removeClass("zcrmp-setupView"),$j("#crmpluscommonuitopbartemplate").show(),void $j("#commonuileftpanelswitchicon").show();if("setup"===type)TopBar.previousType=type,$j("#crmpluscommonuitopbartemplate").hide(),$j("#crmpluscommonuitopbarservicemainview").hide(),$j("#crmpluscommonuisearchview").hide(),$j("#commonuileftpanelswitchicon").hide(),Common.isNewUI?($j("#crmpluscommonuiclose").show(),$j("#crmpluscommonuisetupbar").show(),TopBar.setup.construct()):$j("#crmpluscommonuisetupbarold").show(),$j("#crmpluscommonuitopbar").addClass("zcrmp-setupView");else if("crmplus"===type)$j("#crmpluscommonuitopbartemplate").hide(),$j("#crmpluscommonuisetupbar").hide(),$j("#crmpluscommonuisetupbarold").hide(),$j("#crmpluscommonuisearchview").hide(),$j("#crmpluscommonuiclose").hide(),$j("#commonuileftpanelswitchicon").show(),$j("#crmpluscommonuimoduleanddepartmentdiv").show(),$j("#crmpluscommonuitopbaroptions").show(),$j("#commonuimodulelistdiv").show(),$j("#crmpluscommonuitopbarservicemainview").show(),$j("#crmpluscommonuitopbar").removeClass("zcrmp-setupView"),this.showTopBarElements(serviceName),this.handleNotificationsIcons(serviceName),this.handleQuickAccessIcons(serviceName);else if("search"==type)return TopBar.previousType=type,void CRMPlusUnifiedSearch.initTopBar(type,serviceName)},showTopBarElements:function(serviceName){var currentModuleList=CRMPlusCommonUi.currentModuleList[serviceName];if(void 0!==currentModuleList){if(void 0!=currentModuleList.module){var moduleJson=currentModuleList.module;this.showTopbarModules(serviceName,moduleJson)}else serviceName===ZCPConstants.SERVICE_SALESINBOX&&this.showTopbarModules(serviceName,{});void 0!=this.currentDepartmentInfo[serviceName]&&this.renderSelectedAndAddDepartment(serviceName)}$j("#crmpluscommonuiaddoptionlist"+serviceName).length>0?($j("#crmpluscommonuiaddoptionicon").show(),$j("#crmpluscommonuiaddoptionlist"+serviceName).show()):$j("#crmpluscommonuiaddoptionicon").hide()},showServiceSpecificOption:function(serviceName){0!=$j("#"+serviceName+"specificoptionsdiv").length&&($j("#crmpluscommonuispecificoptionheader").text(I18N.getValue("service.title."+serviceName)+" Options"),$j("#"+serviceName+"specificoptionsdiv").show(),$j("#crmpluscommonuispecificoption").slideDown(200,"linear",function(){Common.setProfilePanelHeight()}))},showTopbarModules:function(serviceName,moduleJson){var commonUiModuleListId="commonUiModuleList"+serviceName,commonUimoreModuleListId="commonUimoreModuleList"+serviceName;0!=$j("#"+commonUiModuleListId).length&&($j("#"+commonUiModuleListId).show(),$j("#"+commonUimoreModuleListId).show(),moduleJson.hasAddNew===!0?$j("#crmpluscommonuiaddnewmodule").show():$j("#crmpluscommonuiaddnewmodule").hide(),$j("#commonUimoreModuleList > li").length>0?$j("#commonUimoreModuleicon").show():$j("#commonUimoreModuleicon").hide())},showErrorPage:function(type,errorData){if(void 0!==type)switch(type){case"unabletoload":CRMPlusCommonUi.resetErrorPage();var header=I18N.getValue("service.creation.error.header"),message=I18N.getValue("commonui.errorpage.message"),customDiv='<div class="zcrmp-pageErrBtn" onclick="Services.getRedirectionUrl(Services.currentView);">'+I18N.getValue("service.creation.tryagain")+"</div>";CRMPlusCommonUi.setErrorPageContent("/error-image6.png",header,message,customDiv),$j("#commonerrorpage").show(),Services.hideServiceIframe(Services.currentView);break;case"noaccessforservice":CRMPlusCommonUi.resetErrorPage(),CRMPlusCommonUi.setErrorPageContent(errorData.image,errorData.header,errorData.message),$j("#commonerrorpage").show();break;case"noaccessforservices":CRMPlusCommonUi.resetErrorPage();var header=I18N.getValue("crmplus.errorheader.uhoh"),message=I18N.getValue("crmplus.errormessage.noaccessforservices")+"<br/>";Common.crmplusPortalCount>1&&(message+="<span class='blueTxt pointer' onclick='Common.fetchPortals();'>"+I18N.getValue("crmplus.label.switchportal")+"</span> (or) "),message+=I18N.getValue("crmplus.errormessage.contactadmin",["<a rel='noopener' href='mailto:"+Common.ownerEmailID+"'>"+Common.ownerEmailID+"</a>"]),CRMPlusCommonUi.setErrorPageContent("/error-image2.png",header,message,void 0,void 0,!0,!0),$j("#commonerrorpage").show();break;case"noaccessforadminpanel":CRMPlusCommonUi.resetErrorPage();var header=I18N.getValue("crmplus.error.accessdenied"),message=I18N.getValue("commonui.errorpage.nonadmin.adminpanel.message");CRMPlusCommonUi.setErrorPageContent("/error-image2.png",header,message),$j("#commonerrorpage").show(),Services.hideServiceIframe(Services.currentView);break;case"unabletocreateservice":CRMPlusCommonUi.resetErrorPage();var header=I18N.getValue("service.creation.error.header"),message=I18N.getValue("service.creation.error.message"),customDiv='<div class="zcrmp-pageErrBtn" onclick="Services.fetchUsedAccountsData(\''+errorData.servicename+"',true, false);\">"+I18N.getValue("service.creation.tryagain")+"</div>";customDiv+='<span class="greyTxt pL15 pR15">(or)</span><a class="underline" rel="noopener" id="crmplus-errpage-button2" onclick="Feedback.showFeedbackDialog();">'+I18N.getValue("button.contactus")+"</a>",CRMPlusCommonUi.setErrorPageContent("/error-image6.png",header,message,customDiv),$j("#commonerrorpage").show();break;case"conflictcase":CRMPlusCommonUi.resetErrorPage(),CRMPlusCommonUi.setErrorPageContent(errorData.image,errorData.header,errorData.message,errorData.customdiv,errorData.script),$j("#commonerrorpage").show();break;case"conflictmember":CRMPlusCommonUi.resetErrorPage(),CRMPlusCommonUi.setErrorPageContent(errorData.image,errorData.header,errorData.message,errorData.customdiv),$j("#commonerrorpage").show()}},setErrorPageContent:function(errImage,header,message,customDiv,script,isFullPage,isFooterNeeded){null!==errImage&&void 0!==errImage&&""!==errImage.trim()&&($j("#commonerrorpage-image").attr("src",Common.staticImgUrl+errImage),Services.onIframeUIReady(Services.currentView)),$j("#commonerrorpage-header").html(header),$j("#commonerrorpage-message").html(message),$j("#commonerrorpage-customdiv").html(customDiv),null==header||void 0==header||""==header.trim()?$j("#commonerrorpage-header").hide():$j("#commonerrorpage-header").show(),script&&$j("<script>").attr("type","text/javascript").text(script).appendTo("#commonerrorpage-customdiv"),isFullPage?$j("#commonerrorpage").addClass("zcrmp-EntireError"):$j("#commonerrorpage").removeClass("zcrmp-EntireError"),isFooterNeeded?$j("#crmpluscommonuifooterforfullview").show():$j("#crmpluscommonuifooterforfullview").hide()},resetErrorPage:function(){$j("#commonerrorpage-image").removeAttr("src"),CRMPlusCommonUi.setErrorPageContent(null,"","","")},changeSize:function(query,isAnimation,height,width,topx,left){var element=$j(query);if(isAnimation){var styleJson={top:topx,left:left};void 0!==height&&(styleJson.height=height),void 0!==width&&(styleJson.width=width),element.stop().animate(styleJson,{duration:200,queue:!1})}else void 0!==height&&element.css({height:height}),void 0!==width&&element.css({width:width}),element.css({top:topx,left:left})},updateField:function(serviceName,type,key,newvalue){switch(type){case"module":var id="crmpluscommonui_"+serviceName+"_"+key.replace(/[\s.]/g,"");$j("#"+id+">a").text(newvalue);break;case"department":var id="crmpluscommonui_"+serviceName+"_department_id"+key.replace(/[\s.]/g,"");$j("[id$='"+id+"']").text(newvalue),this.currentDepartmentInfo[serviceName].currentdepartment.key===key&&(this.currentDepartmentInfo[serviceName].currentdepartment.label=newvalue),$j("#crmpluscommonuiselecteddepartment").attr("selecteddepartmentid")==id&&$j("#crmpluscommonuiselecteddepartment").text(newvalue)}},constructAddRecordOptionUI:function(serviceName,json){if($j("#crmpluscommonuiaddoptionlist"+serviceName).length>0)$j("#crmpluscommonuiaddoptionlist"+serviceName).html("");else{var ulElement=document.createElement("ul");$j(ulElement).addClass("zcrmp-serDeprtmntList"),$j(ulElement).attr("id","crmpluscommonuiaddoptionlist"+serviceName),$j("#crmpluscommonuiaddoptionlist").append(ulElement)}var serviceListElement=$j("#crmpluscommonuiaddoptionlist"+serviceName);if(serviceListElement.hide(),void 0!==json){var list=json.list;if(void 0!==list)for(var i=0;i<list.length;i++){var option=list[i],id="crmpluscommonuiaddrecordoptionlist_"+serviceName+"_"+option.key,li=document.createElement("li");$j(li).text("+ "+option.label),$j(li).attr("id",id),serviceListElement.append(li),Common.addClickEventListener("#"+id,ServiceCommunicator.triggerAction,[serviceName,"showAddRecordView",option.key,"#event#"],ServiceCommunicator)}for(var key in json)if("list"!==key){var customJson=json[key],label=customJson.label,customList=customJson.list,liForHeader=document.createElement("li");$j(liForHeader).text(label),$j(liForHeader).addClass("zcrmp-lineSep"),serviceListElement.append(liForHeader);for(var i=0;i<customList.length;i++){var option=customList[i],id="crmpluscommonuiaddrecordoptionlist_"+serviceName+"_"+option.key,li=document.createElement("li");$j(li).text("+ "+option.label),$j(li).attr("id",id),serviceListElement.append(li),Common.addClickEventListener("#"+id,ServiceCommunicator.triggerAction,[serviceName,"showAddRecordView",option.key,"#event#"],ServiceCommunicator)}}}0===$j("#crmpluscommonuiaddoptionlist"+serviceName+">li").length&&serviceListElement.remove(),serviceName===Services.currentView&&(0==$j("#crmpluscommonuiaddoptionlist"+serviceName).length?$j("#crmpluscommonuiaddoptionicon").hide():($j("#crmpluscommonuiaddoptionicon").show(),serviceListElement.show()))},handleNotificationsIcons:function(serviceName){$j("#crmpluscommonuinotificationgamescope").hide(),$j("#crmpluscommonuinotificationtimer").hide(),$j("#crmpluscommonuinotificationmailbox").hide(),$j("#crmpluscommonuinotificationfolder").hide(),$j("#crmpluscommonuinotificationcalendar").hide(),$j("#crmpluscommonuinotificationteam").hide(),$j("#crmpluscommonuinotificationgeneral").hide(),$j("#crmpluscommonuinotificationpendingactivities").hide(),$j("#crmpluscommonuinotificationmessageboard").hide();var notificationJson=CRMPlusCommonUi.notifications[serviceName];if(void 0!==notificationJson)for(var key in notificationJson)if(notificationJson[key]){var id="crmpluscommonuinotification"+key;$j("#"+id).show();var countJson=CRMPlusCommonUi.notificationsCount[serviceName],alertJson=CRMPlusCommonUi.isAlertIcon[serviceName],alertIcon=!1,count=0;void 0!==countJson&&(count=countJson[key]),void 0!==alertJson&&(alertIcon=alertJson[key]),CRMPlusCommonUi.setNotificationCount(key,count,alertIcon)}},handleClickOnNotificationIcon:function(event,type){("zia"==type||"stickynotes"==type||"ziachatbot"==type||"telephonyWidget"==type)&&(CRMPlusCommonUi.clickedChatBarIcon=void 0,"zia"==type&&CRMPlusCommonUi.handleZiaNotificationsCount(Services.currentView,type,0)),null!==CRMPlusCommonUi.currentNotificationView&&CRMPlusCommonUi.currentNotificationView!==type&&CRMPlusCommonUi.hideNotificationDialog(Services.currentView);var position={top:0},left=$j("#crmpluscommonuinotification"+type).position().left-$j("#crmpluscommonuileftpanel").outerWidth(!0);position.left=left;var notificationJson={};notificationJson.type=type,notificationJson.position=position,ServiceCommunicator.triggerAction(Services.currentView,"showNotificationDialog",notificationJson,event),CRMPlusCommonUi.currentNotificationView=type},handleChatBarSize:function(isAnimation){void 0===isAnimation&&(isAnimation=!0);var leftForChat=0,widthForChat=$j(window).outerWidth(!0);1==Common.canTreatLeftPanelVisible()&&(leftForChat=$j("#crmpluscommonuileftpanel").outerWidth(!0),widthForChat-=leftForChat);var chatBar=$j("#wmstoolbar");isAnimation?chatBar.stop().animate({left:leftForChat,width:widthForChat},{duration:200,queue:!1}):chatBar.css({left:leftForChat,width:widthForChat})},handleNotificationsCount:function(serviceName,type,count,isAlertIcon){if("zia"===type)return void CRMPlusCommonUi.handleZiaNotificationsCount(serviceName,type,count,isAlertIcon);void 0===CRMPlusCommonUi.notificationsCount[serviceName]&&(CRMPlusCommonUi.notificationsCount[serviceName]={}),void 0===CRMPlusCommonUi.isAlertIcon[serviceName]&&(CRMPlusCommonUi.isAlertIcon[serviceName]={});var currentJson=CRMPlusCommonUi.notificationsCount[serviceName],previousCount=currentJson[type];currentJson[type]=count;var currentAlerJson=CRMPlusCommonUi.isAlertIcon[serviceName],previousAlert=currentAlerJson[type];currentAlerJson[type]=isAlertIcon;var canHighlight=!1;0!=count?(void 0!=previousCount&&(count>previousCount||previousCount==count&&$j("#"+serviceName+"commonuileftpanelswitch").hasClass("_notiDot_"+serviceName))||void 0==previousCount)&&(canHighlight=!0):CRMPlusCommonUi.isNotificationsExist(serviceName)&&(canHighlight=!0),isAlertIcon?(void 0!=previousAlert&&(previousAlert!=isAlertIcon||previousAlert==isAlertIcon&&$j("#"+serviceName+"commonuileftpanelswitch").hasClass("_notiDot_"+serviceName))||void 0==previousAlert)&&(canHighlight=!0):CRMPlusCommonUi.isAlertExist(serviceName)&&(canHighlight=!0),0!=count&&isAlertIcon||0!=$j("#commonUiModuleList"+serviceName+" .zcrmp-alerting").length&&(canHighlight=!0),serviceName===Services.currentView?CRMPlusCommonUi.setNotificationCount(type,count,isAlertIcon):CRMPlusCommonUi.handleServiceHighlighting(serviceName,canHighlight)},handleZiaNotificationsCount:function(serviceName,type,count){void 0==count&&(count=0),count=parseInt(count),count>0?(count>99&&(count="99+"),$j("#crmplus"+serviceName+"ziacount > span").text(count),$j("#crmplus"+serviceName+"ziacount").show()):($j("#crmplus"+serviceName+"ziacount > span").text(0),$j("#crmplus"+serviceName+"ziacount").hide());var totalCount=+$j("#crmpluscrmziacount > span").text().split("+")[0]+ +$j("#crmplussupportziacount > span").text().split("+")[0];totalCount>0?(totalCount>99&&(totalCount="99+"),$j("#crmplustotalziacount").text(totalCount),$j("#crmplustotalziacount").show()):($j("#crmplustotalziacount").text("0"),$j("#crmplustotalziacount").hide())},setNotificationCount:function(type,count,isAlertIcon){void 0==count&&(count=0),count=parseInt(count),count>0?(count>99&&(count="99+"),$j("#crmpluscommonuinotification"+type+"count").text(count),$j("#crmpluscommonuinotification"+type+"count").show()):($j("#crmpluscommonuinotification"+type+"count").text(""),$j("#crmpluscommonuinotification"+type+"count").hide()),void 0==isAlertIcon&&(isAlertIcon=!1),isAlertIcon?$j("#crmpluscommonuinotification"+type).addClass("zcrmp-alertNotify"):$j("#crmpluscommonuinotification"+type).removeClass("zcrmp-alertNotify")},hideNotificationDialog:function(serviceName){null!=CRMPlusCommonUi.currentNotificationView&&(ServiceCommunicator.triggerAction(serviceName,"hideNotificationDialog",CRMPlusCommonUi.currentNotificationView),CRMPlusCommonUi.currentNotificationView=null)},appendNewUIElement:function(type,json,serviceName){if("submodule"===type){var parentKey=json.parentKey,key=json.key,parentId="submodules_"+serviceName+"_"+parentKey;$j("#"+parentId+"emptymessage").remove();var idForLi="crmpluscommonui_"+serviceName+"_"+key.replace(/[\s.]/g,""),li=document.createElement("li");$j(li).attr("id",idForLi),$j(li).attr("parent",parentKey),$j(li).attr("key",key);var anchor=document.createElement("a");if(void 0!=json.href){var subModuleHref=json.href.replace("#","/getcpdata/");anchor.setAttribute("href","#"+subModuleHref)}if($j(anchor).text($j.trim(json.label)),$j(li).append(anchor),0==$j("#"+parentId+">ul").length){var ulElement=document.createElement("ul");$j(ulElement).addClass("zcrmp-serDeprtmntList"),$j(ulElement).attr("max-height","300px"),$j("#"+parentId).append(ulElement)}$j("#"+parentId+">ul").append(li),Common.addClickEventListener("#"+idForLi+">a",ServiceCommunicator.triggerAction,[serviceName,"selectmodule",key,"#event#"],ServiceCommunicator)}},removeUIElement:function(type,key,serviceName){if("module"===type)$j("#crmpluscommonui_"+serviceName+"_"+key.replace(/[\s.]/g,"")).remove();else if("submodule"===type){var elementToDelete=$j("#crmpluscommonui_"+serviceName+"_"+key.replace(/[\s.]/g,"")),parentKey=elementToDelete.attr("parent"),parentId="submodules_"+serviceName+"_"+parentKey;if(elementToDelete.remove(),0==$j("#"+parentId+">ul>li").length){$j("#"+parentId+">ul").remove(),$j("#"+parentId+"emptymessage").remove();var emptyContent=CRMPlusCommonUi.createEmptyListContent(parentId+"emptymessage");$j("#"+parentId).append(emptyContent)}}else if("department"===type){var selectedDept=$j("#crmpluscommonuiselecteddepartment"),idPart="crmpluscommonui_"+serviceName+"_department_id";$j("[id$='"+idPart+key.id.replace(/[\s.]/g,"")+"']").remove(),void 0===key.currentdepartment&&idPart+key.id.replace(/[\s.]/g,"")===selectedDept.attr("selecteddepartmentid")&&(selectedDept.text(I18N.getValue("crmplus.label.select")+" "+I18N.getValue("crmplus.label."+this.currentDepartmentInfo.departmentlabel[serviceName])),selectedDept.attr("selecteddepartmentid","")),void 0!==key.currentdepartment&&this.setCurrentDepartment(serviceName,key.currentdepartment)}},hideTopBar:function(serviceName){if(("crmplus"===TopBar.type||void 0!==serviceName)&&Services.currentView===serviceName&&CRMPlusCommonUi.isTopBarHidden.current!==!0){$j("#crmpluscommonuitopbar").hide(),Services.setTopAndHeightForIframe(),CRMPlusCommonUi.isTopBarHidden.current=!0;var visiblity=Common.getUserOptions(ZCPConstants.LEFTPANEL_VISIBLE);Common.canShowSwitchIconOnHiddenTopBar(Services.currentView)&&!Common.canTreatLeftPanelVisible()?$j("#commonuileftpanelswitchicon").addClass("zcrmp-signuptimeIcn"):visiblity===!1&&$j("#commonuileftpanelswitchicon").hide()}},showTopBar:function(serviceName){if(void 0!==serviceName&&Services.currentView===serviceName&&CRMPlusCommonUi.isTopBarHidden.current!==!1){$j("#crmpluscommonuitopbar").show(),Services.setTopAndHeightForIframe(),CRMPlusCommonUi.isTopBarHidden.current=!1;var visiblity=Common.getUserOptions(ZCPConstants.LEFTPANEL_VISIBLE);visiblity===!1&&$j("#commonuileftpanelswitchicon").show(),$j("#commonuileftpanelswitchicon").removeClass("zcrmp-signuptimeIcn")}},handleClickedChatBarIcon:function(event,clickedChatBarIcon,serviceName){"zia"==clickedChatBarIcon||"stickynotes"==clickedChatBarIcon||"ziachatbot"==clickedChatBarIcon||"telephonyWidget"==clickedChatBarIcon?(Common.hideVisitorOnlinePanel(),Common.hideReminderPanel(),$j("#crmplusziaoptionpanel").hide(),Services.currentView!==serviceName?(CRMPlusCommonUi.clickedChatBarIcon=clickedChatBarIcon,Services.getRedirectionUrl(serviceName,!0,!1,void 0,"iframe-spinner")):Services.isServiceFrameVisible(Services.currentView)?CRMPlusCommonUi.handleClickOnNotificationIcon(event,clickedChatBarIcon):CRMPlusCommonUi.clickedChatBarIcon=clickedChatBarIcon):"activityreminders"==clickedChatBarIcon?$j("#plusReminderIcon").hasClass("selected")?Common.hideReminderPanel():($j("#plusReminderIcon").addClass("selected"),$j("#crmpluscommonui_reminders").slideDown(200,"linear"),$j("#plusRemindersCount").hide(),$j("#crmpluscommonui_reminders_container input").length>0?$j("#plusreminderscountonpaneltop").show():$j("#plusreminderscountonpaneltop").hide(),$j("#crmpluscommonui_reminders_container > div").not("#crmpluscommonui_reminders_container_nodatamsg").length<1&&(Common.fetchAndRenderReminderPanel(),$j("#crmpluscommonui_reminders_loading").css("margin","60px auto"))):"visitorsonline"==clickedChatBarIcon&&(Common.hideReminderPanel(),$j("#plusVisitorIcon").hasClass("selected")?Common.hideVisitorOnlinePanel():Common.showVisitorOnlinePanel())
},onProfilePanelScroll:function(){$j("[id^=sidepanelagent][id$=statuslist]").hide(),$j("[id^=sidepanelagent][id$=preferencesoptions]").hide(),$j("#crmpluscanceltrailoption").hide()},createEmptyListContent:function(id,message){void 0===message&&(message=I18N.getValue("global.add.address.info"));var divElement=document.createElement("div");return $j(divElement).addClass("greyTxt pT20 pB20 f13"),$j(divElement).attr("id",id),$j(divElement).text(message),divElement},onLeftPanelMouseMove:function(event){void 0!==event&&0==event.clientX&&"crmplus"===TopBar.type&&(CRMPlusCommonUi.isLeftPanelVisible||CRMPlusCommonUi.showLeftPanel())},onLeftPanelMouseLeave:function(event){if(!Common.canTreatLeftPanelVisible()&&Common.canHidePanel){var leftPanelPartCount,target=event.currentTarget;"commonuileftpanelswitchicon"===$j(target).attr("id")?leftPanelPartCount=$j("#crmpluscommonuileftpanel:hover").length:"crmpluscommonuileftpanel"===$j(target).attr("id")&&(leftPanelPartCount=$j("#commonuileftpanelswitchicon:hover").length),0===leftPanelPartCount&&CRMPlusCommonUi.hideLeftPanel()}},highlightEntity:function(serviceName,type,moduleKey,canHighlight){"module"==type&&void 0!=canHighlight&&(canHighlight?$j("#commonUiModuleList"+serviceName+" li.selected").attr("key")!=moduleKey&&$j("#crmpluscommonui_"+serviceName+"_"+moduleKey.replace(/[\s.]/g,"")).addClass("zcrmp-alerting"):($j("#crmpluscommonui_"+serviceName+"_"+moduleKey.replace(/[\s.]/g,"")).removeClass("zcrmp-alerting"),(CRMPlusCommonUi.isNotificationsExist(serviceName)||CRMPlusCommonUi.isAlertExist(serviceName))&&(canHighlight=!0)),CRMPlusCommonUi.handleServiceHighlighting(serviceName,canHighlight))},handleServiceHighlighting:function(serviceName,canHighlight){try{void 0!=serviceName&&(canHighlight&&serviceName!=Services.currentView?$j("#"+serviceName+"commonuileftpanelswitch").addClass("_notiDot_"+serviceName):$j("#"+serviceName+"commonuileftpanelswitch").removeClass("_notiDot_"+serviceName)),0!=$j('#crmpluscommonuimoreservicelinks li[class*="_notiDot_"]').length?$j("#crmpluscommonuimoreservices").addClass("_notiDot_"):$j("#crmpluscommonuimoreservices").removeClass("_notiDot_")}catch(e){}},isNotificationsExist:function(serviceName){var currentJson=CRMPlusCommonUi.notificationsCount[serviceName];for(var key in currentJson)if(void 0!=currentJson[key]&&0!=currentJson[key])return!0;return!1},isAlertExist:function(serviceName){var currentAlerJson=CRMPlusCommonUi.isAlertIcon[serviceName];for(var key in currentAlerJson)if(void 0!=currentAlerJson[key]&&currentAlerJson[key])return!0;return!1}};CRMPlusCommonUi.search={canSearch:{},isAdvancedSearchView:{},canShowFilters:!1,loadView:function(canLoadService){TopBar.type="search",Services.currentTopBarType=TopBar.type,CRMPlusCommonUi.initTopBar("search",Services.currentView),CRMPlusCommonUi.hideLeftPanel(),canLoadService!==!1&&Services.loadFrame(Services.currentView),CRMPlusCommonUi.search.UIType="fullview",$j("#crmpluscommonuisearchtext").focus()},show:function(serviceName,canConstruct){var currentServiceSearchDiv=$j("#crmpluscommonuisearchdiv"+serviceName);if(0==currentServiceSearchDiv.length&&void 0===CRMPlusCommonUi.searchData[serviceName])return void ServiceCommunicator.triggerAction(serviceName,"getSearchFilters");null!==CRMPlusCommonUi.searchData[serviceName]&&0!=canConstruct&&($j("#crmplusUnifiedSearch"+serviceName+"FiltersList").html(""),$j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked",!1),CRMPlusUnifiedSearch.constructNewSearchTopBar(serviceName),CRMPlusCommonUi.search.constructSearchUI(serviceName));var sJson=JSON.parse(sessionStorage.getItem("searchJson"+serviceName));"popup"!=CRMPlusCommonUi.search.UIType&&void 0==CRMPlusUnifiedSearch.lastService&&null!=sJson&&""==$j("#crmpluscommonuisearchtext").val()&&$j("#crmpluscommonuisearchtext").val(sJson.searchString),CRMPlusCommonUi.search.canShowFilters===!1&&null!==CRMPlusCommonUi.searchData[serviceName]?(CRMPlusCommonUi.search.hideServiceFilters(serviceName,!1),$j("#crmpluscommonuisearchservicediv"+serviceName).removeClass("loadingif"),$j("#crmpluscommonuisearchservicediv"+serviceName).addClass("loadingif"),$j("#searchLists"+serviceName+" li").removeClass("zcrmp-canttouch"),ServiceCommunicator.triggerAction(serviceName,"getCurrentDefaultFilters")):(CRMPlusCommonUi.search.canShowFilters=!1,$j("#crmpluscommonuisearchservicediv"+serviceName).removeClass("loadingif"),"popup"==CRMPlusCommonUi.search.UIType?($j("#crmpluscommonuisearchpopupfiltercontainer").html($j("#searchLists"+serviceName)),0!=$j("#searchLists"+serviceName).length&&$j("#crmpluscommonuisearchpopupfiltericon").show()):""==document.getElementById("crmplusUnifiedSearch"+serviceName+"FiltersList").innerHTML&&CRMPlusUnifiedSearch.initTopBar("search",serviceName),null==CRMPlusCommonUi.searchData[serviceName]&&$j("#crmpluscommonuisearchview").removeClass("zcrmp-adSrchBox"),CRMPlusCommonUi.search.canSearch[serviceName]!==!1&&CRMPlusCommonUi.search.handleClickOnFilters(Services.currentView))},constructSearchUI:function(serviceName){$j("#crmpluscommonuisearchdiv"+serviceName).remove();var searchParent=document.createElement("div");$j(searchParent).addClass("zcrmp-srchSubmod"),$j(searchParent).attr("id","crmpluscommonuisearchdiv"+serviceName),$j(searchParent).css({"max-height":"500px"});var searchElement=document.createElement("div");if($j(searchElement).addClass("clearFix zcrmp-srchSubmod"),$j(searchElement).attr("id","searchLists"+serviceName),$j(searchParent).append(searchElement),$j("#crmpluscommonuisearchservicediv"+serviceName).append(searchParent),Common.setScroll("crmpluscommonuisearchdiv"+serviceName),void 0!==CRMPlusCommonUi.searchData[serviceName].advancedsearch){var advancedli=document.createElement("div");$j(advancedli).addClass("zcrmp-advSrchHdr clearFix");var id="advancedsearchtoggle"+serviceName,spanHeader=document.createElement("span");$j(spanHeader).text(I18N.getValue("commonui.label.advancedsearch")),$j(spanHeader).addClass("fLeft pR20 lineHgt20"),$j(advancedli).append(spanHeader);var childdiv=document.createElement("div");$j(childdiv).addClass("fRight");var htmlForToggle='<label><input id="'+id+'" exclude="true" type="checkbox" class="toggle-check toggle-check-round"><i></i></label></div>';$j(childdiv).html(htmlForToggle),$j(advancedli).append(childdiv),$j(searchElement).append(advancedli),void 0!==CRMPlusCommonUi.searchData[serviceName].advancedsearch.filter&&(CRMPlusCommonUi.search.constructFilterUI(CRMPlusCommonUi.searchData[serviceName].advancedsearch.filter,serviceName,"advanced"),$j("#searchLists"+serviceName+' ul[type="advanced"]').hide()),Common.addClickEventListener("#advancedsearchtoggle"+serviceName,CRMPlusCommonUi.search.handleAdvancedSearchToggle,[serviceName,"#event#"],CRMPlusCommonUi.search)}var filters=CRMPlusCommonUi.searchData[serviceName].filter;CRMPlusCommonUi.search.constructFilterUI(filters,serviceName),Common.addClickEventListener("#searchLists"+serviceName,CRMPlusCommonUi.search.handleClickOnFilters,[serviceName,"#event#"],CRMPlusCommonUi.search)},constructFilterUI:function(filters,serviceName,searchType){void 0===searchType&&(searchType="normal");for(var filtersIndex in filters){var liElement,filter=filters[filtersIndex],filterName=filter.key,type=filter.type,className="zcrmp-smart"+type,name="searchfilter_"+serviceName+"_"+filterName.replace(/[\s.]/g,""),parentUL=document.createElement("ul");if($j(parentUL).addClass("clearFix"),$j(parentUL).attr("id","searchLists"+serviceName+"_"+filterName.replace(/[\s.]/g,"")),$j(parentUL).attr("type",searchType),$j("#searchLists"+serviceName).append(parentUL),"checkbox"===type){liElement=document.createElement("li");var idForAllFilter=name.replace(/[\s.]/g,"")+"allfilter";$j(liElement).addClass(className);var inputHtml="<label for="+escapeHtml(idForAllFilter)+"><input type="+escapeHtml(type)+" id="+escapeHtml(idForAllFilter)+" ><i>"+I18N.getValue("crmplus.common.all")+"</i></label>";$j(liElement).html(inputHtml),$j(parentUL).append(liElement),$j("#"+idForAllFilter).attr("filterGroup",filterName),$j("#"+idForAllFilter).attr("allfilter","true")}for(var index in filter.list){var filterElements=filter.list[index];liElement=document.createElement("li"),$j(liElement).addClass(className);var id="searchfilter_"+serviceName+"_"+filterName.replace(/[\s.]/g,"")+"_"+filterElements.key.replace(/[\s.]/g,""),idForLi="li_searchfilter_"+serviceName+"_"+filterName.replace(/[\s.]/g,"")+"_"+filterElements.key.replace(/[\s.]/g,"");$j(liElement).attr("id",idForLi);var inputHtml="<label for="+escapeHtml(id)+"><input type="+escapeHtml(type)+" name="+escapeHtml(name)+" id="+escapeHtml(id)+" ><i>"+escapeHtml(filterElements.label)+"</i></label>";$j(liElement).html(inputHtml),$j("#searchLists"+serviceName+"_"+filterName.replace(/[\s.]/g,"")).append(liElement),$j("#"+id).attr("filterGroup",filterName),$j("#"+id).attr("filterKey",filterElements.key),void 0!==filterElements.disabledFilters&&$j(liElement).prop("disabledFilters",filterElements.disabledFilters)}}},handleClickOnFilters:function(serviceName,event){if("popup"!=CRMPlusCommonUi.search.UIType)return void CRMPlusUnifiedSearch.handleClickOnFilters(serviceName,event);var clickedFilterKey=void 0,clickedFilterGroupKey=void 0;if(void 0!==event){event.stopPropagation();var element=getTargetElementFromEvent(event);if("INPUT"!==element.nodeName)return;var isAllFilterClicked=$j(element).attr("allfilter");if("true"==isAllFilterClicked){var filtergroup=$j(element).attr("filterGroup"),isChecked=$j(element).prop("checked");CRMPlusCommonUi.search.handleClickOnAllFilterCheckBox(serviceName,filtergroup,isChecked)}clickedFilterKey=$j(element).attr("filterKey"),clickedFilterGroupKey=$j(element).attr("filterGroup"),CRMPlusCommonUi.search.handleAllFilterCheckBox(serviceName,clickedFilterGroupKey)}void 0!==clickedFilterKey&&($j("#searchLists"+serviceName+" li").removeClass("zcrmp-canttouch"),CRMPlusCommonUi.search.handleUnAvailableFilters(serviceName,clickedFilterKey,clickedFilterGroupKey));var searchText=$j.trim($j("#crmpluscommonuisearchtext").val()),isAdvancedSearch=!1;1==$j("#advancedsearchtoggle"+serviceName).prop("checked")&&(isAdvancedSearch=!0),(""!==searchText||isAdvancedSearch)&&CRMPlusCommonUi.search.triggerSearch(serviceName,searchText)},triggerSearch:function(serviceName,searchText){var searchJson=CRMPlusCommonUi.search.getCurrentCheckedFiltes(serviceName);searchJson.searchString=searchText,CRMPlusCommonUi.search.canSearch[serviceName]=!1,CRMPlusCommonUi.isSearchViewInServices[serviceName]=!0,CRMPlusCommonUi.search.hideAutoSuggestView(serviceName),serviceName==ZCPConstants.SERVICE_CRM?jQuery.isEmptyObject(searchJson.filter)||ServiceCommunicator.triggerAction(serviceName,"triggersearch",searchJson):ServiceCommunicator.triggerAction(serviceName,"triggersearch",searchJson),serviceName==ZCPConstants.SERVICE_SURVEY&&(-1===TopBar.loadedServices.indexOf(serviceName)&&TopBar.loadedServices.push(serviceName),"iframe-spinner"==Services.loadingType&&Services.hideLoading(serviceName,"iframe-spinner")),serviceName!=ZCPConstants.SERVICE_SALESINBOX&&(CRMPlusUnifiedSearch.lastService=serviceName),sessionStorage.setItem("searchJson"+serviceName,JSON.stringify(searchJson)),CRMPlusUnifiedSearch.handleProfileIcon(),Common.handleWindowSize()},getCurrentCheckedFiltes:function(serviceName){if("popup"!=CRMPlusCommonUi.search.UIType)return CRMPlusUnifiedSearch.getCurrentCheckedFiltes(serviceName);var searchJson={},isAdvancedSearch=!1;if(1==$j("#advancedsearchtoggle"+serviceName).prop("checked")&&(isAdvancedSearch=!0),void 0!==CRMPlusCommonUi.searchData[serviceName]&null!==CRMPlusCommonUi.searchData[serviceName]){searchJson.isAdvancedSearch=isAdvancedSearch;var allfilter;if(allfilter=isAdvancedSearch?CRMPlusCommonUi.searchData[serviceName].advancedsearch.filter:CRMPlusCommonUi.searchData[serviceName].filter,void 0!==allfilter){var filterJson={};for(var index in allfilter){for(var currentFilterName=allfilter[index].key,checkedfilterArray=[],currentFilterUIName="searchfilter_"+serviceName+"_"+currentFilterName.replace(/[\s.]/g,""),parentFilterId="searchLists"+serviceName,checkedfilters=$j("#"+parentFilterId+' input[name="'+currentFilterUIName+'"]:checked'),checkedfilterindex=0;checkedfilterindex<checkedfilters.length;checkedfilterindex++){var filterKey=($j(checkedfilters[checkedfilterindex]).attr("id"),$j(checkedfilters[checkedfilterindex]).attr("filterKey"));checkedfilterArray.push(filterKey)}checkedfilterArray.length&&(filterJson[currentFilterName]=checkedfilterArray)}searchJson.filter=filterJson}}return searchJson},handleAdvancedSearchToggle:function(serviceName,event,canTriggerSearch){if($j("#advancedsearchtoggle"+serviceName).prop("checked")===!0)return $j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked",!0),void CRMPlusUnifiedSearch.handleAdvancedSearchToggle(serviceName,event,canTriggerSearch);if(void 0===canTriggerSearch&&(canTriggerSearch=!0),void 0!==event){event.stopPropagation();var element=getTargetElementFromEvent(event);if("INPUT"!==element.nodeName)return}var toggleObject=$j("#advancedsearchtoggle"+serviceName);toggleObject.prop("checked")===!0?($j("#crmpluscommonuisearchview").addClass("zcrmp-adSrchBox"),$j("#searchLists"+serviceName+' ul[type="normal"]').hide(),$j("#searchLists"+serviceName+' ul[type="advanced"]').show(),"popup"==CRMPlusCommonUi.search.UIType&&(CRMPlusCommonUi.search.hideSearchPopUp(),CRMPlusCommonUi.search.loadView(!1))):($j("#searchLists"+serviceName+' ul[type="normal"]').show(),$j("#searchLists"+serviceName+' ul[type="advanced"]').hide(),$j("#crmpluscommonuisearchview").removeClass("zcrmp-adSrchBox")),canTriggerSearch&&CRMPlusCommonUi.search.handleClickOnFilters(serviceName)},keyUpEventForSearch:function(event,type){if(void 0!==event&&"27"==event.keyCode&&"searchpop"===type)return void CRMPlusCommonUi.search.hideSearchPopUp();var textInputElem=$j("#crmpluscommonuisearchtext");"searchpop"==type?textInputElem=$j("#crmpluscommonuisearchpopuptext"):"salesinbox"==type&&(textInputElem=$j("#crmpluscommonuisalesinboxtext"));var textInput=textInputElem.val();if(void 0!==textInput&&""!==$j.trim(textInput)&&("salesinbox"!=type&&(CRMPlusCommonUi.search.hideSearchFilterPopUp(),$j("#crmpluscommonuisearchpopup>div").removeClass("shadowup"),$j("#crmpluscommonuisearchpopup>div").addClass("shadowup")),Services.isLoadedInIframe[Services.currentView]===!0))if(void 0!==event&&void 0!==event.keyCode&&"13"==event.keyCode){if(textInput.trim().length<2)return void showStatusMsg("error",I18N.getValue("crmplus.error.searchminimum"));if("searchpop"===type){$j("#crmpluscommonuisearchtext").val(textInput);var filterJson=CRMPlusCommonUi.search.getCurrentCheckedFiltes(Services.currentView);filterJson.searchString=textInput,sessionStorage.setItem("searchJson"+Services.currentView,JSON.stringify(filterJson)),CRMPlusCommonUi.search.hideSearchPopUp(),CRMPlusUnifiedSearch.loadView(),$j("#crmpluscommonuisearchtext").val(textInput),void 0!=filterJson.filter&&(CRMPlusUnifiedSearch.canSearch=!1,CRMPlusUnifiedSearch.handleDefaultCheckedFilters(Services.currentView,filterJson.filter),delete CRMPlusUnifiedSearch.canSearch)}CRMPlusCommonUi.search.canSearch={},CRMPlusCommonUi.search.triggerSearch(Services.currentView,textInput)}else{var dataForAutoSuggest={};dataForAutoSuggest.textInput=textInput,"searchpop"!=type&&(textInputElem=$j("#crmplusUnifiedSearchServiceTextParent")),Services.currentView==ZCPConstants.SERVICE_SALESINBOX&&(textInputElem=$j("#crmpluscommonuisalesinboxtextparent"));var inputBoxLocation=textInputElem.offset(),serviceLocation=$j("#"+Services.currentView+"LoadFrame").offset(),left=inputBoxLocation.left-serviceLocation.left,top=inputBoxLocation.top+textInputElem.outerHeight()-serviceLocation.top,width=textInputElem.outerWidth();"searchpop"===type?(dataForAutoSuggest.isPopup="1",width="730",left=($j("#crmpluscommonuisearchpopup").width()-730)/2+(CRMPlusCommonUi.isLeftPanelVisible?0:$j("#crmpluscommonuileftpanel").width())):dataForAutoSuggest.isPopup="0";var positiontoset={left:left+"px",top:top+"px",width:width+"px"};dataForAutoSuggest.position=positiontoset,dataForAutoSuggest.isleftpanelvisible=CRMPlusCommonUi.isLeftPanelVisible?"1":"0",CRMPlusCommonUi.search.isAdvancedSearchView[Services.currentView]=!0,ServiceCommunicator.triggerAction(Services.currentView,"ShowAutoSuggestForSearch",dataForAutoSuggest)}},onClose:function(){TopBar.onClose()},handleDefaultCheckedFilters:function(serviceName,checkedFilters){if(CRMPlusUnifiedSearch.handleDefaultCheckedFilters(serviceName,checkedFilters),$j("#crmpluscommonuisearchservicediv"+serviceName).removeClass("loadingif"),serviceName===Services.currentView){CRMPlusCommonUi.search.canShowFilters=!0,$j("#searchLists"+serviceName+" input").prop("checked",!1);var filter;for(filter in checkedFilters){for(var filterArray=checkedFilters[filter],index=0;index<filterArray.length;index++){var filterkey=filterArray[index],id="searchfilter_"+serviceName+"_"+filter.replace(/[\s.]/g,"")+"_"+filterkey.replace(/[\s.]/g,"");$j("#"+id).prop("checked",!0),CRMPlusCommonUi.search.handleUnAvailableFilters(serviceName,filterkey,filter)}CRMPlusCommonUi.search.handleAllFilterCheckBox(serviceName,filter)}checkedFilters.advancedSearch===!0?($j("#advancedsearchtoggle"+serviceName).prop("checked",!0),CRMPlusCommonUi.search.handleAdvancedSearchToggle(serviceName,void 0,!1)):($j("#advancedsearchtoggle"+serviceName).prop("checked",!1),CRMPlusCommonUi.search.handleAdvancedSearchToggle(serviceName,void 0,!1)),CRMPlusCommonUi.search.show(serviceName,!1),CRMPlusCommonUi.search.canSearch[serviceName]!==!1&&CRMPlusCommonUi.search.handleClickOnFilters(Services.currentView)}},handleUnAvailableFilters:function(serviceName,clickedFilterKey,clickedFilterGroupKey){CRMPlusUnifiedSearch.handleUnAvailableFilters(serviceName,clickedFilterKey,clickedFilterGroupKey);var liElement=$j("#li_searchfilter_"+serviceName+"_"+clickedFilterGroupKey.replace(/[\s.]/g,"")+"_"+clickedFilterKey.replace(/[\s.]/g,"")),disabledFilters=liElement.prop("disabledFilters");if(void 0!==disabledFilters){$j("#searchLists"+serviceName+" li").removeClass("zcrmp-canttouch");for(var i=0;i<disabledFilters.length;i++){var liId="li_searchfilter_"+serviceName+"_"+disabledFilters[i].replace(/[\s.]/g,"")+"_";$j("#searchLists"+serviceName+' [id^="'+liId+'"]').addClass("zcrmp-canttouch")}}},showSearchFilters:function(){if(Services.currentView!==ZCPConstants.SERVICE_SALESINBOX)$j("#crmpluscommonuisearchfilterlist").show(),CRMPlusCommonUi.search.showServiceFilters(Services.currentView,!0);else{textInputElem=$j("#crmpluscommonuisalesinboxtextparent");var inputBoxLocation=textInputElem.offset(),serviceLocation=$j("#"+Services.currentView+"LoadFrame").offset(),left=inputBoxLocation.left-serviceLocation.left,top=inputBoxLocation.top+textInputElem.outerHeight()-serviceLocation.top,width=textInputElem.outerWidth(),position={left:left+"px",top:top+"px",width:width+"px"};ServiceCommunicator.triggerAction("salesinbox","showSearchFilter",position)}},hideSearchFilters:function(){$j("#crmpluscommonuisearchfilterlist").hide()},showServiceFilters:function(serviceName,isAnimate){if($j("#crmpluscommonuisearchfilterlist").is(":visible")){var current=$j('#crmpluscommonuisearchfilterlist [id^="crmpluscommonuisearchdiv"]:visible')[0],currentElementHeight=0;void 0!==current&&(currentElementHeight=$j(current).outerHeight(!0));var height=$j("#crmpluscommonuisearchfilterlistscrolldiv").outerHeight(!0)-$j("#crmpluscommonuisearchfilterlistscrolldiv>ul").outerHeight(!0)+currentElementHeight-$j("#crmpluscommonuisearchfilterlistheader").outerHeight(!0),currentSearchDiv=$j("#crmpluscommonuisearchdiv"+serviceName);currentSearchDiv.show(),isAnimate?currentSearchDiv.animate({"max-height":height},{duration:300,queue:!1}):currentSearchDiv.css({"max-height":height})}},hideServiceFilters:function(serviceName,isAnimate){isAnimate?$j("#crmpluscommonuisearchdiv"+serviceName).animate({"max-height":0},{duration:300,queue:!1,complete:function(){$j("#crmpluscommonuisearchdiv"+serviceName).hide()}}):($j("#crmpluscommonuisearchdiv"+serviceName).css({"max-height":0}),$j("#crmpluscommonuisearchdiv"+serviceName).hide())},hideAutoSuggestView:function(serviceName){CRMPlusCommonUi.search.isAdvancedSearchView[serviceName]===!0&&(ServiceCommunicator.triggerAction(serviceName,"HideAutoSuggestForSearch"),CRMPlusCommonUi.search.isAdvancedSearchView[serviceName]=!1)},showSearchPopUp:function(){$j("#crmpluscommonuisearchpopup>div").removeClass("shadowup"),$j("#crmpluscommonuisearchtext").val(""),CRMPlusCommonUi.search.UIType="popup",$j("#crmpluscommonuisearchpopup").show(),$j("#crmpluscommonuisearchpopup").attr("currentService",Services.currentView),$j("#crmpluscommonuisearchpopupinputcontainer").stop().animate({width:"730px"},{duration:300,queue:!1}),$j("#crmpluscommonuisearchpopuptext").focus(),$j("body").addClass("zcrmp-srchpanfreeze"),CRMPlusCommonUi.search.show(Services.currentView),ServiceCommunicator.handleFreezerLayerVisibility(Services.currentView,!0)},hideSearchPopUp:function(){if("popup"===CRMPlusCommonUi.search.UIType){CRMPlusCommonUi.search.UIType=null,$j("body").removeClass("zcrmp-srchpanfreeze"),$j("#crmpluscommonuisearchpopupinputcontainer").stop().animate({width:"0px"},{duration:200,queue:!1,complete:function(){$j("#crmpluscommonuisearchpopup").hide()}}),$j("#crmpluscommonuisearchpopuptext").val(""),CRMPlusCommonUi.search.hideSearchFilterPopUp(!1),$j("#crmpluscommonuisearchpopupfiltericon").hide();var serviceToHide=$j("#crmpluscommonuisearchpopup").attr("currentService");$j("#crmpluscommonuisearchpopup").removeAttr("currentService"),CRMPlusCommonUi.search.hideAutoSuggestView(serviceToHide),ServiceCommunicator.handleFreezerLayerVisibility(serviceToHide,!1),$j("#searchLists"+serviceToHide).length&&$j("#crmpluscommonuisearchdiv"+serviceToHide).append($j("#searchLists"+serviceToHide))}},hideSearchFilterPopUp:function(isAnimate){void 0==isAnimate&&(isAnimate=!0);var filterContainer=$j("#crmpluscommonuisearchpopupfilter");isAnimate?filterContainer.stop().animate({"max-height":"0px"},{duration:300,queue:!1,complete:function(){filterContainer.hide()}}):(filterContainer.css({"max-height":"0px"}),filterContainer.hide()),$j("#crmpluscommonuisearchpopupfiltericon").removeClass("selected")},showSearchFilterPopUp:function(isAnimate){void 0==isAnimate&&(isAnimate=!0);var filterContainer=$j("#crmpluscommonuisearchpopupfilter");""!=$j("#crmpluscommonuisearchpopupfiltercontainer").html()&&(filterContainer.show(),isAnimate?filterContainer.stop().animate({"max-height":"500px"},{duration:300,queue:!1}):filterContainer.css({"max-height":"500px"}),$j("#crmpluscommonuisearchpopupfiltericon").addClass("selected"))},clearAdvancedSearch:function(){$j("#advancedsearchtoggle"+Services.currentView).prop("checked",!1),CRMPlusCommonUi.search.handleAdvancedSearchToggle(Services.currentView)},handleClickOnAllFilterCheckBox:function(serviceName,filterGroup,ischecked){if("popup"!=CRMPlusCommonUi.search.UIType)return void CRMPlusUnifiedSearch.handleClickOnAllFilterCheckBox(serviceName,filterGroup,ischecked);{var id="searchLists"+serviceName+"_"+filterGroup.replace(/[\s.]/g,"");"searchfilter_"+serviceName+"_"+filterGroup.replace(/[\s.]/g,"")}ischecked?$j("#"+id+" input").prop("checked",!0):$j("#"+id+" input").prop("checked",!1)},handleAllFilterCheckBox:function(serviceName,filterGroup){if("popup"!=CRMPlusCommonUi.search.UIType)return void CRMPlusUnifiedSearch.handleAllFilterCheckBox(serviceName,filterGroup);var id="searchLists"+serviceName+"_"+filterGroup.replace(/[\s.]/g,""),name="searchfilter_"+serviceName+"_"+filterGroup.replace(/[\s.]/g,""),checkedfilters=$j("#"+id+' input[name="'+name+'"]:checked'),allFilters=$j("#"+id+' input[name="'+name+'"]');checkedfilters.length==allFilters.length?$j("#"+name+"allfilter").prop("checked",!0):$j("#"+name+"allfilter").prop("checked",!1)}},CRMPlusCommonUi.browserTitle={titles:{},setForService:function(serviceName,title){CRMPlusCommonUi.browserTitle.titles[serviceName]=title,Services.currentView==serviceName&&CRMPlusCommonUi.browserTitle.set(serviceName)},set:function(serviceName){var titleToChange=CRMPlusCommonUi.browserTitle.titles[serviceName];void 0===titleToChange&&"setup"!=TopBar.type&&"search"!=TopBar.type&&(titleToChange=CRMPlusCommonUi.currentlySelectedModule(serviceName)),(void 0===titleToChange||""==titleToChange.trim())&&(titleToChange=I18N.getValue("service.title."+serviceName)),Common.changeBrowserTitle(titleToChange)}},CRMPlusCommonUi.currentlySelectedModule=function(serviceName){var selectedElement=$j("#commonUiModuleList"+serviceName+" li.selected a")[0];return $j(selectedElement).text()},AdminPanel.hash,AdminPanel.init=function(){AdminPanel.authRoles.defaultRoleId={admin:1,nonadmin:2},AdminPanel.authRoles.fetch()},AdminPanel.layout={fetch:function(callback){var params={};Common.appProperties&&0!=$j("#admin-panel-data-temp").length||Services.hasAdminPanelAccess&&(params.is_include_appprop=!0),$j.ajax({type:"GET",loadingParams:{type:"iframe"},data:params,url:Common.getPortalUrl(!0)+"/adminpanellayout.do",success:function(data){$j("body").css("overflow","hidden"),$j("#crmplus-adminpanel").length>0?(data=$j(data).filter("#crmplus-adminpanel"),$j("#crmplus-adminpanel").replaceWith(data)):0==$j("#crmplus-adminpanel-templates").length?$j("#serviceFrameContainer").append(data):$j(data).insertBefore("#crmplus-adminpanel-templates"),AdminPanel.adjustWidth(),AdminPanel.adjustHeight(),AdminPanel.authRoles.set(),Common.htmlContext="#crmplus-adminpanel",AdminPanel.util.attachevents(),callback?callback():AdminPanel.layout.defaultView()}})},show:function(callback,refetch){Services.setTopAndHeightForIframe("adminpanel"),void 0===refetch&&$j("#crmplus-adminpanel").length>0?($j("#iframeLoading").css("display","none"),$j("#crmplus-adminpanel").fadeIn(),callback&&callback()):this.fetch(callback)},defaultView:function(){AdminPanel.users.show()},hide:function(){$j("#crmplus-adminpanel").hide(),AdminPanel.users.hideDetail()}},AdminPanel.overView={get:function(callback){$j.ajax({type:"GET",loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do?action=overview",success:function(data){$j("#adminPanelContBody").append(data);var configuredApps=AdminPanel.util.getConfiguredApps();for(var index in configuredApps){var appName=configuredApps[index];AdminPanel.apps.getOwner(appName)}callback&&callback(),AdminPanel.overView.attachEvents(),AdminPanel.showCurrentTabView()}})},show:function(callback){$j("#overview").length>0?($j("#overview").show(),callback&&callback()):this.get(callback),addSelected($j("#overview-li")),Hash.set("settings/apps"),AdminPanel.toggleModules("overview")},attachEvents:function(){for(var index in Services.nameArray){var appName=Services.nameArray[index],apAddUserLink=$(appName+"-add-user");if(apAddUserLink&&null!=apAddUserLink){var clickListener=AdminPanel.apps.showAddUser.bind(AdminPanel.apps,appName,null);Common.addEventListener(apAddUserLink,"click",clickListener)}}Common.addClickEventListener("#adminpanel-overview-apps [data-click]")}},AdminPanel.adjustHeight=function(){var adminPanelBodyHeight=$j(window).height()-($j("#crmpluscommonuitopbar").height()+$j("#wms-chatwindowcontainer").height()+$j("#adminPanelContHeader").height());$j("#adminPanelContBody").css("height",adminPanelBodyHeight)},AdminPanel.adjustWidth=function(){var width=$j(window).width()-$j(".zcrmp-adminLeftPan").width(),widthInPx=width+"px";$j("#adminPanelContHeader").css("width",widthInPx),$j("#adminPanelRhs").css("width",widthInPx)},AdminPanel.showCurrentTabView=function(){var id="adduserview",selectedTabID=$j("#crmplus-adminpanel-tabs .selected").attr("view");selectedTabID&&(id=selectedTabID),AdminPanel.toggleModules(id)},AdminPanel.toggleModules=function(id){$j("#adminPanelContHeader > div").css("display","none"),$j("#adminPanelContBody > div").css("display","none"),$j("#"+id+"header").css("display","block"),$j("#"+id).css("display","block"),"userview"!=id&&AdminPanel.users.hideDetail()},AdminPanel.subscriptionView={get:function(callback,action){var service,appProp,confUsagestatsServices=[];for(service in Services.configuredServicesData)appProp=AdminPanel.appProperties.get(service),Services.configuredServicesData[service].ISCONFIGURED&&AdminPanel.authRoles.isAuthorized(service)&&appProp&&appProp.has_addons&&confUsagestatsServices.push(service);if("subscriptionstats"==action)if($j.ajax({type:"GET",loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do?action=licensestats",success:function(data){0==$j("#substab-licensestats").length&&($j("#substab-usagestats").length>0?($j(data).insertBefore($j("#substab-usagestats")),$j("#substab-usagestats").show()):$j("#subscriptionview").append($j(data))),callback&&callback()}}),confUsagestatsServices.length>0){var json={};json.services=confUsagestatsServices;var params={};params.data=JSON.stringify(json),params.data.services=confUsagestatsServices,$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/adminpanel.do?action=usagestats",data:params,success:function(data){$j("#substab-usagestats-table").removeClass("zcrmp-dummyTabs text"),$j("#substab-usagestats-tbody>.substab-usagestats-dummy-row").remove(),$j("#substab-usagestats-tbody").append(data),callback&&callback()}})}else $j("#substab-usagestats").remove();else"usercountstats"==action&&$j.ajax({type:"GET",loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do?action="+action,success:function(data){AdminPanel.subscriptionView.setUserStats(data),callback&&callback()}})},show:function(callback){$j("#substab-licensestats").length>0?(this.get(callback,"usercountstats"),callback&&callback()):this.get(callback,"subscriptionstats"),addSelected($j("#subscriptionview-li")),Hash.set("settings/subscription"),AdminPanel.toggleModules("subscriptionview")},setUserStats:function(data){var userstats=data.subscription[0].userstats,totalUsers=userstats.paidusers;"freeusers"in userstats&&(totalUsers+=userstats.freeusers);var reminingLic=totalUsers-userstats.used;0>reminingLic&&(reminingLic=0);userstats.usedlightuser;$j("#substab-tot-users").text(totalUsers),userstats.freeusers>0&&($j("#substab-paidusers").text(userstats.paidusers),$j("#substab-freeusers").text(userstats.freeusers)),$j("#substab-used-lic").text(userstats.used),$j(".substab-lic-remain").text(reminingLic),0==reminingLic?$j("#substab-licensestats .zcrmp-donutvalue").addClass("allused"):$j("#substab-licensestats .zcrmp-donutvalue").removeClass("allused"),$j("#substab-lightusers").text(userstats.usedlightuser);var toBeFilled=100*(userstats.used/totalUsers),fillValue=""+toBeFilled+","+(100-toBeFilled);$j("#substab-fillcircle").attr("stroke-dasharray",fillValue)}},AdminPanel.orgView={logoPreviewReader:void 0,get:function(callback){$j.ajax({type:"GET",loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do?action=orgview",success:function(data){$j("#adminPanelContBody").append(data),callback&&callback(),AdminPanel.showCurrentTabView()}})},show:function(callback){$j("#orgview").length>0?($j("#orgview").show(),callback&&callback()):this.get(callback),addSelected($j("#orgview-li")),Hash.set("settings/orgs"),AdminPanel.toggleModules("orgview")},refresh:function(){$j("#orgview").remove(),AdminPanel.orgView.show()},fetchEditForm:function(field){showLoading(),$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/fetchAdminpanelOrgEditForm.do",success:function(responseText){AdminPanel.orgView.showEditForm(field,responseText)},complete:function(){hideLoading()}})},showEditForm:function(field,editFormHtml){if(void 0===editFormHtml)return void AdminPanel.orgView.fetchEditForm(field);var html=$j("<div>").append(editFormHtml),button=I18N.getValue("crmplus.label.update");showDialog("crmplus-dialog",I18N.getValue("crmplus.orginfo.header.edit"),html,button,"$c('#orginfoform').submit()"),AdminPanel.orgView.populateEditForm(),$c("#crmplus-org-editform").show(),void 0==field&&(field="companyname"),$c("#adminpanel-orgeditform-"+field).focus()},hideEditForm:function(){hideDialog("crmplus-dialog",!0)},checkPortalAvailability:function(){var portalName=$j("[name='portal']").val(),apiUrl=window.location.origin+"/api/v1/orgs/"+Common.myOrgId+"/verifyportal?filter_portal="+portalName;
portalName.length>3&&$j.ajax({type:"GET",url:apiUrl,success:function(){}})},changeOwner:function(){var newOwner=$c("#crmplus-apps-adduser-container .js-user-autosugg:visible")[0],newOwnerZUID=newOwner?newOwner.getAttribute("identifier"):void 0;if(void 0===newOwnerZUID||isNaN(newOwnerZUID))return void showStatusMsg("error",I18N.getValue("crmplus.error.select_owner"));var params={};params.action="changeowner",params.zuids=newOwnerZUID,params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),showLoading(),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/adminpanel.do",data:params,success:function(data){var isError=AdminPanel.util.handleError(data);isError||(AdminPanel.orgView.refresh(),$j("#crmplus-adminpanel").removeClass("zcrmp-role-sadmin"),$j("#crmplus-adminpanel").addClass("zcrmp-role-admin"),hideDialog("crmplus-dialog",!0),$c("#crmplus-apps-adduser-label").removeAttr("style"),showStatusMsg("success",I18N.getValue("crmplus.success.owner_change")))},complete:function(){hideLoading()}})},showChangeOwner:function(){var inputComponent=$j("#crmplus-apps-adduser").clone(),noteComponent=$j("#crmplus-adminpanel-note").clone();inputComponent.attr("type","owner"),html=$j("<div>").append(inputComponent),html.append(noteComponent);var button=I18N.getValue("adminview.changeowner");showDialog("crmplus-dialog",button,html,button,"AdminPanel.orgView.changeOwner()"),$c("#crmplus-apps-adduser").show(),$c("#crmplus-apps-adduser-label").text(I18N.getValue("adminpanel.changeowner.choose")),$c("#crmplus-apps-adduser-label").css({"text-transform":"none","font-size":"14px"}),$c("#crmplus-adminpanel-note").show(),$c("#crmplus-apps-adduser-email").focus(),$c("#crmplus-apps-adduser").attr("onkeyup","AdminPanel.util.getAutoFillUsers('autofill_users',event)")},uploadLogo:function(files){var formData=new FormData,file=files[0];formData.append("logo[org_logo]",file),formData.append(Security.csrfParam.get(),encodeURIComponent(Security.csrfToken.get()));var apiUrl=window.location.origin+"/api/v1/orgs/"+Common.myOrgId+"/logo";$j("#crmplus-org-logo-parent").addClass("loading"),$j.ajax({type:"POST",url:apiUrl,data:formData,processData:!1,contentType:!1,dataType:"text",success:function(){},complete:function(){$j("#crmplus-org-logo-parent").removeClass("loading")},error:function(){var logoElement=$j("#crmplus-org-logo");delete AdminPanel.orgView.logoPreviewReader,logoElement.removeAttr("src"),logoElement.attr("src",logoElement.attr("psrc")),logoElement.removeAttr("psrc")}})},showPreview:function(input){if(input.files&&input.files[0]){var file=input.files[0],fileSize=file.size,fileName=file.name;if(!isImageFile(fileName))return void showStatusMsg("error",I18N.getValue("setup.company.logo.file"));if(fileSize>ZCPConstants.COMPANY_LOGO_MAX_SIZE)return void showStatusMsg("error",I18N.getValue("setup.company.logo.size"));var logoElement=$j("#crmplus-org-logo");logoElement.attr("psrc",logoElement.attr("src")),AdminPanel.orgView.logoPreviewReader=showPreview(input,"crmplus-org-logo"),AdminPanel.orgView.uploadLogo(input.files)}},submitForm:function(formObj,isFromOnBoardPopUp,params){var length=0;void 0!==formObj&&(length=formObj.elements.length);var orgInfoJson={};orgInfoJson.address={};for(var canSubmit=!0,firstInvalidInput=null,i=0;length>i;i++){var ele=formObj.elements[i],keyName=ele.name,keyValue=ele.value;void 0!==keyName&&""!=keyName&&(CRMPlusValidator.isValidInputField(ele)||(canSubmit=!1,null==firstInvalidInput&&(firstInvalidInput=ele)),"timezone"!==keyName&&"language"!==keyName&&"currency_locale"!==keyName?"street"===keyName||"city"===keyName||"state"===keyName||"country"===keyName||"postal_code"===keyName?orgInfoJson.address[keyName]=keyValue:orgInfoJson[keyName]=keyValue:orgInfoJson[keyName]=$j(ele).attr("key"))}if(!canSubmit)return null!=firstInvalidInput&&$j(firstInvalidInput).focus(),!1;var orgJson={};if(orgJson.orgs=orgInfoJson,null==Common.currentPortalName)return Common.scheduleCompanyPopUp(orgInfoJson),$j("#onboardpopup").fadeOut(500),!1;var isRetry=!1;isFromOnBoardPopUp&&void 0!==params&&(orgJson.orgs=params,isRetry=!0);var params={};params.data=JSON.stringify(orgJson),params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get());var loadParams;return isFromOnBoardPopUp?loadParams={id:"onBoardProceedBtn",type:"button"}:showLoading(),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/adminpanel.do?action=updateorg",loadingParams:loadParams,data:params,dataType:"json",success:function(responseJson){if("200"==responseJson.status_code){if(void 0===isFromOnBoardPopUp)AdminPanel.orgView.refresh(),AdminPanel.orgView.hideEditForm(),void 0!==AdminPanel.hasLanguageChange&&AdminPanel.hasLanguageChange&&location.reload();else{$j("#onboardpopup").fadeOut();var service=ZCPConstants.SERVICE_CRM;if(void 0!==AdminPanel.hasLanguageChange&&AdminPanel.hasLanguageChange&&(service=void 0,Services.reloadFrame(service)),void 0!=Common.isCompanyPopUpShown&&Common.isCompanyPopUpShown&&(Common.trackFeature(ZCPConstants.COMPANYPOPUPSHOWN),Common.isCompanyPopUpShown=void 0),isFromOnBoardPopUp&&Common.trackFeature(ZCPConstants.COMPANYPOPUPSUBMIT),Services.configuredServicesData&&Services.configuredServicesData.crm){var crmData=Services.configuredServicesData.crm;crmData.STATUS!=ZCPConstants.STATUS_NOTCONFIGURED||crmData.APPID||"crm"!=Services.currentView||Services.completeOverView()}}isRetry||showStatusMsg("success",I18N.getValue("crmplus.orginfo.message.editsuccess")),CRMPlusLocalStorage.remove("companyInfoFormObj")}},complete:function(){hideLoading()}}),!1},populateEditForm:function(){var fieldsToBePopulated=["companyname","website","mobile","phone","fax","street","city","state","country","postalcode"];for(var index in fieldsToBePopulated){var field=fieldsToBePopulated[index],fieldElement=$j("#adminpanel-orginfo-"+field);fieldElement.hasClass("zcrmp-nodata")||$c("#adminpanel-orgeditform-"+field).val(fieldElement.text())}$c("#adminpanel-orgeditform-timezone").val($j("#adminpanel-orginfo-timezone").text()),$c("#adminpanel-orgeditform-timezone").attr("key",$j("#adminpanel-orginfo-timezone").attr("key")),$c("#adminpanel-orgeditform-language").val($j("#adminpanel-orginfo-language").text()),$c("#adminpanel-orgeditform-language").attr("key",$j("#adminpanel-orginfo-language").attr("key"))},showList:function(type){$c("#adminpanel-orgeditform-"+type+"list").show(),$c("#adminpanel-orgeditform-"+type+"-nomatch").hide(),$c("#adminpanel-orgeditform-"+type+"-search").val(""),$c("#adminpanel-orgeditform-"+type+"list-parent").stop().fadeIn("fast"),$c("#adminpanel-orgeditform-"+type+"-search").focus()},hideList:function(type){var inputElement=$c("#adminpanel-orgeditform-"+type+"list-parent");inputElement.stop().fadeOut("fast",function(){var liList=$c("#adminpanel-orgeditform-"+type+"list>li");liList.removeClass("selected"),liList.show()})},selectOnList:function(type,event){Common.stopEvents(event,!0);var clickedElement=getTargetElementFromEvent(event);"LI"==clickedElement.nodeName&&void 0!=clickedElement&&(clickedElement=$c(clickedElement),inputElement=$c("#adminpanel-orgeditform-"+type),inputElement.attr("key",clickedElement.attr("key")),inputElement.val(clickedElement.text()),"language"===type&&(AdminPanel.hasLanguageChange=!0))},searchOnList:function(type,event){if(void 0!==event&&void 0!==event.keyCode&&"13"==event.keyCode){var selectedElement=$c("#adminpanel-orgeditform-"+type+"list>li.selected");return void(selectedElement.length>0&&($j(selectedElement).click(),AdminPanel.orgView.hideList(type)))}var searchString=$c("#adminpanel-orgeditform-"+type+"-search").val();searchString=searchString.toLowerCase();for(var liList=$c("#adminpanel-orgeditform-"+type+"list>li"),isEmpty=!0,index=0;index<liList.length;index++){var li=liList[index],textInLi=$j(li).text();$j(li).removeClass("selected"),void 0!=textInLi&&(textInLi=textInLi.toLowerCase(),-1==textInLi.indexOf(searchString)?$j(li).hide():(isEmpty=!1,$j(li).show()))}if(isEmpty)$c("#adminpanel-orgeditform-"+type+"list").hide(),$c("#adminpanel-orgeditform-"+type+"-nomatch").show();else{$c("#adminpanel-orgeditform-"+type+"-nomatch").hide(),$c("#adminpanel-orgeditform-"+type+"list").show();var liVisibleList=$c("#adminpanel-orgeditform-"+type+"list>li:visible"),visibleLi=liVisibleList[0];$j(visibleLi).addClass("selected")}},onLogoLoad:function(){$j("#crmplus-org-logo-default").hide(),$j("#crmplus-org-logo").show()},onLogoError:function(){$j("#crmplus-org-logo-default").show(),$j("#crmplus-org-logo").hide()}},AdminPanel.portal={validate:function(portal){var error,params={};return AdminPanel.portal.portalAjax&&AdminPanel.portal.portalAjax.abort(),portal.length<6||portal.length>30?error=I18N.getValue("portal.name.must")+" "+I18N.getValue("portal.name.characters"):Regex.map.portal.test(portal)||(error=I18N.getValue("portal.name.must")+" "+I18N.getValue("portal.name.special")),error?void this.addError(error):portal===Common.currentPortalName?void AdminPanel.portal.addStatusForPortalNameValidation("done"):(params.action="verifyportal",params.portal=portal,void(this.portalAjax=$j.ajax({type:"GET",data:params,url:Common.getPortalUrl(!0)+"/adminpanel.do",beforeSend:function(){AdminPanel.portal.addStatusForPortalNameValidation("loading")},success:function(data){var isError=AdminPanel.util.handleError(data);isError||data.verifyportal&&(data=data.verifyportal,data.isvalid?AdminPanel.portal.addStatusForPortalNameValidation("done"):AdminPanel.portal.addError(I18N.getValue("crmplus.error.potal_exist")))},complete:function(){$j("#crmplus-org-portal-parent").removeClass("load")}})))},addError:function(errorMsg){AdminPanel.portal.addStatusForPortalNameValidation("error"),$j("#crmplus-org-portal-error").attr("onmouseover","tooltip('"+errorMsg+"',event);")},update:function(event,isFromSubmitButton){var portalAjax,portalName=$j("#crmplus-org-portal-name").val().toLocaleLowerCase();if(!isFromSubmitButton&&13!=event.keyCode)return void AdminPanel.portal.validate(portalName,portalAjax);if(!$j("#crmplus-org-portal-parent").hasClass("error")){if(portalName===Common.currentPortalName)return void AdminPanel.portal.hideEditForm();var params={};params.action="updateportal",params.portal=portalName,params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){var isError=AdminPanel.util.handleError(data);isError||(showStatusMsg("success","Portal Name updated successfully!"),window.location.href=window.location.origin+"/"+portalName+"/index.do"+window.location.hash)}})}},reset:function(){$j("#crmplus-org-portal-name").val(Common.currentPortalName),$j("#crmplus-org-portal").removeClass("zcrmp-editportal"),$j("#crmplus-org-portal-parent").attr("class","")},addStatusForPortalNameValidation:function(type){$j("#crmplus-org-portal-parent").removeClass("done loading error"),void 0!==type&&$j("#crmplus-org-portal-parent").addClass(type)},showEditForm:function(){$j("#portalview").addClass("hide"),$j("#portaledit").removeClass("hide"),$j("#crmplus-org-portal-name").focus(),$j("#crmplus-org-portal-name").val(Common.currentPortalName)},hideEditForm:function(){$j("#portaledit").addClass("hide"),$j("#portalview").removeClass("hide"),AdminPanel.portal.addStatusForPortalNameValidation(void 0)}},AdminPanel.accountInfo={get:function(appName,appsoid,container,callback,callbackParmas,excludes){var params={};params.action="getaccountinfo",params.appsoid=appsoid,params.appname=appName;var loadParams=void 0;callback&&!$j("#fullpageloadingtext").is(":visible")&&(loadParams={type:"global"}),excludes&&(params.excludes=excludes),this.showLoading();var isAvailable=AdminPanel.permissions.isAvailable(appName);return isAvailable?void $j.ajax({type:"GET",data:params,url:Common.getPortalUrl(!0)+"/adminpanel.do",loadingParams:loadParams,success:function(data){0==$j("#admin-panel-data-temp #"+appName+"-account-info").length&&($j("#admin-panel-data-temp #account-info-cont").append($j(data)),AdminPanel.appProperties.has(appName)&&(Common.appProperties[appName].select_all_departments_for_admin=$j("#"+appName+"-role-options li[all_departments_selected=true]").length>0||$j("#"+appName+"-profile-options li[all_departments_selected=true]").length>0)),callback&&"function"==typeof callback&&callback.apply(null,callbackParmas),AdminPanel.accountInfo.show(appName,appsoid,container)},error:function(){AdminPanel.accountInfo.handleError(appName)},complete:function(){AdminPanel.accountInfo.hideLoading()}}):void AdminPanel.permissions.fetch(appName,AdminPanel.accountInfo.get.bind(AdminPanel.accountInfo,appName,appsoid,container,callback,callbackParmas,excludes))},show:function(appName,appsoid,containerID,callback){if($c("#app-account-info-error").length>0&&$c("#app-account-info-error").remove(),void 0===containerID&&(containerID="account-info-cont"),0==$j("#admin-panel-data-temp #"+appName+"-account-info").length)this.get(appName,appsoid,containerID,callback);else{if($c("#adduser-apps-list").length>0&&0==$c("#"+appName+"-adduser-li.selected").length)return;if(0==$c("#"+appName+"-account-info").length){var accInfoHTML=$j("#admin-panel-data-temp #"+appName+"-account-info").clone();$c("#"+containerID).append(accInfoHTML)}this.hideLoading(),$c(".js-account-info-cont").hide(),$c("#"+appName+"-account-info").show();var isServiceAdmin=AdminPanel.authRoles.get(appName)>1,hasPermission=!AdminPanel.permissions.isApplicable(appName)||AdminPanel.permissions.isOwner(appName);Common.isAdmin||isServiceAdmin&&hasPermission?$j(".js-"+appName+"-admin").show():$j(".js-"+appName+"-admin").hide(),callback&&"function"==typeof callback&&callback(),this.applyCustomRole(appName),this.attachEvents(appName)}},applyCustomRole:function(appName,customRole){if(void 0===customRole){var isCustomRole=$c("#account-info-cont[custom-iam-sorg-role]").length>0;if(!isCustomRole)return;customRole=$c("#account-info-cont[custom-iam-sorg-role]").attr("custom-iam-sorg-role")}var lightUserError;customRole&&-1==customRole&&(lightUserError=I18N.getValue("crmplus.note.lightuser",[I18N.getValue("crmplus.role.lightagent")])),AdminPanel.util.mandateRole(appName,customRole,lightUserError)},handleError:function(appName,type){$c("#adduser-"+appName+"-check").prop("checked",!1),$c("#app-account-info-error").remove();var errorContainer,errorMsg=I18N.getValue("crmplus.error.account_info");if("license"===type){var isupgradeLink=$j("#crmplus-license-errornote #crmplus-license-errornote-upgradelink a").length>0;if(!isupgradeLink){var upgradeElement=createElement("a"),upgradeLink=Common.isAdmin?Services.allServiceUrl.paymentsurl:"javascript:;",upgradeText=I18N.getValue(Common.isAdmin?"crmplus.error.license.upgrade_admin":"subscription.message.contactadmin");upgradeElement.href=upgradeLink,$j(upgradeElement).text(upgradeText),upgradeElement.rel="noopneer",upgradeElement.target="_blank",$j("#crmplus-license-errornote #crmplus-license-errornote-upgradelink").append(upgradeElement)}if("#crmplus-dialog"!==Common.htmlContext)return $c("#crmplus-license-errornote").removeClass("hide"),void shakeElement("crmplus-license-errornote");if(errorMsg=I18N.getValue("crmplus.error.licenseused.2",[I18N.getValue("service.title.projects"),I18N.getValue("service.title.support")])+" "+I18N.getValue("crmplus.error.licenseused.otherapps")+" ",Common.isAdmin){var purchaseLink=createElement("a");purchaseLink.href=Services.allServiceUrl.paymentsurl,purchaseLink.rel="noopneer",$j(purchaseLink).text(I18N.getValue("crmplus.error.license.upgrade_admin")),purchaseLink.target="_blank",errorMsg+=purchaseLink.outerHTML}else errorMsg+=I18N.getValue("subscription.message.contactadmin")}if("iframeLoading"==Common.htmlContext&&0==$c("#account-info-cont").length)return void AdminPanel.onBoardAdmin.handleError(void 0,appName);if(!(void 0===type&&$c("#"+appName+"-adduser-li:visible").length>0&&0==$c("#"+appName+"-adduser-li.selected").length)){if(void 0===type&&0==$c("#"+appName+"-adduser-li:visible").length)return void showStatusMsg("error",I18N.getValue("crmplus.api.error.invalid_response_from_service",[appName]));$c(".js-account-info-cont").hide(),this.hideLoading(),0==$c("#app-account-info-error").length&&void 0===errorContainer&&(errorContainer=createElement("div","app-account-info-error"),errorContainer.innerHTML=errorMsg,errorContainer.setAttribute("class","zcrmp-adminServErr")),errorContainer&&$c("#account-info-cont").append(errorContainer)}},showLoading:function(){$c(".js-account-info-cont").hide(),$c("#app-account-info-loading").show()},hideLoading:function(){$c("#app-account-info-loading").hide()},attachEvents:function(appName){var element=$c("#"+appName+"-account-info");element.length>0&&Common.addEventListener(element[0],"click",Common.superClickHandler)}},AdminPanel.departments={showSearch:function(appName){$c("#"+appName+"-departments-search-cont .zcrmp-labelHdr").hide(),$c("#"+appName+"-department-cont .zcrmp-deprtSrch").show(),$c("#"+appName+"-departments-search").focus()},hideSearch:function(appName){var depContainerID=appName+"-departments-container",isselected=$c("#"+depContainerID).hasClass("showSelected");isselected?AdminPanel.util.showDepartments(this,appName,"selected"):AdminPanel.util.showDepartments(this,appName)},search:function(appName,searchKey){var searchKey=searchKey.trim(),isEmpty=!0,isSelectedView=$c("#"+appName+"-departments-container").hasClass("showSelected"),departments=$c("#"+appName+"-departments-container .zcrmp-appsdepartlst");isSelectedView&&(departments=$c("#"+appName+"-departments-container .zcrmp-appsdepartlst.zchecked")),departments.each(function(){if(!this.classList.contains("zcrmp-checkHdr")){var text=$j(this.querySelector("label")).text().toLocaleLowerCase();-1==text.indexOf(searchKey.toLocaleLowerCase())?this.classList.add("hideImp"):(this.classList.remove("hideImp"),isEmpty=!1)}}),AdminPanel.util.toggleBulkCheckBox(appName);var nodata_element=$c("#"+appName+"-departments-nodata");if(isEmpty)nodata_element.text(I18N.getValue("adminpanel.adduser."+AdminPanel.util.getDepartmentAlias(appName)+".notmatched")),nodata_element.removeClass("hide");else{nodata_element.addClass("hide");var errorMessage=I18N.getValue("adminpanel.adduser."+AdminPanel.util.getDepartmentAlias(appName)+".noselected");nodata_element.text(errorMessage)}}},AdminPanel.adduser={show:function(view,userID,isSetHash,license,canShowInActiveApps){var appSelector="",makeChecked=!1,appsList=$j("#admin-panel-data-temp").html();if("page"==view)AdminPanel.toggleModules("adduserview"),$c("#adduser-apps-container").html(appsList),$c("#adduser-email").focus(),$j("#crmplus-adminpanel-tabs li").removeClass("selected"),AdminPanel.roles.hide();else if(-1!=Services.nameArray.indexOf(view)&&(appSelector="#"+view+"-adduser-",makeChecked=!0),userID){var zuidOrEmail=$j("#user-"+userID).attr("identifier"),closeAction=void 0;isSetHash&&(closeAction='AdminPanel.adduser.hide("'+userID+'")'),showDialog("crmplus-dialog",I18N.getValue("crmplus.label.assignapp"),appsList,I18N.getValue("crmplus.label.assign"),'AdminPanel.members.assignApps("'+zuidOrEmail+'","'+userID+'")',850,closeAction),DataTemplates.accountInfo.setMemberIdentifier(zuidOrEmail),AdminPanel.accountInfo.attachEvents(view)}var allowedApps=license?license.allowed_apps:void 0;AdminPanel.adduser.renderApps(userID,allowedApps,canShowInActiveApps),this.resetForm(),license&&license.is_license_available?$c("#crmplus-license-errornote").addClass("hide"):allowedApps&&($c("#account-info-cont").attr("custom-iam-sorg-role",License.lightUserIamSorgRole),AdminPanel.accountInfo.handleError(null,"license")),$c("#adduser-apps-list "+appSelector+"li:visible").length>0&&(makeChecked&&$c("#adduser-"+view+"-check").prop("checked",!0),$c("#adduser-apps-list "+appSelector+"li:visible:not(.zcrmp-opacity)")[0].click())},hide:function(userId){hideDialog("crmplus-dialog",!0),Hash.set("settings/users/"+userId)},resetForm:function(){$c("#adduser-email").val(""),$c("#adduser-email-error").hide(),$c("#add-user-error").removeAttr("error-type"),$c("#add-user-error").text(""),$c("#crmplus-license-errornote").removeClass("hide")},renderApps:function(userID,allowedApps,canShowInactiveApps){var serviceData,appCompenent,clickListener,hasAccess=!1,isDisabled=!1;for(var serviceName in Services.configuredServicesData)if(-1==Services.hidden.indexOf(serviceName))if(serviceData=Services.configuredServicesData[serviceName],userID?(hasAccess=0!=$j("#user-"+userID+" #"+serviceName+"-"+userID+" .js-userapp-status:visible[id="+serviceName+"-"+userID+"-unassign]").length,canShowInactiveApps&&!hasAccess&&(hasAccess=0!=$j("#user-"+userID+" #"+serviceName+"-"+userID+" .js-userapp-status:visible[id="+serviceName+"-"+userID+"-disable]").length)):hasAccess=serviceData&&serviceData.ISCONFIGURED&&(serviceData.IS_ADMIN||serviceData.HAS_ACCESS),hasAccess){if(appCompenent=$c("#"+serviceName+"-adduser-li"),appCompenent.length>0){clickListener=AdminPanel.adduser.showAppInfo.bind(AdminPanel.adduser,appCompenent,serviceName,serviceData.APPID),isDisabled=allowedApps&&-1==allowedApps.indexOf(serviceName);var isAppInActive="inactive"==$j("#"+serviceName+"-"+userID).attr("status");if(isDisabled)appCompenent.addClass("zcrmp-opacity"),clickListener=AdminPanel.accountInfo.handleError.bind(AdminPanel.accountInfo,serviceName,"license");else if(isAppInActive){var replacecallback=function(appName){var component=$c("#"+appName+"-adduser-li");component.length>0&&(component[0].onclick=AdminPanel.adduser.showAppInfo.bind(AdminPanel.adduser,component,appName,serviceData.APPID),component[0].removeAttribute("skip_validation"))}.bind(serviceName),identifier=$j("#user-"+userID).attr("identifier"),memberInfoCallBack=AdminPanel.members.show.bind(AdminPanel.members,serviceName,identifier,void 0,replacecallback);appCompenent[0].onclick=AdminPanel.adduser.showAppInfo.bind(AdminPanel.adduser,appCompenent,serviceName,serviceData.APPID,memberInfoCallBack),appCompenent[0].setAttribute("skip_validation",!0)}isAppInActive||Common.addEventListener(appCompenent[0],"click",clickListener)}}else $c("#"+serviceName+"-adduser-li").remove()},renderAppInfo:function(appName,appSOID,callBack){AdminPanel.accountInfo.show(appName,appSOID,void 0,callBack)},showAppInfo:function(element,appName,appSOID,callBack){addSelected(element),AdminPanel.adduser.renderAppInfo(appName,appSOID,callBack),DataTemplates.member.validate("apps",appName)},submit:function(showAllUsers,usersData,resultsStack){var params={},data=usersData,loadParams={id:"adminpanel-adduser-button",type:"button"};try{void 0===data&&(data=DataTemplates.member.getAddUserData())}catch(e){return e.type&&$c("#add-user-error").attr("error-type",e.type),void $c("#add-user-error").text(e.message)}$c("#add-user-error").removeAttr("error-type"),params.data=JSON.stringify(data),params.action="adduser",params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get());var ajax=$j.ajax({type:"POST",data:params,loadingParams:loadParams,url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){if(resultsStack)return void resultsStack.push(data);var error=AdminPanel.util.handleError(data,!1);return error&&void 0!=data.NOTE?void showDialog("crmplus-dialog",I18N.getValue("crmplus.label.note"),error,I18N.getValue("button.ok"),"hideDialog('crmplus-dialog')"):error&&void 0==data.app?void $c("#add-user-error").text(error):(error&&void 0!=data.app?showStatusMsg("error",I18N.getValue("crmplus.error.user_add",[I18N.getValue("service.title."+data.app)])):showStatusMsg("success",I18N.getValue("crmplus.success.user_add")),$c("#add-user-error").removeAttr("error-type"),$c("#add-user-error").text(""),void(showAllUsers&&($j("#users-view-list [type=active]").removeClass("selected"),$j("#userviewheader").removeAttr("filter"),AdminPanel.users.show())))}});return usersData?ajax:void 0},close:function(){AdminPanel.users.show(this.type)},validateLicense:function(type,userID,appName,license){var allowedApps=license.allowed_apps,hasPermissionForAnyAllowedApps=!1,isLightUser=!1;if("edit"==type&&userID&&(isLightUser=AdminPanel.users.isLightUser(userID)),allowedApps)if(hasPermissionForAnyAllowedApps=AdminPanel.authRoles.isAuthorizedForAnyApp(allowedApps),"edit"!=type&&"activate"!=type&&hasPermissionForAnyAllowedApps&&userID){var availableApps=AdminPanel.users.getApps(userID);hasPermissionForAnyAllowedApps=!1;for(var index in allowedApps){var app=allowedApps[index];-1==availableApps.indexOf(app)&&(hasPermissionForAnyAllowedApps=!0)}}else"edit"==type&&hasPermissionForAnyAllowedApps&&(hasPermissionForAnyAllowedApps=-1!=allowedApps.indexOf(appName));if(license.is_license_available||hasPermissionForAnyAllowedApps)if("edit"==type&&userID)!license.is_license_available&&license.custom_role_apps&&$j('#userview-table tr[identifier="'+userID+'"]').attr("iam-sorg-role",License.lightUserIamSorgRole),AdminPanel.members.show(appName,userID);else{var isActivate="activate"==type;AdminPanel.adduser.show(type,userID,void 0,license,isActivate)}else License.showError(isLightUser,license)}},AdminPanel.util={checkForAdmin:function(element,appName,containerID){var element=$c(element);if(element.length>0){void 0===containerID&&(containerID=appName+"-department-cont");var all_departments_selected=element.attr("all_departments_selected");"true"==all_departments_selected?($c("#"+containerID).addClass("zcrmp-custView"),$c("#"+appName+"-applyall").addClass("hide")):($c("#"+containerID).removeClass("zcrmp-custView"),$c("#"+appName+"-applyall").removeClass("hide"))}},showDepartments:function(element,appName,cond){addSelected(element);var depContainerID=appName+"-departments-container",selectedClass=" ",errorMessage=I18N.getValue("adminpanel.adduser."+this.getDepartmentAlias(appName)+".notavailable");"selected"==cond?($c("#"+depContainerID).addClass("showSelected"),selectedClass=" .zchecked",errorMessage=I18N.getValue("adminpanel.adduser."+this.getDepartmentAlias(appName)+".noselected")):$c("#"+depContainerID).removeClass("showSelected"),$c("#"+appName+"-departments-search").val(""),$c("#"+appName+"-departments-container .zcrmp-appsdepartlst").removeClass("hideImp");var nodata_element=$c("#"+appName+"-departments-nodata");0==$c("#"+depContainerID+selectedClass+".zcrmp-appsdepartlst").not(".zcrmp-checkHdr").length?(nodata_element.removeClass("hide"),nodata_element.text(errorMessage),$c("#"+appName+"-departments-container .zcrmp-appsdepartlst").addClass("hideImp"),$c("#"+appName+"-department-cont .zcrmp-labelHdr").hide(),$c("#"+appName+"-department-cont .zcrmp-deprtSrch").hide()):(AdminPanel.util.toggleBulkCheckBox(appName),nodata_element.addClass("hide"),$c("#"+appName+"-department-cont .zcrmp-labelHdr").show(),$c("#"+appName+"-department-cont .zcrmp-deprtSrch").hide())},getDepartmentAlias:function(appName){var appProp=AdminPanel.appProperties.get(appName);return appProp.department_alias?appProp.department_alias:"departments"},toggleChecked:function(element,counterID){var element=$c(element);if(!element.hasClass("zcrmp-canttouch")&&-1==element.attr("id").indexOf("-bulk-check")){var ischecked=element.is(":checked"),parentID=element.attr("parentID"),appName=parentID.substr(0,parentID.indexOf("-")),nodata_element=$c("#"+appName+"-departments-nodata"),count=$c("#"+appName+"-departments-container .js-apps-dept:not(.hideImp):not(.zcrmp-canttouch) .zcrmp-smartcheckbox input:checked").length,selectedClass=" .zchecked",errorMessage=I18N.getValue("adminpanel.adduser."+this.getDepartmentAlias(appName)+".noselected"),search_content=$c("#"+appName+"-departments-search").val();if(ischecked)$c("#"+parentID).addClass("zchecked");else{$c("#"+parentID).removeClass("zchecked");var depContainerID=appName+"-departments-container",isselected=$c("#"+depContainerID).hasClass("showSelected");0==count&&isselected&&(0==$c("#"+depContainerID+selectedClass+".zcrmp-appsdepartlst").not(".zcrmp-checkHdr").length?(nodata_element.removeClass("hide"),nodata_element.text(errorMessage),$c("#"+appName+"-departments-container .zcrmp-appsdepartlst").addClass("hideImp"),$c("#"+appName+"-department-cont .zcrmp-labelHdr").hide(),$c("#"+appName+"-department-cont .zcrmp-deprtSrch").hide()):(AdminPanel.departments.search(appName,search_content),$c("#"+appName+"-departments-search").focus()))}this.toggleBulkCheckBox(appName,count),count=$c("#"+appName+"-departments-container .js-apps-dept .zcrmp-smartcheckbox input:checked").length,$c("#"+counterID).text(count)}},toggleBulkCheckBox:function(appName,count){void 0===count&&(count=$c("#"+appName+"-departments-container .js-apps-dept:not(.hideImp):not(.zcrmp-canttouch) .zcrmp-smartcheckbox input:checked").length),count>0&&$c("#"+appName+"-departments-container .js-apps-dept:not(.hideImp):not(.zcrmp-canttouch)").length==count?$c("#"+appName+"-dep-bulk-check").prop("checked",!0):$c("#"+appName+"-dep-bulk-check").prop("checked",!1)},toggleBulkCheck:function(element,parentID,counterID){var ischecked=$c(element).is(":checked"),inputs=$c("#"+parentID+" .js-apps-dept:not(.hideImp):not(.zcrmp-canttouch) .zcrmp-smartcheckbox input");inputs.length>0&&inputs.each(function(){$c(this).prop("checked")!==ischecked&&($c(this).prop("checked",ischecked),AdminPanel.util.toggleChecked(this,counterID))})},checkForMotivator:function(){var motivatorData=void 0!=Services.configuredServicesData?Services.configuredServicesData.motivator:void 0;void 0!==motivatorData&&motivatorData.ISCONFIGURED&&$j("#crm-adduser-motivator-note").show()},applyToAll:function(appName){var roleName=$c("#"+appName+"-role").val(),roleID=$c("#"+appName+"-role").attr("role-id"),selectedDepartments=$c("#"+appName+"-departments-container .zchecked .js-"+appName+"-dep-role");selectedDepartments.each(function(){this.value=roleName,this.setAttribute("role-id",roleID)})},handleError:function(result,showError,filterErrorCode){var message,dataArray=[];Array.isArray(result)?dataArray=result:dataArray.push(result);for(var index in dataArray){var data=dataArray[index],status=data.status_code;if(200!=status&&201!=status&&204!=status&&(message=I18N.getValue("crmplus.message.common.tryafter"),data.hasOwnProperty("message")?message=data.message:data.hasOwnProperty("errors")&&data.errors.length>0&&(message=data.errors[0].code),filterErrorCode)){var errorCode=data.errors&&data.errors[0]&&data.errors[0].code?data.errors[0].code:void 0;if(errorCode==filterErrorCode)return data}else;}if(void 0===message)return!1;if(void 0!==showError&&!showError)return message;if(data.NOTE)showDialog("crmplus-dialog",I18N.getValue("crmplus.label.note"),message,I18N.getValue("button.ok"),"hideDialog('crmplus-dialog')");else{if("iframeLoading"==Common.htmlContext)return!0;showStatusMsg("error",message)}return!0},lookUpForUser:function(){var inputText=$c("#crmplus-apps-adduser-email").prop("value").trim(),canProceed=!("true"==$c("#crmplus-apps-adduser-parent").attr("inprogress"));if(inputText&&canProceed){var autoFillList=$j("#adminpanel-fixed-pop .js-user-autosugg").not(".error"),elementPosition=-1;if(autoFillList.length>0){for(i=0;i<autoFillList.length;i++){var email=$c(autoFillList[i]).find(".greyTxt").text().trim(),displayName=$c(autoFillList[i]).find(".zcrmp-usrNamefld").text().trim();if(email==inputText||displayName.toLowerCase()==inputText.toLowerCase()){if(-1!=elementPosition){elementPosition=-1;break}elementPosition=i}}-1!=elementPosition&&autoFillList[elementPosition].click()}if(-1==elementPosition){var profileText=AdminPanel.apps.getprofiletext(inputText),isChangeOwner=1==$c("#crmplus-apps-adduser[type=owner]").length;isChangeOwner&&$c("#crmplus-apps-adduser-parent").addClass("zcrmp-changeOwnr");var html='<div class="zcrmp-usrComp clearFix error"><div class="zcrmp-usrImageCont"><span class="zcrmp-usrNameLtrs">'+escapeHtml(profileText)+'</span></div><div class="zcrmp-addUsrDet"><div class="zcrmp-usrnameSts"><div class="zcrmp-usrNamefld">'+escapeHtml(inputText)+'</div></div><div class="greyTxt">'+I18N.getValue("crmplus.error.invalid_email")+'</div></div><div onclick="removeClosest(this,\'.zcrmp-usrComp\');AdminPanel.util.resetChangeOwnerCont();" title="Remove" class="zcrmp-usrCompRemv"><i class="plus-plus"></i></div></div>',div=createElement("div");
div.innerHTML=html;var element=div.childNodes;$c("#crmplus-apps-adduser-container").append(element)}$c("#crmplus-apps-adduser-email").prop("value","")}},_populateAutoFill:function(html){$c("#crmplus-apps-adduser-options").html(html);var listItems=$j("#crmplus-apps-adduser-options .js-user-autosugg").not(".error");void 0!=listItems&&listItems.length>0&&listItems.eq(0).addClass("selected")},_postPopulate:function(){var inputText=$c("#crmplus-apps-adduser-email").val();$c("#crmplus-apps-adduser-parent").removeAttr("inprogress"),inputText&&inputText.trim()&&!$c("#crmplus-apps-adduser-email").is(":focus")&&($j("#adminpanel-fixed-freeze").hide(),AdminPanel.util.lookUpForUser()),AdminPanel.util.holdAddUpdateActions()},getAutoFillUsers:function(viewType,event){if(!(event&&AdminPanel.util.handleArrowPress(event.keyCode)||$c("#crmplus-apps-adduser-parent").hasClass("zcrmp-changeOwnr"))){var queryStr,view="autofill";event?queryStr=$c("#crmplus-apps-adduser-email").prop("value").trim():window.nonUserRequestAccessAddUserEmail&&(queryStr=nonUserRequestAccessAddUserEmail);var errMsg,selectedUsers=$c("#crmplus-apps-adduser-container").children();if(viewType&&(view=viewType),event&&""==queryStr&&8==event.keyCode&&selectedUsers.length>0?$j("#crmplus-apps-adduser").attr("canremove")?selectedUsers.last().remove():$j("#crmplus-apps-adduser").attr("canremove",!0):$j("#crmplus-apps-adduser").attr("canremove")&&$j("#crmplus-apps-adduser").removeAttr("canremove"),queryStr.length<3)errMsg=I18N.getValue("crmplus.error.searchminimum");else if(Regex.map.email.test(queryStr))for(var pickedElements=($c("#crmplus-apps-adduser-container .greyTxt").text(),$c("#crmplus-apps-adduser-container div[data-param]")),i=0;i<pickedElements.length;i++){var email=$c(pickedElements[i]).find(".greyTxt").text().trim();email.toLowerCase()==queryStr.toLowerCase()&&(errMsg=I18N.getValue("crmplus.error.alreadypicked"))}if(errMsg)return html="<div class='zcrmp-typingChar'>"+errMsg+"</div>",this._populateAutoFill(html,queryStr),void showFixedPop("crmplus-apps-adduser-options",void 0,"crmplus-apps-adduser-parent");var callback=function(html){if(window.nonUserRequestAccessAddUserEmail){$c("#crmplus-apps-adduser-options").html(html),$aduserOptions=$c("#crmplus-apps-adduser-options");for(var userDetEl,userEmailId,$userDivList=$aduserOptions.children("div"),i=0;i<$userDivList.length&&(userDetEl=$userDivList[i],userEmailId=$j(userDetEl.querySelector("div.greyTxt")).text(),!userEmailId||userEmailId!==nonUserRequestAccessAddUserEmail);i++);var userStatus=userDetEl.querySelector("span.autosug-userstatus");if(userStatus){var classList=userStatus.classList;if(classList&&(classList.contains("inactive")||classList.contains("pending")||classList.contains("new")))return showStatusMsg("info",I18N.getValue("crmplus.info.nonuser_requestaccess.adduser_notactive"),4e3),$c("#crmplus-apps-adduser-email").focus(),void delete window.nonUserRequestAccessAddUserEmail}return $c("#crmplus-apps-adduser-parent").removeAttr("inprogress"),AdminPanel.util.pickAutoFillUsers(userDetEl),AdminPanel.util.holdAddUpdateActions(),delete window.nonUserRequestAccessAddUserEmail,void(window.from_nonUserRequestAccess_accept=!0)}AdminPanel.util._populateAutoFill(html),showFixedPop("crmplus-apps-adduser-options",event,"crmplus-apps-adduser-parent"),AdminPanel.util._postPopulate(),$j("#adminpanel-fixed-pop").show(),$j("#adminpanel-fixed-pop").scrollTop(0)},excludeUserIDs=[];if("autofill_app_users"==viewType){var appName=$c("#crmplus-apps-adduser").attr("appName"),ownerId=$j("#"+appName+"-row").attr("owner_id");excludeUserIDs.push(ownerId)}selectedUsers.each(function(){var id=this.getAttribute("userid");id&&excludeUserIDs.push(id)}),AdminPanel.users.get(view,void 0,queryStr,excludeUserIDs,callback)}},handleArrowPress:function(code,scrollContainerId,inputFieldId){if(40!=code&&38!=code&&13!=code)return!1;if(13==code){var autoFillList=$j("#adminpanel-fixed-pop .js-user-autosugg:visible").not(".error");if(autoFillList.length>0){var selectedElement=autoFillList.filter(".selected");this.pickAutoFillUsers(selectedElement),hideFixedPop()}}else{var listItems=$j("#adminpanel-fixed-pop .js-user-autosugg:visible").not(".error");if(listItems.length<1)return;var current,selectedIndex=listItems.index(listItems.filter(".selected"));scrollContainerId||(scrollContainerId="adminpanel-fixed-pop");var adjustHeight=6;if($j("#adminpanel-fixed-pop  #crm-reportingto-input-box").length>0&&(adjustHeight+=$j("#adminpanel-fixed-pop #crm-reportingto-input-field").outerHeight()),adjustHeight=adjustHeight+$j("#"+scrollContainerId).outerHeight()-listItems.eq(0).outerHeight(),40==code){if(selectedIndex==listItems.length-1)return!0;current=listItems.eq(selectedIndex+1),$j("#"+scrollContainerId).scrollTop(current[0].offsetTop-adjustHeight)}else{if(0==selectedIndex)return!0;current=listItems.eq(selectedIndex-1),$j("#"+scrollContainerId).scrollTop(current[0].offsetTop-adjustHeight),inputFieldId?$j("#"+inputFieldId).focus().val($j("#"+inputFieldId).val()):$c("#crmplus-apps-adduser-email").focus().val($c("#crmplus-apps-adduser-email").val())}listItems.removeClass("selected"),current.addClass("selected")}return!0},pickAutoFillUsers:function(element){var userElement=$j(element).clone();userElement.removeAttr("onclick");var selectedUsers=$c("#crmplus-apps-adduser-container").children(),lastAddedUser=selectedUsers[selectedUsers.length-1];if(!(selectedUsers.length>0&&userElement.length>0&&(lastAddedUser.hasAttribute("id")&&lastAddedUser.getAttribute("id")==userElement[0].getAttribute("id")||lastAddedUser.hasAttribute("email")&&lastAddedUser.getAttribute("email")==userElement[0].getAttribute("email")))){if(userElement.attr("roleid"))return $c("#crm-reportingto-input-div").append(userElement),$c("#crm-reportingto-input-div").addClass("zcrmp-changeOwnr"),void $c("#crm-reportingto-input-span").hide();var isChangeOwner=1==$c("#crmplus-apps-adduser[type=owner]").length;isChangeOwner&&$c("#crmplus-apps-adduser-parent").addClass("zcrmp-changeOwnr"),$c("#crmplus-apps-adduser-container").append(userElement),$c("#crmplus-apps-adduser-email").prop("value",""),$c("#crmplus-apps-adduser-email").focus();var noOfUsersPopulated=$c("#crmplus-apps-adduser-container .zcrmp-usrComp");!isChangeOwner&&1==noOfUsersPopulated.length&&$j("#crmplus-dialog-error").text().trim()&&$j("#crmplus-dialog-error").text(""),$j("#crmplus-apps-adduser").attr("canremove",!0),hidePanel()}},handleWindowSize:function(){var chatBarHeight=0;if(0!=$j("#crmplus-adminpanel").length){$j("#wmstoolbar").length>0&&(chatBarHeight=$j("#wmstoolbar").height());var topbarHeight=$j("#crmpluscommonuitopbar").outerHeight(),adminpanelHeader=$j("#adminPanelContHeader").outerHeight(),totalHeight=$j(window).height()-(topbarHeight+adminpanelHeader+chatBarHeight);$j("#adminPanelContBody").height(totalHeight)}},handleHash:function(hashValue){if(Common.zohoOneHomeURL)return void window.open(Common.zohoOneHomeURL,"_self");var defaultHash="settings/users";if(!Services.isFetchComplete)return void(AdminPanel.hash=hashValue);if(AdminPanel.hash=void 0,Common.isSignUp&&Services.hideOverViewPage(),"setup"!=TopBar.type?TopBar.loadTopBar("setup","adminpanel",hashValue):0==$j("#crmplus-adminpanel:visible").length&&Services.onBeforeFrameLoad("adminpanel"),!Services.hasAdminPanelAccess)return CRMPlusCommonUi.showErrorPage("noaccessforadminpanel"),Hash.set(defaultHash),void AdminPanel.layout.hide();var uri=hashValue,params={},paramIndex=hashValue.indexOf("?");if(-1!=paramIndex){uri=hashValue.substring(0,paramIndex),paramString=hashValue.substring(paramIndex+1);var paramsArr=paramString.split(",");for(var index in paramsArr){var paramPair=paramsArr[index].split("=");params[paramPair[0]]=paramPair[1]}}var uriParts=uri.split("/"),module=uriParts[1],moduleIdentifier=uriParts[2],action=uriParts[3],actionIdentifier=uriParts[4];AdminPanel.currentModule=module;var callback,refetch;if("apps"==module){var innerCallback;"adduser"==action&&(actionIdentifier&&(window.nonUserRequestAccessAddUserEmail=actionIdentifier),innerCallback=function(){AdminPanel.apps.showAddUser(moduleIdentifier,params.department_id,void 0)},moduleIdentifier&&AdminPanel.authRoles.map.crmplus<1&&(void 0===AdminPanel.authRoles.map[moduleIdentifier]||AdminPanel.authRoles.map[moduleIdentifier]<1)&&(innerCallback=showStatusMsg("error",I18N.getValue("crmplus.label.insufficientpermission"))),Hash.set("settings/apps")),callback=function(){AdminPanel.overView.show(innerCallback)}}else if("users"==module)if("all"==moduleIdentifier)Hash.set(defaultHash),refetch=!0;else if("add"==moduleIdentifier)callback=function(){License.check(void 0,AdminPanel.adduser.validateLicense.bind(AdminPanel.adduser,"page",void 0,void 0),"general")};else{var assignApp="assign"==action,viewType=$j("#users-view-list li.selected").attr("type");if(callback=function(){AdminPanel.users.show(viewType,moduleIdentifier,assignApp,void 0,actionIdentifier)},assignApp){var hash="settings/"+module+"/"+moduleIdentifier+"/assign";actionIdentifier&&(hash=hash+"/"+actionIdentifier),Hash.set(hash)}}else"orgs"==module?callback=function(){AdminPanel.orgView.show()}:"subscription"==module?callback=function(){AdminPanel.subscriptionView.show()}:Hash.set(defaultHash);AdminPanel.layout.show(callback,refetch)},fixHeader:function(){if(0!=$j("#userview-table").length){if($j("#userview-table").position().top>=0)$j("#userview-table-fixed").hide(),$j("#userview-search.zshow").length>0&&$j("#userview-email").focus();else{var width=$j("#userview-table").width(),salutationWidth=$j("#userview-search").outerWidth();$j("#userview-table-fixed #userview-search").css("min-width",salutationWidth-1),$j("#userview-table-fixed").width(width),$j("#userview-table-fixed").show(),$j("#userview-table-fixed #userview-search.zshow").length>0&&$j("#userview-table-fixed #userview-email").focus()}AdminPanel.util.paginate();var leftPos=$j("#userview-table").position().left;$j("#userview-fixed-header").css("left",leftPos),hidePanel()}},paginate:function(isButtonPress){var element=document.getElementById("adminPanelContBody");if((isButtonPress||element.scrollHeight-element.scrollTop-element.clientHeight<10)&&(isButtonPress||0==$j("#userview-email:visible").length&&"block"==$j("#userview").css("display"))&&-1!=$j("#adminPanelContBody").attr("pageno")){if("true"==$j("#adminPanelContBody").attr("hasmore")){AdminPanel.users.hideDetail("close");var viewType=$j("#users-view-list li.selected").attr("type"),pageno=$j("#adminPanelContBody").attr("pageno");AdminPanel.users.get(viewType,void 0,void 0,void 0,void 0,!0,pageno)}$j("#adminPanelContBody").attr("hasmore","false")}},attachevents:function(){Common.addClickEventListener("#users-view-list [type]"),Common.addEventListener(document.getElementById("users-view-list-header-div"),"click",function(event){AdminPanel.users.hideDetail("close"),showPanel("users-view-list",void 0,"translate-y",void 0,event)}),Common.addEventListener(document.getElementById("crmplus-adminpanel-tabs"),"click",function(){$j("#adminPanelContBody").scrollTop(0)}),Common.addClickEventListener("#adduser-apps-container",AdminPanel.util.removeError),$j("#org-billing-anchr").attr("href",Services.allServiceUrl.paymentsurl),$j("#licenseinfo-billing-anchr").attr("href",Services.allServiceUrl.paymentsurl)},loadprofileimage:function(id,url){id&&$j("#"+id).load(AdminPanel.util.loadimagesuccess).error(AdminPanel.util.loadimagefail).attr("src",url)},loadimagesuccess:function(){if(this.complete&&0!==this.naturalHeight){var classname=$j("#"+this.id).attr("class");$j("."+classname).css("display","block"),$j("."+classname+"-name").remove()}},loadimagefail:function(){var classname=$j("#"+this.id).attr("class");$j("."+classname).remove()},checkProjectsModerator:function(userid){var isAvailable=AdminPanel.permissions.isAvailable("projects");if(!isAvailable)return void AdminPanel.permissions.fetch("projects",AdminPanel.util.checkProjectsModerator.bind(AdminPanel.util,userid));var hasDeletePermission=AdminPanel.permissions.canRemove("projects"),isModerator=AdminPanel.authRoles.get("projects")<=1;isModerator&&!hasDeletePermission&&(userid?$j("#projects-"+userid+"-active .js-app-unassign").remove():$j("#userview-table td[app=projects] .js-app-unassign").remove())},resetChangeOwnerCont:function(){$c("#crmplus-apps-adduser-parent").hasClass("zcrmp-changeOwnr")&&($c(".js-account-info-cont").remove(),$c("#crmplus-apps-adduser-parent").removeClass("zcrmp-changeOwnr")),$c("#crmplus-apps-adduser-email").focus()},removeError:function(){var id="add-user-error";"#crmplus-dialog"==Common.htmlContext&&(id="crmplus-dialog-error",$j("#crmplus-dialog-top-error").remove()),$j("#"+id).text("")},mandateRole:function(appName,iamSorgRole,allDepartmentsRole,toolTipMsg){if($c("#"+appName+"-account-info").length>0){if(iamSorgRole)var roleContainer=$c("#"+appName+"-account-info [iam-sorg-role="+iamSorgRole+"]");else if(allDepartmentsRole)var roleContainer=$c("#"+appName+"-account-info [all_departments_selected=true]");if(roleContainer.length>0){roleContainer.click();var profilesContainer=$c("#"+appName+"-profiles"),rolesOrProfilesContainer=profilesContainer.length>0?profilesContainer:$c("#"+appName+"-roles");rolesOrProfilesContainer.addClass("disableChildren"),toolTipMsg&&rolesOrProfilesContainer.attr("onmouseover","tooltip('"+toolTipMsg+"',event)")}}},holdAddUpdateActions:function(isDisable){var id="adminpanel-adduser-button";"#crmplus-dialog"==Common.htmlContext&&(id="crmplus-dialog-button"),isDisable?$c("#"+id).addClass("disabled"):$c("#"+id).removeClass("disabled")},getConfiguredApps:function(){var apps=[],configuredApps=Object.keys(Services.configuredServicesData);for(var index in configuredApps){var appName=configuredApps[index];Services.configuredServicesData[appName].ISCONFIGURED&&-1!=Services.nameArray.indexOf(appName)&&apps.push(appName)}return apps}},AdminPanel.appProperties={fetch:function(appName,callback){return AdminPanel.appProperties.has(appName)&&0!=$j("#admin-panel-data-temp").length?void(callback&&callback()):void $j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/adminpanelTemplatesAndAppProperties.do",success:function(data){data&&data.trim()&&(0==$j("#crmplus-adminpanel-templates").length&&$j("#serviceFrameContainer").append(data.trim()),callback&&callback())}})},get:function(appName){return AdminPanel.appProperties.has(appName)?Common.appProperties[appName]:null},has:function(appName){return!appName&&Common.appProperties||appName&&Common.appProperties&&Common.appProperties[appName]?!0:!1},set:function(appProperties){Common.appProperties=appProperties,Common.appProperties.salesinbox={},Common.appProperties.salesinbox.dependent_service="crm"}},AdminPanel.trees={constructTree:function(appName,dataArray,baseUL,dataMap){if(0!=dataArray.length){var treeName="role";dataMap&&(treeName="territory",$j("#crm-account-info.js-account-info-cont").addClass("zcrmp-formcase")),void 0===baseUL&&(baseUL=createElement("ul",appName+"-"+treeName+"-tree"),baseUL.setAttribute("class","zo-tree js-adduser-role-tree"));var scatteredTerritories=[],dataMapTemp=dataMap;for(var index in dataArray){var data=dataArray[index],dataName=data[treeName+"_name"],dataID=data[treeName+"_id"],parentDataID=data["parent_"+treeName+"_id"],treeLi=createElement("li",treeName+"-"+dataID),treeElement=createElement("a");if(dataMap){var checkbox=createElement("div");checkbox.setAttribute("class","zcrmp-smartcheckbox"),checkbox.insertAdjacentHTML("afterBegin",'<label><input onclick="event.stopPropagation();" type="checkbox"><i>'+dataName+"</i></label>");var inputEle=$j(checkbox).find("input")[0];inputEle.setAttribute("territory-id",dataID),inputEle.setAttribute("territory-name",dataName),inputEle.setAttribute("parent-territory-id",parentDataID);var parentComp=baseUL.querySelector("#territory-"+parentDataID+"-comp");!parentDataID||parentComp&&parentComp.className&&"disabled"==parentComp.className||(inputEle.setAttribute("parent-territory-name",dataMapTemp[parentDataID]),dataMapTemp[dataID]=dataMapTemp[parentDataID]),inputEle.setAttribute("id","territory-"+dataID+"-checkbox"),treeElement.appendChild(checkbox),treeElement.setAttribute("id","territory-"+dataID+"-comp"),treeElement.setAttribute("onclick","AdminPanel.territories.select('"+dataID+"',undefined,undefined,event);event.stopPropagation();")}else $j(treeElement).text(dataName),treeElement.setAttribute("role-id",dataID),treeElement.setAttribute("appName",appName),data.is_reportingto&&($j("#crm-account-info.js-account-info-cont").addClass("zcrmp-formcase zcrmp-showReportinto"),treeElement.setAttribute("reportingTo",!0)),treeElement.setAttribute("onclick",'AdminPanel.roles.set("'+appName+'",this)');if(treeLi.appendChild(treeElement),void 0===parentDataID||null===parentDataID)dataMap&&($j(treeLi.querySelector("#territory-"+dataID+"-checkbox")).remove(),treeLi.firstElementChild.setAttribute("class","disabled"),$j(treeLi).find("i").css("font-style","normal")),baseUL.appendChild(treeLi);else{var parent=baseUL.querySelector("#"+appName+"-"+treeName+"-ul-"+parentDataID);if(null==parent){parent=createElement("ul",appName+"-"+treeName+"-ul-"+parentDataID);var grandParent=baseUL.querySelector("#"+treeName+"-"+parentDataID);null!=grandParent?(grandParent.appendChild(parent),parent.appendChild(treeLi)):scatteredTerritories.push(data)}else parent.appendChild(treeLi)}}return scatteredTerritories.length>0?void this.constructTree(appName,scatteredTerritories,baseUL,dataMap):void $j("#adduser-tree-cont").append(baseUL)}},show:function(appName,event,id){if(void 0==id&&(id=appName+"-role-tree"),AdminPanel.util.removeError(),$c("#adduser-role-terr-tree-cont:visible").length>0)return void(0==$c("#"+id).length&&(Common.stopEvents(event),$c("#adduser-role-terr-tree-cont").hide("slide",{direction:"right"},150),setTimeout(function(){AdminPanel.trees.show(event,appName,id)},200)));var msg="",header="";if(-1!=id.indexOf("territory")?(msg=I18N.getValue("adminpanel.adduser.territorieslist.msg"),header=I18N.getValue("adminpanel.adduser.territorieslist")):(msg=I18N.getValue("adminpanel.adduser.rolelist.msg"),header=I18N.getValue("adminpanel.adduser.rolelist")),event&&Common.stopEvents(event),"#crmplus-dialog"==Common.htmlContext&&0==$c("#crmplus-dialog-body .zcrmp-rolePop").length||"#crmplus-dialog"!=Common.htmlContext&&0==$j("#adduserview .zcrmp-rolePop").length){var treeCont=$j("#crmplus-adminpanel-templates .zcrmp-rolePop").clone(),appProp=AdminPanel.appProperties.get(appName);appProp.has_role_hierarchy&&("#crmplus-dialog"==Common.htmlContext?$j("#crmplus-dialog-body").append(treeCont):$j("#adduser-overview-trees").html(treeCont));var parentClass=0==$c(".js-apps-container").length?"js-account-info-cont":"js-apps-container";0==$c("."+parentClass+"[clickevent]").length&&(Common.addEventListener($c("."+parentClass)[0],"click",AdminPanel.roles.hide),$c("."+parentClass).attr("clickevent","true"))}$c("#adduser-tree-header-span").text(header),$c("#adduser-tree-msg-span").text(msg),$c("#adduser-role-territory-tree .js-adduser-role-tree").remove();var tree=$j("#adduser-tree-cont").find("#"+id);if(tree&&(tree=tree.clone(),$c("#adduser-role-territory-tree").append(tree)),$c("#adduser-role-terr-tree-cont").show(),-1!=id.indexOf("territory")){AdminPanel.territories.selectPicked(),$c("#crm-territories-input-div").addClass("zcrmp-setFocus"),$c("#territories-assign-btn").parent().show(),$c("#territories-assign-btn").show();var height=$c("#adduser-role-terr-tree-cont").outerHeight()-$c("#adduser-tree-header").outerHeight()-$c(".zcrmp-rolePopFtr").outerHeight();$c("#adduser-role-territory-tree").css({overflow:"auto",height:height})}else{$c("#territories-assign-btn").parent().hide(),$c("#territories-assign-btn").hide();var height=$c("#adduser-role-terr-tree-cont").outerHeight()-$c("#adduser-tree-header").outerHeight();$c("#adduser-role-territory-tree").css({overflow:"auto",height:height})}"crm-role-tree"==id&&$c("#crm-reportingto-input-div").attr("showReportingList")&&AdminPanel.trees.showRolePickAlert()},showRolePickAlert:function(){$c("#reporting-to-msg").show(),setTimeout(function(){$c("#reporting-to-msg").addClass("noteAnimated")},500),setTimeout(function(){$c("#reporting-to-msg").removeClass("noteAnimated")},4e3)}},AdminPanel.reportingTo={get:function(roleId,memberInfo,showDrop){if(Services.configuredServicesData.crm){void 0==roleId&&(roleId=memberInfo.role_id);var params={};params.roleId=roleId;var appSOID=Services.configuredServicesData.crm.APPID;params.appsoid=appSOID,params.action="getreportingto",$j.ajax({type:"GET",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",beforeSend:function(){$c("#crm-reportingto-input-div").attr("reset",!0),$c("#crm-reportingto-input-div").addClass("zcrmp-canttouch"),AdminPanel.util.holdAddUpdateActions(!0)},complete:function(){$c("#crm-reportingto-input-div").removeClass("zcrmp-canttouch"),AdminPanel.util.holdAddUpdateActions()},success:function(data){return data.trim()?(AdminPanel.reportingTo.populate(data.trim()),memberInfo&&DataTemplates.accountInfo.setReportingTo(memberInfo.reportingto_zuid,memberInfo.reportingto_email),void(showDrop&&$c("#crm-reportingto-input-div").click())):void 0}})}},populate:function(data){AdminPanel.reportingTo.show();var input=$j("#crm-reportingto-input-field").clone();input&&(data=input.add($j('<div id="reportinToScrollCont" style="max-height:160px;overflow-y: auto;">'+data.trim()+'<div class="zcrmp-typingChar" style="display:none" id="reportingto-user-search-error">'+I18N.getValue("crmplus.error.select_valid_user")+"</div></div>"))),$c("#crm-reportingto-popup").html(data);var identifier=DataTemplates.member.getIdentifier();if(identifier){var removeElement=null;if(removeElement=$c(isNaN(identifier)?'#crm-reportingto-popup div[identifier="'+identifier+'"]':"#user-"+identifier)){var roleID=removeElement.attr("roleid");roleID&&1==$c("#crm-reportingto-popup div[roleid="+roleID+"]").length&&$c("#crm-reportingto-popup #role-header-"+roleID).remove(),removeElement.remove()}}var listItems=$c("#crm-reportingto-popup .js-user-autosugg");void 0!=listItems&&listItems.length>0&&listItems.eq(0).addClass("selected");for(var roleTitles=$c("#crm-reportingto-popup .zcrmp-rtsepline"),i=0;i<roleTitles.length;i++){var element=roleTitles[i];element.textContent=AdminPanel.roles.getRoleName("crm",element.getAttribute("role-id"))}AdminPanel.reportingTo.checkForHasReportingManagers()},search:function(event){if(!event||!AdminPanel.util.handleArrowPress(event.keyCode,"adminpanel-fixed-pop #reportinToScrollCont","adminpanel-fixed-pop #crm-reportingto-input-box")){event?queryText=event.target.value:(queryText="",$j("#adminpanel-fixed-freeze #crm-reportingto-input-box").val(""));for(var list=$j("#adminpanel-fixed-pop .zcrmp-usrComp"),titles=$j("#adminpanel-fixed-pop .zcrmp-rtsepline"),i=0;i<titles.length;i++)$c(titles[i]).hide();for(var i=0;i<list.length;i++){var userComp=list[i],param=userComp.getAttribute("data-param");param=Common.jsonParse(param);var userName=param[0].toLowerCase(),userMail=$j(userComp).find(".greyTxt").text(),roleId=userComp.getAttribute("roleid");queryText&&(queryText=queryText.toLowerCase()),void 0!=queryText&&-1==userName.indexOf(queryText)&&-1==userMail.indexOf(queryText)?$c(userComp).hide():(titles.filter("#role-header-"+roleId).show(),$c(userComp).show())}var listItems=$j("#adminpanel-fixed-pop .js-user-autosugg:visible").not(".error");listItems.length>0?($j("#adminpanel-fixed-pop #reportingto-user-search-error").hide(),listItems.removeClass("selected"),listItems.eq(0).addClass("selected")):$j("#adminpanel-fixed-pop #reportingto-user-search-error").show()}},show:function(){var element=$c("#crm-reportingto-input-div .js-user-autosugg:visible")[0];element&&element.remove(),$c("#crm-reportingto-input").show(),$c("#crm-reportingto-input-div .zcrmp-adUsrComp").remove(),$c("#crm-reportingto-input-close").hide(),$c("#crm-reportingto-input-span").show()},resetInput:function(event){event&&event.stopPropagation(),$c("#crm-reportingto-input-div").hasClass("zcrmp-changeOwnr")&&($c("#crm-reportingto-input-div").removeClass("zcrmp-changeOwnr"),$c("#crm-reportingto-input-span").show())},showDrop:function(){if(-1==DataTemplates.member.getReportingTo()){if($c("#crm-role").length>0&&""==DataTemplates.member.getRole("crm"))return $c("#crm-reportingto-input-div").attr("showReportingList",!0),void $c("#crm-role").click();var context=Common.htmlContext,id="crm-reportingto-popup";context&&(id=context.substr(1)+" #"+id),"true"==$c("#crm-reportingto-input-div").attr("reset")||0==$j("#adminpanel-fixed-freeze #crm-reportingto-input-box").length?($c("#crm-reportingto-input-div").attr("reset",!1),showFixedPop("crm-reportingto-popup",void 0,"crm-reportingto-input-div")):(showFixedPop("crm-reportingto-popup",void 0,"crm-reportingto-input-div",!0),AdminPanel.reportingTo.search()),setTimeout(function(){$j("#adminpanel-fixed-pop #crm-reportingto-input-box").focus()},150)}},showChangeReportingTo:function(data,isDeleteUser,managerEmail,managerZuid){var hasAccountInfo=0!=$j("#admin-panel-data-temp #crm-account-info").length;if(isDeleteUser&&!hasAccountInfo){var callback=function(){AdminPanel.reportingTo.showChangeReportingTo(data,isDeleteUser,managerEmail,managerZuid)};return void AdminPanel.accountInfo.get("crm",Services.configuredServicesData.crm.APPID,void 0,callback)}var userName="";managerZuid&&(userName=$j("#userview-table-body tr[identifier="+managerZuid+"]").find(".zcrmp-adminUsrName").text().trim()),managerEmail&&(userName=$j('#userview-table-body tr[identifier="'+managerEmail.toLowerCase()+'"]').find(".zcrmp-adminUsrName").text().trim());var title=I18N.getValue("crmplus.label.updateSubordinates",[userName]),body=$j(createElement("div")),reportingtoInput=$j("#crm-reportingto-input").clone();$c("#crm-territories-input").show();var tempElement=createElement("div");tempElement.innerHTML=data,tempElement=$j(tempElement);var subordinates=tempElement.find("#subordinate-users").clone(),subordinatesCont=$j("#crm-subordinate-cont").clone(),subordinatesNote=$j("#crmplus-adminpanel-note").clone();tempElement.find("#subordinate-users").remove(),body.append(subordinatesCont),body.append(reportingtoInput),body.find("#crm-subordinate-div").append(subordinates),body.append(subordinatesNote),body.find("#crmplus-crm-reportingto-label").text(I18N.getValue("crmplus.label.newreportingto")),body.find("#crm-reportingto-input-div").attr("reset",!0),body.find("#crmplus-adminpanel-note span").text(I18N.getValue("adminpanel.updateuser.crm.subordinatesnote",[userName])),subordinatesNote.show(),subordinatesCont.show(),showDialog("crmplus-dialog",title,body.html(),I18N.getValue("crmplus.label.update"),"AdminPanel.reportingTo.updateSubordinates();"),Common.setScroll("subordinate-users"),AdminPanel.reportingTo.populate(tempElement.html())},updateSubordinates:function(){var subordinateUsers=$c("#crm-subordinate-div .zcrmp-territTags"),appJson={};appJson.app_name="crm",appJson.zaaid=Services.configuredServicesData.crm.APPID,appJson.is_reportingto_enabled=!0;var reportingTo=DataTemplates.member.getReportingTo();if(reportingTo.zuid)appJson.reportingto_zuid=reportingTo.zuid;else{if(!reportingTo.email)return showStatusMsg("success",I18N.getValue("crmplus.success.update_subordinates")),void hideDialog("crmplus-dialog",!0);appJson.reportingto_email=reportingTo.email}for(var emails=[],zuids=[],i=0;i<subordinateUsers.length;i++){var user=subordinateUsers[i];user.hasAttribute("zuid")&&-1!=user.getAttribute("zuid")?zuids.push(user.getAttribute("zuid")):user.hasAttribute("email")&&emails.push(user.getAttribute("email"))}0==emails.length&&(emails=void 0),0==zuids.length&&(zuids=void 0),AdminPanel.apps.addUser("crm",void 0,appJson,emails,zuids)},checkForHasReportingManagers:function(roleName){roleName||(roleName=$c("#crm-role").val()),$c("#crm-reportingto-popup .js-user-autosugg").length>0?($c("#crm-reportingto-input").removeAttr("onmouseover"),$c("#crm-reportingto-input .zcrmp-canttouch").removeClass("zcrmp-canttouch")):($c("#crm-reportingto-input-div .zcrmp-usrCompRemv :visible").click(),$c("#crm-reportingto-input").children().addClass("zcrmp-canttouch"),$c("#crm-reportingto-input").attr("onmouseover","tooltip('"+I18N.getValue("adminpanel.adduser.noreportingtoavailable",[roleName])+"',event);"),$c("#adduser-role-terr-tree-cont").is(":visible")&&($c("#crm-reportingto-input").trigger("mouseover"),setTimeout(function(){$c("#crm-reportingto-input").trigger("mouseleave")},2e3)))}},AdminPanel.territories={constructTree:function(territoriesArray,baseUL){if(0!=territoriesArray.length&&($j("#crm-territories-input").css("display","block"),0==$j("#crm-territory-tree").length)){var territoryIdName={};for(index in territoriesArray){var territory=territoriesArray[index],territoryName=territory.territory_name,territoryID=territory.territory_id;territoryIdName[territoryID]=territoryName}AdminPanel.trees.constructTree("crm",territoriesArray,baseUL,territoryIdName)}},select:function(id,element,action,event){if(element||(element=$c("#territory-"+id+"-checkbox")),event&&"i"!=event.target.tagName.toLowerCase())return void element.next().click();action||(action=element.prop("checked")?"check":"uncheck");for(var parentId=element.attr("territory-id"),childList=$c("#crm-territory-ul-"+parentId+' input[parent-territory-id="'+parentId+'"]'),i=0;i<childList.length;i++){var child=$c(childList[i]),isChildChecked=child.prop("checked"),isDisabled="false"==child.attr("canedit");(isChildChecked&&"check"==action||isChildChecked&&"uncheck"==action&&isDisabled||!isChildChecked&&"uncheck"==action)&&(child.click(),isDisabled&&child.prop("checked",!0)),AdminPanel.territories.select(void 0,$c(childList[i]),action)}},populateSelected:function(){for(var selected=$c("#adduser-role-terr-tree-cont :checked"),territotyArray=[],index=0;index<selected.length;index++){var inputEle=selected[index],territoryID=inputEle.getAttribute("territory-id"),canEdit=!inputEle.hasAttribute("canEdit"),obj={};obj.territory_id=territoryID,obj.has_permission=canEdit,territotyArray.push(obj)}AdminPanel.roles.hide(),DataTemplates.accountInfo.setTerritories(territotyArray)},selectPicked:function(){for(var selected=$c("#crm-territories-input-div div"),index=0;index<selected.length;index++){var component=selected[index],id=component.getAttribute("territoryId"),canEdit=component.getAttribute("canEdit");if($c("#territory-"+id+"-checkbox").prop("checked",!0),"false"==canEdit){$c("#territory-"+id+"-checkbox").attr("canEdit","false");var comp=$c("#territory-"+id+"-comp");comp.attr("onclick","event.stopPropagation();"),comp.attr("onmouseover","tooltip('"+I18N.getValue("crmplus.error.territory_manager")+"',event);"),comp.addClass("zcrmp-notallowed")}}},remove:function(event){var target=event.target,parent=target.parentElement;if($c("#territory-"+parent.getAttribute("territoryid")+"-checkbox").click(),parent.remove(),0==$c("#crm-territories-input-div div").length){var span=$j("#crmplus-adminpanel-templates #crm-territories-input-div").html();$c("#crm-territories-input-div").append(span)}event.stopPropagation()}},AdminPanel.roles={constructTree:function(appName,rolesArray,baseUL){0==$j("#"+appName+"-role-tree").length&&AdminPanel.trees.constructTree(appName,rolesArray,baseUL)},set:function(appName,element){var showRepDrop=!1;$c("#crm-reportingto-input-div").attr("showReportingList")&&(showRepDrop=!0);var roleID=element.getAttribute("role-id"),isReportingToAvail=!element.hasAttribute("reportingTo")&&$c("#crm-account-info.js-account-info-cont.zcrmp-showReportinto").length>0,roleName=$j(element).text(),roleInput=$c("#"+appName+"-role");if(roleInput.val()==roleName)return void this.hide();roleInput.attr("app_name",appName),roleInput.attr("role-id",roleID),roleInput.val(roleName);var parentID=roleInput.attr("parentID"),parentElement=document.getElementById(parentID);parentElement.setAttribute("appName",roleInput.attr("app_name")),parentElement.click(),parentElement.removeAttribute("appName"),this.hide(),$c("#crm-reportingto-popup").html("");var appProp=AdminPanel.appProperties.get(appName);
appProp.has_reporting_to&&isReportingToAvail&&$c("#adduser-role-terr-tree-cont").is(":visible")?AdminPanel.reportingTo.get(roleID,void 0,showRepDrop):appProp.has_reporting_to&&$c("#crm-account-info.js-account-info-cont.zcrmp-showReportinto").length>0&&AdminPanel.reportingTo.checkForHasReportingManagers(roleName)},hide:function(){$c("#adduser-role-terr-tree-cont").hide("slide",{direction:"right"},150);var territoryDiv=$c("#crm-territories-input-div");territoryDiv&&territoryDiv.removeClass("zcrmp-setFocus"),$c("#crm-reportingto-input-div").removeAttr("showReportingList")},toggleSupportOptions:function(id){"support-role-agent"==id?($c("#support-role-custom-options").fadeOut(),$c("#support-role-agent-options").fadeIn()):"support-role-admin"==id||"support-role-lightagent"==id?($c("#support-role-agent-options").fadeOut(),$c("#support-role-custom-options").fadeOut()):"support-role-custom"==id&&($c("#support-role-agent-options").fadeOut(),$c("#support-role-custom-options").fadeIn()),this.hide()},getRoleName:function(appName,roleId){return $j("#"+appName+"-role-tree a[role-id="+roleId+"]")[0].textContent.trim()}},AdminPanel.filters={apply:function(appname,count){return void 0!=count&&0==count?void tooltip(I18N.getValue("adminpanel.user.filter.nouser"),event):($j("#users-view-list li[class=selected]").removeClass("selected"),$j("#userviewheader").attr("filter",appname),AdminPanel.users.show("all"),void $j("#users-view-list-header").html(I18N.getValue("adminpanel.service.state.active")+" "+I18N.getValue("service.title."+appname)+" "+I18N.getValue("crmplus.label.users")))}},AdminPanel.users={get:function(type,zuidOrEmail,queryStr,excludes,callback,canapplyfilters,pageno,userid){var hashValue,params={},loadParams={type:"global"};void 0!=canapplyfilters&&$j("#userviewheader").attr("filter")&&(params.appname=$j("#userviewheader").attr("filter")),params.action="getusers",zuidOrEmail&&(isNaN(zuidOrEmail)?params.emails=zuidOrEmail:params.zuids=zuidOrEmail),void 0!==type&&"all"!=type&&(params.view_type=type),void 0!==queryStr&&(params.q=queryStr,"autofill_app_users"==type&&(params.appname=$c("#crmplus-apps-adduser").attr("appName")),-1==type.indexOf("admin")&&(loadParams={id:"user-view-search-load",type:"button"})),pageno&&(params.page=pageno,1!=pageno&&(loadParams={id:"loadingusers",type:"paginate"})),void 0!==excludes&&excludes.length>0&&(params.excludes=excludes.toString()),callback&&(loadParams=void 0),void 0===zuidOrEmail&&void 0===excludes&&void 0===userid&&(hashValue=!0),userid&&(params.userid=userid),this.currentAjax=$j.ajax({type:"GET",data:params,loadingParams:loadParams,url:Common.getPortalUrl(!0)+"/adminpanel.do",beforeSend:function(){queryStr&&AdminPanel.users.currentAjax&&AdminPanel.users.currentAjax.abort(),type&&type.startsWith("auto")&&(AdminPanel.util.holdAddUpdateActions(!0),$c("#crmplus-apps-adduser-parent").attr("inprogress",!0))},success:function(data){if(pageno&&(pageNo=parseInt(params.page,10),$j("#adminPanelContBody").attr("pageno",pageNo+1)),void 0!==zuidOrEmail)return AdminPanel.users._replace(zuidOrEmail,data),void(callback&&"function"==typeof callback&&callback());if(void 0!==hashValue){if(void 0!=queryStr){var width=$j("#userview-search").outerWidth();$j("#userview tr[id^=user]").remove(),""==data.trim()?($j("#userview-search-error").show(),$j("#userview-search").css("min-width",width)):($j("#userview-search-error").hide(),$j("#userview-table tbody").append(data))}else $j("#userview").length>0?data.trim().startsWith("<tr")?$j("#userview-table-body").append(data):$j("#userview").html(data):$j("#adminPanelContBody").append(data);AdminPanel.util.handleWindowSize();for(serviceName in Services.configuredServicesData){var serviceData=Services.configuredServicesData[serviceName];serviceData&&!serviceData.ISCONFIGURED&&$j("#userview-table").addClass("zcrmp-"+serviceName+"disable"),AdminPanel.permissions.isApplicable(serviceName)&&void 0!=type&&!type.startsWith("autofill")&&AdminPanel.util.checkProjectsModerator()}}callback&&callback(data,queryStr),AdminPanel.showCurrentTabView()}})},show:function(type,userID,showAssignApps,isresetpage,appName){void 0!=isresetpage&&1==isresetpage&&($j("#adminPanelContBody").attr("hasmore","true"),$j("#adminPanelContBody").attr("pageno",1));var callback,showAppsFn;if(void 0===type&&(type="active"),showAssignApps&&userID&&(showAppsFn=function(){AdminPanel.adduser.show(appName,userID,!0)}),userID&&(callback=function(){AdminPanel.users.showDetail(userID,void 0,showAppsFn)}),0==$j("#userview-li.selected").length&&(AdminPanel.toggleModules("userview"),addSelected($j("#userview-li"))),0==$j("#users-view-list [type="+type+"][class=selected]").length||isresetpage&&void 0!=$j("#userviewheader").attr("filter")?(isresetpage&&$j("#userviewheader").removeAttr("filter"),addSelected($j("#users-view-list [type="+type+"]")),$j("#adminPanelContBody").scrollTop(0),$j("#adminPanelContBody").attr("hasmore","true"),$j("#adminPanelContBody").attr("pageno",1),AdminPanel.users.get(type,void 0,void 0,void 0,callback,!0,1)):callback&&callback(),void 0===callback){var hash="settings/users";userID&&(hash=hash+"/"+userID),Hash.set(hash)}hidePanel(),void 0==$j("#userviewheader").attr("filter")&&$j("#users-view-list-header").text($j("#users-view-list [type="+type+"]").text())},_replace:function(zuidOrEmail,userRow){if($j('#userview-table tr[identifier="'+zuidOrEmail+'"]').replaceWith(userRow),$j("#user-detail:visible").length>0){var userID=$j('tr[identifier="'+zuidOrEmail+'"]').attr("id").split("-")[1];AdminPanel.users.showDetail(userID,!0)}},updateStatus:function(zuidOrEmail,status,callback){var params={};isNaN(zuidOrEmail)?params.emails=zuidOrEmail:params.zuids=zuidOrEmail,params.activate=status,params.action="changestatus",params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){AdminPanel.util.handleError(data),status||AdminPanel.users.get(void 0,zuidOrEmail),callback&&"function"==typeof callback&&callback()}})},showAddAdmin:function(){var inputComponent=$j("#crmplus-apps-adduser").clone();html=$j("<div>").append(inputComponent),showDialog("crmplus-dialog",I18N.getValue("user.label.addadmin"),html,I18N.getValue("user.label.add"),"AdminPanel.users.updateAdmin(true)"),$c("#crmplus-apps-adduser-label").text(I18N.getValue("adminpanel.addadmin.choose")),$c("#crmplus-apps-adduser-label").css({"text-transform":"none","font-size":"14px"}),$c("#crmplus-apps-adduser").show(),$c("#crmplus-apps-adduser").attr("onkeyup","AdminPanel.util.getAutoFillUsers('autofill_admins',event)"),$c("#crmplus-apps-adduser-email").focus()},updateAdmin:function(toAssign,zuid){var zuids=[];if(toAssign){var selectedUsers=$c("#crmplus-apps-adduser-container div[identifier]");if(0==selectedUsers.length)return void $j("#crmplus-dialog-error").text(I18N.getValue("crmplus.error.select_one"));if(selectedUsers.length>10)return void $j("#crmplus-dialog-error").text(I18N.getValue("crmplus.error.max_users_selected"));selectedUsers.each(function(){var id=this.getAttribute("identifier");zuid=id,zuids.push(id)})}else zuids.push(zuid);var params={};params.zuids=zuids.toString(),params.action="updateadmin",params.assign=toAssign,params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){var error=AdminPanel.util.handleError(data,!1);if(!error){hideDialog("crmplus-dialog",!0),$c("#crmplus-apps-adduser-label").removeAttr("style");var assignMsg=toAssign?"assign":"unassign";showStatusMsg("success",I18N.getValue("crmplus.success.user_"+assignMsg+"_admin")),AdminPanel.users.show(),AdminPanel.users.updateUserUiDetails(toAssign,zuids)}$j("#crmplus-dialog-error").text(error)}})},updateUserUiDetails:function(toAssign,zuids){for(var i=0;i<zuids.length;i++){var zuid=zuids[i],tableRow=$j("#userview-table-body tr[identifier="+zuid+"]");if(tableRow)if(toAssign){tableRow.attr("user_role",1);var actionButtonsCont=tableRow.find(".zcrmp-usrActnBtns");if(actionButtonsCont&&2==actionButtonsCont.find("div").length)return;var imgCont=tableRow.find(".zcrmp-usrImageCont");$j('<div class="zcrmp-userRoleLabel">'+I18N.getValue("crmplus.user.role.admin")+"</div>").insertAfter(imgCont),$j('<div style="display:none" class="zcrmp-adminBtns primary zcrmp-role-admin-inl" onclick="AdminPanel.users.updateAdmin(false,'+escapeHtml(zuid)+')">'+I18N.getValue("button.unassign")+"</div>").insertBefore(actionButtonsCont.find("i"))}else tableRow.attr("user_role",0),tableRow.find(".zcrmp-userRoleLabel").remove(),tableRow.find(".zcrmp-usrActnBtns .zcrmp-adminBtns")[1].remove(),$j("#user-detail-info .zcrmp-userRoleLabel").remove(),$j("#user-detail-info .zcrmp-usrActnBtns .zcrmp-adminBtns")[1].remove(),0==tableRow.find("td[status=active]").length&&AdminPanel.users.get(void 0,zuid)}},getCount:function(){var params={};params.action="getuserscount",$j.ajax({type:"GET",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){var error=AdminPanel.util.handleError(data,!1);return error?void $j("#crmplus-dialog-error").text(error):(hideDialog("crmplus-dialog",!0),void showStatusMsg("success",I18N.getValue("crmplus.success.user_assign_admin")))}})},getdetails:function(data,userID,callback){""!=data.trim()?($j("#userview-table-body").append(data),AdminPanel.users.showDetail(userID,void 0,callback,!0)):AdminPanel.users.show()},showDetail:function(userID,toreplace,callback,ishiderow){if(0==$j("#user-"+userID).length){var inner_callback=function(data){AdminPanel.users.getdetails(data,userID,callback)};return void AdminPanel.users.get(void 0,void 0,void 0,void 0,inner_callback,void 0,void 0,userID)}var appsWithPermission=$j("#user-"+userID+" td[status]").not("[status=noaccess]"),membersAJAX=[],membersAJAXResult={},appsList=[],zuidOrEmail=$j("#user-"+userID).attr("identifier");if(toreplace||$j("#user-detail:visible").attr("identifier")!=zuidOrEmail){var infoInnerHTML=$j("#user-"+userID+" td a")[0].innerHTML,infoHTML=$j("<div>").append(infoInnerHTML);if($j("#user-detail").css("left",90+$j(".zcrmp-searchComp").outerWidth()),$j("#user-detail").attr("identifier",zuidOrEmail),$j("#user-detail-app-container .js-user-detail-app").remove(),$j("#user-detail-info").html(infoHTML),$j("#user-detail").show("slide",{direction:"right"},250),0!=appsWithPermission.length)$j("#user-detail-app-nodata").hide(),appsWithPermission.each(function(){var appName=this.getAttribute("app"),appSOID=Services.configuredServicesData[appName].APPID;AdminPanel.users.renderApp(appName);var ajax=AdminPanel.members.get(appName,appSOID,zuidOrEmail,membersAJAXResult);membersAJAX.push(ajax),appsList.push(appName)}),$j.when.apply($j,membersAJAX).then(function(){if($j("#user-detail").attr("identifier")==zuidOrEmail){var identifier=isNaN(zuidOrEmail)?"pendingmembers":"members";for(var index in appsList){var appName=appsList[index],data=membersAJAXResult[appName],memberInfo=data[identifier];if(void 0!==memberInfo){var isActive=(memberInfo.role_id,1==$j("#"+appName+"-"+userID+"-active:visible").length),actionsHTML=$j("#"+appName+"-"+userID+" .js-userapp-status:visible .valign").html();void 0==actionsHTML&&(actionsHTML="");var hasAccountInfo=0!=$j("#admin-panel-data-temp #"+appName+"-account-info").length;if(hasAccountInfo)AdminPanel.users.renderApp(appName,isActive,actionsHTML,memberInfo);else{var appSOID=Services.configuredServicesData[appName].APPID,excludes=AdminPanel.authRoles.isAuthorized(appName)?void 0:"departments";AdminPanel.accountInfo.get(appName,appSOID,void 0,AdminPanel.users.renderApp,[appName,isActive,actionsHTML,memberInfo],excludes)}}else AdminPanel.users.renderApp(appName,!0,"")}}}).always(function(){callback&&callback(),ishiderow&&$j("#user-detail").attr("removeRowID",userID)}),this.showAddApplication(appsList,userID),Hash.set("settings/users/"+userID);else if($j("#user-detail-app-nodata").show(),this.showAddApplication(appsList,userID),callback&&(callback(),ishiderow)){var element=$j("#user-"+userID)[0];element.parentNode.removeChild(element)}}},hideDetail:function(event){if(0!=$j("#user-detail:visible").length){if(event&&Common.stopEvents(event),$j("#user-detail").attr("removeRowID")){var userID=$j("#user-detail").attr("removeRowID"),element=$j("#user-"+userID)[0];element.parentNode.removeChild(element),$j("#user-detail").removeAttr("removeRowID")}-1!=Hash.current.indexOf("users")&&Hash.set("settings/users"),$j("#user-detail").hide("slide",{direction:"right"},250)}},showAddApplication:function(appsList,userID){var allowedApps=[],showAddUser=!1,configuredApps=Services.configuredCount,isMotivatorMapped=Services.configuredServicesData.motivator?Services.configuredServicesData.motivator.ISCONFIGURED:!1;if(userID&&void 0===appsList&&(appsList=this.getApps(userID)),isMotivatorMapped&&-1==appsList.indexOf("motivator")&&(configuredApps-=1),Common.isAdmin)appsList.length<configuredApps&&(showAddUser=!0,allowedApps=Services.nameArray);else{var appRoles=AdminPanel.authRoles.map;for(app in appRoles){var appRole=appRoles[app],isHiddenService=-1!=Services.hidden.indexOf(app);!isHiddenService&&appRole>0&&-1==appsList.indexOf(app)&&allowedApps.push(app)}showAddUser=allowedApps.length>0}if(showAddUser){var clickListener,isLightUser=$j("#user-"+userID).attr("lightuser"),isInactiveUser="inactive"==$j("#user-"+userID).attr("status"),addAppElement=createElement("a","user-detail-assign-app");if($j("#user-detail-assign-app").remove(),addAppElement.setAttribute("href","javascript:;"),addAppElement.setAttribute("class","f12 fLeft mL20"),$j(addAppElement).text("+"+I18N.getValue("crmplus.label.add")),isLightUser||isInactiveUser){var licenseCallback=AdminPanel.adduser.validateLicense.bind(AdminPanel.adduser,"detail",userID,void 0);clickListener=License.check.bind(null,allowedApps.join(),licenseCallback)}else clickListener=AdminPanel.adduser.show.bind(AdminPanel.adduser,"detail",userID,void 0);Common.addEventListener(addAppElement,"click",clickListener),$j("#user-detail-applications-header").append(addAppElement)}else $j("#user-detail-assign-app").remove()},renderApp:function(appName,isactive,actionsHTML,data){var appHTML=$j("#user-detail-app").clone()[0];isactive=void 0==isactive?!0:isactive,appHTML.style.display="block",appHTML.setAttribute("app",appName),appHTML.removeAttribute("id");var roleName=DataTemplates.member.getDisplayRoleName(appName,data);""!=roleName.trim()&&$j(appHTML.querySelector(".js-user-detail-app-role")).text(roleName),$j(appHTML.querySelector(".js-user-detail-app-name")).text(I18N.getValue("service.title."+appName)),actionsHTML&&appHTML.querySelector(".js-user-detail-app-actions").classList.add(appName+"-role-admin"),appHTML.querySelector(".js-user-detail-app-actions").innerHTML=actionsHTML,appHTML.querySelector(".js-user-detail-app-logo").classList.add(appName),appHTML.querySelector(".js-user-detail-app-disabled").style.display=isactive?"none":"inline",0==$j("#user-detail-app-container .js-user-detail-app[app="+appName+"]").length?$j("#user-detail-app-container").append(appHTML):$j("#user-detail-app-container .js-user-detail-app[app="+appName+"]").replaceWith(appHTML),$j("#user-detail-app-container").show()},search:function(queryStr){$j("#adminPanelContBody").scrollTop(0),$j("#adminPanelContBody").attr("hasmore","true"),$j("#adminPanelContBody").attr("pageno",1),$j(".js-userview-email").val(queryStr);var viewType=$j("#users-view-list li.selected").attr("type");AdminPanel.users.get(viewType,void 0,queryStr,void 0,void 0,!0)},showSearch:function(){$j("#loadingusers-span").hide(),$j(".js-userview-search").addClass("zshow"),$j(".js-userview-email").val(""),$j(".js-userview-email").focus(),AdminPanel.users.hideDetail("close")},hideSearch:function(){$j(".js-userview-search").removeClass("zshow");var viewType=$j("#users-view-list li.selected").attr("type");void 0!=$j("#userview-email").val().trim()&&($j("#adminPanelContBody").scrollTop(0),$j("#adminPanelContBody").attr("hasmore","true"),$j("#adminPanelContBody").attr("pageno",1),AdminPanel.users.get(viewType,void 0,void 0,void 0,void 0,!0,1)),AdminPanel.users.hideDetail("close")},syncUserStatus:function(appName,userId,status){0!=$j("#"+appName+"-"+userId).length&&($j("#"+appName+"-"+userId+"-active").hide(),$j("#"+appName+"-"+userId+"-disable").hide(),$j("#"+appName+"-"+userId+"-unassign").hide(),$j("#"+appName+"-"+userId).attr("status",status),$j("#"+appName+"-"+userId+"-"+status).show())},getApps:function(userID){var apps=$j("#user-"+userID+" td[status]").not("[status=noaccess]");return appsList=[],apps.each(function(){var appName=this.getAttribute("app");appsList.push(appName)}),appsList},getUserIDFromIdentifier:function(identifier){var user=$j('#userstableview tr[identifier="'+identifier+'"]');return user.length>0?user.attr("id").replace("user-",""):-1},isLightUser:function(identifier,userID){var userRow;return identifier?userRow=$j('#userstableview tr[identifier="'+identifier+'"]'):userID&&(userRow=$j("#user-"+userID)),userRow&&userRow.length>0?"true"==userRow.attr("lightuser"):void 0}},AdminPanel.invitations={resend:function(email){var params={};params.emails=email,params.action="resendinvite",params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){var error=AdminPanel.util.handleError(data);error||showStatusMsg("success",I18N.getValue("crmplus.success.user_invite"))}})},deleteUser:function(emailOrZuid){var params={};isNaN(emailOrZuid)&&(params.emails=emailOrZuid),params.action="adduser",isNaN(emailOrZuid)||(params.zuids=emailOrZuid,params.action="deleteuser"),params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",data:params,loadingParams:{type:"global"},url:Common.getPortalUrl(!0)+"/adminpanel.do",beforeSend:function(){AdminPanel.util.holdAddUpdateActions(!0)},complete:function(){AdminPanel.util.holdAddUpdateActions()},success:function(data){if("string"==typeof data&&data.trim())return data.trim().startsWith("<div")&&AdminPanel.reportingTo.showChangeReportingTo(data.trim(),!0,params.emails,params.zuids),void AdminPanel.invitations._remove(emailOrZuid);var error=AdminPanel.util.handleError(data);error||(AdminPanel.invitations._remove(emailOrZuid),showStatusMsg("success",I18N.getValue("crmplus.success.user_delete"))),AdminPanel.util.holdAddUpdateActions(),hideDialog("crmplus-dialog",!0)},error:function(){AdminPanel.util.holdAddUpdateActions(),hideDialog("crmplus-dialog",!0)}})},_remove:function(emailOrZuid){$j('#userview-table tr[identifier="'+emailOrZuid+'"]').remove(),$j("#user-detail").hide()},add:function(emails,appData,resultStack){var params={};parmas.data_all=JSON.Stringify(DataTemapletes.member.getAddusersData(emails,appData)),params.action="adduser",params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",data:params,loadingParams:{id:"crmplus-dialog-button",type:"button"},url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){if(resultStack)return void resultStack.push(data);var error=AdminPanel.util.handleError(data,!1);error&&void 0==data.app?$c("#crmplus-dialog-error").text(error):showStatusMsg("success",I18N.getValue("crmplus.success.user_add"))}})},showAlert:function(emailOrZuid){var userRow=$j('#userview-table tr[identifier="'+emailOrZuid+'"]'),userName=userRow.find(".zcrmp-adminUsrName").text();showDialog("crmplus-dialog",I18N.getValue("crmplus.label.deleteuseralert"),"<span>"+I18N.getValue("crmplus.message.deleteuseralert",[userName])+"</span>",I18N.getValue("button.proceedtodelete"),'AdminPanel.invitations.deleteUser("'+emailOrZuid+'")',void 0,void 0,!0,!1),Common.animateScrollToTop("crmplus-dialog-body",0,200)}},AdminPanel.authRoles={init:function(){AdminPanel.authRoles.map={crmplus:2},AdminPanel.authRoles.set()},fetch:function(){void 0!==Common.myOrgId&&$j.ajax({type:"GET",url:"/api/v1/orgs/"+Common.myOrgId+"/authroles/"+Common.myZuid,success:function(data){200==data.status_code&&(AdminPanel.authRoles.map=data.authroles,AdminPanel.authRoles.set(data.authroles),AdminPanel.hash&&(Hash.set(AdminPanel.hash),AdminPanel.util.handleHash(AdminPanel.hash)))}})},set:function(){if(void 0==this.map)return void this.fetch();var authroles=this.map,roleClassList="",isServiceAdmin=!1,isServiceModerator=!1;for(app in authroles)role=authroles[app],"crmplus"!=app?(roleClass=2==role||1==role?" zcrmp-role-"+app+"admin":"",isServiceAdmin||(isServiceAdmin=2==role),isServiceModerator||(isServiceModerator=1==role)):roleClass=2==role?" zcrmp-role-sadmin":1==role?" zcrmp-role-admin":"",roleClassList+=roleClass;isServiceAdmin?roleClassList+=" zcrmp-role-service-admin":isServiceModerator&&(roleClassList+=" zcrmp-role-service-moderator"),""!=roleClassList?(Services.hasAdminPanelAccess=!0,$j("#commontopbaradminpanel").show()):(Services.hasAdminPanelAccess=!1,$j("#crmplus-setup").hide()),$j("#crmplus-adminpanel").addClass(roleClassList),$j("#crmplus-dialog").addClass(roleClassList),$j("#user-detail").addClass(roleClassList)},isAuthorized:function(appName){return this.get(appName)>0},isAuthorizedForAnyApp:function(appNames){for(var index in appNames){var appName=appNames[index];if(this.isAuthorized(appName))return!0}return!1},get:function(appName){return AdminPanel.authRoles.map.crmplus>=1?2:void 0!=appName&&AdminPanel.authRoles.map[appName]?AdminPanel.authRoles.map[appName]:-1},getAdminApps:function(){var apppsList=[];if(AdminPanel.authRoles.map.crmplus>=1)apppsList=Services.nameArray;else{var authroles=AdminPanel.authRoles.map;for(var app in authroles)role=authroles[app],"crmplus"==app||2!=role&&1!=role||apppsList.push(app)}return apppsList.join(",")}},AdminPanel.permissions={admin:{create:!0,edit:!0,remove:!0},fetch:function(appName,callback){if(void 0!==Common.myOrgId){if(!this.isApplicable(appName)||this.isAvailable(appName))return void(callback&&callback());var appSOID=Services.getServiceSoid(appName)[appName];$j.ajax({type:"GET",url:"/api/v1/orgs/"+Common.myOrgId+"/serviceorgs/"+appSOID+"/permissions/"+Common.myZuid,success:function(data){200==data.status_code&&(AdminPanel.permissions[appName]=data.permissions,AdminPanel.hash&&(Hash.set(AdminPanel.hash),AdminPanel.util.handleHash(AdminPanel.hash)),callback&&callback())}})}},isApplicable:function(appName){return"projects"===appName},get:function(appName){return Common.isAdmin?this.admin:this[appName]},canEdit:function(appName){var isServiceAdmin=2==AdminPanel.authRoles.get(appName);return!isServiceAdmin&&this.isApplicable(appName)?this[appName]&&void 0!=this[appName].edit?this[appName].edit:!1:!0},canRemove:function(appName){var isServiceAdmin=2==AdminPanel.authRoles.get(appName);return!isServiceAdmin&&this.isApplicable(appName)?this[appName]&&void 0!=this[appName].remove?this[appName].remove:!1:!0},isOwner:function(appName){return this.isApplicable(appName)&&this[appName]&&void 0!=this[appName].is_owner?this[appName].is_owner:!1},isAvailable:function(appName){return!Common.isAdmin&&this.isApplicable(appName)?void 0!=AdminPanel.permissions[appName]:!0}},AdminPanel.apps={showAddUser:function(appName,departmentID,license){var appProp=AdminPanel.appProperties.get(appName);if(!appProp||0==$j("#admin-panel-data-temp").length){var callback=function(){AdminPanel.apps.showAddUser(appName,departmentID,license)};return void AdminPanel.appProperties.fetch(appName,callback)}appProp.dependent_service&&(appName=appProp.dependent_service);var appSOID=Services.configuredServicesData[appName].APPID,hasAccountInfo=0!=$j("#admin-panel-data-temp #"+appName+"-account-info").length;hasAccountInfo?this._populateAddUser(appName,departmentID,license):AdminPanel.accountInfo.get(appName,appSOID,void 0,function(){AdminPanel.apps._populateAddUser(appName,departmentID,license)})},addUser:function(appName,departmentID,appJSON,email,zuid){var users=$c("#crmplus-apps-adduser-container .js-user-autosugg");if(appJSON||(appJSON=DataTemplates.member.getAppData(appName,!0)),0==users.length&&!email&&!zuid)return void $c("#crmplus-dialog-error").text(I18N.getValue(appJSON.error?"crmplus.error.select_all_fields":"crmplus.error.select_one"));if(appJSON.error){var error=appJSON.error;return void $c("#crmplus-dialog-error").text(error.message)}appJSON.skip_no_permission=!0,(email||zuid)&&(appJSON.isSkipActivate=!0);var appData=JSON.stringify(appJSON),emails=[],zuids=[],newInvites=[];users.each(function(){var identifier=this.getAttribute("identifier");void 0!==identifier&&null!=identifier?isNaN(identifier)?emails.push(identifier):zuids.push(identifier):newInvites.push(this.getAttribute("email"))}),email&&(emails=email),zuid&&(zuids=zuid);var ajaxArr=[],resultsStack=[];if(emails.length>0)for(var index in emails){var emailId=emails[index];ajaxArr.push(AdminPanel.members.update(appName,appData,resultsStack,"emails",emailId))}if(zuids.length>0&&ajaxArr.push(AdminPanel.members.update(appName,appData,resultsStack,"zuids",zuids)),newInvites.length>0){var apps=[];apps.push(appJSON);for(var index in newInvites){var emailId=newInvites[index],data=DataTemplates.member.getAddUserData(emailId,apps);ajaxArr.push(AdminPanel.adduser.submit(!1,data,resultsStack))}}ajaxArr.length>0&&Loading.button.start({id:"crmplus-dialog-button"}),$j.when.apply($j,ajaxArr).then(function(){var error=AdminPanel.util.handleError(resultsStack,!1,"maximum_user_limit_exceeded");return AdminPanel.util.removeError(),error?void("object"==typeof error?AdminPanel.apps.showLicenseError(appName,error):$c("#crmplus-dialog-error").text(error)):(email||zuid?showStatusMsg("success",I18N.getValue("crmplus.success.update_subordinates")):showStatusMsg("success",I18N.getValue("crmplus.success.user_assign")),hideDialog("crmplus-dialog",!0),$j("#users-view-list [type=active]").removeClass("selected"),$j("#userviewheader").removeAttr("filter"),void AdminPanel.users.show())}).always(function(){Loading.button.stop({id:"crmplus-dialog-button"}),Services.isLoadedInIframe[appName]&&ServiceCommunicator.triggerAction(appName,"showUsersTab",departmentID)})},showLicenseError:function(appName,errorData){if($j("#crmplus-dialog-top-error").length>0)return void Common.animateScrollToTop("crmplus-dialog-body",0,200);var paidUsersCount=errorData.paid,subscriptionLink=(errorData.app_active_users,"");subscriptionLink=Common.isAdmin?"<a rel='noopener' target='_blank' href='"+Services.allServiceUrl.paymentsurl+"'>"+I18N.getValue("button.upgrade")+"</a>":I18N.getValue("subscription.message.trialexpired.contactadmin");var I18nAppname=I18N.getValue("service.title."+appName),chooseUsersLink="<a rel='noopener'  href='javascript:;' onclick='AdminPanel.apps.removeSelectedUsers()'>"+I18N.getValue("crmplus.label.choose_users",[I18nAppname])+"</a>",errorElement=createElement("ul","crmplus-dialog-top-error");errorElement.setAttribute("class","zcrmp-errCompbox");var errorParams=[paidUsersCount,subscriptionLink,chooseUsersLink],errorMessage=I18N.getValue("crmplus.error.license.appuser",errorParams);errorElement.innerHTML=errorMessage,$j("#crmplus-dialog-body").prepend(errorElement),Common.animateScrollToTop("crmplus-dialog-body",0,200)},removeSelectedUsers:function(){$j("#crmplus-apps-adduser-container div").remove(),$j("#crmplus-apps-adduser-email").focus()},_populateAddUser:function(appName,departmentID,license){var accInfoHTML=$j("#admin-panel-data-temp #"+appName+"-account-info").clone(),inputComponent=$j("#crmplus-apps-adduser").clone(),html=inputComponent.add(accInfoHTML);if(html=$j("<div>").append(html),showDialog("crmplus-dialog",I18N.getValue("crmplus.label.adduser"),html,I18N.getValue("crmplus.label.adduser"),'AdminPanel.apps.addUser("'+escapeHtml(appName)+'","'+escapeHtml(departmentID)+'")',680),$c("#"+appName+"-account-info").show(),$c("#crmplus-apps-adduser").show(),$c("#crmplus-apps-adduser").attr("onkeyup","AdminPanel.util.getAutoFillUsers(undefined,event)"),window.hasOwnProperty("nonUserRequestAccessAddUserEmail")||$c("#crmplus-apps-adduser-email").focus(),departmentID){var departmentCheck=$c("input[parentid="+appName+"-dep-"+departmentID+"]");if(departmentCheck.length>0){departmentCheck.prop("checked",!0),AdminPanel.util.toggleChecked(departmentCheck[0],appName+"-sel-dep-count");var selectedDepartmentsHeader=$c("#"+appName+"-department-cont .zcrmp-appsmainTabs li")[1];AdminPanel.util.showDepartments(selectedDepartmentsHeader,appName,"selected")}}license&&license.custom_role_apps&&!license.is_license_available&&AdminPanel.accountInfo.applyCustomRole(appName,License.lightUserIamSorgRole),AdminPanel.accountInfo.attachEvents(appName),window.nonUserRequestAccessAddUserEmail&&AdminPanel.util.getAutoFillUsers(void 0,void 0)},_populateChangeOwner:function(appName){var appProp=AdminPanel.appProperties.get(appName);appProp.dependent_service&&(appName=appProp.dependent_service);var inputComponent=$j("#crmplus-apps-adduser").clone(),noteComponent=$j("#crmplus-adminpanel-note").clone();inputComponent.attr("type","owner");var note=I18N.getValue("crmplus.error.new_service_owner");html=$j("<div>").append(inputComponent),html.append(noteComponent);var button=I18N.getValue("adminview.changeowner"),title=I18N.getValue("adminview.changeowner")+" - "+I18N.getValue("service.title."+appName);showDialog("crmplus-dialog",title,html,button,"AdminPanel.apps.changeOwner()"),$c("#crmplus-apps-adduser").show(),$c("#crmplus-apps-adduser-label").text(I18N.getValue("adminpanel.changeappowner.choose",[I18N.getValue("service.title."+appName)])),$c("#crmplus-apps-adduser-label").css({"text-transform":"none","font-size":"14px"}),$c("#crmplus-adminpanel-note span").text(note),$c("#crmplus-adminpanel-note").show(),$c("#crmplus-apps-adduser-email").focus(),$c("#crmplus-apps-adduser").attr("onkeyup","AdminPanel.util.getAutoFillUsers('autofill_app_users',event)"),$c("#crmplus-apps-adduser").attr("appName",appName)},getOwner:function(appName){var params={};params.action="getappowner",params.appname=appName,params.appsoid=Services.configuredServicesData[appName].APPID;$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/adminpanel.do",data:params,success:function(data){data.owners&&AdminPanel.apps._populateOwner(appName,data.owners[0])}})},_populateOwner:function(appName,data){$j("#"+appName+"-owner-email").text(data.email_id),$j("#"+appName+"-owner-name").text(data.display_name),$j("#"+appName+"-owner-anchor").attr("href","#settings/users/"+data.userid),$j("#"+appName+"-row").attr("identifier",data.email_id),$j("#"+appName+"-row").attr("owner_id",data.userid),$j("#"+appName+"-row").attr("owner_zuid",data.zuid);var owner_image=data.display_image+"&API=true",profiletext=null;if(profiletext=AdminPanel.apps.getprofiletext(void 0!=data.display_name&&data.display_name.length>0?data.display_name:data.email_id),$j("#"+appName+"-owner-img-name").attr("class","zcrmp-usrNameLtrs "+data.zuid+"user-img-name"),$j("#"+appName+"-owner-img").attr("class",data.zuid+"user-img"),$j("#"+appName+"-owner-img-name").text(profiletext),AdminPanel.util.loadprofileimage(appName+"-owner-img",owner_image),(data.userid==Common.myId||AdminPanel.authRoles.get("crmplus")>=1)&&0==$j("#"+appName+"-changeowner-btn").length){var changeOwnerHtml='<span id="'+appName+'-changeowner-btn" class="zcrmp-serAddUsrLabel  '+appName+'-role-admin-inl" onclick="AdminPanel.apps._populateChangeOwner(\''+appName+'\');event.stopPropagation();" style="display:none">'+I18N.getValue("adminview.changeowner")+"</span>",tdElement=$j("."+appName+"-role-admin-inl")[0];tdElement&&tdElement.insertAdjacentHTML("afterend",changeOwnerHtml)}},getprofiletext:function(userName){if(void 0==userName||null==userName)return void(userName="Ns");var displayText=userName.replace(/[\.\-\_\@\!\&\#\*]/gi,"");if(null!=userName){displayText=displayText.split(" ");for(var i=displayText.length-1;i>=0;i--)""===displayText[i]&&displayText.splice(i,1);displayText=displayText[0].charAt(0)+(displayText.length>1?displayText[1].charAt(0):displayText[0].charAt(1))
}return displayText.toUpperCase()},changeOwner:function(){var newOwner=$c("#crmplus-apps-adduser-container .js-user-autosugg:visible")[0],newOwnerZUID=newOwner?newOwner.getAttribute("identifier"):void 0;if(void 0===newOwnerZUID||isNaN(newOwnerZUID))return void showStatusMsg("error",I18N.getValue("crmplus.error.select_owner"));var appName=$c("#crmplus-apps-adduser").attr("appName"),params={};params.action="changeAppOwner";var data={};data.currentOwnerZuid=$j("#"+appName+"-row").attr("owner_zuid"),params.data=JSON.stringify(data),params.zuids=newOwnerZUID;var appSOID=Services.configuredServicesData[appName].APPID;params.appsoid=appSOID,params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/adminpanel.do",data:params,loadingParams:{type:"global"},success:function(data){if(data)if(data.ownerChangeMessage)AdminPanel.apps.updateAppRow(appName),hideDialog("crmplus-dialog",!0),showStatusMsg("success",I18N.getValue("crmplus.success.owner_change"));else if(data.message)showStatusMsg("error",data.message);else{var error=AdminPanel.util.handleError(data);error&&showStatusMsg("error",error)}}})},updateAppRow:function(appName){$j("#"+appName+"-changeowner-btn").remove();var newOwner=$c("#crmplus-apps-adduser-container .js-user-autosugg:visible")[0],appStatus=newOwner.getAttribute("appStatus"),data={},dataParam=newOwner.getAttribute("data-param");dataParam=Common.jsonParse(dataParam);var emailEle=$c(newOwner).find(".greyTxt");if(emailEle&&(data.email_id=emailEle.text()),dataParam&&(data.display_name=dataParam[0],data.display_image=dataParam[2]),data.userid=newOwner.getAttribute("userid"),data.zuid=newOwner.getAttribute("identifier"),AdminPanel.apps._populateOwner(appName,data),1!=appStatus){var countTdEle=$j("#"+appName+"-row td[data-click] span"),count=countTdEle.text();count=parseInt(count)+1,countTdEle.text(count),AdminPanel.users.syncUserStatus(appName,data.userid,"active")}"crm"==appName&&AdminPanel.apps.updateAppRow("motivator"),allDepartmentsRole="projects"==appName,AdminPanel.util.mandateRole(appName,allDepartmentsRole?void 0:2,allDepartmentsRole,I18N.getValue("crmplus.error.non_admin"))}},AdminPanel.onBoardAdmin={add:function(appName,isDepartmentsAvail){var currentFrame=appName,appProp=AdminPanel.appProperties.get(appName);if(!appProp||0==$j("#admin-panel-data-temp").length){var callback=function(){AdminPanel.onBoardAdmin.add(appName,isDepartmentsAvail)};return void AdminPanel.appProperties.fetch(appName,callback)}appProp.dependent_service&&(appName=appProp.dependent_service,appProp=AdminPanel.appProperties.get(appName));var isAccountInfoRequired=appProp.is_custom_roles||appProp.has_departments&&!appProp.select_all_departments_for_admin,isDepartmentsAvail=appProp.has_departments&&!appProp.select_all_departments_for_admin;if(isAccountInfoRequired){var hasAccountInfo=0!=$j("#admin-panel-data-temp #"+appName+"-account-info").length;if(!hasAccountInfo){callback=function(){AdminPanel.onBoardAdmin.add(currentFrame)};var appSOID=Services.configuredServicesData[appName].APPID;return isDepartmentsAvail||(Services.onBeforeFrameLoad(currentFrame,!0,void 0,void 0,"iframe-spinner"),Common.htmlContext="iframeLoading"),void AdminPanel.accountInfo.get(appName,appSOID,void 0,callback)}}if(isDepartmentsAvail&&!appProp.select_all_departments_for_admin)return void AdminPanel.onBoardAdmin.showDepartmentsDialog(appName);var data=DataTemplates.member.getAdminJSON(void 0,appName);AdminPanel.onBoardAdmin.updateUser(currentFrame,data)},updateUser:function(appName,data){var currentFrame=appName,appProp=AdminPanel.appProperties.get(appName);if(appProp.dependent_service&&(appName=appProp.dependent_service,appProp=AdminPanel.appProperties.get(appName)),!data){data={};try{data.departments=DataTemplates.member.getDepartments(appName,appProp.department_specific_field,!0)}catch(e){return void $c("#crmplus-dialog-error").text(e.message)}data=DataTemplates.member.getAdminJSON(data,appName)}var callback=function(){AdminPanel.onBoardAdmin.updateAppData(appName,currentFrame)};Common.htmlContext="iframeLoading",Services.onBeforeFrameLoad(currentFrame,!0,void 0,void 0,"iframe-spinner"),AdminPanel.members.update(appName,JSON.stringify(data),void 0,"zuids",Common.myZuid,callback)},showDepartmentsDialog:function(appName){var accInfoHTML=$j("#admin-panel-data-temp #"+appName+"-account-info").clone();showDialog("crmplus-dialog",I18N.getValue("adminpanel.adduser.selectdepartments"),accInfoHTML,I18N.getValue("button.proceed"),'AdminPanel.onBoardAdmin.updateUser("'+appName+'")',620),DataTemplates.accountInfo.pickAdminRole(appName,!0),$c("#"+appName+"-account-info").show()},updateAppData:function(appName,currentFrame){var data={};data.HAS_ACCESS=!0,data.isUserActive=!0,Services.appData.updateDbData(appName,data);for(var appProp={},depentService="",services=Object.keys(Common.appProperties),i=0;i<services.length;i++)appProp=AdminPanel.appProperties.get(services[i]),depentService=appProp.dependent_service,depentService==appName&&Services.appData.updateDbData(services[i],data);Common.htmlContext="","salesinbox"==currentFrame?($j("#crmplusoverviewloadingiconsalesinbox").attr("onclick","Services.completeOverView()"),Common.isAdminOnboard=!0,Services.completeOverView(),SidePanel.getAgentStatus()):Services.completeOverView()},handleError:function(errorObj,appName,appData){var errorCode=void 0;errorObj&&(errorCode=errorObj.errors[0].code);var errorData={};errorData.image="/error-image2.png";"conflict_member"==errorCode?(errorData.header=I18N.getValue("crmplus.api.error.conflict_admin_header",[I18N.getValue("service.title."+appName)]),errorData.message=I18N.getValue("crmplus.api.error.conflict_admin_message",[I18N.getValue("service.title."+appName)])):"unauthorized_org"==errorCode?(errorData.header=I18N.getValue("crmplus.api.error.unauthorized_org_admin_header"),errorData.message=I18N.getValue("crmplus.api.error.unauthorized_org_admin_message")):"not_currentorg_user"==errorCode?(errorData.header=I18N.getValue("crmplus.api.error.not_currentorg_user_admin_header"),errorData.message=I18N.getValue("crmplus.api.error.not_currentorg_user_admin_message")):(errorData.header=I18N.getValue("crmplus.api.error.general_error_header"),errorData.message=I18N.getValue("crmplus.api.error.invalid_response_from_service",[I18N.getValue("service.title."+appName)]),errorData.customdiv='<div class="zcrmp-pageErrBtn redBtn" onclick=\'AdminPanel.onBoardAdmin.retry("'+appName+'",'+JSON.stringify(appData)+");'>"+I18N.getValue("service.creation.tryagain")+"</div>"),CRMPlusCommonUi.showErrorPage("conflictmember",errorData)},retry:function(appName,data){if(data){var currentFrame=Services.currentView,callback=function(){AdminPanel.onBoardAdmin.updateAppData(appName,currentFrame)};Common.htmlContext="iframeLoading",Services.onBeforeFrameLoad(currentFrame,!0,void 0,void 0,"iframe-spinner"),AdminPanel.members.update(appName,data,void 0,"zuids",Common.myZuid,callback)}else{var currentFrame=Services.currentView;AdminPanel.onBoardAdmin.add(currentFrame)}}},AdminPanel.members={show:function(appName,zuidOrEmail,toenable,callback){var callbackFn,appSOID=Services.configuredServicesData[appName].APPID,hasAccountInfo=0!=$j("#admin-panel-data-temp #"+appName+"-account-info").length;callbackFn=toenable?function(){AdminPanel.members._populate(appName),DataTemplates.accountInfo.setMemberIdentifier(zuidOrEmail),callback&&"function"==typeof callback&&callback(appName)}:function(){callback&&"function"==typeof callback?AdminPanel.members.get(appName,appSOID,zuidOrEmail,void 0,callback.bind(null,appName)):AdminPanel.members.get(appName,appSOID,zuidOrEmail)},hasAccountInfo?callbackFn():AdminPanel.accountInfo.get(appName,appSOID,void 0,callbackFn)},get:function(appName,appSOID,zuidOrEmail,resultArr,callback){var params={},memberType="members";params.action="getmemberinfo",params.appsoid=appSOID,params.includes="departments",isNaN(zuidOrEmail)?(params.emails=zuidOrEmail,memberType="pendingmembers"):params.zuids=zuidOrEmail;var loadParams={type:"global"};resultArr&&(params.includes="role_name",loadParams=void 0),callback&&(loadParams=void 0,AdminPanel.accountInfo.showLoading());var ajax=$j.ajax({type:"GET",url:Common.getPortalUrl(!0)+"/adminpanel.do",data:params,loadingParams:loadParams,success:function(data){return resultArr?void(resultArr[appName]=data):void(AdminPanel.util.handleError(data)||(AdminPanel.members._populate(appName,data[memberType]),callback&&callback(data[memberType])))},complete:function(){callback&&(AdminPanel.accountInfo.hideLoading(),$c("#"+appName+"-account-info").show())}});return resultArr?ajax:void 0},_populate:function(appName,memberInfo){{var isServiceModerator,isServiceAdmin,isMemberAdmin,isServiceOwner,canEditRoles=!0,isNotAuthorizedToEditAdmin=!1,appProp=AdminPanel.appProperties.get(appName);appProp.has_moderator&&1==AdminPanel.authRoles.get(appName)}if(appProp.has_moderator){var authRole=AdminPanel.authRoles.get(appName);isServiceModerator=1==authRole,isServiceAdmin=2==authRole,isServiceOwner=AdminPanel.permissions.isOwner(appName),isNotAuthorizedToEditAdmin=appProp.is_custom_roles?isServiceModerator||!Common.isAdmin&&isServiceAdmin&&!isServiceOwner:isServiceModerator,canEditRoles=appProp.is_custom_roles?AdminPanel.permissions.canEdit(appName):isServiceAdmin}if(isMemberAdmin=memberInfo&&2==memberInfo.iam_sorg_role,isNotAuthorizedToEditAdmin&&isMemberAdmin)return void showStatusMsg("info",I18N.getValue("crmplus.error.user.nopermission"));if("#crmplus-dialog"!==Common.htmlContext){var accInfoHTML=$j("#admin-panel-data-temp #"+appName+"-account-info").clone();showDialog("crmplus-dialog",I18N.getValue("crmplus.label.updateuser"),accInfoHTML,I18N.getValue("crmplus.label.update"),'AdminPanel.members.update("'+appName+'")'),$c("#"+appName+"-account-info").show()}if(canEditRoles||($c("#"+appName+"-roles").hide(),$c("#"+appName+"-profiles").hide()),AdminPanel.accountInfo.attachEvents(appName),memberInfo&&(DataTemplates.accountInfo.populate(appName,memberInfo),"crm"==appName)){var element=$j("#crm-role-tree a[role-id="+memberInfo.role_id+"]");if(element.length>0&&!element[0].hasAttribute("reportingto")&&$c("#crm-account-info.js-account-info-cont.zcrmp-showReportinto").length>0)return void AdminPanel.reportingTo.get(void 0,memberInfo)}var identifier=$c("#crmplus-member-identifier").val(),iamSorgRole=$j('#userview-table tr[identifier="'+identifier+'"]').attr("iam-sorg-role");AdminPanel.accountInfo.applyCustomRole(appName,iamSorgRole)},update:function(appName,data,resultsArray,identifierType,identifiers,callback){var displayRoleName,appSOID=Services.configuredServicesData[appName].APPID,params={},appData=data,memberType="members";if(void 0===data){var appDataJSON=DataTemplates.member.getAppData(appName,!0),error=appDataJSON.error;if(error)return $c("#crmplus-dialog-error").attr("error-type",error.type),void $c("#crmplus-dialog-error").text(error.message);displayRoleName=DataTemplates.member.getDisplayRoleName(appName,appDataJSON),appData=JSON.stringify(appDataJSON)}try{if(params.action="updatemember",params.data=appData,params.appsoid=appSOID,window.from_nonUserRequestAccess_accept&&(params.from_nonUserRequestAccess_accept=!0),params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),void 0!==identifierType&&void 0!==identifiers)params[identifierType]=identifiers.toString();else{var zuidOrEmail=DataTemplates.member.getIdentifier();isNaN(zuidOrEmail)?(params.emails=zuidOrEmail,memberType="pendingmembers"):params.zuids=zuidOrEmail}}catch(e){return void showStatusMsg("error",I18N.getValue("mandatory.field.missing"))}var loadParmas=void 0,isAdminOnboard="iframeLoading"==Common.htmlContext;void 0!==resultsArray||isAdminOnboard||(loadParmas=$c("#crmplus-dialog-button").is(":visible")?{id:"crmplus-dialog-button",type:"button"}:{type:"global"}),isAdminOnboard&&(params.self_assign=!0,hideDialog("crmplus-dialog",!0),Common.htmlContext="iframeLoading");var updateAJAX=$j.ajax({type:"POST",data:params,loadingParams:loadParmas,url:Common.getPortalUrl(!0)+"/adminpanel.do",success:function(data){if("string"==typeof data)return data.trim()&&data.trim().startsWith("<div")&&(hideDialog("crmplus-dialog",!0),setTimeout(function(){AdminPanel.reportingTo.showChangeReportingTo(data.trim(),!1,params.emails,params.zuids)},300)),void showStatusMsg("success",I18N.getValue("crmplus.success.member_update"));if(resultsArray)return void resultsArray.push(data);var error=AdminPanel.util.handleError(data);if(error&&isAdminOnboard&&AdminPanel.onBoardAdmin.handleError(data,appName,appData),!error){AdminPanel.members._changeDisplayRole(appName,displayRoleName);var userID=AdminPanel.users.getUserIDFromIdentifier(zuidOrEmail);AdminPanel.members._changeOptions(appName,userID,"active"),"object"==typeof data&&data[memberType]&&data[memberType].isactivated&&AdminPanel.users.get(void 0,zuidOrEmail),$j(".js-user-detail-app[app="+appName+"] .js-user-detail-app-disabled").hide(),callback?callback():showStatusMsg("success",I18N.getValue("crmplus.success.member_update"))}},complete:function(){void 0===resultsArray&&0==$c("#crm-subordinate-cont :visible").length&&hideDialog("crmplus-dialog",!0)}});return resultsArray?updateAJAX:void 0},_changeDisplayRole:function(appName,roleName){$j(".js-user-detail-app[app="+appName+"] .js-user-detail-app-role").text(roleName)},updateStatus:function(appName,zuidOrEmail,userID,status){var params={},appSOID=Services.configuredServicesData[appName].APPID;params.action="changememberstatus",params.appsoid=appSOID,params.activate="active"==status,isNaN(zuidOrEmail)?params.emails=zuidOrEmail:params.zuids=zuidOrEmail,params[Security.csrfParam.get()]=encodeURIComponent(Security.csrfToken.get()),$j.ajax({type:"POST",url:Common.getPortalUrl(!0)+"/adminpanel.do",data:params,loadingParams:{type:"global"},success:function(data){var error=AdminPanel.util.handleError(data);error||(showStatusMsg("success",I18N.getValue("crmplus.success.member_"+status,[I18N.getValue("service.title."+appName)])),AdminPanel.members._changeOptions(appName,userID,status),AdminPanel.members.checkForLastAppInactive(userID,zuidOrEmail))}})},checkForLastAppInactive:function(userID,zuidOrEmail){var userRole=$j("#user-"+userID).attr("id");if(1!==userRole&&2!==userRole){var activeServicesInDetailView=$j(".zcrmp-userDetailsSer .zcrmp-serDisabled").not(":visible"),activeServicesInListView=$j("td[id$='"+userID+"'][status='active']");(0==activeServicesInDetailView.length||0==activeServicesInListView.length)&&AdminPanel.users.get(void 0,zuidOrEmail)}},_changeOptions:function(appName,userID,status){if(!($j("#"+appName+"-"+userID+"-"+status+":visible").length>0)){$j("#"+appName+"-"+userID+" .js-userapp-status").hide(),$j("#"+appName+"-"+userID+"-"+status).show();var statusAttr="unassign"==status?"noaccess":status;if($j("#"+appName+"-"+userID).attr("status",statusAttr),0!=$j("#user-detail:visible").length)if("unassign"==status)$j(".js-user-detail-app[app="+appName+"]").remove(),AdminPanel.users.showAddApplication(void 0,userID);else{"disable"==status?$j(".js-user-detail-app[app="+appName+"] .js-user-detail-app-disabled").show():$j(".js-user-detail-app[app="+appName+"] .js-user-detail-app-disabled").hide();var options=$j("#"+appName+"-"+userID+"-"+status+" .valign").html();$j(".js-user-detail-app[app="+appName+"] .js-user-detail-app-actions").html(options)}}},assignApps:function(zuidOrEmail,userId){var apps;try{apps=DataTemplates.member.getApps()}catch(e){return $c("#crmplus-dialog-error").attr("error-type",e.type),void $c("#crmplus-dialog-error").text(e.message)}var isInActive="inactive"==$j("#user-"+userId).attr("status");if(isInActive){var callback=function(zuidOrEmail,userId){$j("#user-"+userId).attr("status","active"),AdminPanel.members.assignApps(zuidOrEmail,userId)}.bind(null,zuidOrEmail,userId);return void AdminPanel.users.updateStatus(zuidOrEmail,!0,callback)}$c("#crmplus-dialog-error").removeAttr("error-type"),$c("#crmplus-dialog-error").text("");var appsAjax=[],appResults=[],hasApps=!1;for(index in apps){var appData=apps[index],appName=appData.app_name;appsAjax.push(AdminPanel.members.update(appName,JSON.stringify(appData),appResults)),hasApps=!0}hasApps&&Loading.button.start({id:"crmplus-dialog-button"}),$j.when.apply($j,appsAjax).then(function(){var error=AdminPanel.util.handleError(appResults,!1);error?$c("#crmplus-dialog-error").text(error):(showStatusMsg("success",I18N.getValue("crmplus.success.user_assign")),hideDialog("crmplus-dialog",!0)),AdminPanel.users.get(void 0,zuidOrEmail)}).always(function(){userId&&-1!=Hash.current.indexOf("assign")&&Hash.set("settings/users/"+userId),Loading.button.stop({id:"crmplus-dialog-button"})})}},AdminPanel.exportData={users:function(){$j.ajax({type:"GET",url:"/api/v1/orgs/"+Common.myOrgId+"/exportdata/users",loadingParams:{type:"global"},success:function(responseData){if(responseData&&200==responseData.status_code){var result=responseData.exportdata;if(result.csvContent){showStatusMsg("success",I18N.getValue("crmplus.inprogress.exportdata"));var csvContent=result.csvContent;if(window.navigator.msSaveBlob){var blob=new Blob([csvContent],{type:"csv/text;charset=utf-8;"});return void window.navigator.msSaveOrOpenBlob(blob,"users.csv")}var csvData="data:application/csv;charset=utf-8,"+encodeURIComponent(csvContent),dummyElement=createElement("a");return $j(dummyElement).attr({href:csvData,download:"users.csv"}),document.body.appendChild(dummyElement),dummyElement.click(),void document.body.removeChild(dummyElement)}AdminPanel.exportData.showStatusPop(!0)}else AdminPanel.exportData.showStatusPop()},error:function(){AdminPanel.exportData.showStatusPop()}})},showStatusPop:function(isSuccess){var bodyHTML=void 0;bodyHTML=isSuccess?"<span>"+I18N.getValue("crmplus.success.exportdata")+"</span>":"<span style='color:#e45555'>"+I18N.getValue("crmplus.error.exportdata")+"</span>",showDialog("crmplus-dialog",I18N.getValue("crmplus.message.exportusersdata"),bodyHTML,I18N.getValue("button.ok"),"hideDialog('crmplus-dialog',true)",void 0,void 0,!0,!0),Common.animateScrollToTop("crmplus-dialog-body",0,200)}},License.lightUserIamSorgRole=-1,License.check=function(apps,callback){var params={};params.include="unused_licenese",void 0===apps&&(apps=AdminPanel.authRoles.getAdminApps()),params.filter_apps=apps,$j.ajax({type:"GET",url:Common.apiPrefix+"/orgs/"+Common.myOrgId+"/license",data:params,loadingParams:{type:"global"},dataType:"json",success:function(data){data.license&&"function"==typeof callback?callback(data.license[0]):showStatusMsg("error",I18N.getValue("crmplus.api.error.maximum_user_limit_exceeded"))}})},License.showError=function(isLightUser,params){var button,buttonLink,hideCancelButton,html=I18N.getValue("crmplus.error.license.general",[params.paidUsers])+" ",header=I18N.getValue("crmplus.error.license.generalheader");isLightUser&&(html+=I18N.getValue("crmplus.error.license.lightuser")),Common.isAdmin?(html+=I18N.getValue("crmplus.error.license.upgrade_admin"),button=I18N.getValue("button.upgrade"),buttonLink='window.open(Services.allServiceUrl.paymentsurl,"_blank")',hideCancelButton=!1):(html+=I18N.getValue("subscription.message.contactadmin"),button=I18N.getValue("button.ok"),buttonLink='hideDialog("crmplus-dialog",true)',hideCancelButton=!0),showDialog("crmplus-dialog",header,html,button,buttonLink,void 0,void 0,!0,hideCancelButton),Hash.set("settings/users")},DataTemplates.member={getDepartments:function(appName,include,isMandatory){var departments=[];if(0==$c("#"+appName+"-departments-container").length)return[];var departmnetElements=$c("#"+appName+"-departments-container .zchecked");if(departmnetElements.each(function(){var department={};if(department.department_id=this.getAttribute("dept-id"),void 0!=include&&""!=include){var selector="#"+appName+"-dep-"+department.department_id+"-"+include;"role"==include?department.role_id=this.querySelector(selector).getAttribute(include+"-id"):"chat"==include&&(department.chat_enabled=this.querySelector(selector).checked)}departments.push(department)}),isMandatory&&0==departments.length)throw new exception(I18N.getValue("adminpanel.adduser."+AdminPanel.util.getDepartmentAlias(appName)+".selectone"));return departments},getReportingTo:function(){var reportingToUser=$c("#crm-reportingto-input-div .js-user-autosugg:not([onclick])")[0];if(reportingToUser){var identifier=reportingToUser.getAttribute("identifier"),result={};return identifier&&isNaN(identifier)?result.email=identifier:result.zuid=identifier,result}return-1},getTerritories:function(){var territories=[],territoryElements=$c("#crm-territories-input-div div");return territoryElements.each(function(){territories.push(this.getAttribute("territoryId"))}),territories},getAppData:function(appName,includeError,skipError){if(0!=$c("#"+appName+"-account-info").length){var json={};json.app_name=appName,json.zaaid=this.getSOID(appName),json.is_light_user=!1,json.is_service_admin=!1;try{json=this.getUserPickedData(appName,!0,json),this.removeAppError(appName)}catch(e){if(skipError||this.setAppError(appName,e.message),json.error=e,!includeError)return}return json}},getAddUserData:function(emailID,appData){var completeData={};try{if(void 0===emailID)try{emailID=this.getEmail()}catch(ex){try{{this.getApps()}}catch(exp){throw new exception("noAppPicked"==exp.type?I18N.getValue("mandatory.field.emailapp.missing"):I18N.getValue("crmplus.error.email_fields"))}throw ex}void 0===appData&&(appData=this.getApps()),completeData.email_id=emailID,completeData.last_name=this.getFirstName(emailID),completeData.apps=appData,completeData.is_active=!0}catch(e){throw e}return completeData},getApps:function(excludeApp,isSkipError){var apps=[],errorAppName=void 0,selectedApps=$c("#adduser-apps-list .js-adduser-app:checked");if(excludeApp&&this.removeAppError(excludeApp),selectedApps.each(function(){var appName=this.getAttribute("app-name");if(void 0==excludeApp||excludeApp!=appName){var appJSON=DataTemplates.member.getAppData(appName,void 0,isSkipError);void 0!==appJSON?apps.push(appJSON):void 0==errorAppName&&(errorAppName=appName)}}),0==selectedApps.length){var exp=new exception(I18N.getValue("crmplus.error.no_app"));throw exp.type="noAppPicked",exp}if(selectedApps.length!==apps.length){if(excludeApp||isSkipError||$c("#"+errorAppName+"-adduser-li").hasClass("selected")||($c("#"+errorAppName+"-adduser-error").mouseover(),setTimeout(function(){$c("#"+errorAppName+"-adduser-error").mouseleave()},2500)),selectedApps.length-apps.length==1){var msg=$c("#"+errorAppName+"-adduser-error").attr("error-msg")+" "+I18N.getValue("crmplus.message.in")+" "+I18N.getValue("service.title."+errorAppName),exp=new exception(msg);throw exp.type="mandatoryFields",exp}var exp=new exception(I18N.getValue("mandatory.field.missing"));throw exp.type="mandatoryFields",exp}return apps},getEmail:function(){var email=$c("#adduser-email").val(),errorMessage="";if(""==email)errorMessage="enter email ID";else if(Regex.map.email.test(email))return $c("#adduser-email-error").hide(),$c("#adduser-email-note").show(),$c("#adduser-email").attr("onkeyup",""),email;errorMessage=I18N.getValue("crmplus.error.email"),$c("#adduser-email-note").hide(),$c("#adduser-email-error").show(),$c("#adduser-email").attr("onkeyup",'DataTemplates.member.validate("email")');var exp=new exception(errorMessage);throw exp.type="invalidEmail",exp},getRole:function(appName,isMandatory){return this.getProperty(appName,"role",isMandatory)},getProfile:function(appName,isMandatory){return this.getProperty(appName,"profile",isMandatory)},getSOID:function(appName){var appData=Services.configuredServicesData[appName];if(null!=appData)return appData.APPID;throw new exception("App SOID Not available")},getUserPickedData:function(appName,isMandatory,json){json||(json={});var appProp=AdminPanel.appProperties.get(appName),missingFields="",isCustomRole=!1;if(appProp.has_role_specific_fields&&(isCustomRole=$c("#"+appName+"-role-custom").prop("checked"),json.is_admin=$c("#"+appName+"-role-admin").prop("checked"),json.is_light_user=$c("#"+appName+"-role-lightagent").prop("checked"),json.is_agent=$c("#"+appName+"-role-agent").prop("checked"),json.is_agent&&(json.access_to=this.getProperty(appName,"agent",!0))),!appProp.has_role_specific_fields||appProp.has_role_specific_fields&&isCustomRole){var role=AdminPanel.authRoles.defaultRoleId.nonadmin;$j("#"+appName+"-role").length>0&&(role=this.getProperty(appName,"role")),json.role_id=role,isMandatory&&""==role&&(missingFields+="role,")}if(appProp.has_profiles&&(!appProp.has_role_specific_fields||appProp.has_role_specific_fields&&isCustomRole)){var profile=this.getProperty(appName,"profile");json.profile_id=profile,isAllDepartmetnsSelected=getAttrValue("#"+appName+"-profile","all_departments_selected"),"true"==isAllDepartmetnsSelected&&(json.all_departments_selected=!0),isMandatory&&""==profile&&(missingFields+="profile,")}if(appProp.has_departments){if(!json.all_departments_selected&&json.role_id){var adminLiElement=$c("#"+appName+"-roles-options li[role-id="+json.role_id+"]")[0];adminLiElement&&(json.all_departments_selected="true"==adminLiElement.getAttribute("all_departments_selected"))}if(!json.all_departments_selected){var include=appProp.department_specific_field;try{json.departments=this.getDepartments(appName,include,isMandatory)}catch(e){var deptAlias=AdminPanel.util.getDepartmentAlias(appName);missingFields=missingFields+deptAlias+","}}}if(appProp.can_monitor_user&&json.role_id!=AdminPanel.authRoles.defaultRoleId.admin&&(json.monitor_user=$c("#"+appName+"-monitor-user").prop("checked")),appProp.has_territories&&(json.territories=this.getTerritories()),appProp.has_reporting_to){$j("#"+appName+"-role-tree a[reportingTo]").length>0&&(json.is_reportingto_enabled=!0);var reportingTo=this.getReportingTo();reportingTo.zuid?json.reportingto_zuid=reportingTo.zuid:reportingTo.email&&(json.reportingto_email=reportingTo.email)}if(json.role_id==AdminPanel.authRoles.defaultRoleId.admin&&(json.is_service_admin=!0),""!=missingFields){var errorMsg=this.getErrorMsg(missingFields);throw new exception(errorMsg)}return json},getErrorMsg:function(missingFields){if(!missingFields||""==missingFields)return"";var fields=missingFields.split(",");fields.pop();for(var errorMsg=I18N.getValue("crmplus.error.select")+" ",i=0;i<fields.length;i++)i+1==fields.length&&0!=i?errorMsg=errorMsg+" "+I18N.getValue("crmplus.message.and")+" "+I18N.getValue("mandatory.field."+fields[i])+" ":0!=i?errorMsg=errorMsg+", "+I18N.getValue("mandatory.field."+fields[i]):errorMsg+=I18N.getValue("mandatory.field."+fields[i]);return errorMsg},getProperty:function(appName,property,isMandatory){var id="#"+appName+"-"+property;("#crmplus-dialog"==Common.htmlContext||"#adduserview"==Common.htmlContext||"#crmplus-adminpanel"==Common.htmlContext)&&(id=Common.htmlContext+" "+id);var propValue=getAttrValue(id,property+"-id");if(isMandatory&&""==propValue)throw new exception(I18N.getValue("crmplus.error."+property.toLowerCase()));return propValue},getDisplayRoleName:function(appName,data){if(void 0===data)return I18N.getValue("crmplus.role.user");var roleName,appProp=AdminPanel.appProperties.get(appName);if(appProp.has_role_specific_fields?data.is_agent?roleName=I18N.getValue("crmplus.role.agent"):data.is_light_user?roleName=I18N.getValue("crmplus.role.lightagent"):data.is_admin&&(roleName=I18N.getValue("crmplus.role.admin")):(!appProp.multiple_admins_allowed||appProp.dependent_service)&&(roleName=I18N.getValue(2==data.role_id?"crmplus.role.user":"crmplus.role.admin")),void 0!=roleName)return roleName;if(data.role_id){var roleID=data.role_id,oldRoleID=data.old_role_id,idName="role-id";oldRoleID&&(idName="old-role-id",roleID=oldRoleID),roleName=appProp.has_role_hierarchy?$j("#"+appName+"-role-tree #role-"+roleID+" a[role-id="+roleID+"]").text():$j("#"+appName+"-roles-options li["+idName+"="+roleID+"]").text()}if(data.profile_id){var profileID=data.profile_id,oldProfileID=data.old_profile_id,profileIDName="profile-id";return oldProfileID&&(profileIDName="old-profile-id",profileID=oldProfileID),roleName+", "+$j("#"+appName+"-profile-options li["+profileIDName+"="+profileID+"]").text()}return roleName},getFirstName:function(email){return void 0!==email?email.substr(0,email.indexOf("@")):getAttrValue("#adduser-first-name","value")},setAppError:function(appName,message){var showTooltip=!1;!$c("#"+appName+"-adduser-error").is(":visible")&&$c("#"+appName+"-adduser-li").is(":visible")&&(showTooltip=!0),message&&$c("#"+appName+"-adduser-error").attr("error-msg",message.trim()),$c("#"+appName+"-adduser-error").removeClass("hide").attr("onmouseover",'tooltip("'+message+'",event)'),showTooltip&&!$c("#"+appName+"-adduser-li").hasClass("selected")&&($c("#"+appName+"-adduser-error").mouseover(),setTimeout(function(){$j("#tooltip:visible").remove()},2500))},removeAppError:function(appName){$c("#"+appName+"-adduser-error").addClass("hide")},validate:function(param,appName){try{return AdminPanel.util.removeError(),"email"==param?(this.getEmail(),this.validateAllFields()):"apps"==param&&this.getApps(appName),!0}catch(e){return!1}},validateAllFields:function(isEmailEdit,appName){var id="add-user-error";"#crmplus-dialog"==Common.htmlContext&&(id="crmplus-dialog-error");var error=$j("#"+id).text().trim();if(error){if(appName){if($c("#crmplus-apps-adduser-container").is(":visible")&&0==$c("#crmplus-apps-adduser-container .zcrmp-usrComp").length)return;var appJSON=DataTemplates.member.getAppData(appName,!0);if(appJSON.error)return}else{var errorType=$j("#"+id).attr("error-type");if("mandatoryFields"==errorType||"noAppPicked"==errorType)try{this.getApps(void 0,!0)}catch(e){if(errorType==e.type)return}else if("invalidEmail"==errorType)try{this.getEmail()}catch(e){return}}$j("#"+id).text("")}},getIdentifier:function(){return $c("#crmplus-member-identifier").val()},validateCurrentAppFields:function(event){var appName=event.target.getAttribute("appName"),isAppChecked=!1,skipValidation=!1;if(void 0!=appName&&appName&&(isAppChecked=$c("#adduser-"+appName+"-check").prop("checked"),skipValidation="true"==$c("#"+appName+"-adduser-li").attr("skip_validation"),!isAppChecked&&!skipValidation)){var appData=DataTemplates.member.getAppData(appName,!0,!0);void 0!=appData&&void 0==appData.error&&$c("#adduser-"+appName+"-check").prop("checked",!0)}},getAdminJSON:function(data,appName,callback){var json={},appProp=AdminPanel.appProperties.get(appName);if(json.app_name=appName,json.zaaid=DataTemplates.member.getSOID(appName),json.is_light_user=!1,json.is_service_admin=!1,appProp.has_role_specific_fields)json.is_admin=!0;else if(data&&data.role_id)json.role_id=data.role_id;else if(appProp.is_custom_roles){var adminLiElement=$j("#"+appName+"-roles-options li[iam-sorg-role=2]:not([hidden-role])")[0];adminLiElement||(adminLiElement=$j("#"+appName+"-roles-options li[old-role-id=1]:not([hidden-role])")[0]),adminLiElement||(adminLiElement=$j("#"+appName+"-role-tree a")[0]),adminLiElement&&(json.role_id=adminLiElement.getAttribute("role-id")),json.is_service_admin=!0}else appProp.multiple_admins_allowed?(json.role_id=AdminPanel.authRoles.defaultRoleId.admin,json.is_service_admin=!0):json.role_id=AdminPanel.authRoles.defaultRoleId.nonadmin;if(appProp.has_profiles)if(data&&data.profile_Id)json.profile_Id=data.profile_Id;else{var adminLiElement=$j("#"+appName+"-profile-options li[iam-sorg-role=2]:not([hidden-profile])")[0];adminLiElement&&(json.profile_id=adminLiElement.getAttribute("profile-id"))}return appProp.has_territories&&data&&(json.territories=data.territories),appProp.has_reporting_to&&data&&(json.reportingto_zuid=data.reportingto_zuid,json.reportingto_email=data.reportingto_email),appProp.has_departments&&!appProp.select_all_departments_for_admin&&(json.departments=data&&data.departments?data.departments:DataTemplates.accountInfo.getDepartments(appName,appProp.department_specific_field,!0)),callback?void callback(json):json}},DataTemplates.accountInfo={populate:function(appName,data,throwError){try{this.data=data,this.app=appName,this.setMemberIdentifier();
var isCustomRole=!1,appProp=AdminPanel.appProperties.get(appName);if(appProp.has_role_specific_fields){var is_agent=this.data.is_agent,is_light_user=this.data.is_light_user,is_admin=this.data.is_admin;is_agent?($c("#"+appName+"-role-agent").prop("checked",!0),this.setProperty("agent",this.data.access_to)):is_light_user?$c("#"+appName+"-role-lightagent").prop("checked",!0):is_admin?$c("#"+appName+"-role-admin").prop("checked",!0):($c("#"+appName+"-role-custom").prop("checked",!0),$c("#"+appName+"-role-custom-options").show(),isCustomRole=!0),is_agent||$c("#"+appName+"-role-agent-options").hide()}if((!appProp.has_role_specific_fields||appProp.has_role_specific_fields&&isCustomRole)&&this.setRole(),appProp.has_profiles&&(!appProp.has_role_specific_fields||appProp.has_role_specific_fields&&isCustomRole)&&this.setProfile(),appProp.has_departments){var roleLi=$c("#"+appName+"-roles-options li[role-id="+this.data.role_id+"]")[0],isSelectAllDepartments=!1;roleLi&&(isSelectAllDepartments="true"==roleLi.getAttribute("all_departments_selected")),isSelectAllDepartments||this.setDepartments(appProp.department_specific_field)}appProp.has_territories&&this.setTerritories(),appProp.has_reporting_to&&this.setReportingTo(),appProp.can_monitor_user&&(this.data.role_id!=AdminPanel.authRoles.defaultRoleId.admin&&this.data.monitor_user&&$c("#"+appName+"-monitor-user").prop("checked",!0),$c("#"+appName+"-monitor-cont").hide())}catch(e){if(throwError)throw e}hidePanel()},setRole:function(){var roleID=this.data.role_id,oldRoleID=this.data.old_role_id;if(!roleID)throw new exception("Role Id not present");var appProp=AdminPanel.appProperties.get(this.app);appProp.has_role_hierarchy?$j("#"+this.app+"-role-tree #role-"+roleID+" a[role-id="+roleID+"]").click():oldRoleID?$c("#"+this.app+"-roles-options li[old-role-id="+oldRoleID+"]").click():$c("#"+this.app+"-roles-options li[role-id="+roleID+"]").click()},setProfile:function(){var profileID=this.data.profile_id,oldProfileID=this.data.old_profile_id,IdName="profile-id";if(oldProfileID&&(IdName="old-profile-id",profileID=oldProfileID),!profileID)throw new exception("Profile Id not present");this.setProperty("profile",profileID,IdName)},setDepartments:function(include){if(!this.data.departments)throw new exception("departments not present");var departments=this.data.departments;for(var index in departments){var department=departments[index],depID=department.department_id;if($c("#"+this.app+"-dep-"+depID+"-check").click(),"role"==include){var depRole=department.role_id;$c("#"+this.app+"-dep-"+depID+" li[role-id="+depRole+"]").click()}if("chat"==include){var chatStatus=department.chat_enabled;chatStatus&&$c("#"+this.app+"-dep-"+depID+"-chat").prop("checked",!0)}}},setProperty:function(property,value,id){void 0==id&&(id=property+"-id"),$c("#"+this.app+"-"+property+"-options li["+id+"="+value+"]").click()},setMemberIdentifier:function(identifier){var parentCont=void 0;void 0===identifier?(this.data.hasOwnProperty("email_id")?identifier=this.data.email_id:this.data.hasOwnProperty("zuid")&&(identifier=this.data.zuid),parentCont=$c("#"+this.app+"-account-info")):parentCont=$c("#crmplus-dialog-body"),$c("<input>").attr({type:"hidden",id:"crmplus-member-identifier",value:identifier}).appendTo(parentCont)},setTerritories:function(territories){void 0==territories&&(territories=this.data.territories);var parentDiv=$c("#crm-territories-input-div");if(0!=parentDiv.length){if(parentDiv.html(""),!territories||0==territories.length){var span=$j("#crmplus-adminpanel-templates #crm-territories-input-div").html();return void $c("#crm-territories-input-div").append(span)}for(index in territories){var territory=territories[index],territoryId=territory.territory_id,canEdit=territory.has_permission,territoryLi=$j("#territory-"+territoryId+"-checkbox"),parentName=territoryLi.attr("parent-territory-name"),childName=territoryLi.attr("territory-name");if(childName){var component=createElement("div");parentName?parentName+=" &#187; ":parentName="",canEdit?(component.innerHTML=parentName+childName+'<i title="Remove" onclick="AdminPanel.territories.remove(event);" class="zcrmp-terrClse"></i>',component.setAttribute("class","zcrmp-territTags")):(component.innerHTML=parentName+childName+'<i title="'+I18N.getValue("crmplus.error.territory_manager")+'" onclick="event.stopPropagation();" class="zcrmp-terrClse"></i>',component.setAttribute("class","zcrmp-notallowed zcrmp-territTags")),component.setAttribute("territoryId",territoryId),component.setAttribute("canEdit",canEdit),parentDiv.append(component)}}Common.setScroll(Common.htmlContext.substr(1)+" #crm-territories-input-div")}},setReportingTo:function(reportingToZuid,reportingToEmail){var reportingToList=void 0;reportingToZuid||reportingToEmail||!this.data.reporting_manager||(reportingToZuid=this.data.reporting_manager.zuid,reportingToEmail=this.data.reporting_manager.email,reportingToList=this.data.reportingToList),reportingToList&&AdminPanel.reportingTo.populate(reportingToList),reportingToZuid?$c("#user-"+reportingToZuid).click():reportingToEmail&&$c('#crm-reportingto-popup div[identifier="'+reportingToEmail+'"]').click()},getDepartments:function(appName,include){var departments=[],departmnetElements=$j("#admin-panel-data-temp #"+appName+"-department-cont .js-apps-dept");return departmnetElements.each(function(){var department={};if(department.department_id=this.getAttribute("dept-id"),void 0!=include&&""!=include){var selector="#"+appName+"-dep-"+department.department_id+"-"+include;"role"==include?department.role_id=this.querySelector(selector).getAttribute(include+"-id"):"chat"==include&&(department.chat_enabled=this.querySelector(selector).checked)}departments.push(department)}),departments},pickAdminRole:function(appName,isRemoveSelectedFields){var tooltipMessage=I18N.getValue("crmplus.error.non_admin"),appProp=AdminPanel.appProperties.get(appName);if(appProp.has_role_specific_fields){$c("#"+appName+"-role-admin").click();var container=$c("#"+appName+"-roles");$c("#"+appName+"-role-agent-options").hide(),isRemoveSelectedFields?container.remove():(container.addClass("disabled"),container.parent().attr("id")!="temp-wrap-"+appName&&container.wrap("<div onmouseover=\"tooltip('"+tooltipMessage+'\',event)" id="temp-wrap-'+appName+'" style="display: inline-block;"></div>'))}else{var field=null,adminLiElement=null,adminLiElement=null;if(appProp.has_profiles&&!appProp.has_role_specific_fields?(field="profile",adminLiElement=$c("#"+appName+"-profile-options li[iam-sorg-role=2]")[0]):(field="role",adminLiElement=$c("#"+appName+"-roles-options li[iam-sorg-role=2]")[0]),adminLiElement){var inputElement=$c("#"+appName+"-"+field);inputElement.attr(field+"-id",adminLiElement.getAttribute(field+"-id")),inputElement.val(adminLiElement.textContent);var parent=inputElement.parent();isRemoveSelectedFields?parent.parent().remove():(parent.addClass("disabled"),parent.prev().addClass("disabled"),parent.parent().attr("id")!="temp-wrap-"+appName&&parent.wrap("<div onmouseover=\"tooltip('"+tooltipMessage+'\',event)" id="temp-wrap-'+appName+'" style="display: inline-block;"></div>')),"true"==adminLiElement.getAttribute("select-all")&&($c("#"+appName+"-department-cont").addClass("zcrmp-custView"),$c("#"+appName+"-applyall").addClass("hide")),appProp.can_monitor_user&&$c("#"+appName+"-monitor-cont").addClass("zcrmp-custView")}}}},Loading.global={start:function(){showLoading()},stop:function(){hideLoading()}},Loading.button={start:function(params){var id=params.id;$j("#"+id).addClass("loading"),$j("#"+id+" span").hide()},stop:function(params){var id=params.id;$j("#"+id).removeClass("loading"),setTimeout(function(){$j("#"+id+" span").show()},180)}},Loading.component={start:function(params){var id=params.id;if(params.siblingClass){var siblingsClass=params.siblingClass;$j("."+siblingsClass).hide()}$j("#"+id).show()},stop:function(params){var id=params.id;$j("#"+id).hide()}},Loading.input={start:function(params){var id=params.id;$j("#"+id).addClass("load")},stop:function(params){var id=params.id;$j("#"+id).removeClass("load")}},Loading.iframe={start:function(){$j("#iframeLoading").fadeIn()},stop:function(){$j("#iframeLoading").fadeOut("fast")}},Loading.paginate={start:function(params){var id=params.id;$j("#"+id+"-span").hide(),$j("#"+id).show()},stop:function(params){var id=params.id;$j("#"+id).hide(),"loadingusers"==id&&"-1"!=$j("#adminPanelContBody").attr("pageno")&&$j("#"+id+"-span").show()}},CRMPlusForm={init:function(formId){for(var elements=document.getElementById(formId),i=0;i<elements.length;i++)CRMPlusInputField.init(elements[i])}},CRMPlusInputField={init:function(inputElement){Common.addEventListener(inputElement,"keyup",CRMPlusInputField.onKeyUp)},onKeyUp:function(event){var element=getTargetElementFromEvent(event),jElement=$j(element),id=jElement.attr("id");$j("#"+id+"msg").remove()},addErrorMessage:function(id,type,message){var message,idForMsg=id+"msg",inpuElement=$j("#"+id),msgElement=$j("#"+idForMsg);if(0==msgElement.length){var msgElement=$j("<span>");msgElement.attr("id",idForMsg),msgElement.addClass("redTxt"),msgElement.insertAfter(inpuElement)}if(void 0==message){var errorMessageInputArray=this.getInputsForErrorMessage(id,type);message=I18N.getValue("js.validator."+type+".msg",errorMessageInputArray)}msgElement.text(message),msgElement.show()},getInputsForErrorMessage:function(id,type){var element=$j("#"+id),inputArray=[];return("empty"==type||"website"==type||"length"==type)&&inputArray.push(element.attr("displayName")),"length"==type&&inputArray.push(element.attr("length")),inputArray}},CRMPlusRegEx={phone:/^[0-9\-\(\)\.\+\s]*$/,website:/^(([A-Za-z]+:\/\/)?[A-Za-z0-9-_]+\.[A-Za-z0-9-_%&?\/.=]+)?$/,zip:/^([a-zA-Z0-9\ \-])*$/},CRMPlusRegEx={phone:/^[0-9\-\(\)\.\+\s]*$/,website:/^(([A-Za-z]+:\/\/)?[A-Za-z0-9-_]+\.[A-Za-z0-9-_%&?\/.=]+)?$/,zip:/^([a-zA-Z0-9\ \-])*$/},CRMPlusValidator={functionMapForType:{phone:"isPhoneNumber",website:"isWebSite",zip:"isZipCode"},isValidInputField:function(inputElement,canAddErrorMessage){void 0==canAddErrorMessage&&(canAddErrorMessage=!0);var jInputElement=$j(inputElement),value=jInputElement.val(),canBeEmpty=jInputElement.attr("canbeempty");if("false"==canBeEmpty&&this.isEmpty(value))return CRMPlusInputField.addErrorMessage(jInputElement.attr("id"),"empty"),!1;var maxLength=jInputElement.attr("length");if(void 0!==maxLength&&void 0!=value&&""!=value.trim()){var strLength=value.length;if(strLength>maxLength)return CRMPlusInputField.addErrorMessage(jInputElement.attr("id"),"length"),!1}var type=jInputElement.attr("inputtype");if(void 0!=type){var functionName=CRMPlusValidator.functionMapForType[type];if(void 0!==functionName){var functionRef=CRMPlusValidator[functionName];if(void 0!==functionRef){var isValid=functionRef(value);if(!isValid)return CRMPlusInputField.addErrorMessage(jInputElement.attr("id"),type),!1}}}return!0},isEmpty:function(value){return void 0==value||""==value.trim()?!0:!1},isPhoneNumber:function(value){if(void 0===value)return!1;var regex=CRMPlusRegEx.phone;return regex.test(value)},isWebSite:function(value){if(void 0===value)return!1;var regex=CRMPlusRegEx.website;return regex.test(value)},isZipCode:function(value){if(void 0===value)return!1;var regex=CRMPlusRegEx.zip;return regex.test(value)}};var CRMPlusUnifiedSearch={isFilterClick:!1,lastService:void 0,loadView:function(){TopBar.type="search",Services.currentTopBarType=TopBar.type,CRMPlusUnifiedSearch.initTopBar("search",Services.currentView),$j("#"+Services.currentView+"commonuileftpanelswitch").removeClass("selected"),$j("#searchcommonuileftpanelswitch").show(),$j("#searchcommonuileftpanelswitch").addClass("selected"),CRMPlusCommonUi.handleWindowSize(),CRMPlusCommonUi.search.UIType="fullview",$j("#crmpluscommonuisearchtext").focus()},initTopBar:function(type,serviceName){"search"==TopBar.type&&(TopBar.previousType=type,$j("#crmpluscommonuitopbarservicemainview").hide(),$j("#crmpluscommonuimoduleanddepartmentdiv").hide(),$j("#crmpluscommonuitopbaroptions").hide(),$j("#commonuimodulelistdiv").hide(),$j("#crmpluscommonuisetupbar").hide(),$j("#crmpluscommonuisetupbarold").hide(),$j("#crmpluscommonuiclose").hide(),$j("#crmpluscommonuitopbar").removeClass("zcrmp-setupView"),$j("#crmpluscommonuitopbartemplate").hide(),$j("#crmpluscommonuisearchview").show(),$j("#crmplusUnifiedAdvancedSearchSwitch").hide(),$j("#crmplusUnifiedSearchFiltersParent div[id$='FilterList']").hide(),$j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked",!1),CRMPlusUnifiedSearch.handleProfileIcon(),$(serviceName+"LoadFrame")&&CRMPlusUnifiedSearch.constructNewSearchTopBar(serviceName),$j("#crmplusUnifiedSearch"+serviceName+"FiltersList [id$='FilterList']").show(),$j("#"+serviceName+"_advancedmoduleFilterList").hide(),$j("#crmplusUnifiedSearchFilterByServicesul>li").removeClass("selected"),$j("#crmplusUnifiedSearchFilterByServicesli"+serviceName).addClass("selected"))},constructNewSearchTopBar:function(serviceName){if($j("#crmplusUnifiedSearchFilterByService").text(I18N.getValue("service.title."+serviceName)),void 0!==CRMPlusCommonUi.searchData[serviceName]){var searchData=void 0;null!==CRMPlusCommonUi.searchData[serviceName]&&(searchData=CRMPlusCommonUi.searchData[serviceName],CRMPlusUnifiedSearch.constructSearchFilterUI(searchData.filter,serviceName,"normal"),void 0!=searchData.advancedsearch&&($j("#crmplusUnifiedAdvancedSearchSwitch").show(),CRMPlusUnifiedSearch.constructSearchFilterUI(CRMPlusCommonUi.searchData[serviceName].advancedsearch.filter,serviceName,"advanced"),CRMPlusUnifiedSearch.handleAdvancedSearchToggle(serviceName,void 0,!1),Common.addClickEventListener("#crmplusUnifiedAdvancedSearchSwitchInput",CRMPlusUnifiedSearch.handleAdvancedSearchToggle,[serviceName,"#event#"],CRMPlusUnifiedSearch)))}},constructSearchFilterUI:function(filters,serviceName,searchType){if(void 0!=filters){for(var filtersIndex in filters){var filter=filters[filtersIndex],type=filter.type;if(void 0==type)return;var filterName=filter.key,filterLabel=filter.label;if(0==$j("#"+serviceName+"_"+filterName+"FilterList").length){var parentdiv=document.createElement("div");$j(parentdiv).attr("id",serviceName+"_"+filterName+"FilterList"),$j(parentdiv).addClass("zcrmp-fltrDD hide"),$j("#crmplusUnifiedSearch"+serviceName+"FiltersList").append(parentdiv),void 0==filterLabel&&(filterLabel=I18N.getValue("crmplus.search."+filterName.toLowerCase()));var innerdiv="<span class='zcrmp-filterLabel'>"+escapeHtml(filterLabel)+"&nbsp;:&nbsp;</span><span class='pointer' id='filterDropDown'><span class='ellipsis' id='"+serviceName+"_"+filterName+"Label' onmouseenter='CRMPlusUnifiedSearch.handleTooltipForFilters(event);'></span><i class='plus-arrow_drop_down'></i></span><div class='zcrmp-serSubModList clearFix selected hidepop' id='searchFilterBy"+serviceName+"_"+filterName+"div'></div>";if($j("#"+serviceName+"_"+filterName+"FilterList").html(innerdiv),Common.addClickEventListener("#"+serviceName+"_"+filterName+"FilterList span[id='filterDropDown']",CRMPlusUnifiedSearch.showFilter,[serviceName,filterName,"#event#"]),0==$j("#ulSearch_"+serviceName+"_"+filterName.replace(/[\s.]/g,"")).length){var liElement,className="zcrmp-smart"+type,name="liSearchName"+serviceName+"_"+filterName.replace(/[\s.]/g,""),parentUL=document.createElement("ul");if($j(parentUL).addClass("radio"==type?"clearFix zcrmp-serDeprtmntList":"clearFix zcrmp-serDeprtmntList zcrmp-modfltrli"),$j(parentUL).attr("id","ulSearch_"+serviceName+"_"+filterName.replace(/[\s.]/g,"")),$j(parentUL).attr("type",searchType),$j(parentUL).attr("style","max-height: 300px; overflow: auto; width: auto;"),$j("#searchFilterBy"+serviceName+"_"+filterName+"div").html(parentUL),filter.list.length>8){var searchdiv='<div class="zcrmp-DeprtSrchViw" id="crmplusCommonUiMoreFilterSearch"><input id="crmplusCommonUiMoreFilterSearchBox" type="text" autocomplete="off" placeholder="Search" onkeyup=CRMPlusUnifiedSearch.searchMoreFilterList(this.value,"'+serviceName+'","'+filterName+'"); onmouseover="this.focus()" onclick="Common.stopEvents(event);"><i class="plus-search2"></i></div><div id="crmplusCommonUiMoreFilterSearchNoData" class="txtCenter greyTxt pT20 pB20 f13 hide">No module found</div>';$j("#ulSearch_"+serviceName+"_"+filterName.replace(/[\s.]/g,"")).append(searchdiv)}if("checkbox"===type){liElement=document.createElement("li");var idForAllFilter=name.replace(/[\s.]/g,"")+"_allfilter";$j(liElement).addClass(className);var inputHtml="<label for="+escapeHtml(idForAllFilter)+"><input type="+escapeHtml(type)+" id="+escapeHtml(idForAllFilter)+" ><i>"+I18N.getValue("crmplus.common.all")+"</i></label>";$j(liElement).html(inputHtml),$j(parentUL).append(liElement),$j("#"+idForAllFilter).attr("filterGroup",filterName),$j("#"+idForAllFilter).attr("allfilter","true")}for(var index in filter.list){var filterElements=filter.list[index];liElement=document.createElement("li"),"radio"!=type&&$j(liElement).addClass(className);var id=name+"_"+filterElements.key.replace(/[\s.]/g,""),idForLi="liSearch_"+serviceName+"_"+filterName.replace(/[\s.]/g,"")+"_"+filterElements.key.replace(/[\s.]/g,"");$j(liElement).attr("id",idForLi);var inputHtml="";"radio"===type?($j(liElement).attr("filterGroup",filterName),$j(liElement).attr("filterKey",filterElements.key),$j(liElement).attr("type",type),$j(liElement).html(escapeHtml(filterElements.label))):(inputHtml="<label for="+escapeHtml(id)+"><input type="+escapeHtml(type)+" name="+escapeHtml(name)+" id="+escapeHtml(id)+" ><i>"+escapeHtml(filterElements.label)+"</i></label>",$j(liElement).html(inputHtml)),$j(parentUL).append(liElement),$j("#"+id).attr("filterGroup",filterName),$j("#"+id).attr("filterKey",filterElements.key),void 0!==filterElements.disabledFilters&&$j(liElement).prop("disabledFilters",filterElements.disabledFilters)}}Common.addClickEventListener("#searchFilterBy"+serviceName+"_"+filterName+"div",CRMPlusCommonUi.search.handleClickOnFilters,[serviceName,"#event#"],CRMPlusCommonUi.search),$j("#"+serviceName+"_"+filterName+"FilterList").show()}}try{""==document.getElementById("crmplusUnifiedSearch"+serviceName+"FiltersList").innerHTML&&$j("#crmplusUnifiedSearch"+serviceName+"FiltersList").hide()}catch(e){}}},showFilter:function(serviceName,filterName,event){showPanel("searchFilterBy"+serviceName+"_"+filterName+"div",void 0,"translate-y",!1,event),$j("#crmplusUnifiedSearch"+serviceName+"FiltersList input[id='crmplusCommonUiMoreFilterSearchBox']").val(""),$j("#ulSearch_"+serviceName+"_"+filterName+" li").show()},handleProfileIcon:function(){CRMPlusCommonUi.isLeftPanelVisible&&$j("#crmpluscommonuiservicelistscrolldiv").length>0?($j("#prfileicon2").removeClass("hide"),$j("#crmplusUnifiedSearchClose").addClass("hide")):($j("#crmplusUnifiedSearchClose").removeClass("hide"),$j("#prfileicon2").addClass("hide"))},handleClickOnService:function(serviceName,event){$j("#crmpluscommonuisearchtext").val().trim().length<2||(event&&Common.stopEvents(event,!0),hidePanel(),serviceName!=Services.currentView&&(0==CRMPlusCommonUi.search.canSearch[serviceName]?CRMPlusUnifiedSearch.lastService=serviceName:Services.showLoading(serviceName,"iframe-spinner"),$j("#crmplusUnifiedSearchInputParent").removeClass("zcrmp-addisabled"),$j("#crmplusUnifiedSearchFilterByServicesul>li").removeClass("selected"),$j("#crmplusUnifiedSearchFilterByServicesli"+serviceName).addClass("selected"),CRMPlusUnifiedSearch.isFilterClick=!0,Services.getRedirectionUrl(serviceName,!0,!1,void 0,"iframe-spinner"),$j("#searchcommonuileftpanelswitch").show(),$j("#"+Services.currentView+"commonuileftpanelswitch").removeClass("selected"),$j("#searchcommonuileftpanelswitch").addClass("selected"),CRMPlusCommonUi.handleWindowSize(),CRMPlusUnifiedSearch.initTopBar("search",serviceName)))},handleClickOnFilters:function(serviceName,event){var clickedFilterKey=void 0,clickedFilterGroupKey=void 0;if(void 0!==event){var element=getTargetElementFromEvent(event);if("radio"==$j(element).attr("type"))"LI"==element.nodeName&&($j(element).parent().find("li").removeClass("selected"),$j(element).addClass("selected"),event.stopPropagation(),hidePanel());else{if("INPUT"!==element.nodeName)return;event.stopPropagation();var isAllFilterClicked=$j(element).attr("allfilter");if("true"==isAllFilterClicked){var filtergroup=$j(element).attr("filterGroup"),isChecked=$j(element).prop("checked");CRMPlusUnifiedSearch.handleClickOnAllFilterCheckBox(serviceName,filtergroup,isChecked)}}clickedFilterKey=$j(element).attr("filterKey"),clickedFilterGroupKey=$j(element).attr("filterGroup"),CRMPlusUnifiedSearch.handleAllFilterCheckBox(serviceName,clickedFilterGroupKey)}void 0!==clickedFilterKey&&($j("#crmplusUnifiedSearch"+serviceName+"FiltersList [id$='FilterList']").removeClass("zcrmp-canttouch"),CRMPlusCommonUi.search.handleUnAvailableFilters(serviceName,clickedFilterKey,clickedFilterGroupKey));var searchText=$j.trim($j("#crmpluscommonuisearchtext").val()),isAdvancedSearch=!1;if(1==$j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked")&&(isAdvancedSearch=!0),""!==searchText||isAdvancedSearch){try{document.getElementById("crmplusCommonUiMoreFilterSearchBox").select()}catch(e){}0!=CRMPlusUnifiedSearch.canSearch&&CRMPlusCommonUi.search.triggerSearch(serviceName,searchText)}},handleClickOnAllFilterCheckBox:function(serviceName,filterGroup,ischecked){{var id="ulSearch_"+serviceName+"_"+filterGroup.replace(/[\s.]/g,"");"liSearchName"+serviceName+"_"+filterGroup.replace(/[\s.]/g,"")}ischecked?$j("#"+id+" input").prop("checked",!0):$j("#"+id+" input").prop("checked",!1)},handleAllFilterCheckBox:function(serviceName,filterGroup){var id="ulSearch_"+serviceName+"_"+filterGroup.replace(/[\s.]/g,""),name="liSearchName"+serviceName+"_"+filterGroup.replace(/[\s.]/g,""),checkedfilters=$j("#"+id+' input[name="'+name+'"]:checked'),allFilters=$j("#"+id+' input[name="'+name+'"]');if(checkedfilters.length==allFilters.length&&void 0==$j("#"+id+" li").attr("type"))$j("#"+name+"_allfilter").prop("checked",!0),$j("#"+serviceName+"_"+filterGroup+"Label").text(I18N.getValue("crmplus.search.allmodules"));else{$j("#"+name+"_allfilter").prop("checked",!1);var searchJson=CRMPlusUnifiedSearch.getCurrentCheckedFiltes(serviceName),label="";for(var key in searchJson.filter[filterGroup])label+=$j("#liSearch_"+serviceName+"_"+filterGroup+"_"+searchJson.filter[filterGroup][key]).text()+", ";label=label.substring(0,label.length-2),""!=label&&$j("#"+serviceName+"_"+filterGroup+"Label").text(label)}},handleAdvancedSearchToggle:function(serviceName,event,canTriggerSearch){if(void 0===canTriggerSearch&&(canTriggerSearch=!0),void 0!==event){event.stopPropagation();var element=getTargetElementFromEvent(event);if("INPUT"!==element.nodeName)return}var toggleObject=$j("#crmplusUnifiedAdvancedSearchSwitchInput");toggleObject.prop("checked")===!0?("popup"==CRMPlusCommonUi.search.UIType&&(CRMPlusCommonUi.search.hideSearchPopUp(),CRMPlusUnifiedSearch.loadView(),$j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked",!0),CRMPlusUnifiedSearch.handleAdvancedSearchToggle(serviceName),$j("#crmpluscommonuisearchtext").blur()),$j("#crmplusUnifiedSearchInputParent").addClass("zcrmp-addisabled"),$j("#crmplusUnifiedSearch"+serviceName+"FiltersList [id$='FilterList']").hide(),$j("#"+serviceName+"_advancedmoduleFilterList").show(),CRMPlusUnifiedSearch.handleAllFilterCheckBox(serviceName,"advancedmodule")):($j("#crmplusUnifiedSearchInputParent").removeClass("zcrmp-addisabled"),$j("#crmplusUnifiedSearch"+serviceName+"FiltersList [id$='FilterList']").show(),$j("#"+serviceName+"_advancedmoduleFilterList").hide()),canTriggerSearch&&CRMPlusUnifiedSearch.handleClickOnFilters(serviceName)},getCurrentCheckedFiltes:function(serviceName){var searchJson={},isAdvancedSearch=!1;if(1==$j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked")&&(isAdvancedSearch=!0),void 0!==CRMPlusCommonUi.searchData[serviceName]&null!==CRMPlusCommonUi.searchData[serviceName]){searchJson.isAdvancedSearch=isAdvancedSearch;var allfilter;if(allfilter=isAdvancedSearch?CRMPlusCommonUi.searchData[serviceName].advancedsearch.filter:CRMPlusCommonUi.searchData[serviceName].filter,void 0!==allfilter){var filterJson={};for(var index in allfilter){var currentFilterName=allfilter[index].key,checkedfilterArray=[],currentFilterUIName="liSearchName"+serviceName+"_"+currentFilterName.replace(/[\s.]/g,""),parentFilterId="searchFilterBy"+serviceName+"_"+currentFilterName+"div",checkedfilters=[];checkedfilters=$j(void 0!=$j("#"+parentFilterId+" li").attr("type")&&"radio"==$j("#"+parentFilterId+" li").attr("type")?"#ulSearch_"+serviceName+"_"+currentFilterName.replace(/[\s.]/g,"")+" li.selected":"#"+parentFilterId+' input[name="'+currentFilterUIName+'"]:checked');for(var checkedfilterindex=0;checkedfilterindex<checkedfilters.length;checkedfilterindex++){var filterKey=($j(checkedfilters[checkedfilterindex]).attr("id"),$j(checkedfilters[checkedfilterindex]).attr("filterKey"));checkedfilterArray.push(filterKey)}checkedfilterArray.length&&(filterJson[currentFilterName]=checkedfilterArray)}searchJson.filter=filterJson}}return searchJson},handleDefaultCheckedFilters:function(serviceName,checkedFilters){if(serviceName===Services.currentView){if(CRMPlusCommonUi.search.canShowFilters=!0,"popup"!=CRMPlusCommonUi.search.UIType){var searchJson=JSON.parse(sessionStorage.getItem("searchJson"+serviceName));if(null!=searchJson){var previousFilter=searchJson.filter;for(var filter in checkedFilters)(!previousFilter.hasOwnProperty(filter)||"search"!=TopBar.type&&void 0!=previousFilter[filter]&&previousFilter[filter]!=checkedFilters[filter])&&(previousFilter[filter]=checkedFilters[filter]);previousFilter.advancedSearch=searchJson.isAdvancedSearch,checkedFilters=previousFilter,"search"!=TopBar.type&&(searchJson.filter=previousFilter,sessionStorage.setItem("searchJson"+serviceName,JSON.stringify(searchJson)))}}var filter;for(filter in checkedFilters){var filterArray=checkedFilters[filter];$j("#"+serviceName+"_"+filter+"FilterList input").prop("checked",!1);for(var index=0;index<filterArray.length;index++){var filterkey=filterArray[index],id="liSearchName"+serviceName+"_"+filter.replace(/[\s.]/g,"")+"_"+filterkey.replace(/[\s.]/g,"");void 0===$j("#"+id).attr("type")?($j("#liSearch_"+serviceName+"_"+filter.replace(/[\s.]/g,"")+"_"+filterkey.replace(/[\s.]/g,"")).siblings().removeClass("selected"),$j("#liSearch_"+serviceName+"_"+filter.replace(/[\s.]/g,"")+"_"+filterkey.replace(/[\s.]/g,"")).addClass("selected")):$j("#"+id).prop("checked",!0),CRMPlusUnifiedSearch.handleUnAvailableFilters(serviceName,filterkey,filter)}CRMPlusUnifiedSearch.handleAllFilterCheckBox(serviceName,filter)}checkedFilters.advancedSearch===!0?($j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked",!0),CRMPlusUnifiedSearch.handleAdvancedSearchToggle(serviceName,void 0,!1)):($j("#crmplusUnifiedAdvancedSearchSwitchInput").prop("checked",!1),CRMPlusUnifiedSearch.handleAdvancedSearchToggle(serviceName,void 0,!1)),CRMPlusCommonUi.search.show(serviceName,!1),CRMPlusCommonUi.search.canSearch[serviceName]!==!1&&CRMPlusUnifiedSearch.handleClickOnFilters(Services.currentView)}},handleUnAvailableFilters:function(serviceName,clickedFilterKey,clickedFilterGroupKey){var liElement=$j("#liSearch_"+serviceName+"_"+clickedFilterGroupKey.replace(/[\s.]/g,"")+"_"+clickedFilterKey.replace(/[\s.]/g,"")),disabledFilters=liElement.prop("disabledFilters");if(void 0!==disabledFilters){$j("#crmplusUnifiedSearch"+serviceName+'FiltersList [id$="FilterList"]').removeClass("zcrmp-canttouch");for(var i=0;i<disabledFilters.length;i++)$j("#"+serviceName+"_"+disabledFilters[i]+"FilterList").addClass("zcrmp-canttouch")}},handleMouseOver:function(event){$j("#crmplusUnifiedSearchInputParent").hasClass("zcrmp-addisabled")&&tooltip(I18N.getValue("crmplus.search.advancedon"),event)},handleTooltipForFilters:function(event){var element=getTargetElementFromEvent(event),label=$j(element).text();$j(element)[0].getBoundingClientRect().width>=100&&tooltip(label,event)},clickHandlerForResults:function(){var serviceName=CRMPlusUnifiedSearch.lastService,searchJson=JSON.parse(sessionStorage.getItem("searchJson"+serviceName));null!=searchJson&&""==$j("#crmpluscommonuisearchtext").val()&&$j("#crmpluscommonuisearchtext").val(searchJson.searchString),CRMPlusCommonUi.search.canSearch={},CRMPlusUnifiedSearch.isResultClick=!0,Services.hideOverViewPage(),CRMPlusUnifiedSearch.loadView(),Services.showLoading(serviceName,"iframe-spinner"),Services.loadFrame(serviceName),CRMPlusUnifiedSearch.isResultClick=!1},searchMoreFilterList:function(searchString,serviceName,filterName){var isMatched=!1;$j("#crmplusCommonUiMoreFilterSearchNoData").addClass("hide"),$j("#ulSearch_"+serviceName+"_"+filterName+" > li").each(function(index,li){var label=$j(li).find("i:first").text();"radio"==$j("#ulSearch_"+serviceName+"_"+filterName+" li").attr("type")&&(label=$j(li).text()),-1===label.toLocaleUpperCase().indexOf(searchString.toLocaleUpperCase())?$j(li).hide():(isMatched=!0,$j(li).show())}),isMatched||$j("#crmplusCommonUiMoreFilterSearchNoData").removeClass("hide")},handleEmptySearchText:function(event){$j("#crmpluscommonuisearchtext").val().trim().length<2&&tooltip(I18N.getValue("crmplus.error.searchminimum"),event)},showServiceFilter:function(event){$j("#crmpluscommonuisearchtext").val().trim().length>=2&&showPanel("crmplusUnifiedSearchFilterByServicesdiv",void 0,"translate-y",!1,event)}};